+ [author](http://nsddd.top)

# 第32节 kubernetes 目录结构

<div><a href = '31.md' style='float:left'>⬆️上一节🔗  </a><a href = '33.md' style='float: right'>  ⬇️下一节🔗</a></div>
<br>

> ❤️💕💕新时代拥抱云原生，云原生具有环境统一、按需付费、即开即用、稳定性强特点。Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## 分类

Kubernetes的代码都在kubernetes目录下，如图，根据功能主要分成以下几类：
 1、`文档类`（api、docs、logo）
 2、`工具类`（build、cluster、Godeps、hack、staging、translations）
 3、`代码类`（cmd、pkg、plugin、test、third_party）

工具类主要用到的build目录下的文件，自己动手编译的时候会用到； 

**核心代码集中在cmd和pkg中。**

cmd内部包含各个组件的入口，具体核心的实现部分在pkg目录下。

我们每一个 可执行文件都对应 cmd 



**关于其他目录：**

`plugin` 目录之前的版本包括 `scheduler` 部分的代码，当前版本（应该是在1.10之后）已经将scheduler部分代码移到和其他组件一致的 `pkg` 目录，所以目前 `plugin` 主要包含的是`认证`与`鉴权`部分的代码。



## 根目录

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree -L 1
.
├── api
├── build
├── CHANGELOG
├── CHANGELOG.md -> CHANGELOG/README.md
├── cluster
├── cmd
├── code-of-conduct.md
├── CONTRIBUTING.md
├── docs
├── go.mod
├── go.sum
├── hack
├── LICENSE
├── LICENSES
├── logo
├── Makefile -> build/root/Makefile
├── Makefile.generated_files -> build/root/Makefile.generated_files
├── _output
├── OWNERS
├── OWNERS_ALIASES
├── pkg
├── plugin
├── README.md
├── SECURITY_CONTACTS
├── staging
├── SUPPORT.md
├── test
├── third_party
└── vendor
```





## pkg

::: tip 
大量的 kubernetes 的源码所在，除了被抽离为单独组件的部分，例如 api server 的代码，proxy 组件的代码，kubelet 组件的代码。

+ 业务逻辑都在 pkg
+ 命令行参数都在 cmd

:::

**关于两个组件： `./pkg/api` 和 `./pkg/apis`**

::: warning 
Api 文件夹下包含和Open API 相关的模型定义等内容。

**名称不一样，作用是完全不一样的。**

+ 用于根据 OpenAPI 规范形成符合其规定的 API 

+ apis 是包含内建 API Groups 和 API Objects 的，而 scheme 相关的代码大部分在这里。

:::



```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree -L 1 pkg
pkg
├── api
├── apis
├── auth
├── capabilities
├── client
├── cloudprovider
├── cluster
├── controller
├── controlplane
├── credentialprovider
├── features
├── fieldpath
├── generated
├── kubeapiserver
├── kubectl
├── kubelet
├── kubemark
├── OWNERS
├── printers
├── probe
├── proxy
├── quota
├── registry
├── routes
├── scheduler
├── security
├── securitycontext
├── serviceaccount
├── util
├── volume
└── windows
```



### apis 目录的详解

**目录结构：**

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes/pkg/apis# tree -L 1
.
├── abac
├── admission
├── admissionregistration
├── apidiscovery
├── apiserverinternal
├── apps
├── authentication
├── authorization
├── autoscaling
├── batch
├── certificates
├── coordination
├── core
├── discovery
├── events
├── extensions
├── flowcontrol
├── imagepolicy
├── networking
├── node
├── OWNERS
├── policy
├── rbac
├── resource
├── scheduling
└── storage
```

在Kubernetes源码中，`core`目录和`apps`目录是两个不同的目录，用于存放不同的API对象。

+ `core`目录下存放的是基础的API对象，例如 Pod、Service、ReplicationController 等。这些API对象是Kubernetes的核心功能，提供了基本的调度、管理和监控功能。
+ `apps`目录下存放的是扩展的API对象，例如 Deployment、StatefulSet 等。这些API对象是对基础功能的扩展，提供了更多的调度、管理和监控功能。

总之，`core`目录和`apps`目录是用来存放不同类型的API对象的。如果你想了解某个特定的API对象的详细信息，可以在相应的目录下找到对应的文件。



**主要目录的解释：**

`pkg/apis`目录是Kubernetes源码中用于存放API对象的目录。这个目录中包含了很多子目录，每个子目录存放了不同类型的API对象。

这些子目录的名称通常由两部分组成，例如 `core/v1`、`apps/v1` 等。前面的部分表示API对象的类型，后面的部分表示API对象的版本。

下面是一些常见的子目录及其含义：

+ `core/v1`：这个目录下存放的是基础的API对象，例如 Pod、Service、ReplicationController 等。这些API对象是Kubernetes的核心功能，提供了基本的调度、管理和监控功能。
+ `apps/v1`：这个目录下存放的是扩展的API对象，例如 Deployment、StatefulSet 等

+ `batch/v1`：这个目录下存放的是批处理相关的API对象，例如 Job、CronJob 等。这些API对象主要用于执行批量任务，支持周期性执行、失败重试等功能。
+ `networking.k8s.io/v1`：这个目录下存放的是网络相关的API对象，例如 Ingress、Service 负载均衡器等。这些API对象主要用于提供集群内部及外部的网络访问能力。
+ `extensions/v1beta1`：这个目录下存放的是扩展的API对象，例如 Deployment、Ingress 等。这些API对象是对基础功能的扩展，提供了更多的调度、管理和监控功能。

这些子目录只是部分目录，Kubernetes中还有许多其他子目录，每个子目录存放的是不同类型的API对象。如果你想了解更多信息，可以在Kubernetes源码仓库中查看。

> 在Kubernetes源码中，API对象的定义一般都位于`pkg/apis`目录下。例如，Deployment对象的定义就位于`pkg/apis/apps/v1/deployment.go`文件中。
>
> 具体的位置可能会有所不同，但通常都在这个目录或其子目录下。如果你想查看某个特定的API对象的定义，你可以在Kubernetes源码仓库中搜索关键字，找到对应的文件。
>
> Pod对象的定义位于Kubernetes源码中的`pkg/apis/core/v1/pod.go`文件中。
>
> 这个文件中定义了Pod对象的所有字段，包括名称、命名空间、状态、容器列表等。如果你想了解Pod对象的更多细节，可以在这个文件中查看。



### 其他目录解释

`pkg/apis`目录下的这些子目录都是用于存放不同类型的API对象的。

+ `abac`目录存放的是授权和认证相关的API对象，例如 AttributePolicies、Policy 等。
+ `admission`目录存放的是入门相关的API对象，例如 AdmissionConfiguration、Webhook 等。
+ `admissionregistration`目录存放的是入门注册相关的API对象，例如 InitializerConfiguration、ValidatingWebhookConfiguration 等。
+ `apidiscovery`目录存放的是API发现相关的API对象，例如 APIGroup、APIResourceList 等。
+ `apiserverinternal`目录存放的是API服务器内部相关的API对象，例如 GroupResources、ServerResources 等。
+ `authentication`目录存放的是身份验证相关的API对象，例如 TokenReview、UserInfo 等。
+ `authorization`目录存放的是授权相关的API对象，例如 SelfSubjectAccessReview、SubjectAccessReview 等。
+ `autoscaling`目录存放的是自动伸缩相关的API对象，例如 HorizontalPodAutoscaler、Scale 等。
+ `certificates`目录存放的是证书相关的API对象，例如 CertificateSigningRequest、CertificateSigningRequestList 等。
+ `coordination`目录存放的是协调相关的API对象，例如 Lease、Lock 等。
+ `core`目录存放的是基础的API对象，例如 Pod、Service、ReplicationController
+ `discovery`目录存放的是发现相关的API对象，例如 EndpointSlice、ServiceAccountToken 等。
+ `events`目录存放的是事件相关的API对象，例如 Event、EventList 等。
+ `extensions`目录存放的是扩展的API对象，例如 Deployment、Ingress 等。
+ `flowcontrol`目录存放的是流量控制相关的API对象，例如 FlowSchema、FlowSchemaList 等。
+ `imagepolicy`目录存放的是镜像策略相关的API对象，例如 ImageReview、ImageReviewStatus 等。
+ `networking`目录存放的是网络相关的API对象，例如 Ingress、Service 负载均衡器等。
+ `node`目录存放的是节点相关的API对象，例如 Node、NodeList 等。
+ `OWNERS`目录存放的是OWNERS文件
+ `policy`目录存放的是策略相关的API对象，例如 PodDisruptionBudget、PodSecurityPolicy 等。
+ `rbac`目录存放的是基于角色的访问控制（RBAC）相关的API对象，例如 ClusterRole、RoleBinding 等。
+ `resource`目录存放的是资源相关的API对象，例如 ConfigMap、PersistentVolume 等。
+ `scheduling`目录存放的是调度相关的API对象，例如 PriorityClass、Scheduling 等。
+ `storage`目录存放的是存储相关的API对象，例如 StorageClass、VolumeAttachment 等。
+ `pkg/apis/apps`目录存放的是Kubernetes的扩展API对象。这些API对象是对基础功能的扩展，提供了更多的调度、管理和监控功能。这些API对象主要用于支持应用的部署、扩展和管理。

> 例如，`pkg/apis/apps/v1`目录下存放的是Deployment、StatefulSet、DaemonSet等API对象。这些API对象主要用于支持应用的部署、扩展和管理。
>
> 在`pkg/apis/apps`目录下，你会发现有许多子目录，每个子目录存放的是不同版本的API对象。例如，`pkg/apis/apps/v1`目录下存放的是Deployment、StatefulSet、DaemonSet等API对象的v1版本，`pkg/apis/apps/v1beta1`目录下存在`pkg/apis/apps`目录下，你会发现有许多子目录，每个子目录存放的是不同版本的API对象。例如，`pkg/apis/apps/v1`目录下存放的是Deployment、StatefulSet、DaemonSet等API对象的v1版本，`pkg/apis/apps/v1beta1`目录下存放的是Deployment、StatefulSet、DaemonSet等API对象的v1beta1版本。
>
> 这些子目录是为了支持Kubernetes的多版本特性而设计的。在Kubernetes中，API对象可以有多个版本，这样就可以在不破坏现有代码的情况下，提供新的功能和改进。这使得Kubernetes更加灵活，也使得Kubernetes的更新和升级变得更加容易。
>
> 在`pkg/apis/apps`目录下，你还会发现有很多文件，这些文件是Kubernetes的代码生成器使用的。Kubernetes的代码生成器是一种工具，可以根据用户的输入生成Kubernetes的API对象代码。这使得Kubernetes的API对象可以更加快速、简单地开发，也使得Kubernetes的API对象可以更加一致、统一地管理。
>
> 除了`pkg/apis/apps`目录，Kubernetes还有许多其他目录，这些目录也是Kubernetes的代码生成器使用的。例如，`pkg/apis/authorization`目录存放的是认证和授权相关的API对象，`pkg/apis/batch`目录存放的是批处理相关的API对象，`pkg/apis/coordination`目录存放的是协调相关的API对象等。



## 代码生成器

Kubernetes的代码生成器是一种工具，用于生成Kubernetes的API对象代码。它可以根据用户的输入，自动生成Kubernetes API对象的 Go 代码。Kubernetes的代码生成器使用了一种叫做 OpenAPI 的技术，可以通过定义 API 对象的模型来生成代码。

Kubernetes的代码生成器有许多优点，例如：

+ 减少重复工作：使用代码生成器，可以减少手写代码的工作量。
+ 提高代码质量：使用代码生成器，可以保证生成的代码质量更高，因为它是根据模板生成的。
+ 保证代码一致性：使用代码生成器，可以保证生成的代码风格一致，因为它是根据模板生成的。

Kubernetes的代码生成器对Kubernetes的作用非常重要，它使得Kubernetes的API对象可以更加快速、简单地开发，也使得Kubernetes的API对象可以更加一致、统一地管理。

通过使用代码生成器，Kubernetes的开发人员可以专注于API对象的业务逻辑，而不必担心底层实现细节。这大大降低了开发难度，也提高了开发效率。

此外，使用代码生成器还可以保证Kubernetes的API对象代码质量更高，因为它是根据模板生成的。这能够避免人为疏忽导致的代码错误，使得Kubernetes的API对象更加可靠。

总的来说，Kubernetes的代码生成器是一种非常有用的工具，它为Kubernetes的API对象的开发和管理带来了很多便利。



`Kubernetes`源码中的代码生成器例子，以及它们所在的地址目录：

+ Deployment代码生成器：`pkg/apis/apps/v1/codegen`
+ Service代码生成器：`pkg/apis/core/v1/codegen`
+ Pod代码生成器：`pkg/apis/core/v1/codegen`
+ ReplicationController代码生成器：`pkg/apis/core/v1/codegen`
+ Job代码生成器：`pkg/apis/batch/v1/codegen`
+ CronJob代码生成器：`pkg/apis/batch/v1beta1/codegen`



## cmd

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree -L 1 cmd
cmd
├── clicheck
├── cloud-controller-manager
├── dependencycheck
├── dependencyverifier
├── gendocs
├── genkubedocs
├── genman
├── genswaggertypedocs
├── genutils
├── genyaml
├── importverifier
├── kubeadm
├── kube-apiserver
├── kube-controller-manager
├── kubectl
├── kubectl-convert
├── kubelet
├── kubemark
├── kube-proxy
├── kube-scheduler
├── linkcheck
├── OWNERS
├── preferredimports
├── prune-junit-xml
└── yamlfmt
```

::: tip 
`kube-apiserver` 中有 `apiserver.go` 文件，就是 `apiserver` 启动入口

:::



## build

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree -L 1 build
build
├── build-image
├── common.sh
├── copy-output.sh
├── dependencies.yaml
├── lib
├── make-build-image.sh
├── make-clean.sh
├── nsswitch.conf
├── OWNERS
├── package-tarballs.sh
├── pause
├── README.md
├── release-images.sh
├── release-in-a-container.sh
├── release.sh
├── root
├── run.sh
├── server-image
├── shell.sh
├── tools.go
└── util.sh
```



## vendor

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree -L 1 vendor/
vendor/
├── bitbucket.org
├── cloud.google.com
├── github.com
├── go.etcd.io
├── golang.org
├── gonum.org
├── google.golang.org
├── go.opencensus.io
├── go.opentelemetry.io
├── gopkg.in
├── go.starlark.net
├── go.uber.org
├── k8s.io
├── modules.txt
├── OWNERS
└── sigs.k8s.io
```





## hack

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree -L 1 hack/
hack/
├── benchmark-go.sh
├── boilerplate
├── build-cross.sh
├── build-go.sh
├── cherry_pick_pull.sh
├── conformance
├── dev-build-and-push.sh
├── dev-build-and-up.sh
├── dev-push-conformance.sh
├── e2e-internal
├── e2e-node-test.sh
├── generate-docs.sh
├── gen-swagger-doc
├── get-build.sh
├── ginkgo-e2e.sh
├── grab-profiles.sh
├── install-etcd.sh
├── jenkins
├── lib
├── lint-dependencies.sh
├── list-feature-tests.sh
├── local-up-cluster.sh
├── logcheck.conf
├── make-rules
├── module-graph.sh
├── OWNERS
├── pin-dependency.sh
├── print-workspace-status.sh
├── README.md
├── run-in-gopath.sh
├── run-prometheus-on-etcd-scrapes.sh
├── serve-prom-scrapes.sh
├── testdata
├── test-go.sh
├── test-integration.sh
├── tools
├── unwanted-dependencies.json
├── update-all.sh
├── update-codegen.sh
├── update-conformance-yaml.sh
├── update-generated-api-compatibility-data.sh
├── update-generated-device-plugin-dockerized.sh
├── update-generated-device-plugin.sh
├── update-generated-docs.sh
├── update-generated-kms-dockerized.sh
├── update-generated-kms.sh
├── update-generated-kubelet-plugin-registration-dockerized.sh
├── update-generated-kubelet-plugin-registration.sh
├── update-generated-pod-resources-dockerized.sh
├── update-generated-pod-resources.sh
├── update-generated-protobuf-dockerized.sh
├── update-generated-protobuf.sh
├── update-generated-runtime-dockerized.sh
├── update-generated-runtime.sh
├── update-generated-stable-metrics.sh
├── update-generated-swagger-docs.sh
├── update-gofmt.sh
├── update-import-aliases.sh
├── update-internal-modules.sh
├── update-kustomize.sh
├── update-mocks.sh
├── update-netparse-cve.sh
├── update-openapi-spec.sh
├── update-translations.sh
├── update-vendor-licenses.sh
├── update-vendor.sh
├── update-yamlfmt.sh
├── verify-all.sh
├── verify-api-groups.sh
├── verify-boilerplate.sh
├── verify-cli-conventions.sh
├── verify-codegen.sh
├── verify-conformance-requirements.sh
├── verify-conformance-yaml.sh
├── verify-description.sh
├── verify-e2e-test-ownership.sh
├── verify-external-dependencies-version.sh
├── verify-flags
├── verify-flags-underscore.py
├── verify-generated-device-plugin.sh
├── verify-generated-docs.sh
├── verify-generated-files-remake.sh
├── verify-generated-files.sh
├── verify-generated-kms.sh
├── verify-generated-kubelet-plugin-registration.sh
├── verify-generated-pod-resources.sh
├── verify-generated-protobuf.sh
├── verify-generated-runtime.sh
├── verify-generated-stable-metrics.sh
├── verify-generated-swagger-docs.sh
├── verify-gofmt.sh
├── verify-golangci-lint.sh
├── verify-govet-levee.sh
├── verify-govet.sh
├── verify-import-aliases.sh
├── verify-import-boss.sh
├── verify-imports.sh
├── verify-internal-modules.sh
├── verify-linkcheck.sh
├── verify-mocks.sh
├── verify-netparse-cve.sh
├── verify-non-mutating-validation.sh
├── verify-no-vendor-cycles.sh
├── verify-openapi-spec.sh
├── verify-pkg-names.sh
├── verify-prerelease-lifecycle-tags.sh
├── verify-prometheus-imports.sh
├── verify-publishing-bot.py
├── verify-readonly-packages.sh
├── verify-shellcheck.sh
├── verify-spelling.sh
├── verify-staging-meta-files.sh
├── verify-test-code.sh
├── verify-test-featuregates.sh
├── verify-test-images.sh
├── verify-typecheck-providerless.sh
├── verify-typecheck.sh
├── verify-vendor-licenses.sh
├── verify-vendor.sh
└── verify-yamlfmt.sh
```





## plugin

`plugin`目录之前的版本包括 `scheduler` 部分的代码，当前版本（应该是在1.10之后）已经将scheduler部分代码移到和其他组件一致的pkg目录，所以目前 `plugin` 主要包含的是`认证`与`鉴权`部分的代码。

```bash
root@cubmaster01:~/go/src/k8s.io/kubernetes# tree plugin/ -L 4
plugin/
├── OWNERS
└── pkg
    ├── admission
    │   ├── admit
    │   │   ├── admission.go
    │   │   └── admission_test.go
    │   ├── alwayspullimages
    │   │   ├── admission.go
    │   │   └── admission_test.go
    │   ├── antiaffinity
    │   │   ├── admission.go
    │   │   ├── admission_test.go
    │   │   └── doc.go
    │   ├── certificates
    │   │   ├── approval
    │   │   ├── OWNERS
    │   │   ├── signing
    │   │   ├── subjectrestriction
    │   │   └── util.go
    │   ├── defaulttolerationseconds
    │   │   ├── admission.go
    │   │   └── admission_test.go
    │   ├── deny
    │   │   ├── admission.go
    │   │   └── admission_test.go
    │   ├── eventratelimit
    │   │   ├── admission.go
    │   │   ├── admission_test.go
    │   │   ├── apis
    │   │   ├── cache.go
    │   │   ├── cache_test.go
    │   │   ├── config.go
    │   │   ├── doc.go
    │   │   └── limitenforcer.go
    │   ├── extendedresourcetoleration
    │   │   ├── admission.go
    │   │   └── admission_test.go
    │   ├── gc
    │   │   ├── gc_admission.go
    │   │   └── gc_admission_test.go
    │   ├── imagepolicy
    │   │   ├── admission.go
    │   │   ├── admission_test.go
    │   │   ├── certs_test.go
    │   │   ├── config.go
    │   │   ├── config_test.go
    │   │   ├── doc.go
    │   │   ├── gencerts.sh
    │   │   └── OWNERS
    │   ├── limitranger
    │   │   ├── admission.go
    │   │   ├── admission_test.go
    │   │   └── interfaces.go
    │   ├── namespace
    │   │   ├── autoprovision
    │   │   └── exists
    │   ├── network
    │   │   ├── defaultingressclass
    │   │   └── denyserviceexternalips
    │   ├── noderestriction
    │   │   ├── admission.go
    │   │   ├── admission_test.go
    │   │   └── OWNERS
    │   ├── nodetaint
    │   │   ├── admission.go
    │   │   └── admission_test.go
    │   ├── OWNERS
    │   ├── podnodeselector
    │   │   ├── admission.go
    │   │   └── admission_test.go
    │   ├── podtolerationrestriction
    │   │   ├── admission.go
    │   │   ├── admission_test.go
    │   │   ├── apis
    │   │   ├── config.go
    │   │   └── doc.go
    │   ├── priority
    │   │   ├── admission.go
    │   │   └── admission_test.go
    │   ├── resourcequota
    │   │   └── admission_test.go
    │   ├── runtimeclass
    │   │   ├── admission.go
    │   │   ├── admission_test.go
    │   │   └── OWNERS
    │   ├── security
    │   │   ├── doc.go
    │   │   ├── podsecurity
    │   │   └── podsecuritypolicy
    │   ├── securitycontext
    │   │   └── scdeny
    │   ├── serviceaccount
    │   │   ├── admission.go
    │   │   ├── admission_test.go
    │   │   ├── doc.go
    │   │   └── OWNERS
    │   └── storage
    │       ├── persistentvolume
    │       ├── storageclass
    │       └── storageobjectinuseprotection
    └── auth
        ├── authenticator
        │   ├── OWNERS
        │   └── token
        ├── authorizer
        │   ├── doc.go
        │   ├── node
        │   ├── OWNERS
        │   └── rbac
        ├── doc.go
        └── OWNERS
```



## END 链接
<ul><li><div><a href = '31.md' style='float:left'>⬆️上一节🔗  </a><a href = '33.md' style='float: right'>  ️下一节🔗</a></div></li></ul>

+ [Ⓜ️回到目录🏠](../README.md)

+ [**🫵参与贡献💞❤️‍🔥💖**](https://nsddd.top/archives/contributors))

+ ✴️版权声明 &copy; ：本书所有内容遵循[CC-BY-SA 3.0协议（署名-相同方式共享）&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0协议文本) 

