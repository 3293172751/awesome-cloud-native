+ [author](http://nsddd.top)

# 第5节 sealer

<br>

<div><a href = '4.md' style='float:left'>⬆️上一节🔗  </a><a href = '6.md' style='float: right'>  ⬇️下一节🔗</a></div>
<br>

> ❤️💕💕记录[sealos](https://github.com/3293172751/sealos)开源项目的学习过程。[k8s,docker和云原生的学习](https://github.com/3293172751/sealos)。Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## 前言

**议题：**

+ [https://github.com/sealerio/sealer/issues/1839](https://github.com/sealerio/sealer/issues/1839)
+ [https://github.com/sealerio/sealer/issues/1770](https://github.com/sealerio/sealer/issues/1770)



### What is the problem this feature will solve?

+ Brings all the benefits of k3s. @https://www.rancher.cn/k3s/
+ No k3s no sealos.

> Sealos wants to hit the mass market, which is consistent with the direction of k3s. The lightweight k3s is more popular with mass developers.



我们在路线图中对 k8s、k0s、k3s 运行时支持的工作应该有一个进度记录，应该是让工作进度更加清晰，并吸引更多的参与者加入这个核心工作。这里简单介绍一下部分工作：
阅读 Sealer 主分支代码，理解 runtime 模块中的代码，掌握从 cmd 模块到 runtime 模块的代码调用逻辑。
通过k8s、k0s、k3s官网阅读并设计运行时接口实现方法。

为指定的运行时读取和设计 clusterImage。主要参考： [ClusterImage](http://sealer.cool/docs/advanced/define-cloudimage.html#customize-the-cloudrootfs)、[basefs](https://github.com/sealerio/basefs)。

类型：功能请求

+ 单结点成为高可用~

docker~ run cmd 

init 

::: tip
进展

:::

## Clusterlmage

+ Bin 文件，如 docker、containerd、crictl、kubeadm、kubectl...
+ 配置文件，如 kubelet systemd config、docker systemd config、docker daemon.json...
+ 注册表泊坞窗图像。
+ 一些元数据，例如 Kubernetes 版本。
+ 注册表文件，包含所有的docker镜像，比如kubernetes核心组件docker镜像...
+ 脚本，一些用于安装 docker 和 kubelet 的 shell 脚本... sealer 将调用 init.sh 和 clean.sh。
+ 其他静态文件



## 问题描述

我们需要更新 k0s 运行时代码以适应新结构。
类型：功能请求

### 描述你想要什么功能



## 调研

首先需要调研，然后出一个设计稿，比如install模块怎么和k3s结合

apply会对比一下新旧集群的差别，然后再确定是否调用runtime来扩缩容集群

> 目前k3s还没有实现，k0s在最新代码中还没有适配起来，上面这个文档是在0.8.6版本，也就是9月下旬发布的那个版本代码前设计的，现在的话大体思路一致，如果需要实现k3s的话，首先需要熟读k3s的官方安装文档，其次阅读sealer runtime的接口逻辑，install/scaleup等接口干些什么事儿。最后还需要看一下如何与rootfs进行交互，也就是集群镜像那个部分。如果有兴趣的话，欢迎对sealer进行贡献。k0s、k3s runtime部分的代码会是由我主要负责。
>
> 这个不好说，目前新架构下的cri还没有支持containerd，k0s部分修改起来很快并且已经推动了，预计1个月就可以了，可以期待sealer下个大版本的更新哦如果现在想体验k0s的话，可以切换到9月30号的那次starcomingup的提交，基于那次commit进行编译，k0s镜像的话可以体验一下
>
> 但是不建议上生产哦



## 先决条件

+ 容器化为基于 CRI[@YTGhost](https://github.com/YTGhost)请帮我跟踪这项工作



## 安装/放大/缩小/重置/升级

+ 删除注册表交互逻辑
+ 更改为 `infra-driver` 命令



## 更改 basefs 脚本

+ 容器 `d.sh`
+ 有些东西需要遵循 `k8s` 领先的逻辑



## 入口函数

+ ChooseClusterRuntime()：使用Metadata来区分集群Runtime，需要添加一个字段来区分k0s、k3s、k8s

 

### 附加上下文

在此处添加有关功能请求的任何其他上下文或屏幕截图。





sealos 主议题

+ [k3s 所有议题](https://github.com/sealerio/sealer/issues?q=is%3Aissue+is%3Aopen+k3s)

+ [https://github.com/labring/sealos/issues/1943](https://github.com/labring/sealos/issues/1943)
+ https://github.com/sealerio/sealer/issues/1399



策划文档

+ https://www.yuque.com/zhouxinyuan-6woia/nodno9/iswdqd





## issues

我们在路线图中对 k8s、k0s、k3s 运行时支持的工作应该有一个进度记录，应该是让工作进度更加清晰，并吸引更多的参与者加入这个核心工作。这里简单介绍一下部分工作：
阅读Sealer主分支代码，理解runtime模块中的代码，掌握从cmd模块到runtime模块的代码调用逻辑。
通过k8s、k0s、k3s官网阅读并设计运行时接口实现方法。
为指定的运行时读取和设计 clusterImage。主要参考： [ClusterImage](http://sealer.cool/docs/advanced/define-cloudimage.html#customize-the-cloudrootfs)、[basefs](https://github.com/sealerio/basefs)。
类型：*功能请求*

+ [k0s 跟进文档](https://github.com/sealerio/sealer/pull/1686)
+ [1686议题跟进代码](https://github.com/sealerio/sealer/pull/1686/files)





## END 链接

<ul><li><div><a href = '4.md' style='float:left'>⬆️上一节🔗  </a><a href = '6.md' style='float: right'>  ️下一节🔗</a></div></li></ul>

+ [Ⓜ️回到目录🏠](../README.md)

+ [**🫵参与贡献💞❤️‍🔥💖**](https://nsddd.top/archives/contributors))

+ ✴️版权声明 &copy; ：本书所有内容遵循[CC-BY-SA 3.0协议（署名-相同方式共享）&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0协议文本) 

