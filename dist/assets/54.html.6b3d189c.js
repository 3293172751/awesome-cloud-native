import{_ as o,r as n,o as i,c as d,a as e,b as a,w as l,e as t,d as p}from"./app.2d12850e.js";const c={},u={href:"http://nsddd.top",target:"_blank",rel:"noopener noreferrer"},h=t("author"),b=e("h1",{id:"\u7B2C54\u8282-kubernetes-\u751F\u547D\u5468\u671F\u7BA1\u7406\u548C\u670D\u52A1\u53D1\u73B0",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u7B2C54\u8282-kubernetes-\u751F\u547D\u5468\u671F\u7BA1\u7406\u548C\u670D\u52A1\u53D1\u73B0","aria-hidden":"true"},"#"),t(" \u7B2C54\u8282 Kubernetes \u751F\u547D\u5468\u671F\u7BA1\u7406\u548C\u670D\u52A1\u53D1\u73B0")],-1),m=e("div",null,[e("a",{href:"53.md",style:{float:"left"}},"\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} "),e("a",{href:"55.md",style:{float:"right"}}," \u2B07\uFE0F\u4E0B\u4E00\u8282\u{1F517}")],-1),P=e("br",null,null,-1),k=t("\u2764\uFE0F\u{1F495}\u{1F495}\u65B0\u65F6\u4EE3\u62E5\u62B1\u4E91\u539F\u751F\uFF0C\u4E91\u539F\u751F\u5177\u6709\u73AF\u5883\u7EDF\u4E00\u3001\u6309\u9700\u4ED8\u8D39\u3001\u5373\u5F00\u5373\u7528\u3001\u7A33\u5B9A\u6027\u5F3A\u7279\u70B9\u3002Myblog:"),v={href:"http://nsddd.top/",target:"_blank",rel:"noopener noreferrer"},g=t("http://nsddd.top"),y=p(`<hr><p>[TOC]</p><h2 id="\u6709\u4F55\u4F18\u96C5\u7684\u7BA1\u7406pod\u751F\u547D\u5468\u671F" tabindex="-1"><a class="header-anchor" href="#\u6709\u4F55\u4F18\u96C5\u7684\u7BA1\u7406pod\u751F\u547D\u5468\u671F" aria-hidden="true">#</a> \u6709\u4F55\u4F18\u96C5\u7684\u7BA1\u7406Pod\u751F\u547D\u5468\u671F</h2><p>\u8981\u4F18\u96C5\u5730\u7BA1\u7406Pod\u7684\u751F\u547D\u5468\u671F\uFF0C\u53EF\u4EE5\u907F\u514D\u5BB9\u5668\u8FDB\u7A0B\u88AB\u7EC8\u6B62\u548CPod\u88AB\u9A71\u9010\uFF0C\u8BBE\u7F6E\u5408\u7406\u7684\u8D44\u6E90\u9650\u5236\u548C\u786E\u4FDD\u6570\u636E\u5199\u5165\u4E0D\u8D85\u8FC7emptyDir\u7684\u9650\u5236\uFF0C\u9632\u6B62OOMKill\u548CPod\u88AB\u9A71\u9010\u3002\u6B64\u5916\uFF0C\u8FD8\u53EF\u4EE5\u8BBE\u7F6E\u5065\u5EB7\u68C0\u67E5\u63A2\u9488\uFF0C\u5305\u62EClivenessProbe\u3001readinessProbe\u548CstartupProbe\uFF0C\u5176\u4E2DreadinessProbe\u53EF\u5728livenessProbe\u6267\u884C\u524D\u5904\u7406\u72B6\u6001\u3002\u63A2\u6D4B\u65B9\u6CD5\u5305\u62ECExecAction\u3001TCPSocketAction\u548CHTTPGetAction\u3002\u53EF\u4EE5\u901A\u8FC7\u6DFB\u52A0readinessGates condition\u6765\u5F15\u5165\u81EA\u5B9A\u4E49\u7684\u5C31\u7EEA\u6761\u4EF6\uFF0C\u9664\u4E86\u7531k8s\u5185\u90E8\u7684\u63A2\u9488\u63A7\u5236\u4E4B\u5916\uFF0C\u8FD8\u53EF\u4EE5\u7531k8s\u5916\u90E8controller\u6765\u63A7\u5236\u3002</p><p><img src="http://sm.nsddd.top/sm202303091924004.png" alt="image-20230309192447683"></p><h3 id="pod-\u72B6\u6001\u673A" tabindex="-1"><a class="header-anchor" href="#pod-\u72B6\u6001\u673A" aria-hidden="true">#</a> Pod \u72B6\u6001\u673A</h3><p>Pod \u7684\u72B6\u6001\u53EF\u4EE5\u5206\u4E3A\u4EE5\u4E0B\u51E0\u79CD\uFF1A</p><ul><li>Pending\uFF1APod \u5DF2\u88AB\u521B\u5EFA\uFF0C\u4F46\u662F\u8FD8\u672A\u88AB\u5206\u914D\u5230\u8282\u70B9\u4E0A\u8FD0\u884C\u3002</li><li>Running\uFF1APod \u5DF2\u7ECF\u88AB\u8C03\u5EA6\u5230\u8282\u70B9\u4E0A\u8FD0\u884C\uFF0C\u5E76\u4E14\u81F3\u5C11\u6709\u4E00\u4E2A\u5BB9\u5668\u6B63\u5728\u8FD0\u884C\u3002</li><li>Succeeded\uFF1APod \u4E2D\u6240\u6709\u7684\u5BB9\u5668\u90FD\u5DF2\u7ECF\u6210\u529F\u8FD0\u884C\u7ED3\u675F\uFF0C\u4E14\u4E0D\u4F1A\u518D\u91CD\u542F\u3002</li><li>Failed\uFF1APod \u4E2D\u81F3\u5C11\u6709\u4E00\u4E2A\u5BB9\u5668\u5DF2\u7ECF\u8FD0\u884C\u5931\u8D25\uFF0C\u5E76\u4E14\u5904\u4E8E\u4E0D\u80FD\u6062\u590D\u7684\u72B6\u6001\uFF0C\u6216\u8005\u5BB9\u5668\u56E0\u4E3A OOM \u7B49\u539F\u56E0\u88AB\u64CD\u4F5C\u7CFB\u7EDF\u5F3A\u5236\u7EC8\u6B62\u3002</li><li>Unknown\uFF1A\u65E0\u6CD5\u83B7\u53D6 Pod \u7684\u72B6\u6001\u4FE1\u606F\uFF0C\u901A\u5E38\u662F\u7531\u4E8E\u8C03\u5EA6\u5668\u6216\u8005\u63A7\u5236\u5668\u7EC4\u4EF6\u51FA\u73B0\u95EE\u9898\u5BFC\u81F4\u7684\u3002</li></ul><p>\u5728 Pod \u8FD0\u884C\u8FC7\u7A0B\u4E2D\uFF0C\u7531\u4E8E\u5404\u79CD\u539F\u56E0\uFF0CPod \u7684\u72B6\u6001\u53EF\u80FD\u4F1A\u53D1\u751F\u53D8\u5316\uFF0C\u6BD4\u5982\u5BB9\u5668\u610F\u5916\u7EC8\u6B62\u3001\u8282\u70B9\u6545\u969C\u7B49\u3002Kubernetes \u4F1A\u4E0D\u65AD\u5730\u76D1\u63A7 Pod \u7684\u72B6\u6001\uFF0C\u786E\u4FDD Pod \u80FD\u591F\u4FDD\u6301\u6B63\u5E38\u8FD0\u884C\u3002</p><p><img src="http://sm.nsddd.top/sm202303171925468.png" alt="image-20230309192455697"></p><h3 id="pod-phase" tabindex="-1"><a class="header-anchor" href="#pod-phase" aria-hidden="true">#</a> Pod Phase</h3><p><strong>kubectl get pod \u663E\u793A\u7684\u72B6\u6001\u4FE1\u606F\u662F\u7531 podstatus \u7684 conditions \u548C phase \u8BA1\u7B97\u51FA\u6765\u7684</strong></p><h3 id="pod-\u72B6\u6001\u8BA1\u7B97\u7EC6\u8282" tabindex="-1"><a class="header-anchor" href="#pod-\u72B6\u6001\u8BA1\u7B97\u7EC6\u8282" aria-hidden="true">#</a> Pod \u72B6\u6001\u8BA1\u7B97\u7EC6\u8282</h3><p>\u8981\u67E5\u770B Pod \u7684\u7EC6\u8282\uFF0C\u53EF\u4EE5\u4F7F\u7528 <code>kubectl get pod $podname -oyaml</code> \u547D\u4EE4\u6765\u67E5\u770B\u3002\u6B64\u5916\uFF0C\u53EF\u4EE5\u901A\u8FC7 <code>kubectl describe pod</code> \u547D\u4EE4\u6765\u67E5\u770B\u4E0E\u8BE5 Pod \u76F8\u5173\u7684\u4E8B\u4EF6\u3002</p><p>\u4EE5\u4E0B\u662F\u8BA1\u7B97 Pod \u72B6\u6001\u7684\u8BE6\u7EC6\u4FE1\u606F\uFF1A</p><table><thead><tr><th>kubectl get pod \u8FD4\u56DE\u7684\u72B6\u6001</th><th>Pod Phase</th><th>Conditions</th></tr></thead><tbody><tr><td>Completed</td><td>Succeded</td><td></td></tr><tr><td>ContainerCreating</td><td>Pending</td><td></td></tr><tr><td>CrashLoopBackOff</td><td>Running</td><td>Container exits</td></tr><tr><td>CreateContainerConfigError</td><td>Pending</td><td>configmap &#39;xxx&#39; not foundsecret &#39;xxx&#39; not found</td></tr><tr><td>ErrImagePullI</td><td></td><td></td></tr><tr><td>magePullBackOff</td><td></td><td></td></tr><tr><td>Init:ImagePullBackOff</td><td></td><td></td></tr><tr><td>InvalidImageName</td><td>Pending</td><td>Back-off pulling image</td></tr><tr><td>Error</td><td>Failed</td><td>restartPolicy:Nevercontainer exits with error\uFF08exit code not 0\uFF09</td></tr><tr><td>Evicted</td><td>Failed</td><td>message: &#39;Usage of EmptyDir volume &#39;myworkdir&quot; exceeds the limit &quot;40Gi&quot;. &#39;reason: Evicted</td></tr><tr><td>Init:0/1</td><td>Pending</td><td>Init container don&#39;t exit</td></tr><tr><td>Init:CrashLoopBackOffInit:Error</td><td>Pending</td><td>Init container crashed (exit with not 1)</td></tr><tr><td>OOMKilled</td><td>Running</td><td>Containers are OOMKilled</td></tr><tr><td>StartError</td><td>Running</td><td>Containers can not be started</td></tr><tr><td>Unknown</td><td>Running</td><td>Node NotReady</td></tr><tr><td>OutOfCpu / OutOfMemory</td><td>Failed</td><td>Scheduled, but it cannot pass kubelet admit</td></tr></tbody></table><p>\u8981\u4FDD\u8BC1 Pod \u7684\u9AD8\u53EF\u7528\u6027\uFF0C\u53EF\u4EE5\u91C7\u53D6\u4EE5\u4E0B\u63AA\u65BD\uFF1A</p><ul><li>\u8BBE\u7F6E\u5408\u7406\u7684\u8D44\u6E90\u9650\u5236\u548C\u786E\u4FDD\u6570\u636E\u5199\u5165\u4E0D\u8D85\u8FC7 emptyDir \u7684\u9650\u5236\uFF0C\u9632\u6B62\u5BB9\u5668\u8FDB\u7A0B\u88AB\u7EC8\u6B62\u548C Pod \u88AB\u9A71\u9010\u3002</li><li>\u5B9A\u4E49 Guaranteed \u7C7B\u578B\u7684\u8D44\u6E90\u9700\u6C42\u6765\u4FDD\u62A4\u91CD\u8981\u7684 Pod\u3002</li><li>\u8BA4\u771F\u8003\u8651 Pod \u7684\u771F\u5B9E\u9700\u6C42\u5E76\u8BBE\u7F6E <code>limit</code> \u548C <code>resource</code>\uFF0C\u8FD9\u53EF\u4EE5\u5C06\u96C6\u7FA4\u8D44\u6E90\u5229\u7528\u7387\u63A7\u5236\u5728\u5408\u7406\u8303\u56F4\u5E76\u51CF\u5C11 Pod \u88AB\u9A71\u9010\u7684\u73B0\u8C61\u3002</li><li>\u907F\u514D\u5C06\u751F\u4EA7 Pod \u8BBE\u7F6E\u4E3A BestEffort\uFF0C\u4F46\u662F\u5BF9\u4E8E\u6D4B\u8BD5\u73AF\u5883\u6765\u8BF4\uFF0CBestEffort Pod \u80FD\u786E\u4FDD\u5927\u591A\u6570\u5E94\u7528\u4E0D\u4F1A\u56E0\u4E3A\u8D44\u6E90\u4E0D\u8DB3\u800C\u5904\u4E8E Pending \u72B6\u6001\u3002</li><li>Burstable \u9002\u7528\u4E8E\u5927\u591A\u6570\u573A\u666F\u3002</li></ul><p>\u5982\u679C\u9700\u8981\u907F\u514D Pod \u88AB\u9A71\u9010\uFF0C\u53EF\u4EE5\u589E\u52A0 tolerationSeconds \u7684\u503C\uFF0C\u7279\u522B\u662F\u5BF9\u4E8E\u4F9D\u8D56\u4E8E\u672C\u5730\u5B58\u50A8\u72B6\u6001\u7684\u6709\u72B6\u6001\u5E94\u7528\u6765\u8BF4\u3002</p><p>\u5065\u5EB7\u68C0\u67E5\u63A2\u9488\u5206\u4E3A livenessProbe\u3001readinessProbe \u548C startupProbe\uFF0C\u5176\u4E2D readinessProbe \u53EF\u4EE5\u5728 livenessProbe \u6267\u884C\u524D\u5904\u7406\u72B6\u6001\uFF0C\u63A2\u6D4B\u65B9\u6CD5\u5305\u62EC ExecAction\u3001TCPSocketAction \u548C HTTPGetAction\u3002\u53EF\u4EE5\u901A\u8FC7\u6DFB\u52A0 readinessGates condition \u6765\u5F15\u5165\u81EA\u5B9A\u4E49\u7684\u5C31\u7EEA\u6761\u4EF6\u3002\u63A2\u9488\u5C5E\u6027\u5305\u62EC initialDelaySeconds\u3001periodSeconds\u3001timeoutSeconds\u3001successThreshold \u548C failureThreshold\u3002</p><p>\u67E5\u770Bpod\u7EC6\u8282\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl get pod <span class="token variable">$podname</span> <span class="token parameter variable">-oyaml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u67E5\u770Bpod\u76F8\u5173\u4E8B\u4EF6\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl describe pod
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u5982\u4F55\u4FDD\u8BC1-pod-\u7684\u9AD8\u53EF\u7528" tabindex="-1"><a class="header-anchor" href="#\u5982\u4F55\u4FDD\u8BC1-pod-\u7684\u9AD8\u53EF\u7528" aria-hidden="true">#</a> \u5982\u4F55\u4FDD\u8BC1 Pod \u7684\u9AD8\u53EF\u7528</h3><p>\u907F\u514D\u5BB9\u5668\u8FDB\u7A0B\u88AB\u7EC8\u6B62\u907F\u514DPod\u88AB\u9A71\u9010</p><ul><li>\u8BBE\u7F6E\u5408\u7406\u7684 <code>resources.memory limits</code> \u9632\u6B62\u5BB9\u5668\u8FDB\u7A0B\u88AB OOMKill</li><li>\u8BBE\u7F6E\u5408\u7406\u7684 <code>emptydir.sizeLimit</code> \u5E76\u4E14\u786E\u4FDD\u6570\u636E\u5199\u5165\u4E0D\u8D85\u8FC7 emptyDir \u7684\u9650\u5236\uFF0C \u9632\u6B62 Pod \u88AB\u9A71\u9010</li></ul><h3 id="pod-\u7684-qos-\u5206\u7C7B" tabindex="-1"><a class="header-anchor" href="#pod-\u7684-qos-\u5206\u7C7B" aria-hidden="true">#</a> Pod \u7684 Qos \u5206\u7C7B</h3><p>Kubernetes \u4E2D\u7684 QoS\uFF08Quality of Service\uFF09\u662F\u7528\u6765\u63CF\u8FF0 Pod \u5BF9\u8282\u70B9\u8D44\u6E90\u7684\u9700\u6C42\u548C\u8BF7\u6C42\uFF0C\u4EE5\u53CA\u5728\u8282\u70B9\u8D44\u6E90\u4E0D\u8DB3\u65F6 Kubernetes \u5982\u4F55\u5904\u7406 Pod \u7684\u7B56\u7565\u3002QoS \u603B\u5171\u6709\u4E09\u79CD\u7C7B\u578B\uFF1AGuaranteed\u3001Burstable \u548C BestEffort\u3002</p><ul><li><code>Guaranteed</code>\uFF1APod \u8BF7\u6C42\u4E86\u6240\u6709\u7684\u8D44\u6E90\uFF0Ckubelet \u4F1A\u4FDD\u8BC1\u8FD9\u4E9B\u8D44\u6E90\u88AB\u5206\u914D\u5230 Pod \u4E2D\uFF0C\u5982\u679C\u8D44\u6E90\u4E0D\u8DB3\uFF0CPod \u4F1A\u5904\u4E8E Pending \u72B6\u6001\u3002</li><li><code>Burstable</code>\uFF1APod \u8BF7\u6C42\u4E86\u6700\u5C0F\u7684\u8D44\u6E90\uFF0C\u4F46\u53EF\u4EE5\u52A0\u500D\u4F7F\u7528\uFF0C\u76F4\u5230\u8FBE\u5230\u8BF7\u6C42\u7684\u4E0A\u9650\u3002\u5982\u679C\u8D44\u6E90\u4E0D\u8DB3\uFF0CPod \u4F1A\u88AB\u6682\u505C\u6216\u8005\u8C03\u5EA6\u5230\u5176\u4ED6\u8282\u70B9\u3002</li><li><code>BestEffort</code>\uFF1APod \u8BF7\u6C42\u4E86\u6700\u5C0F\u7684\u8D44\u6E90\uFF0C\u4F46\u4E0D\u5FC5\u4FDD\u8BC1\u8D44\u6E90\u5206\u914D\u5230 Pod \u4E2D\u3002\u5982\u679C\u8D44\u6E90\u4E0D\u8DB3\uFF0CPod \u4F1A\u88AB\u6682\u505C\u6216\u8005\u8C03\u5EA6\u5230\u5176\u4ED6\u8282\u70B9\u3002</li></ul><p>QoS \u7C7B\u578B\u7684\u5224\u65AD\u4F9D\u636E\u662F Pod \u6240\u8BF7\u6C42\u7684 CPU \u548C\u5185\u5B58\u7684 request \u548C limit\u3002\u5982\u679C request \u548C limit \u76F8\u7B49\uFF0C\u90A3\u4E48 Pod \u7684 QoS \u7C7B\u578B\u5C31\u662F Guaranteed\uFF1B\u5982\u679C limit \u5927\u4E8E request\uFF0C\u90A3\u4E48 Pod \u7684 QoS \u7C7B\u578B\u5C31\u662F Burstable\uFF1B\u5982\u679C request \u548C limit \u90FD\u4E3A 0\uFF0C\u90A3\u4E48 Pod \u7684 QoS \u7C7B\u578B\u5C31\u662F BestEffort\u3002</p><ul><li>Guaranteed <ul><li>Pod \u7684\u6BCF\u4E2A\u5BB9\u5668\u90FD\u8BBE\u7F6E\u4E86\u8D44\u6E90 CPU \u548C\u5185\u5B58\u9700\u6C42</li><li>Limits \u548C requests \u7684\u503C\u5B8C\u5168\u4E00 \u81F4</li></ul></li><li>Burstable <ul><li>\u81F3\u5C11\u4E00\u4E2A\u5BB9\u5668\u6307\u5B9A\u4E86 CPU \u6216\u5185\u5B58 request</li><li>Pod \u7684\u8D44\u6E90\u9700\u6C42\u4E0D\u7B26\u5408 Gauranteed QoS \u7684\u6761\u4EF6\uFF0C\u4E5F\u5C31\u662F requests \u548C limits \u4E0D\u4E00\u81F4</li></ul></li><li>BestEffort <ul><li>Pod\u4E2D\u7684\u6240\u6709\u5BB9\u5668\u90FD\u672A\u6307\u5B9ACPU\u6216\u5185\u5B58\u8D44\u6E90\u9700\u6C42requests</li></ul></li></ul><p>\u5F53\u8BA1\u7B97\u8282\u70B9\u68C0\u6D4B\u5230\u5185\u5B58\u538B\u529B\u65F6\uFF0CKubernetes \u4F1A\u6309 BestEffort-&gt; Burstable-&gt;Guaranteed \u7684\u987A\u5E8F\u4F9D\u6B21\u9A71\u9010 Pod\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl get pod test-vfgg6 <span class="token parameter variable">-oyaml</span> <span class="token operator">|</span><span class="token function">grep</span> qosClass
qosClass: Burstable
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u5B9A\u4E49 Guaranteed \u7C7B\u578B\u7684\u8D44\u6E90\u9700\u6C42\u6765\u4FDD\u62A4\u4F60\u7684\u91CD\u8981 Pod</li><li>\u8BA4\u771F\u8003\u91CF Pod \u9700\u8981\u7684\u771F\u5B9E\u9700\u6C42\u5E76\u8BBE\u7F6E limit \u548C resource,\u8FD9\u6709\u5229\u4E8E\u5C06\u96C6\u7FA4\u8D44\u6E90\u5229\u7528\u7387\u63A7\u5236\u5728\u5408\u7406\u8303\u56F4\u5E76\u51CF\u5C11 Pod \u88AB\u9A71\u9010\u7684\u73B0\u8C61\u3002</li><li>\u5C3D\u91CF\u907F\u514D\u5C06\u751F\u4EA7 Pod \u8BBE\u7F6E\u4E3A BestEffort,\u4F46\u662F\u5BF9\u6D4B\u8BD5\u73AF\u5883\u6765\u8BB2\uFF0CBestEffort Pod \u80FD\u786E\u4FDD\u5927\u591A\u6570\u5E94\u7528\u4E0D\u4F1A\u56E0\u4E3A\u8D44\u6E90\u4E0D\u8DB3\u800C\u5904\u4E8E Pending \u72B6\u6001\u3002</li><li>Burstable \u9002\u7528\u4E8E\u5927\u591A\u6570\u573A\u666F\u3002 <ul><li>\u601D\u8003\uFF1A\u4E3A\u4EC0\u4E48?</li><li>\u4E3A\u4E86\u8282\u7701\u8D44\u6E90\uFF0CGuaranteed \u7C7B\u578B Pod \u5360\u7528\u7684\u8D44\u6E90 k8s \u4F1A\u4F18\u5148\u4FDD\u8BC1\uFF0C\u4E0D\u8DB3\u65F6\u5C31\u9A71\u9010 Pod\uFF0C \u5982\u679C\u5B9E\u9645 Pod \u6CA1\u6709\u6D88\u8017\u6389\u7533\u8BF7\u7684\u8D44\u6E90\u5C31\u4F1A\u9020\u6210\u6D6A\u8D39\u3002</li></ul></li></ul><h3 id="\u57FA\u4E8Etaint\u7684evictions" tabindex="-1"><a class="header-anchor" href="#\u57FA\u4E8Etaint\u7684evictions" aria-hidden="true">#</a> \u57FA\u4E8ETaint\u7684Evictions</h3><p>\u57FA\u4E8E Taint \u7684 Evictions \u662F Kubernetes \u4E2D\u7684\u4E00\u79CD\u8282\u70B9\u9A71\u9010\u673A\u5236\u3002\u5F53\u8282\u70B9\u4E34\u65F6\u4E0D\u53EF\u8FBE\uFF0C\u6BD4\u5982\u51FA\u73B0\u7F51\u7EDC\u5206\u533A\u3001kubelet \u6216 containerd \u4E0D\u5DE5\u4F5C\u7B49\u60C5\u51B5\uFF0C\u6216\u8005\u8282\u70B9\u91CD\u542F\u8D85\u8FC7 15 \u5206\u949F\u65F6\uFF0C\u5C31\u4F1A\u89E6\u53D1\u8BE5\u673A\u5236\uFF0C\u4ECE\u800C\u4FDD\u8BC1 Pod \u7684\u9AD8\u53EF\u7528\u6027\u3002\u4E3A\u4E86\u907F\u514D\u88AB\u9A71\u9010\uFF0C\u53EF\u4EE5\u589E\u5927 tolerationSeconds \u7684\u503C\uFF0C\u7279\u522B\u662F\u5BF9\u4E8E\u4F9D\u8D56\u4E8E\u672C\u5730\u5B58\u50A8\u72B6\u6001\u7684\u6709\u72B6\u6001\u5E94\u7528\u6765\u8BF4\u3002</p><ul><li>\u8282\u70B9\u4E34\u65F6\u4E0D\u53EF\u8FBE <ul><li>\u7F51\u7EDC\u5206\u533A</li><li>kubelet, containerd \u4E0D\u5DE5\u4F5C</li><li>\u8282\u70B9\u91CD\u542F\u8D85\u8FC7\u4E8615 \u5206\u949F</li></ul></li><li>\u589E\u5927tolerationSeconds \u4EE5\u907F\u514D\u88AB\u9A71\u9010 <ul><li>\u7279\u522B\u662F\u4F9D\u8D56\u4E8E\u672C\u5730\u5B58\u50A8\u72B6\u6001\u7684\u6709\u72B6\u6001\u5E94\u7528</li></ul></li></ul><h2 id="\u5065\u5EB7\u68C0\u67E5\u63A2\u9488" tabindex="-1"><a class="header-anchor" href="#\u5065\u5EB7\u68C0\u67E5\u63A2\u9488" aria-hidden="true">#</a> \u5065\u5EB7\u68C0\u67E5\u63A2\u9488</h2><p>\u5065\u5EB7\u68C0\u67E5\u63A2\u9488\u662F Kubernetes \u4E2D\u7684\u4E00\u79CD\u673A\u5236\uFF0C\u7528\u4E8E\u68C0\u6D4B Pod \u4E2D\u5BB9\u5668\u7684\u8FD0\u884C\u72B6\u6001\u3002\u5065\u5EB7\u63A2\u9488\u7C7B\u578B\u5206\u4E3A\uFF1AlivenessProbe\u3001readinessProbe \u548C startupProbe\u3002\u5176\u4E2D\uFF0ClivenessProbe \u7528\u4E8E\u63A2\u6D3B\uFF0C\u5F53\u68C0\u6D4B\u5230\u5BB9\u5668\u4E0D\u5065\u5EB7\u65F6\uFF0CKubernetes \u4F1A\u81EA\u52A8\u91CD\u542F\u8BE5\u5BB9\u5668\uFF1BreadinessProbe \u7528\u4E8E\u63A2\u6D4B\u5BB9\u5668\u662F\u5426\u5DF2\u7ECF\u51C6\u5907\u597D\u63A5\u6536\u6D41\u91CF\uFF0C\u5982\u679C\u5BB9\u5668\u65E0\u6CD5\u5904\u7406\u6D41\u91CF\uFF0CKubernetes \u4F1A\u5C06\u5176\u4ECE Service \u4E2D\u5220\u9664\uFF0C\u4ECE\u800C\u907F\u514D\u6D41\u91CF\u88AB\u5206\u914D\u5230\u4E0D\u5065\u5EB7\u7684\u5BB9\u5668\u4E0A\uFF1BstartupProbe \u7528\u4E8E\u5728\u5BB9\u5668\u542F\u52A8\u65F6\u68C0\u67E5\u5E94\u7528\u7A0B\u5E8F\u662F\u5426\u5DF2\u7ECF\u542F\u52A8\u6210\u529F\uFF0C\u5982\u679C\u5E94\u7528\u7A0B\u5E8F\u6CA1\u6709\u542F\u52A8\u6210\u529F\uFF0C\u90A3\u4E48 Kubernetes \u4F1A\u8BA4\u4E3A\u5BB9\u5668\u4E0D\u5065\u5EB7\u3002\u63A2\u6D4B\u65B9\u6CD5\u5305\u62EC ExecAction\u3001TCPSocketAction \u548C HTTPGetAction\u3002\u63A2\u9488\u5C5E\u6027\u5305\u62EC initialDelaySeconds\u3001periodSeconds\u3001timeoutSeconds\u3001successThreshold \u548C failureThreshold\u3002</p><p>\u5065\u5EB7\u63A2\u9488\u7C7B\u578B\u5206\u4E3A\uFF1A</p><ul><li>livenessProbe <ul><li>\u63A2\u6D3B\uFF0C\u5F53\u68C0\u67E5\u5931\u8D25\u65F6\uFF0C\u610F\u5473\u7740\u8BE5\u5E94\u7528\u8FDB\u7A0B\u5DF2\u7ECF\u65E0\u6CD5\u6B63\u5E38\u63D0\u4F9B\u670D\u52A1, kubelet \u4F1A\u7EC8\u6B62\u8BE5\u5BB9\u5668\u8FDB\u7A0B\u5E76\u6309\u7167 restartPolicy \u51B3\u5B9A\u662F\u5426\u91CD\u542F</li><li><strong>\u5728\u8BE5\u63A2\u9488\u6267\u884C\u524D Pod \u9ED8\u8BA4\u5C31\u662F\u5B58\u6D3B\u72B6\u6001</strong></li></ul></li><li>readinessProbe <ul><li>\u5C31\u7EEA\u72B6\u6001\u68C0\u67E5\uFF0C\u5F53\u68C0\u67E5\u5931\u8D25\u65F6\uFF0C\u610F\u5473\u7740\u5E94\u7528\u8FDB\u7A0B\u6B63\u5728\u8FD0\u884C\uFF0C\u4F46\u56E0\u4E3A\u67D0\u4E9B\u539F\u56E0\u4E0D\u80FD\u63D0\u4F9B\u670D\u52A1\uFF0CPod \u72B6\u6001\u4F1A\u88AB\u6807\u8BB0\u4E3ANotReady</li><li>\u9ED8\u8BA4\u4E3A NotReady\uFF0CPod \u9700\u8981\u901A\u8FC7\u8BE5\u68C0\u67E5\u540E\u624D\u80FD\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1</li></ul></li><li>startupProbe <ul><li>\u5728\u521D\u59CB\u5316\u9636\u6BB5(Ready\u4E4B\u524D)\u8FDB\u884C\u7684\u5065\u5EB7\u68C0\u67E5\uFF0C\u901A\u5E38\u7528\u6765\u907F\u514D\u8FC7\u4E8E\u9891\u7E41\u7684\u76D1\u6D4B\u5F71\u54CD\u5E94\u7528\u542F\u52A8</li><li>\u6709\u4E9B Pod \u542F\u52A8\u6BD4\u8F83\u6162\uFF0C\u9891\u7E41\u7684 readinessProbe \u63A2\u9488\u53EF\u80FD\u53CD\u800C\u4F1A\u5F71\u54CD\u5230\u8BE5 Pod \u7684\u542F\u52A8</li></ul></li></ul><p>\u63A2\u6D4B\u65B9\u6CD5\u5305\u62EC</p><ul><li>ExecAction\uFF1A\u5728\u5BB9\u5668\u5185\u90E8\u8FD0\u884C\u6307\u5B9A\u547D\u4EE4,\u5F53\u8FD4\u56DE\u7801\u4E3A0\u65F6\uFF0C\u63A2\u6D4B\u7ED3\u679C\u4E3A\u6210\u529F</li><li>TCPSocketAction\uFF1A\u7531kubelet\u53D1\u8D77\uFF0C\u901A\u8FC7TCP\u534F\u8BAE\u68C0\u67E5\u5BB9\u5668IP\u548C\u7AEF\u53E3\uFF0C\u5F53\u7AEF\u53E3\u53EF\u8FBE\u65F6\uFF0C\u63A2\u6D4B\u7ED3\u679C\u4E3A\u6210\u529F</li><li>HTTPGetAction\uFF1A\u7531 kubelet \u53D1\u8D77\uFF0C\u5BF9 Pod \u7684 IP \u548C\u6307\u5B9A\u7AEF\u53E3\u4EE5\u53CA\u8DEF\u5F84\u8FDB\u884C HTTPGet \u64CD\u4F5C\uFF0C\u5F53\u8FD4\u56DE\u7801\u4E3A 200-400 \u4E4B\u95F4\u65F6\uFF0C\u63A2\u6D4B\u7ED3\u679C\u4E3A\u6210\u529F</li></ul><p>\u5C0F\u7ED3\uFF1A<strong>\u56E0\u4E3A livenessProbe \u6267\u884C\u524D\uFF0CPod \u72B6\u6001\u9ED8\u8BA4\u5C31\u662F\u5B58\u6D3B\uFF0C\u56E0\u6B64\u9700\u8981\u914D\u7F6E readinessProbe \u6765\u5904\u7406 livenessProbe \u8FD0\u884C\u524D\u8FD9\u6BB5\u65F6\u95F4\u7684\u72B6\u6001\uFF0C\u4FDD\u8BC1\u7528\u6237\u6D41\u91CF\u8FBE\u5230\u65F6 Pod \u4E00\u5B9A\u662F\u80FD\u63D0\u4F9B\u670D\u52A1\u7684\u3002</strong></p><p>\u4F8B\u5982\uFF1A</p><p>livenessProbe \u8BBE\u7F6E\u4E3A\u542F\u52A8\u540E 10s \u624D\u6267\u884C\u3002</p><p>\u5F53\u65F6 Pod \u4E24\u79D2\u5C31\u542F\u52A8\u5B8C\u6210\u4E86\uFF0C\u5269\u4E0B\u8FD9 8 \u79D2\u5C31\u76F4\u63A5\u4EE5 Ready \u72B6\u6001\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\u4E86\u3002\u5982\u679C\u6B64\u65F6 Pod \u4E0D\u80FD\u6B63\u5E38\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\uFF0C\u8FD9\u90E8\u5206\u8BF7\u6C42\u5C31\u4F1A\u5931\u8D25\u3002</p><p>\u56E0\u6B64\u9700\u8981\u8BBE\u7F6E readinessProbe\uFF0C\u5728 readinessProbe \u68C0\u6D4B\u901A\u8FC7\u4E4B\u524D Pod \u90FD\u4E0D\u80FD\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\u3002</p><p>\u4E3A\u4E86\u89E3\u51B3\u4E0A\u8FF0\u95EE\u9898\uFF0C\u53EF\u4EE5\u6DFB\u52A0 readinessProbe\uFF0C\u5E76\u4E14\u6700\u597D\u5728\u4E24\u79D2\u540E\u5C31\u5F00\u59CB\u68C0\u6D4B\uFF0C\u8FD9\u6837\u53EF\u4EE5\u8BA9 Pod \u80FD\u5C3D\u5FEB\u7684\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\u3002readinessProbe \u901A\u8FC7\u540E\u5C31\u53EF\u4EE5\u5BF9\u5916\u63D0\u4F9B\u670D\u52A1\u4E86\uFF0C\u7136\u540E\u540E\u7EED\u8FD0\u884C\u8FC7\u7A0B\u4E2D\u53EF\u80FD\u56E0\u4E3A\u67D0\u4E9B \u60C5\u51B5\u53C8\u4F1A\u51FA\u73B0\u5F02\u5E38\uFF0C\u8FD9\u65F6\u5C31\u9700\u8981 livenessProbe \u5728\u68C0\u6D4B\u4E86\uFF0C\u5F53 livenessProbe \u68C0\u6D4B\u5230\u4E0D\u6B63\u5E38\u65F6\u5C31\u4F1A kill \u6389\u5BB9\u5668\u8FDB\u7A0B\uFF0C\u5982\u679C\u914D\u7F6E\u4E86 \u6B63\u786E\u7684 restartPolicy \u90A3\u4E48 kubelet \u5C31\u4F1A\u91CD\u542F\u8BE5 Pod\u3002</p><h3 id="\u63A2\u9488\u5C5E\u6027" tabindex="-1"><a class="header-anchor" href="#\u63A2\u9488\u5C5E\u6027" aria-hidden="true">#</a> \u63A2\u9488\u5C5E\u6027</h3><table><thead><tr><th>\u53C2\u6570</th><th>\u63CF\u8FF0</th><th>\u9ED8\u8BA4\u503C</th></tr></thead><tbody><tr><td>initialDelaySecons</td><td>Pod \u542F\u52A8\u540E\u5EF6\u8FDF\u63A2\u6D4B\u7684\u65F6\u95F4</td><td>Defaults to 0 seconds. Minimum value is 0.</td></tr><tr><td>periodSeconds</td><td>\u63A2\u6D4B\u9891\u7387</td><td>Default to 10 seconds. Minimum value is 1.</td></tr><tr><td>timeoutSeconds</td><td>\u6BCF\u6B21\u63A2\u6D4B\u8D85\u65F6\u65F6\u95F4</td><td>Defaults to 1 second. Minimum value is 1.</td></tr><tr><td>success Threshold</td><td>\u6210\u529F\u9608\u503C\uFF0C\u8FDE\u7EED\u6210\u529F\u591A\u5C11\u6B21\u5C31\u7B97\u6210\u529F</td><td>Defaults to 1. Must be 1 for liveness. Minimum value is 1.</td></tr><tr><td>failure&#39; Threshold</td><td>\u5931\u8D25\u9608\u503C\uFF0C\u8FDE\u7EED\u5931\u8D25\u591A\u5C11\u6B21\u5C31\u7B97\u5931\u8D25</td><td>Defaults to 3. Minimum value is 1.</td></tr></tbody></table><h3 id="readinessgates" tabindex="-1"><a class="header-anchor" href="#readinessgates" aria-hidden="true">#</a> ReadinessGates</h3><ul><li>Readiness \u5141\u8BB8\u5728 Kubernetes \u81EA\u5E26\u7684 Pod Conditions \u4E4B\u5916\u5F15\u5165\u81EA\u5B9A\u4E49\u7684\u5C31\u7EEA\u6761\u4EF6</li><li>\u65B0\u5F15\u5165\u7684readinessGates condition \u9700\u8981\u4E3A True \u72B6\u6001\u540E\uFF0C\u52A0\u4E0A\u5185\u7F6E\u7684 Conditions, Pod \u624D\u53EF\u4EE5\u4E3A\u5C31\u7EEA\u72B6\u6001</li><li>\u8BE5\u72B6\u6001\u5E94\u8BE5\u7531\u67D0\u63A7\u5236\u5668\u4FEE\u6539</li></ul><p>ReadinessGates \u662F\u4E00\u4E2A hook\uFF0C\u4E3B\u8981\u7528\u4E8E\u8FDB\u884C\u6269\u5C55\u3002</p><p>\u573A\u666F\uFF1A\u67D0\u4E2A Pod \u662F\u5426 Ready\uFF0C\u9664\u4E86\u7531 k8s \u5185\u90E8\u7684\u63A2\u9488\u63A7\u5236\u4E4B\u5916\uFF0C\u53EF\u80FD\u8FD8\u9700\u8981\u7531\u67D0\u4E9B k8s \u5916\u90E8 controller \u6765\u63A7\u5236\u3002</p><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> v1
<span class="token literal-property property">kind</span><span class="token operator">:</span> Pod
<span class="token literal-property property">metadata</span><span class="token operator">:</span>
  <span class="token literal-property property">labels</span><span class="token operator">:</span>
    <span class="token literal-property property">app</span><span class="token operator">:</span> readiness<span class="token operator">-</span>gate
  <span class="token literal-property property">name</span><span class="token operator">:</span> readiness<span class="token operator">-</span>gate
<span class="token literal-property property">spec</span><span class="token operator">:</span>
  # \u914D\u7F6E\u8BE5\u5C5E\u6027\uFF0C\u6307\u5B9A\u4E00\u4E2A\u7C7B\u578B\u5373\u53EF
  <span class="token literal-property property">readinessGates</span><span class="token operator">:</span>
    <span class="token operator">-</span> conditionType<span class="token operator">:</span> <span class="token string">&quot;www.example.com/feature-1&quot;</span>  <span class="token literal-property property">containers</span><span class="token operator">:</span>
    <span class="token operator">-</span> name<span class="token operator">:</span> readiness<span class="token operator">-</span>gate
      <span class="token literal-property property">image</span><span class="token operator">:</span> nginx
<span class="token operator">--</span><span class="token operator">-</span>
<span class="token literal-property property">apiVersion</span><span class="token operator">:</span> v1
<span class="token literal-property property">kind</span><span class="token operator">:</span> Service
<span class="token literal-property property">metadata</span><span class="token operator">:</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> readiness<span class="token operator">-</span>gate
<span class="token literal-property property">spec</span><span class="token operator">:</span>
  <span class="token literal-property property">ports</span><span class="token operator">:</span>
    <span class="token operator">-</span> port<span class="token operator">:</span> <span class="token number">80</span>
      <span class="token literal-property property">protocol</span><span class="token operator">:</span> <span class="token constant">TCP</span>
      <span class="token literal-property property">targetPort</span><span class="token operator">:</span> <span class="token number">80</span>
  <span class="token literal-property property">selector</span><span class="token operator">:</span>
    <span class="token literal-property property">app</span><span class="token operator">:</span> readiness<span class="token operator">-</span>gate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BE5 Pod \u8FD0\u884C\u540E\u5C31\u4F1A\u7531\u4E8E readinessGates Not Ready \u5BFC\u81F4\u6574\u4E2A Pod \u8FDB\u5165Not Ready \u7684\u72B6\u6001\uFF0C\u76F4\u5230\u5916\u90E8\u63A7\u5236\u5668\u4FEE\u6539\u4E86 readinessGates condition \u7684\u503C\u4E3A True\u3002</p><h3 id="post-start\u548Cpre-stop-hook" tabindex="-1"><a class="header-anchor" href="#post-start\u548Cpre-stop-hook" aria-hidden="true">#</a> Post-start\u548CPre-Stop Hook</h3><p>\u5728\u542F\u52A8\u540E\u6216\u8005\u505C\u6B62\u524D\u53EF\u4EE5\u6267\u884C\u81EA\u5B9A\u4E49 hook\uFF1A</p><p><img src="http://sm.nsddd.top/sm202303091925831.png" alt="image-20230309192549695"></p><p>\u6CE8\u610F\u70B9\uFF1A</p><ul><li>\u65E0\u6CD5\u4FDD\u8BC1 postStart \u811A\u672C\u7684\u5BB9\u5668\u7684 Entrypoint \u54EA\u4E2A\u5148\u6267\u884C</li><li>postStart \u7ED3\u675F\u4E4B\u524D\uFF0C\u5BB9\u5668\u4E0D\u4F1A\u88AB\u6807\u8BB0\u4E3A Running \u72B6\u6001</li></ul><p><img src="http://sm.nsddd.top/sm202303091925137.png" alt="image-20230309192528965"></p><p>\u6CE8\u610F\u4E8B\u9879\uFF1A</p><ul><li>\u5BB9\u5668\u6709\u4E00\u4E2AterminationGracePeriodSeconds \u65F6\u95F4\uFF0C\u9ED8\u8BA4\u4E3A 30 \u79D2\uFF0C\u5982\u679C\u8D85\u8FC7\u8FD9\u4E2A\u65F6\u95F4\u4F1A\u88AB\u5F3A\u5236 kill <ul><li>\u4E00\u822C\u7528\u4E8E\u505A\u670D\u52A1\u7684\u4F18\u5316\u9000\u51FA\uFF0C\u6BD4\u5982 http \u670D\u52A1\u53EF\u4EE5\u518D\u8FD9\u6BB5\u65F6\u95F4\u628A\u5DF2\u7ECF\u8FDB\u6765\u7684\u8BF7\u6C42\u5904\u7406\u5B8C\u518D\u9000\u51FA</li></ul></li><li>\u53EA\u6709\u5F53 Pod \u88AB\u7EC8\u6B62\u65F6\uFF0CKubernetes \u624D\u4F1A\u6267\u884C preStop \u811A\u672C\uFF0C\u8FD9\u610F\u5473\u7740\u5F53 Pod \u5B8C\u6210\u6216\u5BB9\u5668\u9000\u51FA\u65F6\uFF0CpreStop \u811A\u672C\u4E0D\u4F1A\u88AB\u6267\u884C\u3002</li></ul><div class="language-jsx ext-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token literal-property property">apiVersion</span><span class="token operator">:</span> v1
<span class="token literal-property property">kind</span><span class="token operator">:</span> Pod
<span class="token literal-property property">metadata</span><span class="token operator">:</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> prestop
<span class="token literal-property property">spec</span><span class="token operator">:</span>
  <span class="token literal-property property">containers</span><span class="token operator">:</span>
    <span class="token operator">-</span> name<span class="token operator">:</span> lifecycle<span class="token operator">-</span>demo<span class="token operator">-</span>container
      <span class="token literal-property property">image</span><span class="token operator">:</span> nginx
      <span class="token literal-property property">lifecycle</span><span class="token operator">:</span>
        <span class="token literal-property property">preStop</span><span class="token operator">:</span>
          <span class="token literal-property property">exec</span><span class="token operator">:</span>
            <span class="token literal-property property">command</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;nginx -s quit; while killall -0 nginx; do sleep 1; done&quot;</span> <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="terminationgraceperiodseconds-\u7684\u5206\u89E3" tabindex="-1"><a class="header-anchor" href="#terminationgraceperiodseconds-\u7684\u5206\u89E3" aria-hidden="true">#</a> terminationGracePeriodSeconds \u7684\u5206\u89E3</h3><p>terminationGracePeriodSeconds \u5B9A\u4E49\u4E86 Pod \u9000\u51FA\u5230\u5F3A\u5236 kill \u4E2D\u95F4\u7684\u95F4\u9694\u65F6\u95F4\u3002</p><p><img src="http://sm.nsddd.top/sm202303091926192.png" alt="image-20230309192608101"></p><p>\u957F\u8FDE\u63A5\u573A\u666F\u4E0B\u5BF9 terminationGracePeriodSeconds \u4F9D\u8D56\u6BD4\u8F83\u5927\uFF0C\u6BD4\u5982\u4E00\u4E2A\u89C6\u9891\u4F1A\u8BAE\u7684\u670D\u52A1\uFF0C\u4E00\u4E2A\u89C6\u9891\u4F1A\u8BAE\u53EF\u80FD\u4E00\u5F00\u5C31\u662F\u51E0\u4E2A\u5C0F\u65F6\uFF0C\u751A\u81F3\u66F4\u957F\u65F6\u95F4\u90FD\u6709\u53EF\u80FD\uFF0C\u8FD9\u79CD\u60C5\u51B5\u4E0B\u4E1A\u52A1\u5982\u4F55\u505A\u6EDA\u52A8\u5347\u7EA7\u5462\uFF1F</p><blockquote><p>\u4E00\u5347\u7EA7\u5C31\u4F1A\u628A\u73B0\u6709\u8FDE\u63A5 kill \u6389\uFF0C\u7528\u6237\u4F53\u9A8C\u5C31\u5F88\u7CDF\u7CD5\u3002</p></blockquote><p>\u8FD9\u79CD\u60C5\u51B5\u4E0B\u5C31\u53EF\u4EE5\u628A terminationGracePeriodSeconds \u8BBE\u7F6E\u975E\u5E38\u957F\u65F6\u95F4\uFF0C\u6BD4\u5982\u8BBE\u7F6E\u4E2A 1\u5929\uFF0C\u7136\u540E\u4E1A\u52A1\u91CC\u5B9E\u73B0\u4F18\u5316\u5173\u673A\u903B\u8F91\uFF0C\u7B49\u6240\u6709\u8FDE\u63A5\u5904\u7406\u5B8C\u6210\u540E\u7A0B\u5E8F\u518D\u9000\u51FA\u3002</p><h3 id="terminating-pod\u7684\u8BEF\u7528" tabindex="-1"><a class="header-anchor" href="#terminating-pod\u7684\u8BEF\u7528" aria-hidden="true">#</a> Terminating Pod\u7684\u8BEF\u7528</h3><p>bash/sh \u4F1A\u5FFD\u7565 SIGTERM \u4FE1\u53F7\u91CF\uFF0C\u56E0\u6B64 kill -SIGTERM \u4F1A\u6C38\u8FDC\u8D85\u65F6\uFF0C\u82E5\u5E94\u7528\u4F7F\u7528 bash/sh \u4F5C\u4E3A Entrypoint, \u5219\u5E94\u907F\u514D\u8FC7\u957F\u7684 grace period\u3002</p><p>\u6839\u636E\u4E0A\u56FE\u53EF\u77E5\uFF0C\u5982\u679C Pod \u5FFD\u7565 SIGTERM \u4FE1\u53F7\u91CF\uFF0C\u90A3\u4E48\u5C31\u4F1A\u4E00\u76F4\u963B\u585E\u5728 kill -SIGTERM \u8FD9\u4E00\u6B65\uFF0C\u76F4\u5230\u6574\u4E2A grace period \u65F6\u95F4\u8017\u5C3D\u624D\u89E6\u53D1 kill -SIGKILL\u3002</p><h3 id="terminating-pod\u7684\u7ECF\u9A8C\u5206\u4EAB" tabindex="-1"><a class="header-anchor" href="#terminating-pod\u7684\u7ECF\u9A8C\u5206\u4EAB" aria-hidden="true">#</a> Terminating Pod\u7684\u7ECF\u9A8C\u5206\u4EAB</h3><p>terminationGracePeriodSeconds\u9ED8\u8BA4\u65F6\u957F30\u79D2</p><ul><li>\u5982\u679C\u4E0D\u5173\u5FC3 Pod \u7684\u7EC8\u6B62\u65F6\u957F\uFF0C\u90A3\u4E48\u65E0\u9700\u91C7\u53D6\u7279\u6B8A\u63AA\u65BD</li><li>\u5982\u679C\u5E0C\u671B\u5FEB\u901F\u7EC8\u6B62\u5E94\u7528\u8FDB\u7A0B\uFF0C\u90A3\u4E48\u53EF\u91C7\u53D6\u5982\u4E0B\u65B9\u6848 <ul><li>\u5728 preStop script \u4E2D\u4E3B\u52A8\u9000\u51FA\u8FDB\u7A0B.</li><li>\u5728\u4E3B\u5BB9\u5668\u8FDB\u7A0B\u4E2D\u4F7F\u7528\u7279\u5B9A\u7684\u521D\u59CB\u5316\u8FDB\u7A0B <ul><li>https://github.com/krallin/tini</li></ul></li></ul></li><li>\u4F18\u96C5\u7684\u521D\u59CB\u5316\u8FDB\u7A0B\u5E94\u8BE5 <ul><li>\u6B63\u786E\u5904\u7406\u7CFB\u7EDF\u4FE1\u53F7\u91CF,\u5C06\u4FE1\u53F7\u91CF\u8F6C\u53D1\u7ED9\u5B50\u8FDB\u7A0B</li><li>\u5728\u4E3B\u8FDB\u7A0B\u9000\u51FA\u4E4B\u524D\uFF0C\u9700\u8981\u5148\u7B49\u5F85\u5E76\u786E\u4FDD\u6240\u6709\u5B50\u8FDB\u7A0B\u9000\u51FA</li><li>\u76D1\u63A7\u5E76\u6E05\u7406\u5B64\u513F\u5B50\u8FDB\u7A0B</li></ul></li></ul><h2 id="\u5728-k8s-\u4E0A\u90E8\u7F72\u5E94\u7528\u7684\u6311\u6218" tabindex="-1"><a class="header-anchor" href="#\u5728-k8s-\u4E0A\u90E8\u7F72\u5E94\u7528\u7684\u6311\u6218" aria-hidden="true">#</a> \u5728 k8s \u4E0A\u90E8\u7F72\u5E94\u7528\u7684\u6311\u6218</h2><p>\u8D44\u6E90\u89C4\u5212</p><ul><li>\u6BCF\u4E2A\u5B9E\u4F8B\u9700\u8981\u591A\u5C11\u8BA1\u7B97\u8D44\u6E90 <ul><li>CPU/GPU?</li><li>Memory</li></ul></li><li>\u8D85\u552E\u9700\u6C42</li><li>\u6BCF\u4E2A\u5B9E\u4F8B\u9700\u8981\u591A\u5C11\u5B58\u50A8\u8D44\u6E90 <ul><li>\u5927\u5C0F</li><li>\u672C\u5730\u8FD8\u662F\u7F51\u76D8</li><li>\u8BFB\u5199\u6027\u80FD</li><li>Disk IO</li></ul></li><li>\u7F51\u7EDC\u9700\u6C42 <ul><li>\u6574\u4E2A\u5E94\u7528\u603B\u4F53QPS\u548C\u5E26\u5BBD</li></ul></li></ul><h3 id="\u5B58\u50A8\u5E26\u6765\u7684\u6311\u6218" tabindex="-1"><a class="header-anchor" href="#\u5B58\u50A8\u5E26\u6765\u7684\u6311\u6218" aria-hidden="true">#</a> \u5B58\u50A8\u5E26\u6765\u7684\u6311\u6218</h3><p>\u591A\u5BB9\u5668\u4E4B\u95F4\u5171\u4EAB\u5B58\u50A8\uFF0C\u6700\u7B80\u65B9\u6848\u662F emptyDir</p><p>\u5E26\u6765\u7684\u6311\u6218\uFF1A</p><ul><li>emptyDir \u9700\u8981\u63A7\u5236 size limt,\u5426\u5219\u65E0\u9650\u6269\u5F20\u7684\u5E94\u7528\u4F1A\u6491\u7206\u4E3B\u673A\u78C1\u76D8\u5BFC\u81F4\u4E3B\u673A\u4E0D\u53EF\u7528,\u8FDB\u800C\u5BFC\u81F4\u5927\u89C4\u6A21\u96C6\u7FA4\u6545\u969C</li><li>emptyDir size limit \u751F\u6548\u4EE5\u540E, kubelet \u4F1A\u5B9A\u671F\u5BF9\u5BB9\u5668\u76EE\u5F55\u6267\u884C\u8BFB\u64CD\u4F5C\uFF0C\u4F1A\u5BFC\u81F4\u4E9B\u8BB8\u7684\u6027\u80FD\u5F71\u54CD.</li><li>size limit \u8FBE\u5230\u4EE5\u540E\uFF0CPod \u4F1A\u88AB\u9A71\u9010\uFF0C\u539F Pod \u7684\u65E5\u5FD7\u914D\u7F6E\u7B49\u4FE1\u606F\u4F1A\u6D88\u5931</li></ul><h3 id="\u5E94\u7528\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u5E94\u7528\u914D\u7F6E" aria-hidden="true">#</a> \u5E94\u7528\u914D\u7F6E</h3><p>\u4F20\u5165\u65B9\u5F0F</p><ul><li>Environment Variables</li><li>Volume Mount</li></ul><p>\u6570\u636E\u6765\u6E90</p><ul><li>ConfigMap</li><li>Secret</li><li>Downward API</li></ul><h3 id="\u6570\u636E\u5E94\u8BE5\u5982\u4F55\u4FDD\u5B58" tabindex="-1"><a class="header-anchor" href="#\u6570\u636E\u5E94\u8BE5\u5982\u4F55\u4FDD\u5B58" aria-hidden="true">#</a> \u6570\u636E\u5E94\u8BE5\u5982\u4F55\u4FDD\u5B58</h3><table><thead><tr><th>\u5B58\u50A8\u5377\u7C7B\u578B</th><th>\u5BB9\u5668\u91CD\u542F\u540E\u662F\u5426\u5B58\u5728</th><th>Pod \u91CD\u5EFA\u540E\u6570\u636E\u662F\u5426\u5B58\u5728</th><th>\u662F\u5426\u6709\u5927\u5C0F\u63A7\u5236</th><th>\u6CE8\u610F\u4E8B\u9879</th></tr></thead><tbody><tr><td>emptyDir</td><td>\u662F</td><td>\u5426</td><td>\u662F</td><td></td></tr><tr><td>hostPath</td><td>\u662F</td><td>\u5426</td><td>\u5426</td><td>\u9700\u8981\u989D\u5916\u6743\u9650\u63A7\u5236</td></tr><tr><td>Local Volume</td><td>\u662F</td><td>\u5426</td><td>\u662F</td><td>\u65E0\u5907\u4EFD</td></tr><tr><td>Network Volume</td><td>\u662F</td><td>\u662F</td><td>\u662F</td><td></td></tr><tr><td>rootFS</td><td>\u5426</td><td>\u5426</td><td>\u5426</td><td>\u4E0D\u8981\u5199\u4EFB\u4F55\u6570\u636E</td></tr></tbody></table><p>\u6CE8\u610F\u63A7\u5236\u65E5\u5FD7\u5199\u5165\u901F\u5EA6\uFF0C\u9632\u6B62\u64CD\u4F5C\u7CFB\u7EDF\u5728\u914D\u7F6E\u65E5\u5FD7\u6EDA\u52A8\u7A97\u53E3\u671F\u628A\u786C\u76D8\u5199\u6EE1\u3002</p><h3 id="\u5BB9\u5668\u5E94\u7528\u53EF\u80FD\u9762\u4E34\u7684\u8FDB\u7A0B\u4E2D\u65AD" tabindex="-1"><a class="header-anchor" href="#\u5BB9\u5668\u5E94\u7528\u53EF\u80FD\u9762\u4E34\u7684\u8FDB\u7A0B\u4E2D\u65AD" aria-hidden="true">#</a> \u5BB9\u5668\u5E94\u7528\u53EF\u80FD\u9762\u4E34\u7684\u8FDB\u7A0B\u4E2D\u65AD</h3><table><thead><tr><th>\u7C7B\u578B</th><th>\u5F71\u54CD</th><th>\u5EFA\u8BAE</th><th>\u5907\u6CE8</th></tr></thead><tbody><tr><td>kubelet \u5347\u7EA7</td><td>\u4E0D\u91CD\u5EFA\u5BB9\u5668</td><td>\u65E0\u5F71\u54CD</td><td></td></tr><tr><td>kubelet \u5347\u7EA7\uFF08\u67D0\u51E0\u4E2A\u7248\u672C\uFF09</td><td>\u91CD\u5EFA\u5BB9\u5668Pod \u8FDB\u7A0B\u4F1A\u88AB\u91CD\u542F</td><td>\u5197\u4F59\u90E8\u7F72\u8DE8\u6545\u969C\u57DF\u90E8\u7F72</td><td>kubelet \u5982\u4F55\u5224\u65AD Pod \u662F\u5426\u542F\u52A8\uFF1F\u8BA1\u7B97 hash \u503C\uFF0C\u548C etcd \u4E2D\u7684 Pod \u8FDB\u884C\u5BF9\u6BD4\uFF0C\u5982\u679C\u4E0D\u4E00\u81F4\u5219\u8BA4\u4E3A\u6CA1\u6709\u542F\u52A8\uFF0C\u4F1A\u91CD\u65B0\u62C9\u53D6 Pod\u3002\u800C\u6709\u51E0\u4E2A\u7248\u672C k8s \u4E2D\u5BF9\u8BA1\u7B97 hash \u503C\u7684\u65B9\u6CD5\u8FDB\u884C\u4E86\u4FEE\u6539\uFF0C\u56E0\u6B64\u5347\u7EA7\u5230\u8BE5\u7248\u672C\u540E kubelet \u4F1A\u8BA4\u4E3A Pod \u6CA1\u6709\u88AB\u542F\u52A8\uFF0C\u53C8\u91CD\u65B0\u521B\u5EFA Pod\uFF0C\u5BF9\u4E1A\u52A1\u5F71\u54CD\u6BD4\u8F83\u5927</td></tr><tr><td>\u4E3B\u673A\u64CD\u4F5C\u7CFB\u7EDF\u5347\u7EA7\u624B\u5DE5\u8282\u70B9\u91CD\u542F</td><td>\u8282\u70B9\u91CD\u542FPod \u8FDB\u7A0B\u4F1A\u88AB\u7EC8\u6B62\u6570\u5206\u949F\uFF0810\u5206\u949F\u5DE6\u53F3\uFF09</td><td>\u8DE8\u6545\u969C\u57DF\u90E8\u7F72\u589E\u52A0 liveiness\u3001readiness \u63A2\u9488\u8BBE\u7F6E\u5408\u7406\u7684 NotReady node \u7684 toleration</td><td></td></tr><tr><td>\u8282\u70B9\u4E0B\u67B6\uFF0C\u9001\u4FEE</td><td>\u8282\u70B9\u4F1A drain\uFF0C\u91CD\u542F\u6216\u4ECE\u96C6\u7FA4\u4E2D\u5220\u9664Pod \u8FDB\u7A0B\u4F1A\u88AB\u7EC8\u6B62\u6570\u5206\u949F</td><td>\u8DE8\u6545\u969C\u57DF\u90E8\u7F72\u5229\u7528 Pod disruption budget \u907F\u514D\u8282\u70B9\u88AB drain \u5BFC\u81F4 Pod \u88AB\u610F\u5916\u5220\u9664\u800C\u5F71\u54CD\u4E1A\u52A1\u5229\u7528 preStop script \u505A\u6570\u636E\u5907\u4EFD\u7B49\u64CD\u4F5C</td><td>\u56E0\u6B64\u5347\u7EA7 k8s \u7248\u672C\u4E4B\u524D\u9700\u8981\u8BA4\u771F\u67E5\u770B\u6BCF\u4E2A\u7248\u672C\u7684 changelog\u3002\u6BD4\u5982Pod\u67093\u526F\u672C\uFF0C\u7ED3\u679C\u8BE5\u8282\u70B9\u4E0A\u5C31\u6709\u4E24\u4E2A\uFF0C\u4E00\u4E0B\u5B50 drain \u6389\u4E24\u4E2A 2/3 \u526F\u672C\u6570\u53EF\u80FD\u4F1A\u4E1A\u52A1\u5C31\u4F1A\u6709\u6BD4\u8F83\u5927\u7684\u5F71\u54CD</td></tr><tr><td></td><td>pod will</td><td>\u8DE8\u6545\u969C\u57DF\u90E8\u7F72\u8BBE\u7F6E\u5408\u7406\u7684 NotReady node \u7684 toleration</td><td></td></tr><tr><td>\u8282\u70B9\u5D29\u6E83</td><td>Pod \u8FDB\u7A0B\u4F1A\u88AB\u7EC8\u6B62 15 \u5206\u949F\u5DE6\u53F3</td><td>\u8DE8\u6545\u969C\u57DF\u90E8\u7F72</td><td></td></tr></tbody></table><h3 id="\u9AD8\u53EF\u7528\u90E8\u7F72\u65B9\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u9AD8\u53EF\u7528\u90E8\u7F72\u65B9\u5F0F" aria-hidden="true">#</a> \u9AD8\u53EF\u7528\u90E8\u7F72\u65B9\u5F0F</h3><p>\u591A\u5C11\u5B9E\u4F8B</p><p>\u66F4\u65B0\u7B56\u7565</p><ul><li>maxSurge</li><li>maxUnavalibale\uFF08\u9700\u8981\u8003\u8651 ResourceQuota \u7684\u9650\u5236\uFF09 <ul><li>\u6BD4\u5982\u5F53\u524D Pod \u526F\u672C\u6570\u5DF2\u7ECF\u628A ResourceQuota \u5360\u6EE1\u4E86\uFF0C\u7136\u540E maxUnavalibale \u8FD8\u914D\u7F6E\u4E3A 0\uFF0C\u6EDA\u52A8\u66F4\u65B0\u65F6\u52BF\u5FC5\u8981\u542F\u52A8\u65B0 Pod\uFF0C\u7136\u540E\u53C8\u4F1A\u88AB ResourceQuota \u5361\u4F4F\uFF0C\u5BFC\u81F4\u4E00\u81F4\u65E0\u6CD5\u66F4\u65B0</li></ul></li></ul><p>\u6DF1\u5165\u7406\u89E3 PodTemplateHash \u5BFC\u81F4\u7684\u5E94\u7528\u7684\u6613\u53D8\u6027</p><h2 id="\u8BFE\u540E\u4F5C\u4E1A" tabindex="-1"><a class="header-anchor" href="#\u8BFE\u540E\u4F5C\u4E1A" aria-hidden="true">#</a> \u8BFE\u540E\u4F5C\u4E1A</h2><p>\u73B0\u5728\u4F60\u5BF9 Kubernetes \u7684\u63A7\u5236\u9762\u677F\u7684\u5DE5\u4F5C\u673A\u5236\u662F\u5426\u6709\u4E86\u6DF1\u5165\u7684\u4E86\u89E3\u5462?</p><p>\u662F\u5426\u5BF9\u5982\u4F55\u6784\u5EFA\u4E00\u4E2A\u4F18\u96C5\u7684\u4E91\u4E0A\u5E94\u7528\u6709\u4E86\u6DF1\u523B\u7684\u8BA4\u8BC6\uFF0C\u90A3\u4E48\u63A5\u4E0B\u6765\u7528\u6700\u8FD1\u5B66\u8FC7\u7684\u77E5\u8BC6\u628A\u4F60\u4E4B\u524D\u7F16\u5199\u7684 http \u4EE5\u4F18\u96C5\u7684\u65B9\u5F0F\u90E8\u7F72\u8D77\u6765\u5427\uFF0C\u4F60\u53EF\u80FD\u9700\u8981\u5BA1\u89C6\u4E4B\u524D\u4EE3\u7801\u662F\u5426\u80FD\u6EE1\u8DB3\u4F18\u96C5\u4E0A\u4E91\u7684\u9700\u6C42\u3002</p><p>\u4F5C\u4E1A\u8981\u6C42\uFF1A\u7F16\u5199 Kubernetes \u90E8\u7F72\u811A\u672C\u5C06 httpserver \u90E8\u7F72\u5230 kubernetes \u96C6\u7FA4\uFF0C\u4EE5\u4E0B\u662F\u4F60\u53EF\u4EE5\u601D\u8003\u7684\u7EF4\u5EA6\uFF1A</p><ul><li>\u4F18\u96C5\u542F\u52A8</li><li>\u4F18\u96C5\u7EC8\u6B62</li><li>\u8D44\u6E90\u9700\u6C42\u548C QoS \u4FDD\u8BC1</li><li>\u63A2\u6D3B</li><li>\u65E5\u5E38\u8FD0\u7EF4\u9700\u6C42\uFF0C\u65E5\u5FD7\u7B49\u7EA7</li><li>\u914D\u7F6E\u548C\u4EE3\u7801\u5206\u79BB</li></ul><h2 id="end-\u94FE\u63A5" tabindex="-1"><a class="header-anchor" href="#end-\u94FE\u63A5" aria-hidden="true">#</a> END \u94FE\u63A5</h2><ul><li><div><a href="53.md" style="float:left;">\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} </a><a href="55.md" style="float:right;"> \uFE0F\u4E0B\u4E00\u8282\u{1F517}</a></div></li></ul>`,108),f=t("\u24C2\uFE0F\u56DE\u5230\u76EE\u5F55\u{1F3E0}"),x={href:"https://nsddd.top/archives/contributors",target:"_blank",rel:"noopener noreferrer"},S=e("strong",null,"\u{1FAF5}\u53C2\u4E0E\u8D21\u732E\u{1F49E}\u2764\uFE0F\u200D\u{1F525}\u{1F496}",-1),_=t(")"),E=t("\u2734\uFE0F\u7248\u6743\u58F0\u660E \xA9 \uFF1A\u672C\u4E66\u6240\u6709\u5185\u5BB9\u9075\u5FAA"),C={href:"http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},T=t("CC-BY-SA 3.0\u534F\u8BAE\uFF08\u7F72\u540D-\u76F8\u540C\u65B9\u5F0F\u5171\u4EAB\uFF09\xA9");function G(R,q){const s=n("ExternalLinkIcon"),r=n("RouterLink");return i(),d("div",null,[e("ul",null,[e("li",null,[e("a",u,[h,a(s)])])]),b,m,P,e("blockquote",null,[e("p",null,[k,e("a",v,[g,a(s)])])]),y,e("ul",null,[e("li",null,[e("p",null,[a(r,{to:"/"},{default:l(()=>[f]),_:1})])]),e("li",null,[e("p",null,[e("a",x,[S,a(s)]),_])]),e("li",null,[e("p",null,[E,e("a",C,[T,a(s)])])])])])}const I=o(c,[["render",G],["__file","54.html.vue"]]);export{I as default};
