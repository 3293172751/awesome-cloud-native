import{_ as l,r as t,o as r,c,a as e,b as n,w as d,e as s,d as o}from"./app.2d12850e.js";const p={},u={href:"http://nsddd.top",target:"_blank",rel:"noopener noreferrer"},h=s("author"),b=e("h1",{id:"\u7B2C20\u8282-\u65B0\u4F1A\u8BAE\u6539\u53D8basefs",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u7B2C20\u8282-\u65B0\u4F1A\u8BAE\u6539\u53D8basefs","aria-hidden":"true"},"#"),s(" \u7B2C20\u8282 \u65B0\u4F1A\u8BAE\u6539\u53D8basefs")],-1),_=e("div",null,[e("a",{href:"19.md",style:{float:"left"}},"\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} "),e("a",{href:"21.md",style:{float:"right"}}," \u2B07\uFE0F\u4E0B\u4E00\u8282\u{1F517}")],-1),m=e("br",null,null,-1),k=s("\u2764\uFE0F\u{1F495}\u{1F495}\u8BB0\u5F55"),v={href:"https://github.com/cubxxw/sealos",target:"_blank",rel:"noopener noreferrer"},f=s("sealos"),g=s("\u5F00\u6E90\u9879\u76EE\u7684\u5B66\u4E60\u8FC7\u7A0B\u3002"),y={href:"https://github.com/cubxxw/sealos",target:"_blank",rel:"noopener noreferrer"},x=s("k8s,docker\u548C\u4E91\u539F\u751F\u7684\u5B66\u4E60"),w=s("\u3002Myblog:"),C={href:"http://nsddd.top/",target:"_blank",rel:"noopener noreferrer"},E=s("http://nsddd.top"),z=e("hr",null,null,-1),L=e("p",null,"[TOC]",-1),M=e("h2",{id:"\u5F00\u59CB",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u5F00\u59CB","aria-hidden":"true"},"#"),s(" \u5F00\u59CB")],-1),N=s("add image spec definition "),R={href:"https://github.com/sealerio/sealer/pull/1915",target:"_blank",rel:"noopener noreferrer"},A=s("#1915"),O=s("New design for basefs "),B={href:"https://github.com/sealerio/sealer/pull/1909",target:"_blank",rel:"noopener noreferrer"},F=s("#1909"),H=s("sealer new doc "),I={href:"https://github.com/sealerio/sealer.cool/issues/15",target:"_blank",rel:"noopener noreferrer"},V=s("sealerio/sealer.cool#15"),q=s("More detail about How to implement image policy for sealer using Kyverno "),D={href:"https://github.com/sealerio/sealer/issues/1899",target:"_blank",rel:"noopener noreferrer"},Y=s("#1899"),P=s("sealer CI e2e-test by using github action "),S={href:"https://github.com/sealerio/sealer/issues/1633",target:"_blank",rel:"noopener noreferrer"},T=s("#1633"),j=e("hr",null,null,-1),K=e("p",null,[e("strong",null,"\u5173\u4E8Ebasefs \u7684\u8BBE\u8BA1\uFF1A")],-1),U={href:"https://github.com/sealerio/basefs",target:"_blank",rel:"noopener noreferrer"},W=s("https://github.com/sealerio/basefs"),G=e("h2",{id:"\u5173\u4E8Erootfs\u7684\u5B89\u6392",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u5173\u4E8Erootfs\u7684\u5B89\u6392","aria-hidden":"true"},"#"),s(" \u5173\u4E8Erootfs\u7684\u5B89\u6392")],-1),J={href:"https://github.com/sealerio/sealer/pull/1909",target:"_blank",rel:"noopener noreferrer"},Q=s("https://github.com/sealerio/sealer/pull/1909"),X=e("h2",{id:"\u63CF\u8FF0",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u63CF\u8FF0","aria-hidden":"true"},"#"),s(" \u63CF\u8FF0")],-1),Z=s("\u7B7E\u5B57\u4EBA\uFF1Ahuaiyou "),$={href:"https://mail.google.com/mail/?view=cm&fs=1&tf=1&to=huaiyou.cyz@alibaba-inc.com",target:"_blank",rel:"noopener noreferrer"},ee=s("huaiyou.cyz@alibaba-inc.com"),se=o('<p>\u4E3A\u4E86\u65B9\u4FBF\u57FA\u7840\u955C\u50CF\u5236\u4F5C\u8005\u7684\u4F7F\u7528\uFF0C\u6211\u4EEC\u9700\u8981\u5BF9 sealer \u7684 rootfs \u5B9A\u4E49\u8FDB\u884C\u89C4\u8303\u3002</p><p><strong>\u6211\u4E3B\u8981\u505A\u4E86\u4EE5\u4E0B\u8BBE\u8BA1\uFF1A</strong></p><ol><li><code>bin</code> \u7B49\u548C <code>plugins</code> \u7684\u7528\u9014\u57FA\u672C\u76F8\u540C\uFF0C\u53EA\u662F\u660E\u786E\u4E86\u4F7F\u7528\u65B9\u6CD5\u3002</li><li>\u9610\u660E Metadata\u3001README.md \u548C imageList \u7684\u7528\u9014\u3002</li><li>\u65B0\u589E yamls \u548C charts \u4E24\u4E2A\u76EE\u5F55\uFF0C\u4E3A\u7528\u6237\u63D0\u4F9B\u66F4\u7075\u6D3B\u6269\u5C55\u57FA\u7840\u955C\u50CF\u7684\u80FD\u529B\u3002</li><li>\u6700\u540E\u660E\u786E\u4E86scripts\u4E0B\u4E0D\u540C\u811A\u672C\u7684\u7528\u9014\u3002</li></ol><p>\u4E3A\u4E86\u65B9\u4FBF\u57FA\u7840\u955C\u50CF\u5236\u4F5C\u8005\u7684\u4F7F\u7528\uFF0C\u6211\u4EEC\u9700\u8981\u6807\u51C6\u5316 sealer \u7684 rootfs \u7684\u5B9A\u4E49\u3002</p><p>\u6211\u4E3B\u8981\u505A\u4E86\u4EE5\u4E0B\u8BBE\u8BA1\uFF1A</p><ol><li><code>bin</code>\uFF0C<code>etc</code>\uFF0C<code>plugins</code> \u8FD9\u51E0\u4E2A\u76EE\u5F55\u7684\u4F7F\u7528\u57FA\u672C\u4E0D\u53D8\uFF0C\u53EA\u662F\u660E\u786E\u4E86\u4F7F\u7528\u65B9\u5F0F\u3002</li><li>\u660E\u786E\u5B9A <code>scripts</code> \u4E0B\u7684\u4E0D\u540C\u811A\u672C\u7684\u7528\u9014\u3002</li></ol><h2 id="\u8BBE\u8BA1\u89C4\u8303" tabindex="-1"><a class="header-anchor" href="#\u8BBE\u8BA1\u89C4\u8303" aria-hidden="true">#</a> \u8BBE\u8BA1\u89C4\u8303</h2>',7),ne={href:"https://github.com/sealerio/sealer/blob/ec9d2b561eaa20ff59bea28303669b3da0d7c4dd/docs/api/cloudrootfs.md",target:"_blank",rel:"noopener noreferrer"},ae=s("https://github.com/sealerio/sealer/blob/ec9d2b561eaa20ff59bea28303669b3da0d7c4dd/docs/api/cloudrootfs.md"),te=o(`<h2 id="cloud-rootfs" tabindex="-1"><a class="header-anchor" href="#cloud-rootfs" aria-hidden="true">#</a> cloud rootfs</h2><p>cloud rootfs will package all the dependencies refers to the kubernetes cluster requirements</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token punctuation">.</span>
\u251C\u2500\u2500 bin # binaries will be installed at all nodes&#39; <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin
\u2502   \u251C\u2500\u2500 conntrack
\u2502   \u251C\u2500\u2500 containerd<span class="token operator">-</span>rootless<span class="token operator">-</span>setuptool<span class="token punctuation">.</span>sh
\u2502   \u251C\u2500\u2500 containerd<span class="token operator">-</span>rootless<span class="token punctuation">.</span>sh
\u2502   \u251C\u2500\u2500 crictl
\u2502   \u251C\u2500\u2500 kubeadm
\u2502   \u251C\u2500\u2500 kubectl
\u2502   \u251C\u2500\u2500 kubelet
\u2502   \u251C\u2500\u2500 nerdctl
\u2502   \u251C\u2500\u2500 kubelet<span class="token operator">-</span>pre<span class="token operator">-</span>start<span class="token punctuation">.</span>sh
\u2502   \u251C\u2500\u2500 helm
\u2502   \u2514\u2500\u2500 seautil
\u251C\u2500\u2500 etc # configs will be put into all nodes&#39; sealer<span class="token operator">-</span>rootfs
\u2502   \u251C\u2500\u2500 <span class="token number">10</span><span class="token operator">-</span>kubeadm<span class="token punctuation">.</span>conf
\u2502   \u251C\u2500\u2500 daemon<span class="token punctuation">.</span>json
\u2502   \u251C\u2500\u2500 docker<span class="token punctuation">.</span>service
\u2502   \u251C\u2500\u2500 audit<span class="token operator">-</span>policy<span class="token punctuation">.</span>yml
\u2502   \u251C\u2500\u2500 kubeadm<span class="token operator">-</span>config<span class="token punctuation">.</span>yaml
\u2502   \u251C\u2500\u2500 kubeadm<span class="token operator">-</span>config<span class="token punctuation">.</span>yaml<span class="token punctuation">.</span>tmpl # a<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">.</span>tmpl will be rendered using envs and rename to a<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c
\u2502   \u2514\u2500\u2500 kubelet<span class="token punctuation">.</span>service
\u251C\u2500\u2500 plugins # plugins can run on some hooks<span class="token punctuation">,</span> such as pre<span class="token operator">-</span>init<span class="token operator">-</span>host<span class="token punctuation">,</span> post<span class="token operator">-</span>install<span class="token punctuation">,</span> see more in the plugins documentation
\u2502   \u2514\u2500\u2500 disk_init_shell_plugin<span class="token punctuation">.</span>yaml
\u251C\u2500\u2500 scripts # scripts can use all ClusterFile&#39;s env as Linux env variables
\u2502   \u251C\u2500\u2500 init<span class="token operator">-</span>kube<span class="token punctuation">.</span>sh # initialize kube<span class="token operator">*</span> binaries on target hosts
\u2502   \u251C\u2500\u2500 clean<span class="token operator">-</span>kube<span class="token punctuation">.</span>sh # remove kube<span class="token operator">*</span> binaries from target hosts
\u2502   \u251C\u2500\u2500 init<span class="token operator">-</span>container<span class="token operator">-</span>runtime<span class="token punctuation">.</span>sh # initialize container runtime binaries on target hosts
\u2502   \u251C\u2500\u2500 clean<span class="token operator">-</span>container<span class="token operator">-</span>runtime<span class="token punctuation">.</span>sh # remove container runtime binaries on target hosts
\u2502   \u2514\u2500\u2500 init<span class="token operator">-</span>registry<span class="token punctuation">.</span>sh # initialize registry on local registry&#39;s deploy<span class="token operator">-</span>hosts
\u2514\u2500\u2500 applications # applications put here
\u2502   \u251C\u2500\u2500 redis
\u2502   \u2514\u2500\u2500 mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Using cloud rootfs to build a base cloudImage:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>FROM scratch
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
sealer build <span class="token parameter variable">-t</span> kuberntes:v1.18.3 <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="hooks" tabindex="-1"><a class="header-anchor" href="#hooks" aria-hidden="true">#</a> Hooks</h2><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> kubernetes:1.18.3</span>
<span class="token instruction"><span class="token keyword">COPY</span> preHook.sh /scripts/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>preHook.sh will execute after init.sh before kubeadm init master0</p><h2 id="registry" tabindex="-1"><a class="header-anchor" href="#registry" aria-hidden="true">#</a> Registry</h2><p>registry container name must be &#39;sealer-registry&#39;</p><h2 id="end-\u94FE\u63A5" tabindex="-1"><a class="header-anchor" href="#end-\u94FE\u63A5" aria-hidden="true">#</a> END \u94FE\u63A5</h2><ul><li><div><a href="19.md" style="float:left;">\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} </a><a href="21.md" style="float:right;"> \uFE0F\u4E0B\u4E00\u8282\u{1F517}</a></div></li></ul>`,12),oe=s("\u24C2\uFE0F\u56DE\u5230\u76EE\u5F55\u{1F3E0}"),ie={href:"https://nsddd.top/archives/contributors",target:"_blank",rel:"noopener noreferrer"},le=e("strong",null,"\u{1FAF5}\u53C2\u4E0E\u8D21\u732E\u{1F49E}\u2764\uFE0F\u200D\u{1F525}\u{1F496}",-1),re=s(")"),ce=s("\u2734\uFE0F\u7248\u6743\u58F0\u660E \xA9 \uFF1A\u672C\u4E66\u6240\u6709\u5185\u5BB9\u9075\u5FAA"),de={href:"http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},pe=s("CC-BY-SA 3.0\u534F\u8BAE\uFF08\u7F72\u540D-\u76F8\u540C\u65B9\u5F0F\u5171\u4EAB\uFF09\xA9");function ue(he,be){const a=t("ExternalLinkIcon"),i=t("RouterLink");return r(),c("div",null,[e("ul",null,[e("li",null,[e("a",u,[h,n(a)])])]),b,_,m,e("blockquote",null,[e("p",null,[k,e("a",v,[f,n(a)]),g,e("a",y,[x,n(a)]),w,e("a",C,[E,n(a)])])]),z,L,M,e("ul",null,[e("li",null,[N,e("a",R,[A,n(a)])]),e("li",null,[O,e("a",B,[F,n(a)])]),e("li",null,[H,e("a",I,[V,n(a)])]),e("li",null,[q,e("a",D,[Y,n(a)])]),e("li",null,[P,e("a",S,[T,n(a)])])]),j,K,e("ul",null,[e("li",null,[e("a",U,[W,n(a)])])]),G,e("ul",null,[e("li",null,[e("a",J,[Q,n(a)])])]),X,e("p",null,[Z,e("a",$,[ee,n(a)])]),se,e("ul",null,[e("li",null,[e("a",ne,[ae,n(a)])])]),te,e("ul",null,[e("li",null,[e("p",null,[n(i,{to:"/"},{default:d(()=>[oe]),_:1})])]),e("li",null,[e("p",null,[e("a",ie,[le,n(a)]),re])]),e("li",null,[e("p",null,[ce,e("a",de,[pe,n(a)])])])])])}const me=l(p,[["render",ue],["__file","20.html.vue"]]);export{me as default};
