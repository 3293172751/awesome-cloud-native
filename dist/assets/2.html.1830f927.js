import{_ as o,r as l,o as c,c as i,a as n,b as a,w as u,e as s,d as t}from"./app.5bf1abd2.js";const r={},d={href:"http://nsddd.top",target:"_blank",rel:"noopener noreferrer"},k=s("author"),m=n("h1",{id:"\u7B2C2\u8282-\u4F7F\u7528-sealos-\u642D\u5EFA-k8s-helm\u5B66\u4E60",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u7B2C2\u8282-\u4F7F\u7528-sealos-\u642D\u5EFA-k8s-helm\u5B66\u4E60","aria-hidden":"true"},"#"),s(" \u7B2C2\u8282 \u4F7F\u7528 sealos \u642D\u5EFA k8s\uFF0Chelm\u5B66\u4E60")],-1),v=n("br",null,null,-1),b=n("div",null,[n("a",{href:"1.md",style:{float:"left"}},"\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} "),n("a",{href:"3.md",style:{float:"right"}}," \u2B07\uFE0F\u4E0B\u4E00\u8282\u{1F517}")],-1),h=n("br",null,null,-1),g=s("\u2764\uFE0F\u{1F495}\u{1F495}\u8BB0\u5F55"),y={href:"https://github.com/cubxxw/sealos",target:"_blank",rel:"noopener noreferrer"},_=s("sealos"),f=s("\u5F00\u6E90\u9879\u76EE\u7684\u5B66\u4E60\u8FC7\u7A0B\u3002"),q={href:"https://github.com/cubxxw/sealos",target:"_blank",rel:"noopener noreferrer"},x=s("k8s,docker\u548C\u4E91\u539F\u751F\u7684\u5B66\u4E60"),C=s("\u3002Myblog:"),w={href:"http://nsddd.top/",target:"_blank",rel:"noopener noreferrer"},$=s("http://nsddd.top"),A=n("hr",null,null,-1),D=n("p",null,"[TOC]",-1),E=n("h2",{id:"\u5173\u4E8Esealos\u642D\u5EFAk8s",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u5173\u4E8Esealos\u642D\u5EFAk8s","aria-hidden":"true"},"#"),s(" \u5173\u4E8Esealos\u642D\u5EFAk8s")],-1),T=s("[x] "),V={href:"https://docker.nsddd.top/Cloud-Native-k8s/6.html",target:"_blank",rel:"noopener noreferrer"},N=s("\u6587\u6863\u5730\u5740"),P=t(`<h2 id="\u5173\u4E8Esealos" tabindex="-1"><a class="header-anchor" href="#\u5173\u4E8Esealos" aria-hidden="true">#</a> \u5173\u4E8Esealos</h2><p><img src="http://sm.nsddd.top/smimage-20221023205145184.png" alt="image-20221023205145184"></p><div class="custom-container tip"><p class="custom-container-title">sealos\u5C31\u662F\uFF1F</p><p>sealos \u662F\u7528\u6765\u7BA1\u7406\u6570\u636E\u4E2D\u5FC3\u6240\u6709\u673A\u5668\u7684\u4E91\u64CD\u4F5C\u7CFB\u7EDF\uFF0Ckubernetes \u5C31\u662F\u8FD9\u4E2A\u64CD\u4F5C\u7CFB\u7EDF\u7684\u5185\u6838\uFF0Csealos\u4E0A \u9762\u4F1A\u8DD1\u5404\u79CD\u5404\u6837\u7684\u5206\u5E03\u5F0F\u5E94\u7528\u3002</p><ul><li>\u65E9\u671F\u5355\u673A\u64CD\u4F5C\u7CFB\u7EDF\u4E5F\u662F\u5206\u5C42\u67B6\u6784\uFF0C\u540E\u9762\u624D\u6F14\u5316\u6210\u4ECA\u5929\u7684\u5B8F\u5185\u6838\u5FAE\u5185\u6838\u67B6\u6784\uFF0C\u4E91\u64CD\u4F5C\u7CFB\u7EDF\u4E5F\u4E00\u5B9A\u4F1A\u6709\u7C7B\u4F3C\u53D1\u5C55\u8D8B\u52BF\u3002</li><li>\u4EE5\u524D\u90FD\u662F\u5355\u673A\u5E94\u7528\uFF0C\u800C\u73B0\u4EE3\u5E94\u7528\u51E0\u4E4E\u90FD\u662F\u5206\u5E03\u5F0F\u5E94\u7528\uFF0Ckubernetes \u5DF2\u7ECF\u6210\u4E3A\u4E8B\u5B9E\u4E0A\u7684\u201C\u4E91\u64CD\u4F5C\u7CFB\u7EDF\u5185\u6838\u201D\uFF0C\u80FD\u8BA9\u5185\u6838\u666E\u53CA\u7684\u53D1\u578B\u7248\u547C\u4E4B\u6B32\u51FA\u3002</li><li>sealos \u629B\u5F03\u4E86 IaaS, \u57FA\u4E8E\u4E91\u5185\u6838\u7684\u9AD8\u5185\u805A\u8BBE\u8BA1\uFF0C\u51B3\u5B9A\u4E86 sealos \u53EF\u4EE5\u8BA9\u4E91\u66F4\u7B80\u5355\uFF0C\u66F4\u4FBF\u5B9C\uFF0C\u4ECE\u800C\u50CF linux \u53D1\u884C\u7248\u4E00\u6837\u666E\u53CA\u3002</li></ul></div><h2 id="\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> \u89E3\u51B3\u65B9\u6848</h2><p><img src="http://sm.nsddd.top/smimage-20221023205623196.png" alt="image-20221023205623196"></p><blockquote><p>\u63D0\u4F9B\u4E00\u4E2A\u5F00\u6E90\u5F00\u653E\u7684\u4E91\u64CD\u4F5C\u7CFB\u7EDF\uFF0C\u5229\u7528\u4E91\u539F\u751F\u7684\u80FD\u529B\u505A\u4E00\u4E2A\u76EE\u524D\u4E91\u5382\u5546\u7684\u53EF\u66FF\u4EE3\u54C1</p></blockquote><ul><li>\u5F00\u6E90 sealos\uFF0C\u63D0\u4F9B\u51FA\u4E00\u4E2A\u62BD\u8C61\u7684\u4E91\u64CD\u4F5C\u7CFB\u7EDF\uFF0C\u4E00\u5207\u7686\u5E94\u7528\u7684\u8BBE\u8BA1\u7406\u5FF5\u3002</li><li>sealos cloud - \u73AF\u754C\u81EA\u5DF1\u8FD0\u884C\u7684 sealos \u516C\u6709\u4E91\u7248\u672C\uFF0C\u670D\u52A1\u80FD\u529B\u5BF9\u6807 aws \u963F\u91CC\u4E91\u7B49\u516C\u6709\u4E91</li><li>\u7528\u6237\u81EA\u7531\u4E0B\u8F7D\u793E\u533A\u7248\u6216\u5546\u4E1A\u7248\u672C sealos\uFF0C\u5728\u4EFB\u610F\u5730\u65B9\u542F\u52A8\u4E00\u4E2A\u5C5E\u4E8E\u81EA\u5DF1\u7684 <code>sealos cloud</code></li></ul><blockquote><p>\u5206\u5E03\u5F0F\u5E94\u7528\u751F\u6001\u6784\u5EFA</p></blockquote><ul><li>\u5E7F\u5EA6\uFF0C\u5E38\u7528\u5206\u5E03\u5F0F\u8F6F\u4EF6\u5982 <code>mysql</code> \u96C6\u7FA4\uFF0C<code>redis</code> \u96C6\u7FA4\uFF0C\u6D88\u606F\u961F\u5217\u7B49\u9010\u6B65\u8986\u76D6\uFF0C\u4E0D\u65AD\u6269\u5C55\u5E38\u7528\u5206\u5E03\u5F0F\u5E94\u7528\u6570\u91CF</li><li>\u6DF1\u5EA6\uFF0C<code>\u57FA\u672C\u5B89\u88C5 -&gt; \u9AD8\u53EF\u7528 -&gt; \u53EF\u76D1\u63A7 -&gt; \u81EA\u8FD0\u7EF4 -&gt; \u9AD8\u6027\u80FD / \u5B89\u5168\u6027 -&gt; GUI\u7BA1\u63A7</code>\uFF0C\u516D\u4E2A\u9636\u6BB5\u8861\u91CF\u4E00\u4E2A\u5206\u5E03\u5F0F\u5E94\u7528\u6210\u719F\u5EA6</li></ul><p>\u5E94\u7528\u5305\u542B\u4E09\u4E2A\u6765\u6E90\uFF1A\u73AF\u754C\u81EA\u7814\u5E94\u7528\u5982\u51FD\u6570\u8BA1\u7B97\uFF0C\u5F00\u6E90\u4E8C\u6B21\u5C01\u88C5\u5E94\u7528\uFF0C\u7B2C\u4E09\u65B9\u5E94\u7528\u5982\u4E0E\u8BAF\u98DE\u5408\u4F5C\u7684 AI \u80FD\u529B\u5E94\u7528\u4E0E <code>sealos</code> \u7ED3\u5408\u3002</p><h2 id="\u8FD0\u884C\u4E4B\u540E" tabindex="-1"><a class="header-anchor" href="#\u8FD0\u884C\u4E4B\u540E" aria-hidden="true">#</a> \u8FD0\u884C\u4E4B\u540E</h2><div class="custom-container warning"><p class="custom-container-title">\u6CE8\u610F</p><p>\u4F60\u8FD0\u884C\u8D77\u6765\u7684\u53EF\u4EE5\u4E0D\u662F<code>kubernetes</code>\uFF0C\u53EF\u4EE5\u662F\u4E2A <code>k0s</code> \u6216\u8005\u662F <code>k3s</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u5355\u4E3B\u673A</span>
$ sealos run labring/kubernetes:v1.25.0 labring/helm:v3.8.2 labring/calico:v3.24.1 <span class="token parameter variable">--single</span>
<span class="token comment"># remove taint</span>
$ kubectl taint <span class="token function">node</span> <span class="token parameter variable">--all</span> node-role.kubernetes.io/control-plane-
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="custom-container danger"><p class="custom-container-title">\u4F7F\u7528 docker \u4F5C\u4E3A run labring</p><p>\u9ED8\u8BA4\u662F\u4F7F\u7528<code>kubernetes</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sealos run labring/kubernetes-docker:v1.20.5-4.1.3 labring/calico:v3.24.1 <span class="token punctuation">\\</span>
     <span class="token parameter variable">--masters</span> <span class="token number">192.168</span>.64.2,192.168.64.22,192.168.64.20 <span class="token punctuation">\\</span>
     <span class="token parameter variable">--nodes</span> <span class="token number">192.168</span>.64.21,192.168.64.19 <span class="token parameter variable">-p</span> <span class="token punctuation">[</span>your-ssh-passwd<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>\u6211\u4EEC\u53EF\u4EE5\u5728 <code>sealos</code> \u4E0A\u9762\u8FD0\u884C\u5BF9\u8C61\u5B58\u50A8\u3001\u7F51\u5173\u3001\u6570\u636E\u5E93\u7B49\u7B49\u4E1C\u897F\uFF0C\u90FD\u53EF\u4EE5\u901A\u8FC7<code>sealos run</code> \u4E00\u952E\u5728\u4E91\u64CD\u4F5C\u7CFB\u7EDF\u4E0A\u9762<code>run</code>\u8D77\u6765\u3002</p><blockquote><p>docker \u955C\u50CF\u672C\u8D28\u662F\u4E00\u5806\u6587\u4EF6\u7EC4\u6210\uFF0C\u901A\u8FC7 <code>commit</code> \u6216\u8005 <code>dockerfile</code> \u4E00\u5C42\u5C42\u53E0\u52A0\uFF0C\u800C <code>sealos run</code> \u53EF\u4EE5 <code>run</code> \u6574\u4E2A\u96C6\u7FA4\u955C\u50CF\uFF0C\u4E0D\u7BA1\u662F <code>Kubernetes</code> \u96C6\u7FA4\uFF0C <code>Mysql</code> \u96C6\u7FA4\uFF0C \u8FD8\u662F <code>Redis</code> \u96C6\u7FA4\u3002<code>sealos build</code> \u53EF\u4EE5 build \u6574\u4E2A\u96C6\u7FA4\u3002</p><ul><li><code>docker</code> \u6570\u636E\u4E2D\u5FC3\u4F5C\u4E3A\u6574\u4F53\uFF08run\u5355\u673A\u64CD\u4F5C\u7CFB\u7EDF\uFF09</li><li><code>kubernetes</code> \u4F5C\u4E3A\u64CD\u4F5C\u7CFB\u7EDF</li><li><code>sealos run</code> \u51FA\u6765\u7684\u90FD\u662F\u96C6\u7FA4\u7684\uFF0C\u8FD0\u884C\u5728 <code>kubernetes</code> \u4E0A</li></ul></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sealos run labring/helm:v3.8.2 <span class="token comment"># install helm</span>
sealos run labring/openebs:v1.9.0 <span class="token comment"># install openebs</span>
sealos run labring/minio-operator:v4.4.16 labring/ingress-nginx:4.1.0 <span class="token punctuation">\\</span>
   labring/mysql-operator:8.0.23-14.1 labring/redis-operator:3.1.4 <span class="token comment"># oneliner</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16),S=n("p",null,[n("code",null,"labring/ingress-nginx"),s("\uFF1A\u8868\u793A\u7684\u662F\u96C6\u7FA4\u955C\u50CF\uFF0C\u4ED6\u4EEC\u662F\u5982\u4F55\u88AB\u6253\u5305\u7684\u5462\uFF1F")],-1),R=s("\u8FD9\u4E2A\u65F6\u5019\u6D89\u53CA\u5230\u4E86 "),H={href:"https://www.sealos.io/docs/getting-started/build-example-cloudimage",target:"_blank",rel:"noopener noreferrer"},L=s("build an Exmple Cloudmage"),I=t('<details class="custom-container details"><summary>\u4EC0\u4E48\u65F6\u5019\u9700\u8981\u96C6\u7FA4\u955C\u50CF</summary><p>\u7528\u6237\u5E0C\u671B\u5F97\u5230\u4E00\u4E2A\u96C6\u7FA4</p><p>sealos \u4E0D\u4F1A\u8BB0\u5F55\u542F\u52A8\u7684\u5B9E\u4F8B\u540D\u79F0\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u4F20\u53C2\u6570\u6765\u8BB0\u5F55\u4E0B\u6765\u3002</p></details><h3 id="\u6784\u5EFA\u955C\u50CF" tabindex="-1"><a class="header-anchor" href="#\u6784\u5EFA\u955C\u50CF" aria-hidden="true">#</a> \u6784\u5EFA\u955C\u50CF</h3><p>\u4E0B\u9762\u4ECB\u7ECD\u5982\u4F55\u4F7F\u7528 <code>helm</code> \u6784\u5EFA <code>nginx</code>-\u5165\u53E3\u7FA4\u96C6\u6620\u50CF\u3002</p><blockquote><p><code>helm</code> \u6700\u6838\u5FC3\u7684\u95EE\u9898\u662F\uFF1A\u6A21\u677F\u6E32\u67D3\uFF0C<code>sealos</code> \u53EF\u4EE5\u9009\u62E9 <code>helm</code> \u3002</p></blockquote>',4),K={class:"custom-container details"},F=n("summary",null,"helm\u4ECB\u7ECD",-1),M=n("p",null,"helm\u7684\u5B98\u7F51\u6587\u6863\u5730\u5740\uFF1A",-1),B={href:"https://docker.nsddd.top/Cloud-Native-k8s/15.html",target:"_blank",rel:"noopener noreferrer"},O=s("\u6587\u6863\u5730\u5740"),z=t("<p><strong>Helm \u662F\u4EC0\u4E48\uFF1F\uFF1F</strong></p><p>Helm \u662F Kubernetes \u7684\u5305\u7BA1\u7406\u5668\u3002\u5305\u7BA1\u7406\u5668\u7C7B\u4F3C\u4E8E\u6211\u4EEC\u5728 Ubuntu \u4E2D\u4F7F\u7528\u7684apt\u3001Centos\u4E2D\u4F7F\u7528\u7684yum \u6216\u8005Python\u4E2D\u7684 pip \u4E00\u6837\uFF0C\u80FD\u5FEB\u901F\u67E5\u627E\u3001\u4E0B\u8F7D\u548C\u5B89\u88C5\u8F6F\u4EF6\u5305\u3002Helm \u7531\u5BA2\u6237\u7AEF\u7EC4\u4EF6 helm \u548C\u670D\u52A1\u7AEF\u7EC4\u4EF6 Tiller \u7EC4\u6210, \u80FD\u591F\u5C06\u4E00\u7EC4K8S\u8D44\u6E90\u6253\u5305\u7EDF\u4E00\u7BA1\u7406, \u662F\u67E5\u627E\u3001\u5171\u4EAB\u548C\u4F7F\u7528\u4E3AKubernetes\u6784\u5EFA\u7684\u8F6F\u4EF6\u7684\u6700\u4F73\u65B9\u5F0F\u3002</p><p><strong>Helm \u89E3\u51B3\u4E86\u4EC0\u4E48\u75DB\u70B9\uFF1F</strong></p><p>\u5728 Kubernetes\u4E2D\u90E8\u7F72\u4E00\u4E2A\u53EF\u4EE5\u4F7F\u7528\u7684\u5E94\u7528\uFF0C\u9700\u8981\u6D89\u53CA\u5230\u5F88\u591A\u7684 Kubernetes \u8D44\u6E90\u7684\u5171\u540C\u534F\u4F5C\u3002\u6BD4\u5982\u4F60\u5B89\u88C5\u4E00\u4E2A WordPress \u535A\u5BA2\uFF0C\u7528\u5230\u4E86\u4E00\u4E9B Kubernetes (\u4E0B\u9762\u5168\u90E8\u7B80\u79F0k8s)\u7684\u4E00\u4E9B\u8D44\u6E90\u5BF9\u8C61\uFF0C\u5305\u62EC Deployment \u7528\u4E8E\u90E8\u7F72\u5E94\u7528\u3001Service \u63D0\u4F9B\u670D\u52A1\u53D1\u73B0\u3001Secret \u914D\u7F6E WordPress \u7684\u7528\u6237\u540D\u548C\u5BC6\u7801\uFF0C\u53EF\u80FD\u8FD8\u9700\u8981 pv \u548C pvc \u6765\u63D0\u4F9B\u6301\u4E45\u5316\u670D\u52A1\u3002\u5E76\u4E14 WordPress \u6570\u636E\u662F\u5B58\u50A8\u5728mariadb\u91CC\u9762\u7684\uFF0C\u6240\u4EE5\u9700\u8981 mariadb \u542F\u52A8\u5C31\u7EEA\u540E\u624D\u80FD\u542F\u52A8 WordPress\u3002\u8FD9\u4E9B k8s \u8D44\u6E90\u8FC7\u4E8E\u5206\u6563\uFF0C\u4E0D\u65B9\u4FBF\u8FDB\u884C\u7BA1\u7406\uFF0C\u76F4\u63A5\u901A\u8FC7 kubectl \u6765\u7BA1\u7406\u4E00\u4E2A\u5E94\u7528\uFF0C\u4F60\u4F1A\u53D1\u73B0\u8FD9\u5341\u5206\u86CB\u75BC\u3002</p><p>\u6240\u4EE5\u603B\u7ED3\u4EE5\u4E0A\uFF0C\u6211\u4EEC\u5728 <code>k8s</code> \u4E2D\u90E8\u7F72\u4E00\u4E2A\u5E94\u7528\uFF0C\u901A\u5E38\u9762\u4E34\u4EE5\u4E0B\u51E0\u4E2A\u95EE\u9898\uFF1A</p><ul><li>\u5982\u4F55\u7EDF\u4E00\u7BA1\u7406\u3001\u914D\u7F6E\u548C\u66F4\u65B0\u8FD9\u4E9B\u5206\u6563\u7684 <code>k8s</code> \u7684\u5E94\u7528\u8D44\u6E90\u6587\u4EF6</li><li>\u5982\u4F55\u5206\u53D1\u548C\u590D\u7528\u4E00\u5957\u5E94\u7528\u6A21\u677F</li><li>\u5982\u4F55\u5C06\u5E94\u7528\u7684\u4E00\u7CFB\u5217\u8D44\u6E90\u5F53\u505A\u4E00\u4E2A\u8F6F\u4EF6\u5305\u7BA1\u7406</li></ul><p><strong>Helm \u76F8\u5173\u7EC4\u4EF6\u53CA\u6982\u5FF5\uFF1A</strong></p><p>Helm \u5305\u542B\u4E24\u4E2A\u7EC4\u4EF6\uFF0C\u5206\u522B\u662F helm \u5BA2\u6237\u7AEF \u548C Tiller \u670D\u52A1\u5668\uFF1A</p><ul><li><strong>helm</strong> \u662F\u4E00\u4E2A\u547D\u4EE4\u884C\u5DE5\u5177\uFF0C\u7528\u4E8E\u672C\u5730\u5F00\u53D1\u53CA\u7BA1\u7406<code>chart</code>\uFF0C<code>chart</code>\u4ED3\u5E93\u7BA1\u7406\u7B49</li><li><strong>Tiller</strong> \u662F <code>Helm</code> \u7684\u670D\u52A1\u7AEF\u3002<code>Tiller</code> \u8D1F\u8D23\u63A5\u6536 <code>Helm</code> \u7684\u8BF7\u6C42\uFF0C\u4E0E <code>k8s</code> \u7684 <code>apiserver</code> \u4EA4\u4E92\uFF0C\u6839\u636E<code>chart</code> \u6765\u751F\u6210\u4E00\u4E2A <code>release</code> \u5E76\u7BA1\u7406 <code>release</code></li><li><strong>chart</strong> Helm\u7684\u6253\u5305\u683C\u5F0F\u53EB\u505A<code>chart</code>\uFF0C\u6240\u8C13 <code>chart</code> \u5C31\u662F\u4E00\u7CFB\u5217\u6587\u4EF6, \u5B83\u63CF\u8FF0\u4E86\u4E00\u7EC4\u76F8\u5173\u7684 <code>k8s</code> \u96C6\u7FA4\u8D44\u6E90</li><li><strong>release</strong> \u4F7F\u7528 <code>helm install</code> \u547D\u4EE4\u5728 <code>Kubernetes</code> \u96C6\u7FA4\u4E2D\u90E8\u7F72\u7684 <code>Chart</code> \u79F0\u4E3A <code>Release</code></li><li><code>Repoistory Helm chart</code> \u7684\u4ED3\u5E93\uFF0C<code>Helm</code> \u5BA2\u6237\u7AEF\u901A\u8FC7 <code>HTTP</code> \u534F\u8BAE\u6765\u8BBF\u95EE\u5B58\u50A8\u5E93\u4E2D <code>chart</code> \u7684\u7D22\u5F15\u6587\u4EF6\u548C\u538B\u7F29\u5305</li></ul>",9),W=t('<p><strong>Helm \u539F\u7406\uFF1A</strong></p><p>\u4E0B\u9762\u4E24\u5F20\u56FE\u63CF\u8FF0\u4E86 Helm \u7684\u51E0\u4E2A\u5173\u952E\u7EC4\u4EF6 Helm\uFF08\u5BA2\u6237\u7AEF\uFF09\u3001Tiller\uFF08\u670D\u52A1\u5668\uFF09\u3001Repository\uFF08Chart \u8F6F\u4EF6\u4ED3\u5E93\uFF09\u3001Chart\uFF08\u8F6F\u4EF6\u5305\uFF09\u4E4B\u95F4\u7684\u5173\u7CFB\u4EE5\u53CA\u5B83\u4EEC\u4E4B\u95F4\u5982\u4F55\u901A\u4FE1\u3002</p><p><img src="http://sm.nsddd.top/smimage-20221023214555169.png" alt="image-20221023214555169"></p><p><strong>helm \u7EC4\u4EF6\u901A\u4FE1\uFF1A</strong></p><p><img src="http://sm.nsddd.top/smimage-20221023214604275.png" alt="image-20221023214604275"></p><p><strong>helm \u67B6\u6784</strong></p><p><strong>\u521B\u5EFArelease\uFF1A</strong></p><ul><li><code>helm</code> \u5BA2\u6237\u7AEF\u4ECE\u6307\u5B9A\u7684\u76EE\u5F55\u6216\u672C\u5730 <code>tar</code> \u6587\u4EF6\u6216\u8FDC\u7A0B <code>repo</code> \u4ED3\u5E93\u89E3\u6790\u51FA <code>chart</code> \u7684\u7ED3\u6784\u4FE1\u606F</li><li><code>helm</code> \u5BA2\u6237\u7AEF\u6307\u5B9A\u7684 <code>chart</code> \u7ED3\u6784\u548C <code>values</code> \u4FE1\u606F\u901A\u8FC7 <code>gRPC</code> \u4F20\u9012\u7ED9 <code>Tiller</code></li><li><code>Tiller</code> \u670D\u52A1\u7AEF\u6839\u636E <code>chart</code> \u548C <code>values</code> \u751F\u6210\u4E00\u4E2A <code>release</code></li><li><code>Tiller</code> \u5C06 <code>install release</code> \u8BF7\u6C42\u76F4\u63A5\u4F20\u9012\u7ED9 <code>kube-apiserver</code></li></ul><p><strong>\u5220\u9664release\uFF1A</strong></p><ul><li><code>helm</code> \u5BA2\u6237\u7AEF\u4ECE\u6307\u5B9A\u7684\u76EE\u5F55\u6216\u672C\u5730 <code>tar</code> \u6587\u4EF6\u6216\u8FDC\u7A0B <code>repo</code> \u4ED3\u5E93\u89E3\u6790\u51FA <code>chart</code> \u7684\u7ED3\u6784\u4FE1\u606F</li><li><code>helm</code> \u5BA2\u6237\u7AEF\u6307\u5B9A\u7684 <code>chart</code> \u7ED3\u6784\u548C <code>values</code> \u4FE1\u606F\u901A\u8FC7 gRPC \u4F20\u9012\u7ED9 Tiller</li><li><code>Tiller</code> \u670D\u52A1\u7AEF\u6839\u636E <code>chart</code> \u548C <code>values</code> \u751F\u6210\u4E00\u4E2A <code>release</code></li><li><code>Tiller</code> \u5C06 <code>delete release</code> \u8BF7\u6C42\u76F4\u63A5\u4F20\u9012\u7ED9 <code>kube-apiserver</code></li></ul><p><strong>\u66F4\u65B0release\uFF1A</strong></p><ul><li><code>helm</code> \u5BA2\u6237\u7AEF\u5C06\u9700\u8981\u66F4\u65B0\u7684 <code>chart</code> \u7684 <code>release</code> \u540D\u79F0 <code>chart</code> \u7ED3\u6784\u548C <code>value</code> \u4FE1\u606F\u4F20\u7ED9 <code>Tiller</code></li><li><code>Tiller</code> \u5C06\u6536\u5230\u7684\u4FE1\u606F\u751F\u6210\u65B0\u7684 <code>release</code>\uFF0C\u5E76\u540C\u65F6\u66F4\u65B0\u8FD9\u4E2A <code>release</code> \u7684 <code>history</code></li><li><code>Tiller</code> \u5C06\u65B0\u7684 <code>release</code> \u4F20\u9012\u7ED9 <code>kube-apiserver</code> \u8FDB\u884C\u66F4\u65B0</li></ul><h3 id="chart-\u7684\u57FA\u672C\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#chart-\u7684\u57FA\u672C\u7ED3\u6784" aria-hidden="true">#</a> chart \u7684\u57FA\u672C\u7ED3\u6784</h3><p>Helm\u7684\u6253\u5305\u683C\u5F0F\u53EB\u505Achart\uFF0C\u6240\u8C13<code>chart</code>\u5C31\u662F\u4E00\u7CFB\u5217\u6587\u4EF6, \u5B83\u63CF\u8FF0\u4E86\u4E00\u7EC4\u76F8\u5173\u7684 k8s \u96C6\u7FA4\u8D44\u6E90\u3002Chart\u4E2D\u7684\u6587\u4EF6\u5B89\u88C5\u7279\u5B9A\u7684\u76EE\u5F55\u7ED3\u6784\u7EC4\u7EC7, \u6700\u7B80\u5355\u7684 <code>chart</code> \u76EE\u5F55\u5982\u4E0B\u6240\u793A\uFF1A</p><p><img src="http://sm.nsddd.top/smimage-20221023214623073.png" alt="image-20221023214623073"></p><p>chart \u7ED3\u6784</p><ul><li><code>charts</code> \u76EE\u5F55\u5B58\u653E\u4F9D\u8D56\u7684chart</li><li><code>Chart.yaml</code> \u5305\u542BChart\u7684\u57FA\u672C\u4FE1\u606F\uFF0C\u5305\u62ECchart\u7248\u672C\uFF0C\u540D\u79F0\u7B49</li><li><code>templates</code> \u76EE\u5F55\u4E0B\u5B58\u653E\u5E94\u7528\u4E00\u7CFB\u5217 k8s \u8D44\u6E90\u7684 yaml \u6A21\u677F</li><li><code>_helpers.tpl</code> \u6B64\u6587\u4EF6\u4E2D\u5B9A\u4E49\u4E00\u4E9B\u53EF\u91CD\u7528\u7684\u6A21\u677F\u7247\u65AD\uFF0C\u6B64\u6587\u4EF6\u4E2D\u7684\u5B9A\u4E49\u5728\u4EFB\u4F55\u8D44\u6E90\u5B9A\u4E49\u6A21\u677F\u4E2D\u53EF\u7528</li><li><code>NOTES.txt</code> \u4ECB\u7ECDchart \u90E8\u7F72\u540E\u7684\u5E2E\u52A9\u4FE1\u606F\uFF0C\u5982\u4F55\u4F7F\u7528chart\u7B49</li><li><code>values.yaml</code> \u5305\u542B\u4E86\u5FC5\u8981\u7684\u503C\u5B9A\u4E49\uFF08\u9ED8\u8BA4\u503C\uFF09, \u7528\u4E8E\u5B58\u50A8 templates \u76EE\u5F55\u4E2D\u6A21\u677F\u6587\u4EF6\u4E2D\u7528\u5230\u53D8\u91CF\u7684\u503C</li></ul><p><strong>\u5B89\u88C5Helm\uFF1A</strong></p>',18),G=s("Helm \u63D0\u4F9B\u4E86\u51E0\u79CD\u5B89\u88C5\u65B9\u5F0F\uFF0C\u672C\u6587\u63D0\u4F9B\u4E24\u79CD\u5B89\u88C5\u65B9\u5F0F\uFF0C\u60F3\u8981\u67E5\u770B\u66F4\u591A\u5B89\u88C5\u65B9\u5F0F\uFF0C\u8BF7\u9605\u8BFB Helm \u7684"),U={href:"https://links.jianshu.com/go?to=https%3A%2F%2Fdocs.helm.sh%2Fusing_helm%2F%23installing-helm",target:"_blank",rel:"noopener noreferrer"},Y=s("\u5B98\u65B9\u6587\u6863"),j=s("\uFF1A"),Z=t(`<ul><li>\u624B\u52A8\u5B89\u88C5\u65B9\u5F0F</li></ul><div class="language-ruby ext-rb line-numbers-mode"><pre class="language-ruby"><code>$ \u4E0B\u8F7D Helm \u4E8C\u8FDB\u5236\u6587\u4EF6
$ wget https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>storage<span class="token punctuation">.</span>googleapis<span class="token punctuation">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">-</span>helm<span class="token operator">/</span>helm<span class="token operator">-</span>v2<span class="token punctuation">.</span><span class="token number">9.1</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
$ \u89E3\u538B\u7F29
$ tar <span class="token operator">-</span>zxvf helm<span class="token operator">-</span>v2<span class="token punctuation">.</span><span class="token number">9.1</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
$ \u590D\u5236 helm \u4E8C\u8FDB\u5236 \u5230bin\u76EE\u5F55\u4E0B
<span class="token variable">$cp</span> linux<span class="token operator">-</span>amd64<span class="token operator">/</span>helm <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token regex-literal"><span class="token regex">/bin/</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u4F7F\u7528\u5B98\u65B9\u63D0\u4F9B\u7684\u811A\u672C\u4E00\u952E\u5B89\u88C5</li></ul><div class="language-ruby ext-rb line-numbers-mode"><pre class="language-ruby"><code>$ curl https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">/</span>helm<span class="token operator">/</span>master<span class="token operator">/</span>scripts<span class="token operator">/</span>get <span class="token operator">&gt;</span> get_helm<span class="token punctuation">.</span>sh
$ chmod <span class="token number">700</span> get_helm<span class="token punctuation">.</span>sh
$ <span class="token punctuation">.</span><span class="token operator">/</span>get_helm<span class="token punctuation">.</span>sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),J=s("\u4F60\u8FD8\u53EF\u4EE5\u901A\u8FC7 Helm \u7684 "),Q={href:"https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fhelm%2Fhelm%2Freleases",target:"_blank",rel:"noopener noreferrer"},X=s("github"),nn=s(" \u9879\u76EE\u4E0B\u627E\u5230\u4F60\u60F3\u8981\u7684 Helm \u7248\u672C\u7684\u4E8C\u8FDB\u5236\uFF0C\u7136\u540E\u901A\u8FC7\u624B\u52A8\u5B89\u88C5\u65B9\u5F0F\u4E00\u6837\u5B89\u88C5\u5373\u53EF"),sn=t(`<p><strong>\u56FD\u5185\u955C\u50CF\u52A0\u901F\u4E0B\u8F7D\uFF1A</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> https://mirrors.huaweicloud.com/helm/v3.9.2/helm-v3.9.2-linux-386.tar.gz <span class="token operator">&amp;&amp;</span> <span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> helm-v3.9.2-linux-386.tar.gz <span class="token operator">&amp;&amp;</span> <span class="token function">cp</span>  linux-386/helm /usr/local/bin/ <span class="token operator">&amp;&amp;</span> helm version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,2),an=t(`<p><strong>\u5B89\u88C5 Tiller\uFF1A</strong></p><p>\u5B89\u88C5\u597D helm \u5BA2\u6237\u7AEF\u540E\uFF0C\u5C31\u53EF\u4EE5\u901A\u8FC7\u4EE5\u4E0B\u547D\u4EE4\u5C06 Tiller \u5B89\u88C5\u5728 kubernetes \u96C6\u7FA4\u4E2D\uFF1A</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code>helm <span class="token keyword">init</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,3),en=s("\u8FD9\u4E2A\u5730\u65B9\u9ED8\u8BA4\u4F7F\u7528 \u201C"),tn={href:"https://links.jianshu.com/go?to=https%3A%2F%2Fkubernetes-charts.storage.googleapis.com",target:"_blank",rel:"noopener noreferrer"},ln=s("https://kubernetes-charts.storage.googleapis.com"),pn=s("\u201D \u4F5C\u4E3A\u7F3A\u7701\u7684 stable repository \u7684\u5730\u5740\uFF0C\u4F46\u7531\u4E8E\u56FD\u5185\u6709\u4E00\u5F20\u65E0\u5F62\u7684\u5899\u7684\u5B58\u5728\uFF0C"),on={href:"https://links.jianshu.com/go?to=http%3A%2F%2Fgoogleapis.com",target:"_blank",rel:"noopener noreferrer"},cn=s("googleapis.com"),un=s(" \u662F\u4E0D\u80FD\u8BBF\u95EE\u7684\u3002\u53EF\u4EE5\u4F7F\u7528\u963F\u91CC\u4E91\u7684\u6E90\u6765\u914D\u7F6E\uFF1A"),rn=t(`<div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code>helm <span class="token keyword">init</span> <span class="token operator">--</span>upgrade <span class="token operator">-</span>i registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>hangzhou<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>tiller<span class="token operator">:</span>v2<span class="token punctuation">.</span><span class="token number">9.1</span>  <span class="token operator">--</span>stable<span class="token operator">-</span>repo<span class="token operator">-</span>url https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>kubernetes<span class="token punctuation">.</span>oss<span class="token operator">-</span>cn<span class="token operator">-</span>hangzhou<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>charts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6267\u884C\u4E0A\u9762\u547D\u4EE4\u540E\uFF0C\u53EF\u4EE5\u901A\u8FC7 <code>kubectl get po -n kube-system</code> \u6765\u67E5\u770B <code>tiller</code> \u7684\u5B89\u88C5\u60C5\u51B5\u3002</p><p>\u7531\u4E8E <code>kubernetes</code> \u4ECE1.6 \u7248\u672C\u5F00\u59CB\u52A0\u5165\u4E86 <code>RBAC</code> \u6388\u6743\u3002\u5F53\u524D\u7684 <code>Tiller</code> \u6CA1\u6709\u5B9A\u4E49\u7528\u4E8E\u6388\u6743\u7684 <code>ServiceAccount</code>\uFF0C \u8BBF\u95EE <code>API Server</code> \u65F6\u4F1A\u88AB\u62D2\u7EDD\uFF0C\u9700\u8981\u7ED9 <code>Tiller</code> \u52A0\u5165\u6388\u6743\u3002</p><ul><li>\u521B\u5EFA <code>Kubernetes</code> \u7684\u670D\u52A1\u5E10\u53F7\u548C\u7ED1\u5B9A\u89D2\u8272</li></ul><div class="language-ruby ext-rb line-numbers-mode"><pre class="language-ruby"><code>$ kubectl create serviceaccount <span class="token operator">-</span><span class="token operator">-</span>namespace kube<span class="token operator">-</span>system tiller                               
serviceaccount <span class="token string-literal"><span class="token string">&quot;tiller&quot;</span></span> created

$ kubectl create clusterrolebinding tiller<span class="token operator">-</span>cluster<span class="token operator">-</span>rule <span class="token operator">-</span><span class="token operator">-</span>clusterrole<span class="token operator">=</span>cluster<span class="token operator">-</span>admin <span class="token operator">-</span><span class="token operator">-</span>serviceaccount<span class="token operator">=</span>kube<span class="token operator">-</span>system<span class="token symbol">:tiller</span>
clusterrolebinding<span class="token punctuation">.</span>rbac<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io <span class="token string-literal"><span class="token string">&quot;tiller-cluster-rule&quot;</span></span> created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u7ED9 <code>Tiller</code> \u7684 <code>deployments</code> \u6DFB\u52A0\u521A\u624D\u521B\u5EFA\u7684 <code>ServiceAccount</code></li></ul><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code># \u7ED9 <span class="token class-name">Tiller</span> \u7684 deployments \u6DFB\u52A0\u521A\u624D\u521B\u5EFA\u7684 <span class="token class-name">ServiceAccount</span>
$ kubectl patch deploy <span class="token operator">-</span><span class="token operator">-</span>namespace kube<span class="token operator">-</span>system tiller<span class="token operator">-</span>deploy <span class="token operator">-</span>p &#39;<span class="token punctuation">{</span><span class="token string">&quot;spec&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;template&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;spec&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;serviceAccount&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;tiller&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>&#39;
deployment<span class="token punctuation">.</span>extensions <span class="token string">&quot;tiller-deploy&quot;</span> patched
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u67E5\u770B <code>Tiller deployments</code> \u8D44\u6E90\u662F\u5426\u7ED1\u5B9A <code>ServiceAccount</code></li></ul><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>$ kubectl <span class="token keyword">get</span> deploy <span class="token operator">-</span>n kube<span class="token operator">-</span>system tiller<span class="token operator">-</span>deploy <span class="token operator">-</span>o yaml <span class="token operator">|</span> grep <span class="token class-name">serviceAccount</span>
serviceAccount<span class="token punctuation">:</span> <span class="token class-name">tiller</span>
serviceAccountName<span class="token punctuation">:</span> tiller
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u67E5\u770B <code>Tiller</code> \u662F\u5426\u5B89\u88C5\u6210\u529F</li></ul><div class="language-ruby ext-rb line-numbers-mode"><pre class="language-ruby"><code>$ helm version 
<span class="token symbol">Client</span><span class="token operator">:</span> <span class="token operator">&amp;</span>version<span class="token punctuation">.</span>Version<span class="token punctuation">{</span><span class="token symbol">SemVer</span><span class="token symbol">:&quot;v2.9.1&quot;</span><span class="token punctuation">,</span> <span class="token symbol">GitCommit</span><span class="token symbol">:&quot;20adb27c7c5868466912eebdf6664e7390ebe710&quot;</span><span class="token punctuation">,</span> <span class="token symbol">GitTreeState</span><span class="token symbol">:&quot;clean&quot;</span><span class="token punctuation">}</span>
<span class="token symbol">Server</span><span class="token operator">:</span> <span class="token operator">&amp;</span>version<span class="token punctuation">.</span>Version<span class="token punctuation">{</span><span class="token symbol">SemVer</span><span class="token symbol">:&quot;v2.9.1&quot;</span><span class="token punctuation">,</span> <span class="token symbol">GitCommit</span><span class="token symbol">:&quot;20adb27c7c5868466912eebdf6664e7390ebe710&quot;</span><span class="token punctuation">,</span> <span class="token symbol">GitTreeState</span><span class="token symbol">:&quot;clean&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B89\u88C5\u6210\u529F\u540E\uFF0C\u5373\u53EF\u4F7F\u7528 <code>helm install xxx</code> \u6765\u5B89\u88C5 <code>helm</code> \u5E94\u7528\u3002\u5982\u679C\u9700\u8981\u5220\u9664 <code>Tiller</code>\uFF0C\u53EF\u4EE5\u901A\u8FC7 <code>kubectl delete deployment tiller-deploy --namespace kube-system</code> \u6765\u5220\u9664 <code>Tiller</code> \u7684 <code>deployment</code> \u6216\u8005\u4F7F\u7528 <code>helm reset</code> \u6765\u5220\u9664\u3002</p><p><strong>\u4F7F\u7528 Helm \u64CD\u4F5C Chart\uFF1A</strong></p><p>\u8FD9\u4E00\u8282\u5C06\u4ECB\u7ECD\u5982\u4F55\u4F7F\u7528 helm \u6765\u64CD\u4F5C chart\uFF0C\u5305\u62EC\u521B\u5EFA\u3001\u5220\u9664\u3001\u6253\u5305\u3001\u5B89\u88C5\u7B49\u4F7F\u7528\u3002</p><p>\u5148\u4ECB\u7ECD\u4E00\u4E0B Helm \u7684\u6838\u5FC3\u547D\u4EE4\uFF1A</p><ul><li>helm create \u521B\u5EFA\u4E00\u4E2A Chart \u6A21\u677F</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ helm create <span class="token builtin class-name">test</span>
Creating <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>helm package \u6253\u5305\u4E00\u4E2A Chart \u6A21\u677F</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ helm package <span class="token builtin class-name">test</span>                                                                          
Successfully packaged chart and saved it to: /root/test-0.1.0.tgz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>helm search</code> \u67E5\u627E\u53EF\u7528\u7684 Chart \u6A21\u677F</li></ul><div class="language-ruby ext-rb line-numbers-mode"><pre class="language-ruby"><code>$ helm search nginx                                  
<span class="token constant">NAME</span>                    <span class="token constant">CHART</span> <span class="token constant">VERSION</span>   <span class="token constant">APP</span> <span class="token constant">VERSION</span> <span class="token constant">DESCRIPTION</span>
stable<span class="token operator">/</span>nginx<span class="token operator">-</span>ingress    <span class="token number">0.9</span><span class="token number">.5</span>           <span class="token number">0.10</span><span class="token number">.2</span>      An nginx Ingress controller that uses ConfigMap<span class="token operator">...</span>
stable<span class="token operator">/</span>nginx<span class="token operator">-</span>lego       <span class="token number">0.3</span><span class="token number">.1</span>                       Chart <span class="token keyword">for</span> nginx<span class="token operator">-</span>ingress<span class="token operator">-</span>controller <span class="token keyword">and</span> kube<span class="token operator">-</span>lego
stable<span class="token operator">/</span>gcloud<span class="token operator">-</span>endpoints <span class="token number">0.1</span><span class="token number">.0</span>                       Develop<span class="token punctuation">,</span> deploy<span class="token punctuation">,</span> protect <span class="token keyword">and</span> monitor your APIs <span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>helm inspect</code> \u67E5\u770B\u6307\u5B9A Chart \u7684\u57FA\u672C\u4FE1\u606F</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">appVersion</span><span class="token punctuation">:</span> <span class="token string">&quot;1.0&quot;</span>
<span class="token key atrule">description</span><span class="token punctuation">:</span> A Helm chart for Kubernetes
<span class="token key atrule">name</span><span class="token punctuation">:</span> test
<span class="token key atrule">version</span><span class="token punctuation">:</span> 0.1.0

\u7565<span class="token punctuation">...</span>(\u7701\u7565\u4E00\u5927\u6BB5\u4FE1\u606F\uFF09
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>helm install</code> \u6839\u636E\u6307\u5B9A\u7684 Chart \u90E8\u7F72\u4E00\u4E2A Release \u5230 Kubernetes \u96C6\u7FA4</li></ul><p><strong>Chart \u6587\u4EF6\u7ED3\u6784\uFF1A</strong></p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code>wordpress
\u251C\u2500\u2500 charts
\u251C\u2500\u2500 Chart.yaml
\u251C\u2500\u2500 README.md
\u251C\u2500\u2500 requirements.lock
\u251C\u2500\u2500 requirements.yaml
\u251C\u2500\u2500 templates
\u2502   \u251C\u2500\u2500 deployment.yaml
\u2502   \u251C\u2500\u2500 externaldb-secrets.yaml
\u2502   \u251C\u2500\u2500 _helpers.tpl
\u2502   \u251C\u2500\u2500 ingress.yaml
\u2502   \u251C\u2500\u2500 NOTES.txt
\u2502   \u251C\u2500\u2500 pvc.yaml
\u2502   \u251C\u2500\u2500 secrets.yaml
\u2502   \u251C\u2500\u2500 svc.yaml
\u2502   \u2514\u2500\u2500 tls-secrets.yaml
\u2514\u2500\u2500 values.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E00\u4E2A wordpress chart \u5982\u4E0A\uFF08\u53BB\u9664\u90E8\u5206 test \u548C charts \u4F9D\u8D56\uFF09\uFF0C \u57FA\u672C\u7ED3\u6784\u7531\u4EE5\u4E0B\u51E0\u4E2A\u90E8\u5206\u7EC4\u6210\uFF1A</p><ul><li>charts \u5B58\u653E\u5B50Chart (Subchart) \u7684\u5B9A\u4E49\uFF0CSubchart \u6307\u7684\u662F\u5F53\u524D Chart \u4F9D\u8D56\u7684 Chart \uFF0C \u5728 requirements.yaml \u4E2D\u5B9A\u4E49</li><li>Chart.yaml \u5305\u542B Chart \u4FE1\u606F\u7684 YAML \u6587\u4EF6\uFF0C \u5305\u62EC Chart \u7684\u7248\u672C\u3001\u540D\u79F0\u7B49\uFF0C\u5728 DCE Helm \u63D2\u4EF6\u4E2D\u8FD8\u5305\u542B Chart \u7684 <strong>\u56E2\u961F\u6388\u6743</strong> \u4FE1\u606F \u548C <strong>\u662F\u5426\u516C\u5F00</strong> \u7684\u4FE1\u606F</li><li>README.md \u53EF\u9009\uFF1AChart \u7684\u4ECB\u7ECD\u4FE1\u606F\u7B49\uFF08\u8BE5\u6587\u4EF6\u5BF9\u4E8E\u4E00\u4E2A\u5927\u578B Chart \u6765\u8BF4\u5341\u5206\u91CD\u8981\uFF09</li><li><code>Requirements.yaml</code> \u53EF\u9009\uFF1A\u5217\u4E3E\u5F53\u524D Chart \u7684\u9700\u8981\u4F9D\u8D56\u7684 Chart</li><li><code>templates</code>\uFF1A <ul><li>\u8BE5\u76EE\u5F55\u4E0B\u5B58\u653E Chart \u6240\u6709\u7684 K8s \u8D44\u6E90\u5B9A\u4E49\u6A21\u677F\uFF0C\u901A\u5E38\u4E0D\u540C\u7684\u8D44\u6E90\u653E\u5728\u4E0D\u540C\u7684\u6587\u4EF6\u4E2D\uFF0CDCE Helm \u63D2\u4EF6\u4E2D\u81EA\u5B9A\u4E49\u6A21\u677F\u7684 K8s \u8D44\u6E90\u7EDF\u4E00\u653E\u5728 all_sources.yaml \u6587\u4EF6\u4E2D</li><li>_helpers.tpl \uFF0C \u901A\u5E38\u8FD9\u4E2A\u6587\u4EF6\u5B58\u653E\u53EF\u91CD\u7528\u7684\u6A21\u677F\u7247\u6BB5\uFF0C\u8BE5\u6587\u4EF6\u4E2D\u7684\u5B9A\u4E49\u53EF\u4EE5\u5728 Chart \u5176\u5B83\u8D44\u6E90\u5B9A\u4E49\u6A21\u677F\u4E2D\u4F7F\u7528</li><li>NOTES.txt\uFF0C\u53EF\u9009\uFF1A\u4E00\u6BB5\u7B80\u77ED\u4F7F\u7528\u8BF4\u660E\u7684\u6587\u672C\u6587\u4EF6\uFF0C\u7528\u4E8E\u5B89\u88C5 Release \u540E\u63D0\u793A\u7528\u6237\u4F7F\u7528</li></ul></li><li>values.yaml \u5F53\u524D Chart \u7684\u9ED8\u8BA4\u914D\u7F6E\u7684\u503C</li></ul><h3 id="\u7F16\u5199\u4E00\u4E2A\u7B80\u5355\u7684-chart-\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u7F16\u5199\u4E00\u4E2A\u7B80\u5355\u7684-chart-\u793A\u4F8B" aria-hidden="true">#</a> \u7F16\u5199\u4E00\u4E2A\u7B80\u5355\u7684 Chart \u793A\u4F8B</h3>`,29),dn=s("\u672C\u8282\u4EE5\u6784\u5EFA\u4E00\u4E2A\u540D\u79F0\u4E3A "),kn=n("code",null,"nginx-test Chart",-1),mn=s(" \u4E3A\u793A\u4F8B\uFF0C\u6765\u63CF\u8FF0\u4E00\u4E2A "),vn=n("code",null,"chart",-1),bn=s(" \u5FC5\u8981\u6761\u4EF6\u3002 1\u3001"),hn=n("code",null,"Chart.yaml",-1),gn=s(" \u6587\u4EF6\u662F \u4E00\u4E2A "),yn=n("code",null,"chart",-1),_n=s(" \u5FC5\u8981\u6587\u4EF6\uFF0C \u8BE5\u6587\u4EF6\u53EF\u4EE5\u7B80\u5355\u5305\u62EC\u4EE5\u4E0B\u5B57\u6BB5\uFF08\u5177\u4F53\u5B57\u6BB5\u8BF7\u53C2\u8003"),fn={href:"https://links.jianshu.com/go?to=https%3A%2F%2Fhelm.sh%2F",target:"_blank",rel:"noopener noreferrer"},qn=s("Helm\u5B98\u7F51"),xn=s(")"),Cn=t(`<div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1  (chart \u7684API\u7248\u672C<span class="token punctuation">,</span> \u603B\u662F&quot;v1&quot;<span class="token punctuation">,</span> \u5FC5\u8981)
<span class="token key atrule">name</span><span class="token punctuation">:</span> hello     (chart \u7684\u540D\u79F0<span class="token punctuation">,</span> \u5FC5\u8981)
<span class="token key atrule">version</span><span class="token punctuation">:</span> 0.0.1  (chart \u7684\u7248\u672C\uFF0C\u8FD9\u4E2A\u7248\u672C\u5FC5\u987B\u5FC5\u8981\u9075\u5FAA SemVer 2\u6807\u51C6)
<span class="token key atrule">description</span><span class="token punctuation">:</span> A Helm chart for Kubernetes   (chart \u6A21\u677F\u7684\u7B80\u4ECB\u63CF\u8FF0)
<span class="token punctuation">...</span>
\u4E0B\u9762\u7701\u7565\u4E00\u4E9B\u5B57\u6BB5\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u6709\u8FD9\u51E0\u4E2A\u5B57\u6BB5\u5B9A\u4E49\u5C31\u53EF\u4EE5\u4E86
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2\u3001values.yaml \u6587\u4EF6\u662F chart \u7684\u5FC5\u8981\u6587\u4EF6\uFF0C\u4EE5 nginx \u4E3A\u793A\u4F8B\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># Default values for test.</span>
<span class="token comment"># This is a YAML-formatted file.</span>
<span class="token comment"># Declare variables to be passed into your templates.</span>
<span class="token key atrule">replicaCount</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">image</span><span class="token punctuation">:</span>
  <span class="token key atrule">repository</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">tag</span><span class="token punctuation">:</span> stable
  <span class="token key atrule">pullPolicy</span><span class="token punctuation">:</span> IfNotPresent
<span class="token key atrule">service</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>

<span class="token key atrule">ingress</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment"># kubernetes.io/ingress.class: nginx</span>
    <span class="token comment"># kubernetes.io/tls-acme: &quot;true&quot;</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> /
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> chart<span class="token punctuation">-</span>example.local
  <span class="token key atrule">tls</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">#  - secretName: chart-example-tls</span>
  <span class="token comment">#    hosts:</span>
  <span class="token comment">#      - chart-example.local</span>

<span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment"># We usually recommend not to specify default resources and to leave this as a conscious</span>
  <span class="token comment"># choice for the user. This also increases chances charts run on environments with little</span>
  <span class="token comment"># resources, such as Minikube. If you do want to specify resources, uncomment the following</span>
  <span class="token comment"># lines, adjust them as necessary, and remove the curly braces after &#39;resources:&#39;.</span>
  <span class="token comment"># limits:</span>
  <span class="token comment">#  cpu: 100m</span>
  <span class="token comment">#  memory: 128Mi</span>
  <span class="token comment"># requests:</span>
  <span class="token comment">#  cpu: 100m</span>
  <span class="token comment">#  memory: 128Mi</span>

<span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token key atrule">tolerations</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token key atrule">affinity</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u793A\u4F8B\u4E2D\u53EF\u4EE5\u770B\u51FA\uFF0C<code>values.yaml</code> \u4E2D\u5B9A\u4E49\u4E86\u4E00\u4E9B\u5F53\u524D<code>chart</code> \u7684\u4E00\u4E9B\u9ED8\u8BA4\u503C\uFF0C\u7528\u4E8E <code>templates</code> \u4E0B\u7684 K8s \u8D44\u6E90 yaml \u6E32\u67D3\u65F6\u586B\u5145\u9ED8\u8BA4\u503C\u3002\u4E0D\u8FC7\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u5982\u679C\u4F7F\u7528 helm install \u6765\u90E8\u7F72\u4E00\u4E2A Release , \u53EF\u4EE5\u901A\u8FC7\u4E0B\u9762\u547D\u4EE4\u6307\u5B9A\u4E00\u4EFDyaml \u6587\u4EF6\u4F5C\u4E3A\u586B\u5145\u503C\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ helm <span class="token function">install</span> <span class="token parameter variable">--values</span><span class="token operator">=</span>myvals.yaml nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3\u3001\u521B\u5EFA templates \u4E0B\u7684\u6A21\u677F\u6587\u4EF6\uFF0C \u7528\u4E8E\u751F\u6210 <code>Kubernetes</code> \u8D44\u6E90\u6E05\u5355(manifests) \u5982\u4E0B\u6240\u793A:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># nginx-test/templates/deployments.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1beta2
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template &quot;nginx<span class="token punctuation">-</span>test.fullname&quot; . <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template &quot;nginx<span class="token punctuation">-</span>test.name&quot; . <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">chart</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template &quot;nginx<span class="token punctuation">-</span>test.chart&quot; . <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">release</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Name <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">heritage</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Service <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.replicaCount <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template &quot;nginx<span class="token punctuation">-</span>test.name&quot; . <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">release</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Name <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template &quot;nginx<span class="token punctuation">-</span>test.name&quot; . <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">release</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Name <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Chart.Name <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;{{ .Values.image.repository }}:{{ .Values.image.tag }}&quot;</span>
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.image.pullPolicy <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /
              <span class="token key atrule">port</span><span class="token punctuation">:</span> http
          <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /
              <span class="token key atrule">port</span><span class="token punctuation">:</span> http
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> toYaml .Values.resources <span class="token punctuation">|</span> indent 12 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> with .Values.nodeSelector <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> toYaml . <span class="token punctuation">|</span> indent 8 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> with .Values.affinity <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">affinity</span><span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> toYaml . <span class="token punctuation">|</span> indent 8 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> with .Values.tolerations <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> toYaml . <span class="token punctuation">|</span> indent 8 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span>
    
<span class="token comment"># nginx-test/templates/service.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template &quot;nginx<span class="token punctuation">-</span>test.fullname&quot; . <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template &quot;nginx<span class="token punctuation">-</span>test.name&quot; . <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">chart</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template &quot;nginx<span class="token punctuation">-</span>test.chart&quot; . <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">release</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Name <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">heritage</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Service <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.service.type <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.service.port <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http 
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">name</span><span class="token punctuation">:</span> http
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template &quot;nginx<span class="token punctuation">-</span>test.name&quot; . <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">release</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Name <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u5B9A\u4E49\u4E86 \u4E00\u4E2A <code>deployments.yaml</code> \u548C <code>service.yaml</code> \u8D44\u6E90\u6587\u4EF6\uFF0C\u91CC\u9762\u4F7F\u7528 <code>{{ }}</code> \u7B26\u53F7\u7684\u662F <code>Go</code> \u6A21\u677F\u8BED\u8A00\u7684\u6807\u51C6\u3002\u5176\u4E2D\u53EF\u4EE5\u901A\u8FC7\uFF1A</p><ul><li><code>.Values</code> \u5BF9\u8C61\u8BBF\u95EE <code>values.yaml</code> \u6587\u4EF6\u7684\u5185\u5BB9\uFF0C \u524D\u9762\u7684dot(.) \u8868\u793A\u4ECE\u9876\u5C42\u547D\u540D\u7A7A\u95F4\u5F00\u59CB\uFF0C\u627E\u5230 Values \u5BF9\u8C61(\u4E0B\u540C)</li><li><code>.Release</code>\u3001<code>.Chart</code> \u5F00\u5934\u7684\u9884\u5B9A\u4E49\u503C\u53EF\u7528\u4E8E\u4EFB\u4F55\u7684\u6A21\u677F\u4E2D</li><li><code>.Chart</code> \u5BF9\u8C61\u7528\u6765\u8BBF\u95EE <code>Chart.yaml</code> \u6587\u4EF6\u7684\u5185\u5BB9</li><li><code>.Release</code> \u5BF9\u8C61\u662F Helm\u7684\u5185\u7F6E\u5BF9\u8C61\u4E4B\u4E00\uFF0C \u4F7F\u7528 Helm \u5B89\u88C5\u4E00\u4E2A release \u65F6\uFF0C\u7531 Tiller \u5206\u914D release \u7684\u540D\u79F0</li></ul><p>4\u3001\u547D\u540D\u6A21\u677F(_helper.tpl) \uFF1A\u53EF\u4EE5\u4ECE\u4E0A\u9762\u770B\u5230\u6709 <code>{{ template &quot;nginx-test.fullname&quot; . }}</code> \u5B9A\u4E49\u3002\u8BE5\u5B9A\u4E49\u7531 <code>_helper.tpl</code> \u6587\u4EF6\u5B9A\u4E49\u7684\u5B57\u6BB5\u6765\u5B9E\u73B0\uFF0C\u6BD4\u5982\u4E0B\u9762\u4E00\u4E2A <code>_helper.tpl</code>\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token key atrule">/* vim</span><span class="token punctuation">:</span> <span class="token key atrule">set filetype=mustache</span><span class="token punctuation">:</span> <span class="token important">*/</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>/*
Expand the name of the chart.
<span class="token important">*/</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> define &quot;nginx<span class="token punctuation">-</span>test.name&quot; <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> default .Chart.Name .Values.nameOverride <span class="token punctuation">|</span> trunc 63 <span class="token punctuation">|</span> trimSuffix &quot;<span class="token punctuation">-</span>&quot; <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token punctuation">{</span><span class="token punctuation">{</span>/*
Create a default fully qualified app name.
We truncate at 63 chars because some Kubernetes name fields are limited to this (by the DNS naming spec).
If release name contains chart name it will be used as a full name.
<span class="token important">*/</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> define &quot;nginx<span class="token punctuation">-</span>test.fullname&quot; <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> if .Values.fullnameOverride <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> .Values.fullnameOverride <span class="token punctuation">|</span> trunc 63 <span class="token punctuation">|</span> trimSuffix &quot;<span class="token punctuation">-</span>&quot; <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> else <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> $name <span class="token punctuation">:</span>= default .Chart.Name .Values.nameOverride <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> if contains $name .Release.Name <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> .Release.Name <span class="token punctuation">|</span> trunc 63 <span class="token punctuation">|</span> trimSuffix &quot;<span class="token punctuation">-</span>&quot; <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> else <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> printf &quot;%s<span class="token punctuation">-</span>%s&quot; .Release.Name $name <span class="token punctuation">|</span> trunc 63 <span class="token punctuation">|</span> trimSuffix &quot;<span class="token punctuation">-</span>&quot; <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token punctuation">{</span><span class="token punctuation">{</span>/*
Create chart name and version as used by the chart label.
<span class="token important">*/</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> define &quot;nginx<span class="token punctuation">-</span>test.chart&quot; <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> printf &quot;%s<span class="token punctuation">-</span>%s&quot; .Chart.Name .Chart.Version <span class="token punctuation">|</span> replace &quot;+&quot; &quot;_&quot; <span class="token punctuation">|</span> trunc 63 <span class="token punctuation">|</span> trimSuffix &quot;<span class="token punctuation">-</span>&quot; <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BE5\u6A21\u677F\u5B9A\u4E49\u4E86 &quot;nginx-test.name&quot;\u3001&quot;nginx-test.fullname&quot;\u3001&quot;nginx-test.chart&quot; \u7B49\u53EF\u91CD\u7528\u6A21\u677F\u90E8\u5206\uFF0C\u5F53\u6A21\u677F\u5F15\u64CE\u8BFB\u53D6\u8BE5\u6587\u4EF6\u65F6\uFF0C\u5B83\u5B58\u50A8\u5BF9 nginx-test.name\u7B49\u7684\u5F15\u7528\uFF0C \u76F4\u5230\u8C03\u7528 template &quot;nginx-test.name&quot; \u4E3A\u6B62\u3002\u7136\u540E\u628A\u503C\u6E32\u67D3\u5230\u6A21\u677F\u4E2D\u3002</p><p>\u6CE8\u610F <code>{{ template &quot;nginx-test.chart&quot; . }}</code> \u540E\u9762\u6709\u4E2A<code>dot(.)</code>\uFF0C\u8FD9\u662F\u56E0\u4E3A\u4E00\u4E2A\u5DF2\u547D\u540D\u7684\u6A21\u677F\uFF08\u7528\u4E8E\u521B\u5EFA <code>define</code>) \u88AB\u6E32\u67D3\u65F6\uFF0C\u5B83\u5C06\u63A5\u6536\u7531\u8BE5 <code>template</code> \u8C03\u7528\u4F20\u5165\u7684\u8303\u56F4<code>\uFF08scope)</code>\u3002\u6CA1\u6709\u8303\u56F4\u4F20\u5165\uFF0C\u5728\u6A21\u677F\u4E2D\u65E0\u6CD5\u8BBF\u95EE\u4EFB\u4F55\u5185\u5BB9\uFF0C\u56E0\u6B64\u5728\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> define &quot;nginx<span class="token punctuation">-</span>test.chart&quot; <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
\u8FD9\u91CC\u9762\u7684 .Chart \u5C06\u65E0\u6CD5\u8BBF\u95EE\uFF0C\u5BFC\u81F4\u5728\u6A21\u677F\u4E2D\u65E0\u6CD5\u770B\u5230\u5185\u5BB9\uFF0C\u56E0\u4E3A\u8FD9\u91CC\u503C\u4E3A\u7A7A
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u56E0\u6B64\u5728\u6A21\u677F\u4E2D\u5C06 \u8303\u56F4(scope) \u4F20\u5165\u5373\u53EF\u6B63\u5E38\u4F7F\u7528\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># nginx-test/templates/service.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template &quot;nginx<span class="token punctuation">-</span>test.fullname&quot; . <span class="token punctuation">}</span><span class="token punctuation">}</span>
  \u5728\u672B\u5C3E\u4F20\u9012\u4E86 . \u8FD9\u6837\u5C31\u53EF\u4EE5\u4F7F\u7528 .Values \u6216\u8005 .Chart \u6216\u5176\u5B83\u8303\u56F4(scope)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5\u3001Chart \u4F9D\u8D56\uFF08requirements.yaml)\uFF1A\u6BD4\u5982 <code>WordPress Chart</code> \u4F9D\u8D56\u4E8E mariadb Chart\uFF0C \u4E0B\u9762\u662F WordPress \u7684\u4F9D\u8D56(requirements.yaml)\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">dependencies</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mariadb
  <span class="token key atrule">version</span><span class="token punctuation">:</span> 5.x.x
  <span class="token key atrule">repository</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//kubernetes<span class="token punctuation">-</span>charts.storage.googleapis.com/
  <span class="token key atrule">condition</span><span class="token punctuation">:</span> mariadb.enabled
  <span class="token key atrule">tags</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> wordpress<span class="token punctuation">-</span>database
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BE5\u6587\u4EF6\u5217\u4E3E\u5F53\u524D Chart \u6240\u6709\u7684 \u4F9D\u8D56\uFF08subchart)\u3002\u6709\u51E0\u4E2A\u5B57\u6BB5\u662F\u5FC5\u8981\u7684\uFF1A</p><ul><li>name: \u4F9D\u8D56 Chart \u7684\u540D\u79F0\uFF08\u5FC5\u8981\uFF09</li><li>version: \u4F9D\u8D56 Chart \u7684\u7248\u672C\u53F7\uFF08\u5FC5\u8981\uFF09</li><li>repository: \u4F9D\u8D56 Chart \u7684\u5B58\u50A8\u5E93\u5B8C\u6574URL\uFF0C\u5FC5\u987B\u901A\u8FC7 helm repo add \u6DFB\u52A0 repository\uFF08\u5B58\u50A8\u5E93\uFF09\u5230\u672C\u5730</li></ul><h2 id="clusterfile\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#clusterfile\u6587\u4EF6" aria-hidden="true">#</a> Clusterfile\u6587\u4EF6</h2><blockquote><p>\u5F53\u6211\u4EEC\u4F7F\u7528 <code>sealos</code> \u542F\u52A8\u4E00\u4E2A\u96C6\u7FA4\u955C\u50CF\u7684\u65F6\u5019\u6211\u4EEC\u4F1A\u6709\u4E00\u4E2A <code>Clusterfile</code> \u6587\u4EF6\u3002</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>root@VM-4-3-ubuntu:~/.sealos/default# cat Clusterfile 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><details class="custom-container details"><summary>\u5C55\u5F00</summary><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>root@VM<span class="token punctuation">-</span>4<span class="token punctuation">-</span>3<span class="token punctuation">-</span>ubuntu<span class="token punctuation">:</span>~/.sealos/default<span class="token comment"># cat Clusterfile </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps.sealos.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Cluster
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">&quot;2022-10-20T13:12:33Z&quot;</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">ips</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> 10.0.4.3<span class="token punctuation">:</span><span class="token number">22</span>
    <span class="token key atrule">roles</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> master
    <span class="token punctuation">-</span> amd64
  <span class="token key atrule">image</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> labring/kubernetes<span class="token punctuation">:</span>v1.25.0
  <span class="token punctuation">-</span> labring/helm<span class="token punctuation">:</span>v3.8.2
  <span class="token punctuation">-</span> labring/calico<span class="token punctuation">:</span>v3.24.1
  <span class="token punctuation">-</span> labring/kubernetes<span class="token punctuation">:</span>v1.25.0
  <span class="token punctuation">-</span> labring/helm<span class="token punctuation">:</span>v3.8.2
  <span class="token punctuation">-</span> labring/calico<span class="token punctuation">:</span>v3.24.1
  <span class="token punctuation">-</span> labring/kubernetes<span class="token punctuation">-</span>docker<span class="token punctuation">:</span>v1.20.5<span class="token punctuation">-</span>4.1.3
  <span class="token punctuation">-</span> labring/calico<span class="token punctuation">:</span>v3.24.1
  <span class="token punctuation">-</span> labring/kubernetes<span class="token punctuation">-</span>docker<span class="token punctuation">:</span>v1.20.5<span class="token punctuation">-</span>4.1.3
  <span class="token key atrule">ssh</span><span class="token punctuation">:</span>
    <span class="token key atrule">passwd</span><span class="token punctuation">:</span> <span class="token string">&#39;[your-ssh-passwd]&#39;</span>
    <span class="token key atrule">pk</span><span class="token punctuation">:</span> /root/.ssh/id_rsa
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">22</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span> root
<span class="token key atrule">status</span><span class="token punctuation">:</span>
  <span class="token key atrule">conditions</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">lastHeartbeatTime</span><span class="token punctuation">:</span> <span class="token string">&quot;2022-11-03T11:10:06Z&quot;</span>
    <span class="token key atrule">message</span><span class="token punctuation">:</span> Applied to cluster successfully
    <span class="token key atrule">reason</span><span class="token punctuation">:</span> Ready
    <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token string">&quot;True&quot;</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> ApplyClusterSuccess
  <span class="token key atrule">mounts</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">criData</span><span class="token punctuation">:</span> /var/lib/containerd
      <span class="token key atrule">registryConfig</span><span class="token punctuation">:</span> /etc/registry
      <span class="token key atrule">registryData</span><span class="token punctuation">:</span> /var/lib/registry
      <span class="token key atrule">registryDomain</span><span class="token punctuation">:</span> sealos.hub
      <span class="token key atrule">registryPassword</span><span class="token punctuation">:</span> passw0rd
      <span class="token key atrule">registryPort</span><span class="token punctuation">:</span> <span class="token string">&quot;5000&quot;</span>
      <span class="token key atrule">registryUsername</span><span class="token punctuation">:</span> admin
    <span class="token key atrule">imageName</span><span class="token punctuation">:</span> labring/kubernetes<span class="token punctuation">:</span>v1.25.0
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">auth</span><span class="token punctuation">:</span> auth.sh
      <span class="token key atrule">check</span><span class="token punctuation">:</span> check.sh $registryData
      <span class="token key atrule">clean</span><span class="token punctuation">:</span> clean.sh $criData
      <span class="token key atrule">clean-registry</span><span class="token punctuation">:</span> clean<span class="token punctuation">-</span>registry.sh $registryData $registryConfig
      <span class="token key atrule">image</span><span class="token punctuation">:</span> ghcr.io/labring/lvscare<span class="token punctuation">:</span>v4.1.3
      <span class="token key atrule">init</span><span class="token punctuation">:</span> init.sh $registryDomain $registryPort
      <span class="token key atrule">init-registry</span><span class="token punctuation">:</span> init<span class="token punctuation">-</span>registry.sh $registryData $registryConfig
      <span class="token key atrule">io.buildah.version</span><span class="token punctuation">:</span> 1.25.0<span class="token punctuation">-</span>dev
      <span class="token key atrule">sealos.io.type</span><span class="token punctuation">:</span> rootfs
      <span class="token key atrule">version</span><span class="token punctuation">:</span> v1.25.0
    <span class="token key atrule">mountPoint</span><span class="token punctuation">:</span> /var/lib/containers/storage/overlay/d6743e52e7bd4635107a4e7b586892dd505c9f5e4c5d040f16004f571934bb33/merged
    <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>a26bij8e
    <span class="token key atrule">type</span><span class="token punctuation">:</span> rootfs
  <span class="token punctuation">-</span> <span class="token key atrule">cmd</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> cp opt/helm /usr/bin/
    <span class="token key atrule">imageName</span><span class="token punctuation">:</span> labring/helm<span class="token punctuation">:</span>v3.8.2
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">io.buildah.version</span><span class="token punctuation">:</span> 1.25.0<span class="token punctuation">-</span>dev
    <span class="token key atrule">mountPoint</span><span class="token punctuation">:</span> /var/lib/containers/storage/overlay/a673232bd58b472065d8741c307394e0371b0b8e5e4c199e7e1c3f5df05285d0/merged
    <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>7bztc4cy
    <span class="token key atrule">type</span><span class="token punctuation">:</span> application
  <span class="token punctuation">-</span> <span class="token key atrule">cmd</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> kubectl create namespace tigera<span class="token punctuation">-</span>operator
    <span class="token punctuation">-</span> helm install calico charts/calico <span class="token punctuation">-</span><span class="token punctuation">-</span>namespace tigera<span class="token punctuation">-</span>operator
    <span class="token key atrule">imageName</span><span class="token punctuation">:</span> labring/calico<span class="token punctuation">:</span>v3.24.1
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">io.buildah.version</span><span class="token punctuation">:</span> 1.25.0<span class="token punctuation">-</span>dev
    <span class="token key atrule">mountPoint</span><span class="token punctuation">:</span> /var/lib/containers/storage/overlay/89823056d3a1c3d2daaa7d4c90e3a50c03ff82cb70dfed0ec22b06307a875411/merged
    <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>orerq6tp
    <span class="token key atrule">type</span><span class="token punctuation">:</span> application
  <span class="token punctuation">-</span> <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">criData</span><span class="token punctuation">:</span> /var/lib/docker
      <span class="token key atrule">criDockerdData</span><span class="token punctuation">:</span> /var/lib/cri<span class="token punctuation">-</span>dockerd
      <span class="token key atrule">registryConfig</span><span class="token punctuation">:</span> /etc/registry
      <span class="token key atrule">registryData</span><span class="token punctuation">:</span> /var/lib/registry
      <span class="token key atrule">registryDomain</span><span class="token punctuation">:</span> sealos.hub
      <span class="token key atrule">registryPassword</span><span class="token punctuation">:</span> passw0rd
      <span class="token key atrule">registryPort</span><span class="token punctuation">:</span> <span class="token string">&quot;5000&quot;</span>
      <span class="token key atrule">registryUsername</span><span class="token punctuation">:</span> admin
    <span class="token key atrule">imageName</span><span class="token punctuation">:</span> labring/kubernetes<span class="token punctuation">-</span>docker<span class="token punctuation">:</span>v1.20.5<span class="token punctuation">-</span>4.1.3
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">auth</span><span class="token punctuation">:</span> auth.sh $registryDomain $registryPort $registryUsername $registryPassword
      <span class="token key atrule">check</span><span class="token punctuation">:</span> check.sh $registryData
      <span class="token key atrule">clean</span><span class="token punctuation">:</span> clean.sh $criData $criDockerdData
      <span class="token key atrule">clean-registry</span><span class="token punctuation">:</span> clean<span class="token punctuation">-</span>registry.sh $registryData $registryConfig
      <span class="token key atrule">image</span><span class="token punctuation">:</span> ghcr.io/labring/lvscare<span class="token punctuation">:</span>v4.1.3
      <span class="token key atrule">init</span><span class="token punctuation">:</span> init.sh
      <span class="token key atrule">init-registry</span><span class="token punctuation">:</span> init<span class="token punctuation">-</span>registry.sh $registryData $registryConfig
      <span class="token key atrule">io.buildah.version</span><span class="token punctuation">:</span> 1.25.0<span class="token punctuation">-</span>dev
      <span class="token key atrule">sealos.io.type</span><span class="token punctuation">:</span> rootfs
      <span class="token key atrule">sealos.io.version</span><span class="token punctuation">:</span> v1beta1
      <span class="token key atrule">version</span><span class="token punctuation">:</span> v1.20.5
    <span class="token key atrule">mountPoint</span><span class="token punctuation">:</span> /var/lib/containers/storage/overlay/4af662552ff4c7c5b2fa7ca9995664911e72528ad964f0c181a7f5d718716e2d/merged
    <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>km12aep7
    <span class="token key atrule">type</span><span class="token punctuation">:</span> rootfs
  <span class="token key atrule">phase</span><span class="token punctuation">:</span> ClusterSuccess
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p>\u6211\u4EEC\u8FDB\u5165 <code>/var/lib/containers/storage/overlay/4af662552ff4c7c5b2fa7ca9995664911e72528ad964f0c181a7f5d718716e2d/</code> \u76EE\u5F55\uFF08\u8FD9\u91CC\u9762\u5C31\u662F rootfs\uFF09\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /var/lib/containers/storage/overlay/4af662552ff4c7c5b2fa7ca9995664911e72528ad964f0c181a7f5d718716e2d/merged
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>**\u8FD9\u4E2A\u91CC\u9762\u5C31\u6709\u6240\u6709\u6587\u4EF6\uFF0C\u6587\u4EF6\u91CC\u9762\u6709\u5B89\u88C5 <code>k8s</code> \u6240\u6709\u7684\u4F9D\u8D56 **</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ca9995664911e72528ad964f0c181a7f5d718716e2d/merged<span class="token comment"># ls</span>
bin  cri  etc  images  Kubefile  opt  README.md  registry  scripts  statics
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>bin</code> \u5E26\u7740\u4E00\u4E9B\u96C6\u7FA4\u9700\u8981\u7684 <code>kubeadm</code> \u3001<code>kubelet</code></li><li><code>images</code> \u91CC\u9762\u6587\u4EF6\u4E2D\u6709 <code>docker</code> \u955C\u50CF\u5217\u8868\u548C\u5730\u5740\uFF08\u8F6Ck8s\u96C6\u7FA4\u9700\u8981\u7684\uFF0C\u4F1A\u81EA\u52A8\u62C9\u53D6\u4E0B\u9762\u7684~\uFF09</li><li><code>etcd</code> \u5404\u79CD\u914D\u7F6E\u6587\u4EF6</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>/merged<span class="token comment"># cat images/shim/DefaultI</span>
mageList 
k8s.gcr.io/kube-apiserver:v1.20.5
k8s.gcr.io/kube-controller-manager:v1.20.5
k8s.gcr.io/kube-scheduler:v1.20.5
k8s.gcr.io/kube-proxy:v1.20.5
k8s.gcr.io/pause:3.2
k8s.gcr.io/etcd:3.4.13-0
k8s.gcr.io/coredns:1.7.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u6240\u4EE5 <code>sealos run</code> \u7684\u65F6\u5019\u5148\u627E<code>sealos</code> \u955C\u50CF\u4ED3\u5E93\u4E2D\u7684\u3002</strong></p><p><strong>\u6784\u5EFA\u5F53\u524D\u96C6\u7FA4\u955C\u50CF\uFF1A</strong></p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code>ca9995664911e72528ad964f0c181a7f5d718716e2d/merged# cat Kubefile 
<span class="token instruction"><span class="token keyword">FROM</span> scratch</span>
<span class="token instruction"><span class="token keyword">MAINTAINER</span> sealos</span>
<span class="token instruction"><span class="token keyword">LABEL</span> init=<span class="token string">&quot;init.sh&quot;</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> version=<span class="token string">&quot;v1.20.5&quot;</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> image=<span class="token string">&quot;ghcr.io/labring/lvscare:v4.1.3&quot;</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> clean=<span class="token string">&quot;clean.sh \\$criData \\$criDockerdData&quot;</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> check=<span class="token string">&quot;check.sh \\$registryData&quot;</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> init-registry=<span class="token string">&quot;init-registry.sh \\$registryData \\$registryConfig&quot;</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> clean-registry=<span class="token string">&quot;clean-registry.sh \\$registryData \\$registryConfig&quot;</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> auth=<span class="token string">&quot;auth.sh \\$registryDomain \\$registryPort \\$registryUsername \\$registryPassword&quot;</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> sealos.io.type=<span class="token string">&quot;rootfs&quot;</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> sealos.io.version=<span class="token string">&quot;v1beta1&quot;</span></span>
<span class="token instruction"><span class="token keyword">ENV</span> criData=/var/lib/docker</span>
<span class="token instruction"><span class="token keyword">ENV</span> criDockerdData=/var/lib/cri-dockerd</span>
<span class="token instruction"><span class="token keyword">ENV</span> registryData=/var/lib/registry</span>
<span class="token instruction"><span class="token keyword">ENV</span> registryConfig=/etc/registry</span>
<span class="token instruction"><span class="token keyword">ENV</span> registryDomain=sealos.hub</span>
<span class="token instruction"><span class="token keyword">ENV</span> registryPort=5000</span>
<span class="token instruction"><span class="token keyword">ENV</span> registryUsername=admin</span>
<span class="token instruction"><span class="token keyword">ENV</span> registryPassword=passw0rd</span>
<span class="token instruction"><span class="token keyword">COPY</span> . .</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u6211\u4EEC\u53EF\u4EE5\u76F4\u63A5 build \u51FA\u4E00\u4E2A\u955C\u50CF\uFF1A</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>sealos build <span class="token parameter variable">-t</span> calico:latest <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6211\u4EEC\u4F1A\u628A <code>calica</code> \u4F9D\u8D56\u7684\u6240\u6709\u955C\u50CF\u62C9\u53D6\u4E0B\u6765\uFF0C\u653E\u5230 <code>registry</code> \u76EE\u5F55\u4E0B\u9762\u3002</p><h2 id="end-\u94FE\u63A5" tabindex="-1"><a class="header-anchor" href="#end-\u94FE\u63A5" aria-hidden="true">#</a> END \u94FE\u63A5</h2><ul><li><div><a href="1.md" style="float:left;">\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} </a><a href="3.md" style="float:right;"> \uFE0F\u4E0B\u4E00\u8282\u{1F517}</a></div></li></ul>`,38),wn=s("\u24C2\uFE0F\u56DE\u5230\u76EE\u5F55\u{1F3E0}"),$n={href:"https://nsddd.top/archives/contributors",target:"_blank",rel:"noopener noreferrer"},An=n("strong",null,"\u{1FAF5}\u53C2\u4E0E\u8D21\u732E\u{1F49E}\u2764\uFE0F\u200D\u{1F525}\u{1F496}",-1),Dn=s(")"),En=s("\u2734\uFE0F\u7248\u6743\u58F0\u660E \xA9 \uFF1A\u672C\u4E66\u6240\u6709\u5185\u5BB9\u9075\u5FAA"),Tn={href:"http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},Vn=s("CC-BY-SA 3.0\u534F\u8BAE\uFF08\u7F72\u540D-\u76F8\u540C\u65B9\u5F0F\u5171\u4EAB\uFF09\xA9");function Nn(Pn,Sn){const e=l("ExternalLinkIcon"),p=l("RouterLink");return c(),i("div",null,[n("ul",null,[n("li",null,[n("a",d,[k,a(e)])])]),m,v,b,h,n("blockquote",null,[n("p",null,[g,n("a",y,[_,a(e)]),f,n("a",q,[x,a(e)]),C,n("a",w,[$,a(e)])])]),A,D,E,n("ul",null,[n("li",null,[T,n("a",V,[N,a(e)])])]),P,n("blockquote",null,[S,n("p",null,[R,n("a",H,[L,a(e)])])]),I,n("details",K,[F,M,n("ul",null,[n("li",null,[n("a",B,[O,a(e)])])]),z]),W,n("p",null,[G,n("a",U,[Y,a(e)]),j]),Z,n("blockquote",null,[n("p",null,[J,n("a",Q,[X,a(e)]),nn]),sn]),an,n("p",null,[en,n("a",tn,[ln,a(e)]),pn,n("a",on,[cn,a(e)]),un]),rn,n("p",null,[dn,kn,mn,vn,bn,hn,gn,yn,_n,n("a",fn,[qn,a(e)]),xn]),Cn,n("ul",null,[n("li",null,[n("p",null,[a(p,{to:"/"},{default:u(()=>[wn]),_:1})])]),n("li",null,[n("p",null,[n("a",$n,[An,a(e)]),Dn])]),n("li",null,[n("p",null,[En,n("a",Tn,[Vn,a(e)])])])])])}const Hn=o(r,[["render",Nn],["__file","2.html.vue"]]);export{Hn as default};
