import{_ as l,r as i,o as r,c as d,a as e,b as s,w as c,e as n,d as a}from"./app.e4d6ccd1.js";const u={},_={href:"http://nsddd.top",target:"_blank",rel:"noopener noreferrer"},p=n("author"),h=e("h1",{id:"\u7B2C6\u8282-k3s-runtime-design",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u7B2C6\u8282-k3s-runtime-design","aria-hidden":"true"},"#"),n(" \u7B2C6\u8282 k3s Runtime Design")],-1),v=e("br",null,null,-1),m=e("div",null,[e("a",{href:"5.md",style:{float:"left"}},"\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} "),e("a",{href:"7.md",style:{float:"right"}}," \u2B07\uFE0F\u4E0B\u4E00\u8282\u{1F517}")],-1),b=e("br",null,null,-1),k=n("\u2764\uFE0F\u{1F495}\u{1F495}\u8BB0\u5F55"),g={href:"https://github.com/3293172751/sealos",target:"_blank",rel:"noopener noreferrer"},f=n("sealos"),C=n("\u5F00\u6E90\u9879\u76EE\u7684\u5B66\u4E60\u8FC7\u7A0B\u3002"),x={href:"https://github.com/3293172751/sealos",target:"_blank",rel:"noopener noreferrer"},A=n("k8s,docker\u548C\u4E91\u539F\u751F\u7684\u5B66\u4E60"),E=n("\u3002Myblog:"),y={href:"http://nsddd.top/",target:"_blank",rel:"noopener noreferrer"},w=n("http://nsddd.top"),L=e("hr",null,null,-1),N=e("p",null,"[TOC]",-1),O=e("h2",{id:"idea",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#idea","aria-hidden":"true"},"#"),n(" Idea")],-1),I=n("The community has great expectations for k3s. we need a more lightweight runtime ("),P={href:"https://github.com/sealerio/sealer/issues?q=is%3Aissue+is%3Aopen+k3s",target:"_blank",rel:"noopener noreferrer"},R=n("#issue"),B=n(")"),M=e("li",null,"With high availability, reduce installation cost",-1),q=e("li",null,"high availability etcd",-1),S=e("li",null,"runtime interface need spilt kubeadm and k3s and k0s\uFF0CInterface layer exposure, alignment",-1),Y=e("li",null,[e("code",null,"new_runtime.go"),n(" determines which "),e("code",null,"runtime.go"),n(" to call based on the parameters passed in")],-1),K=e("li",null,"k3s rootfs",-1),D=e("li",null,"Add a corresponding test function",-1),F=n("Minimum resource test "),T={href:"https://docker.nsddd.top/Cloud-Native/7.html",target:"_blank",rel:"noopener noreferrer"},V=n("k3s vs k0s"),j=a(`<h2 id="module-list" tabindex="-1"><a class="header-anchor" href="#module-list" aria-hidden="true">#</a> module list</h2><div class="language-ABAP ext-ABAP line-numbers-mode"><pre class="language-ABAP"><code>#runtime
|____interface.go
|____types.go
|____utils.go
|____utils_test.go
|____new_runtime.go # new_runtime determines which runtime.go to call based on the parameters passed in
|____k0s
| |____common.go
| |____delete_masters.go
| |____delete_nodes.go
| |____init.go
| |____join_masters.go
| |____join_nodes.go
| |____README.md
| |____registry.go
| |____reset.go
| |____runtime.go
| |____upgrade.go
| |____utils.go
| |____v1beta1
| | |____types.go
|____kubernetes
| |____clean.go
| |____driver.go
| |____init.go
| |____join_masters.go
| |____join_nodes.go
| |____kubeadm
| | |____common.go
| | |____kubeadm_config.go
| | |____kubeadm_config_test.go
| |____runtime.go
| |____utils.go

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="interface-\u2615in-preparation" tabindex="-1"><a class="header-anchor" href="#interface-\u2615in-preparation" aria-hidden="true">#</a> interface(\u2615in preparation\u2026)</h2><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Interface <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	<span class="token comment">// Init exec kubeadm init</span>
	<span class="token function">Init</span><span class="token punctuation">(</span>cluster <span class="token operator">*</span>v2<span class="token punctuation">.</span>Cluster<span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">Upgrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">JoinMasters</span><span class="token punctuation">(</span>newMastersIPList <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">JoinNodes</span><span class="token punctuation">(</span>newNodesIPList <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">DeleteMasters</span><span class="token punctuation">(</span>mastersIPList <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token function">DeleteNodes</span><span class="token punctuation">(</span>nodesIPList <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span>
	<span class="token comment">//UpdateCert(certs []string) error</span>
    <span class="token function">NewK0sRuntime</span><span class="token punctuation">(</span>cluster <span class="token operator">*</span>v2<span class="token punctuation">.</span>Cluster<span class="token punctuation">)</span><span class="token punctuation">(</span>runtime<span class="token punctuation">.</span>Installer<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),H=e("strong",null,"demo:",-1),G=n(),U={href:"https://github.com/3293172751/sealer-runtime-demo",target:"_blank",rel:"noopener noreferrer"},J=n("\u{1F9F7} Runtime interface demonstration"),W=a(`<h2 id="achieve-interface" tabindex="-1"><a class="header-anchor" href="#achieve-interface" aria-hidden="true">#</a> achieve interface</h2><ol><li>Support k3s to init\u3001join\u3001upgrade\u3001reset k3s cluster</li><li>Support docker as runtime</li><li>Pakage the CloudImage</li></ol><h2 id="cloudrootfs" tabindex="-1"><a class="header-anchor" href="#cloudrootfs" aria-hidden="true">#</a> CloudRootfs</h2><p><em>kubernetes:</em></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/var/lib/sealer/data/overlay2/ebd0f721b47d5f7f3ea287fe0882613960deef376e5556b34baab95330aa6bad
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><em>Kuberfile - k8s:</em></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>FROM scratch
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
COPY imageList manifests
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em>Kuberfile - k0s:</em></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>COPY rootfs/* <span class="token builtin class-name">.</span>
COPY <span class="token variable">\${ARCH}</span> <span class="token builtin class-name">.</span>
COPY ImageList manifests
BASE rootfs cache
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em>Kuberfile - k3s:</em></p><blockquote><p>My talking about packaging up a minimal Linux distribution to run K3s, similar to https://github.com/rancher/k3os? Or mean just the root filesystem, such as we provide with k3s via https://github.com/k3s-io/k3s-root ?</p><p>\u26A0\uFE0F</p></blockquote>`,11),$={href:"https://docker.nsddd.top/Cloud-Native-k8s/14.html#%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85%E7%9A%84%E8%A7%A3%E6%9E%90",target:"_blank",rel:"noopener noreferrer"},z=n("Online"),Q=n(" Installation"),X=a(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>FROM scratch
COPY imageList manifests
RUN <span class="token function">curl</span> <span class="token parameter variable">-sfL</span> https://get.k3s.io <span class="token operator">|</span> <span class="token assign-left variable">INSTALL_K3S_VERSION</span><span class="token operator">=</span>v1.25.3 <span class="token function">sh</span> -
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),Z={start:"2"},ee={href:"https://docker.nsddd.top/Cloud-Native-k8s/14.html#%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E8%A7%A3%E9%87%8A",target:"_blank",rel:"noopener noreferrer"},ne=n("Offline"),se=n(" installation"),te=a(`<blockquote><p><code>k3s-insatll.sh</code> \u3001<code>k3s-airgap-images-$ARCH.tar</code>\u3001<code>k3s</code>binary system</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>FROM scratch
COPY imageList manifests
COPY . .
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="k3s-rootfs" tabindex="-1"><a class="header-anchor" href="#k3s-rootfs" aria-hidden="true">#</a> k3s - rootfs</h3><blockquote><p><code>sh install.sh</code> There are a number of link types from bin</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">.</span><span class="token comment"># k3s rootfs</span>
\u251C\u2500\u2500 bin
\u2502  \u251C\u2500\u2500 k3s
\u251C\u2500\u2500 etc
\u2502  \u251C\u2500\u2500 k3s
\u2502  \u2502   \u2514\u2500\u2500 k3s.yaml
\u2502  \u2514\u2500\u2500 <span class="token function">node</span>
\u2502      \u2514\u2500\u2500 password
\u251C\u2500\u2500 images
\u251C\u2500\u2500 k3s-install.sh
\u251C\u2500\u2500 Kuberfile
\u251C\u2500\u2500 Metadata
\u2514\u2500\u2500 README.md
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="about-the-k3s-difference" tabindex="-1"><a class="header-anchor" href="#about-the-k3s-difference" aria-hidden="true">#</a> About the k3s difference</h2>`,6),ae=n("Comparison of "),ie={href:"https://docker.nsddd.top/Cloud-Native/7.html",target:"_blank",rel:"noopener noreferrer"},oe=n("k3s vs k0s"),le=n("Comparison of "),re={href:"https://docker.nsddd.top/Cloud-Native-k8s/14.html#containerd",target:"_blank",rel:"noopener noreferrer"},de=n("containerd vs docker"),ce=a('<p>**The installation script is k3s-insatll.sh. **</p><p><strong>cluster role:</strong></p><ul><li>k3s server</li><li>k3s agents(worker nodes)</li></ul><p><strong>uninstalling a node:</strong></p><p><strong>k3s : <code>k3s-uninstall.sh</code></strong></p><ul><li>k3s server : <code>/usr/local/bin/k3s-uninstall.sh</code></li><li>k3s agent : <code>/usr/local/bin/k3s-agent-uninstall.sh</code></li></ul><h2 id="version" tabindex="-1"><a class="header-anchor" href="#version" aria-hidden="true">#</a> version</h2><h2 id="embedded-component-versions" tabindex="-1"><a class="header-anchor" href="#embedded-component-versions" aria-hidden="true">#</a> Embedded Component Versions</h2>',8),ue=e("thead",null,[e("tr",null,[e("th",null,"Component"),e("th",null,"Version")])],-1),_e=e("td",null,"Kubernetes",-1),pe={href:"https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.25.md#v1253",target:"_blank",rel:"noopener noreferrer"},he=n("v1.25.3"),ve=e("td",null,"Kine",-1),me={href:"https://github.com/k3s-io/kine/releases/tag/v0.9.3",target:"_blank",rel:"noopener noreferrer"},be=n("v0.9.3"),ke=e("td",null,"SQLite",-1),ge={href:"https://sqlite.org/releaselog/3_36_0.html",target:"_blank",rel:"noopener noreferrer"},fe=n("3.36.0"),Ce=e("td",null,"Etcd",-1),xe={href:"https://github.com/k3s-io/etcd/releases/tag/v3.5.3-k3s1",target:"_blank",rel:"noopener noreferrer"},Ae=n("v3.5.3-k3s1"),Ee=e("td",null,"Containerd",-1),ye={href:"https://github.com/k3s-io/containerd/releases/tag/v1.6.8-k3s1",target:"_blank",rel:"noopener noreferrer"},we=n("v1.6.8-k3s1"),Le=e("td",null,"Runc",-1),Ne={href:"https://github.com/opencontainers/runc/releases/tag/v1.1.4",target:"_blank",rel:"noopener noreferrer"},Oe=n("v1.1.4"),Ie=e("td",null,"Flannel",-1),Pe={href:"https://github.com/flannel-io/flannel/releases/tag/v0.19.2",target:"_blank",rel:"noopener noreferrer"},Re=n("v0.19.2"),Be=e("td",null,"Metrics-server",-1),Me={href:"https://github.com/kubernetes-sigs/metrics-server/releases/tag/v0.6.1",target:"_blank",rel:"noopener noreferrer"},qe=n("v0.6.1"),Se=e("td",null,"Traefik",-1),Ye={href:"https://github.com/traefik/traefik/releases/tag/v2.9.1",target:"_blank",rel:"noopener noreferrer"},Ke=n("v2.9.1"),De=e("td",null,"CoreDNS",-1),Fe={href:"https://github.com/coredns/coredns/releases/tag/v1.9.1",target:"_blank",rel:"noopener noreferrer"},Te=n("v1.9.1"),Ve=e("td",null,"Helm-controller",-1),je={href:"https://github.com/k3s-io/helm-controller/releases/tag/v0.12.3",target:"_blank",rel:"noopener noreferrer"},He=n("v0.12.3"),Ge=e("td",null,"Local-path-provisioner",-1),Ue={href:"https://github.com/rancher/local-path-provisioner/releases/tag/v0.0.21",target:"_blank",rel:"noopener noreferrer"},Je=n("v0.0.21"),We=e("h2",{id:"end-\u94FE\u63A5",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#end-\u94FE\u63A5","aria-hidden":"true"},"#"),n(" END \u94FE\u63A5")],-1),$e=e("ul",null,[e("li",null,[e("div",null,[e("a",{href:"5.md",style:{float:"left"}},"\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} "),e("a",{href:"7.md",style:{float:"right"}}," \uFE0F\u4E0B\u4E00\u8282\u{1F517}")])])],-1),ze=n("\u24C2\uFE0F\u56DE\u5230\u76EE\u5F55\u{1F3E0}"),Qe={href:"https://nsddd.top/archives/contributors",target:"_blank",rel:"noopener noreferrer"},Xe=e("strong",null,"\u{1FAF5}\u53C2\u4E0E\u8D21\u732E\u{1F49E}\u2764\uFE0F\u200D\u{1F525}\u{1F496}",-1),Ze=n(")"),en=n("\u2734\uFE0F\u7248\u6743\u58F0\u660E \xA9 \uFF1A\u672C\u4E66\u6240\u6709\u5185\u5BB9\u9075\u5FAA"),nn={href:"http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},sn=n("CC-BY-SA 3.0\u534F\u8BAE\uFF08\u7F72\u540D-\u76F8\u540C\u65B9\u5F0F\u5171\u4EAB\uFF09\xA9");function tn(an,on){const t=i("ExternalLinkIcon"),o=i("RouterLink");return r(),d("div",null,[e("ul",null,[e("li",null,[e("a",_,[p,s(t)])])]),h,v,m,b,e("blockquote",null,[e("p",null,[k,e("a",g,[f,s(t)]),C,e("a",x,[A,s(t)]),E,e("a",y,[w,s(t)])])]),L,N,O,e("blockquote",null,[e("p",null,[I,e("a",P,[R,s(t)]),B])]),e("ul",null,[M,q,S,Y,K,D,e("li",null,[F,e("a",T,[V,s(t)])])]),j,e("p",null,[e("em",null,[H,G,e("a",U,[J,s(t)])])]),W,e("ol",null,[e("li",null,[e("a",$,[z,s(t)]),Q])]),X,e("ol",Z,[e("li",null,[e("a",ee,[ne,s(t)]),se])]),te,e("ul",null,[e("li",null,[ae,e("a",ie,[oe,s(t)])]),e("li",null,[le,e("a",re,[de,s(t)])])]),ce,e("table",null,[ue,e("tbody",null,[e("tr",null,[_e,e("td",null,[e("a",pe,[he,s(t)])])]),e("tr",null,[ve,e("td",null,[e("a",me,[be,s(t)])])]),e("tr",null,[ke,e("td",null,[e("a",ge,[fe,s(t)])])]),e("tr",null,[Ce,e("td",null,[e("a",xe,[Ae,s(t)])])]),e("tr",null,[Ee,e("td",null,[e("a",ye,[we,s(t)])])]),e("tr",null,[Le,e("td",null,[e("a",Ne,[Oe,s(t)])])]),e("tr",null,[Ie,e("td",null,[e("a",Pe,[Re,s(t)])])]),e("tr",null,[Be,e("td",null,[e("a",Me,[qe,s(t)])])]),e("tr",null,[Se,e("td",null,[e("a",Ye,[Ke,s(t)])])]),e("tr",null,[De,e("td",null,[e("a",Fe,[Te,s(t)])])]),e("tr",null,[Ve,e("td",null,[e("a",je,[He,s(t)])])]),e("tr",null,[Ge,e("td",null,[e("a",Ue,[Je,s(t)])])])])]),We,$e,e("ul",null,[e("li",null,[e("p",null,[s(o,{to:"/"},{default:c(()=>[ze]),_:1})])]),e("li",null,[e("p",null,[e("a",Qe,[Xe,s(t)]),Ze])]),e("li",null,[e("p",null,[en,e("a",nn,[sn,s(t)])])])])])}const rn=l(u,[["render",tn],["__file","6.html.vue"]]);export{rn as default};
