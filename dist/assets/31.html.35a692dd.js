import{_ as p,r as t,o as l,c,a as n,b as a,w as r,e as s,d as o}from"./app.f3292bfc.js";const u={},d={href:"http://nsddd.top",target:"_blank",rel:"noopener noreferrer"},k=s("author"),v=n("h1",{id:"\u7B2C31\u8282-kubernetes-\u7684\u7F16\u8BD1\u548C\u8C03\u8BD5",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u7B2C31\u8282-kubernetes-\u7684\u7F16\u8BD1\u548C\u8C03\u8BD5","aria-hidden":"true"},"#"),s(" \u7B2C31\u8282 kubernetes \u7684\u7F16\u8BD1\u548C\u8C03\u8BD5")],-1),b=n("div",null,[n("a",{href:"30.md",style:{float:"left"}},"\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} "),n("a",{href:"32.md",style:{float:"right"}}," \u2B07\uFE0F\u4E0B\u4E00\u8282\u{1F517}")],-1),m=n("br",null,null,-1),g=s("\u2764\uFE0F\u{1F495}\u{1F495}\u65B0\u65F6\u4EE3\u62E5\u62B1\u4E91\u539F\u751F\uFF0C\u4E91\u539F\u751F\u5177\u6709\u73AF\u5883\u7EDF\u4E00\u3001\u6309\u9700\u4ED8\u8D39\u3001\u5373\u5F00\u5373\u7528\u3001\u7A33\u5B9A\u6027\u5F3A\u7279\u70B9\u3002Myblog:"),h={href:"http://nsddd.top/",target:"_blank",rel:"noopener noreferrer"},f=s("http://nsddd.top"),y=o(`<hr><p>[TOC]</p><h2 id="\u7F16\u8BD1\u542F\u52A8\u672C\u5730\u5355\u8282\u70B9\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#\u7F16\u8BD1\u542F\u52A8\u672C\u5730\u5355\u8282\u70B9\u96C6\u7FA4" aria-hidden="true">#</a> \u7F16\u8BD1\u542F\u52A8\u672C\u5730\u5355\u8282\u70B9\u96C6\u7FA4\uFF1A</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token variable">$GOPATH</span>/src/k8s.io/kubernetes
<span class="token comment"># \u7F16\u8BD1\u5355\u4E2A\u7EC4\u5EFA\uFF1Asudo make WHAT=&quot;cmd/kube-apiserver&quot;  </span>
<span class="token comment"># \u7F16\u8BD1\u6240\u6709\u7EC4\u4EF6\uFF1Asudo make all  </span>
<span class="token comment"># \u542F\u52A8\u672C\u5730\u5355\u8282\u70B9\u96C6\u7FA4\uFF1A sudo ./hack/local-up-cluster.sh  </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">local-up-cluster \u811A\u672C</p><p><code>./hack/local-up-cluster.sh </code> \u811A\u672C\u662F kubernetes \u793E\u533A\u6784\u5EFA\u7684\u65B9\u4FBF\u5F00\u53D1\u8005\u7684\u811A\u672C\u3002</p><p>\u5B83\u7684\u4F5C\u7528\u662F\u7F16\u8BD1\u51FA\u6240\u6709\u9700\u8981\u7F16\u8BD1\u7684\u5E94\u7528\u7A0B\u5E8F\uFF0C\u5E76\u4E14\u5728\u5F53\u524D\u7684\u673A\u5668\u4E0A\u8DD1\u4E00\u4E2A\u5355\u8282\u70B9\u7684\u96C6\u7FA4\u3002</p><ul><li><p>\u7F16\u8BD1\u5355\u4E2A\u7EC4\u5EFA\uFF1A<code>sudo make WHAT=&quot;cmd/kube-apiserver&quot;</code></p></li><li><p>\u7F16\u8BD1\u6240\u6709\u7EC4\u4EF6\uFF1A<code>sudo make all</code></p></li><li><p>\u542F\u52A8\u672C\u5730\u5355\u8282\u70B9\u96C6\u7FA4\uFF1A <code>sudo ./hack/local-up-cluster.sh</code></p></li></ul></div><h2 id="\u7B2C\u4E00\u6B21\u542F\u52A8\u5355\u8282\u70B9\u96C6\u7FA4\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#\u7B2C\u4E00\u6B21\u542F\u52A8\u5355\u8282\u70B9\u96C6\u7FA4\u5206\u6790" aria-hidden="true">#</a> \u7B2C\u4E00\u6B21\u542F\u52A8\u5355\u8282\u70B9\u96C6\u7FA4\u5206\u6790</h2><p>\u8BB0\u5F55\u7B2C\u4E00\u6B21\u542F\u52A8\u4F46\u96C6\u7FA4\u7684\u72B6\u6001\u5206\u6790\uFF1A</p><p>time\uFF1A\u5927\u6982\u7B49\u4E86 20 - 30 \u5206\u949F\uFF08\u53EF\u4EE5\u5148\u559D\u4E24\u676F\u5496\u5561\u2615\uFF09</p><h3 id="\u5B89\u88C5\u7EC6\u8282" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5\u7EC6\u8282" aria-hidden="true">#</a> \u5B89\u88C5\u7EC6\u8282</h3><p><strong>\u5F00\u59CB\u65F6\u95F4\uFF1A</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>root@cubmaster01:~/go/src/k8s.io/kubernetes# date
Thu 01 Dec 2022 06:45:33 AM UTC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><details class="custom-container details"><summary>details \u5C55\u5F00\u{1F53D}</summary><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>root@cubmaster01:~/go/src/k8s.io/kubernetes<span class="token comment"># sudo ./hack/local-up-cluster.sh</span>
make: Entering directory <span class="token string">&#39;/root/go/src/k8s.io/kubernetes&#39;</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Entering directory <span class="token string">&#39;/root/go/src/k8s.io/kubernetes&#39;</span>
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:45:46<span class="token punctuation">]</span> Building go targets <span class="token keyword">for</span> linux/amd64
    k8s.io/kubernetes/hack/make-rules/helpers/go2make <span class="token punctuation">(</span>non-static<span class="token punctuation">)</span>
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:45:50<span class="token punctuation">]</span> Generating openapi code <span class="token keyword">for</span> KUBE
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:46:29<span class="token punctuation">]</span> Generating openapi code <span class="token keyword">for</span> AGGREGATOR
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:46:31<span class="token punctuation">]</span> Generating openapi code <span class="token keyword">for</span> APIEXTENSIONS
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:46:34<span class="token punctuation">]</span> Generating openapi code <span class="token keyword">for</span> CODEGEN
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:46:36<span class="token punctuation">]</span> Generating openapi code <span class="token keyword">for</span> SAMPLEAPISERVER
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">&#39;/root/go/src/k8s.io/kubernetes&#39;</span>
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:46:39<span class="token punctuation">]</span> Building go targets <span class="token keyword">for</span> linux/amd64
    k8s.io/kubernetes/cmd/kubectl <span class="token punctuation">(</span>static<span class="token punctuation">)</span>
    k8s.io/kubernetes/cmd/kube-apiserver <span class="token punctuation">(</span>static<span class="token punctuation">)</span>
    k8s.io/kubernetes/cmd/kube-controller-manager <span class="token punctuation">(</span>static<span class="token punctuation">)</span>
    k8s.io/kubernetes/cmd/cloud-controller-manager <span class="token punctuation">(</span>non-static<span class="token punctuation">)</span>
    k8s.io/kubernetes/cmd/kubelet <span class="token punctuation">(</span>non-static<span class="token punctuation">)</span>
    k8s.io/kubernetes/cmd/kube-proxy <span class="token punctuation">(</span>static<span class="token punctuation">)</span>
    k8s.io/kubernetes/cmd/kube-scheduler <span class="token punctuation">(</span>static<span class="token punctuation">)</span>

make: Leaving directory <span class="token string">&#39;/root/go/src/k8s.io/kubernetes&#39;</span>
API SERVER secure port is free, proceeding<span class="token punctuation">..</span>.
Detected <span class="token function">host</span> and ready to start services.  Doing some housekeeping first<span class="token punctuation">..</span>.
Using GO_OUT /root/go/src/k8s.io/kubernetes/_output/local/bin/linux/amd64
Starting services now<span class="token operator">!</span>
Starting etcd
etcd --advertise-client-urls http://127.0.0.1:2379 --data-dir /tmp/tmp.ZA6EXyPPss --listen-client-urls http://127.0.0.1:2379 --log-level<span class="token operator">=</span>warn <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> <span class="token string">&quot;/tmp/etcd.log&quot;</span> <span class="token operator">&gt;</span>/dev/null
Waiting <span class="token keyword">for</span> etcd to come up.
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:58:54<span class="token punctuation">]</span> On try <span class="token number">2</span>, etcd: <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">&quot;health&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;true&quot;</span>,<span class="token string">&quot;reason&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;header&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;cluster_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;14841639068965178418&quot;</span>,<span class="token string">&quot;member_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10276657743932975437&quot;</span>,<span class="token string">&quot;revision&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2&quot;</span>,<span class="token string">&quot;raft_term&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>Generating a RSA private key
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.+++++
<span class="token punctuation">..</span><span class="token punctuation">..</span>.+++++
writing new private key to <span class="token string">&#39;/var/run/kubernetes/server-ca.key&#39;</span>
-----
Generating a RSA private key
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>+++++
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.+++++
writing new private key to <span class="token string">&#39;/var/run/kubernetes/client-ca.key&#39;</span>
-----
Generating a RSA private key
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.+++++
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>+++++
writing new private key to <span class="token string">&#39;/var/run/kubernetes/request-header-ca.key&#39;</span>
-----
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">189366430448716360665414597641985438063348873322</span>
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">190125437621142035036292880957413679793726301630</span>
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">606668605759100598551725540945577297218224811054</span>
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">635150309675323248743719255558829775631435343029</span>
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">502583423540832867136826540974772275871393658467</span>
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">712098371673773073639809258966059598612266254784</span>
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">254427577071095149538770795047596258056763227355</span>
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">583900352045971716923710917507647330423197506650</span>
Waiting <span class="token keyword">for</span> apiserver to come up
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:59:03<span class="token punctuation">]</span> On try <span class="token number">6</span>, apiserver: <span class="token builtin class-name">:</span> ok
clusterrolebinding.rbac.authorization.k8s.io/kube-apiserver-kubelet-admin created
clusterrolebinding.rbac.authorization.k8s.io/kubelet-csr created
Cluster <span class="token string">&quot;local-up-cluster&quot;</span> set.
use <span class="token string">&#39;kubectl --kubeconfig=/var/run/kubernetes/admin-kube-aggregator.kubeconfig&#39;</span> to use the aggregated API server
serviceaccount/coredns created
clusterrole.rbac.authorization.k8s.io/system:coredns created
clusterrolebinding.rbac.authorization.k8s.io/system:coredns created
configmap/coredns created
deployment.apps/coredns created
service/kube-dns created
coredns addon successfully deployed.
Checking CNI Installation at /opt/cni/bin
WARNING <span class="token builtin class-name">:</span> The kubelet is configured to not fail even <span class="token keyword">if</span> swap is enabled<span class="token punctuation">;</span> production deployments should disable swap unless testing NodeSwap feature.
<span class="token number">2022</span>/12/01 06:59:07 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:59:07 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:59:07 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:59:07 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:59:07 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">396503892652732852810951929324414744717912185576</span>
kubelet <span class="token punctuation">(</span> <span class="token number">27489</span> <span class="token punctuation">)</span> is running.
<span class="token function">wait</span> kubelet ready
No resources found
No resources found
No resources found
No resources found
No resources found
No resources found
<span class="token number">127.0</span>.0.1   NotReady   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   1s    v1.24.0-dirty
<span class="token number">2022</span>/12/01 06:59:22 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:59:22 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:59:22 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:59:22 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:59:22 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">270579443091576203614576860806582064911709216666</span>
Create default storage class <span class="token keyword">for</span> 
storageclass.storage.k8s.io/standard created
Local Kubernetes cluster is running. Press Ctrl-C to shut it down.

Logs:
  /tmp/kube-apiserver.log
  /tmp/kube-controller-manager.log
  
  /tmp/kube-proxy.log
  /tmp/kube-scheduler.log
  /tmp/kubelet.log

To start using your cluster, you can <span class="token function">open</span> up another terminal/tab and run:

  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/var/run/kubernetes/admin.kubeconfig
  cluster/kubectl.sh

Alternatively, you can <span class="token function">write</span> to the default kubeconfig:

  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBERNETES_PROVIDER</span><span class="token operator">=</span>local

  cluster/kubectl.sh config set-cluster <span class="token builtin class-name">local</span> <span class="token parameter variable">--server</span><span class="token operator">=</span>https://localhost:6443 --certificate-authority<span class="token operator">=</span>/var/run/kubernetes/server-ca.crt
  cluster/kubectl.sh config set-credentials myself --client-key<span class="token operator">=</span>/var/run/kubernetes/client-admin.key --client-certificate<span class="token operator">=</span>/var/run/kubernetes/client-admin.crt
  cluster/kubectl.sh config set-context <span class="token builtin class-name">local</span> <span class="token parameter variable">--cluster</span><span class="token operator">=</span>local <span class="token parameter variable">--user</span><span class="token operator">=</span>myself
  cluster/kubectl.sh config use-context <span class="token builtin class-name">local</span>
  cluster/kubectl.sh

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p><strong>\u7ED3\u675F\u65F6\u95F4\uFF1A</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>root@cubmaster01:~/go/src/k8s.io/kubernetes# date
Thu 01 Dec 2022 07:04:00 AM UTC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u505C\u6B62" tabindex="-1"><a class="header-anchor" href="#\u505C\u6B62" aria-hidden="true">#</a> \u505C\u6B62</h3><p><strong>stop\uFF1A<code>ctrl + c</code></strong></p><h3 id="\u65E5\u5FD7" tabindex="-1"><a class="header-anchor" href="#\u65E5\u5FD7" aria-hidden="true">#</a> \u65E5\u5FD7</h3><p><strong>Logs\uFF1A</strong></p><ul><li><code>/tmp/kube-apiserver.log</code></li><li><code>/tmp/kube-controller-manager.log</code></li><li><code>/tmp/kube-proxy.log</code></li><li><code>/tmp/kube-scheduler.log</code></li><li><code>/tmp/kubelet.log</code></li></ul><h3 id="test-\u7F16\u5199-pod-yaml" tabindex="-1"><a class="header-anchor" href="#test-\u7F16\u5199-pod-yaml" aria-hidden="true">#</a> test\uFF1A\u7F16\u5199 pod.yaml</h3><p><strong>\u521B\u5EFA\u6587\u4EF6\u5E76\u7F16\u5199\u5185\u5BB9\uFF1A</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir ~/go-yaml; cd ~/go-yaml
vim pod.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u8F93\u5165\u4EE5\u4E0B\uFF1A</strong></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span> 
  <span class="token key atrule">name</span><span class="token punctuation">:</span> busybox
  <span class="token key atrule">namespaces</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span> 
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">command</span><span class="token punctuation">:</span> 
  	  <span class="token punctuation">-</span> sleep
  	  <span class="token punctuation">-</span> <span class="token string">&quot;3600&quot;</span>
  	<span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u521B\u5EFA\u5B83\uFF1A</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cluster/kubectl.sh create -f ~/go-yaml/pod.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u83B7\u53D6\uFF1A</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cluster/kubectl.sh get pod
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u7EC6\u8282\uFF1A</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cluster/kubectl.sh describe pod busybox
cluster/kubectl.sh describe node
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u518D\u6B21\u8FD0\u884C\u811A\u672C" tabindex="-1"><a class="header-anchor" href="#\u518D\u6B21\u8FD0\u884C\u811A\u672C" aria-hidden="true">#</a> \u518D\u6B21\u8FD0\u884C\u811A\u672C</h3><div class="custom-container warning"><p class="custom-container-title">\u6CE8\u610F</p><p>\u6211\u4EEC\u4E00\u822C\u518D\u6B21\u8FD0\u884C\u7684\u65F6\u5019\uFF0C\u7F16\u8BD1\u6210 <code>exe</code> \u7684\u52A8\u4F5C\u4E5F\u662F\u88AB\u7F13\u5B58\u4E86\uFF0C\u4E0D\u4F1A\u518D\u751F\u6210\uFF0C\u6240\u4EE5\u4FEE\u6539\u540E debug \u5220\u9664\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">make</span> clean
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h2 id="\u5F00\u542F\u672C\u5730debug\u529F\u80FD" tabindex="-1"><a class="header-anchor" href="#\u5F00\u542F\u672C\u5730debug\u529F\u80FD" aria-hidden="true">#</a> \u5F00\u542F\u672C\u5730debug\u529F\u80FD</h2><div class="custom-container tip"><p class="custom-container-title">\u9700\u8981\u5F00\u542F debug</p><p>\u4E00\u822C\u7F16\u8BD1\u5355\u4E2A\u7EC4\u5EFA\uFF0C\u6216\u8005\u662F\u7F16\u8BD1\u6240\u6709\u7684\u7EC4\u4EF6\uFF0C\u90FD\u9700\u8981\u5F00\u542F debug \u8C03\u8BD5\u3002</p><p>\u6211\u4EEC\u4E3A\u4E86\u65B9\u4FBF\uFF0C\u5728\u4EFB\u4F55\u65F6\u5019\u90FD\u628A debug \u80FD\u529B build \u8FC7\u53BB\u3002</p></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token variable">$GOPATH</span>/src/k8s.io/kubernetes
<span class="token comment"># kubernetes go\u7F16\u8BD1\u6587\u4EF6</span>
<span class="token function">sudo</span> <span class="token function">vim</span> ./hack/lib/golang.sh
<span class="token comment"># \u67E5\u627Ebuild_binaries()\u51FD\u6570 vi\u8BED\u6CD5</span>
?build_binaries<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u627E\u5230\u4E00\u4E0Bbebug\u5224\u65AD-\u6CE8\u91CA-\u4E00\u76F4\u5F00\u542Fdebug\u80FD\u529B" tabindex="-1"><a class="header-anchor" href="#\u627E\u5230\u4E00\u4E0Bbebug\u5224\u65AD-\u6CE8\u91CA-\u4E00\u76F4\u5F00\u542Fdebug\u80FD\u529B" aria-hidden="true">#</a> \u627E\u5230\u4E00\u4E0Bbebug\u5224\u65AD\uFF0C\u6CE8\u91CA\uFF0C\u4E00\u76F4\u5F00\u542Fdebug\u80FD\u529B</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>	<span class="token assign-left variable">gogcflags</span><span class="token operator">=</span><span class="token string">&quot;all=-trimpath=<span class="token variable">\${trimroot}</span> <span class="token variable">\${GOGCFLAGS<span class="token operator">:-</span>}</span>&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">\${DBG<span class="token operator">:-</span>}</span>&quot;</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment"># Debugging - disable optimizations and inlining.</span>
        <span class="token assign-left variable">gogcflags</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">\${gogcflags}</span> -N -l&quot;</span>
    <span class="token keyword">fi</span>

    <span class="token assign-left variable">goldflags</span><span class="token operator">=</span><span class="token string">&quot;all=<span class="token variable"><span class="token variable">$(</span>kube::version::ldflags<span class="token variable">)</span></span> <span class="token variable">\${GOLDFLAGS<span class="token operator">:-</span>}</span>&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">\${DBG<span class="token operator">:-</span>}</span>&quot;</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment"># Not debugging - disable symbols and DWARF.</span>
        <span class="token assign-left variable">goldflags</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">\${goldflags}</span> -s -w&quot;</span>
    <span class="token keyword">fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u6CE8\u91CA\u5224\u65AD\uFF0C\u5C06debug\u76F4\u63A5\u653E\u5728\u4E0B\u9762\uFF0C \u518D\u4FDD\u5B58\u5373\u53EF\uFF1A</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>	<span class="token assign-left variable">gogcflags</span><span class="token operator">=</span><span class="token string">&quot;all=-trimpath=<span class="token variable">\${trimroot}</span> <span class="token variable">\${GOGCFLAGS<span class="token operator">:-</span>}</span>&quot;</span>
    <span class="token comment"># if [[ &quot;\${DBG:-}&quot; == 1 ]]; then</span>
    <span class="token comment">#     # Debugging - disable optimizations and inlining.</span>
    <span class="token comment">#     gogcflags=&quot;\${gogcflags} -N -l&quot;</span>
    <span class="token comment"># fi</span>
	<span class="token assign-left variable">gogcflags</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">\${gogcflags}</span> -N -l&quot;</span>
    <span class="token assign-left variable">goldflags</span><span class="token operator">=</span><span class="token string">&quot;all=<span class="token variable"><span class="token variable">$(</span>kube::version::ldflags<span class="token variable">)</span></span> <span class="token variable">\${GOLDFLAGS<span class="token operator">:-</span>}</span>&quot;</span>
    <span class="token comment"># if [[ &quot;\${DBG:-}&quot; != 1 ]]; then</span>
    <span class="token comment">#     # Not debugging - disable symbols and DWARF.</span>
    <span class="token comment">#     goldflags=&quot;\${goldflags} -s -w&quot;</span>
    <span class="token comment"># fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u89C2\u5BDF\u6B64\u65F6\u7684\u8FDB\u7A0B\uFF1A</strong></p><p><img src="http://sm.nsddd.top/smimage-20221201140939729.png" alt="image-20221201140939729"></p><h2 id="delve-\u8C03\u8BD5" tabindex="-1"><a class="header-anchor" href="#delve-\u8C03\u8BD5" aria-hidden="true">#</a> delve \u8C03\u8BD5</h2><p><strong>\u6216\u8BB8\u4F60\u53EF\u4EE5\u9009\u62E9 GDB\uFF0C\u6216\u8BB8\u4E5F\u6709\u4E00\u4E2A\u66F4\u9002\u5408\u7684\u65B9\u5F0F\uFF1Ago-delve:</strong></p>`,43),q={class:"custom-container tip"},x=n("p",{class:"custom-container-title"},"\u63D0\u793A",-1),_={href:"https://docker.nsddd.top/Cloud-Native/14.html",target:"_blank",rel:"noopener noreferrer"},N=s("delve"),I=n("h3",{id:"\u7279\u6027",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u7279\u6027","aria-hidden":"true"},"#"),s(" \u7279\u6027")],-1),w=n("ul",null,[n("li",null,"\u672C\u5730\u8C03\u8BD5 \u548C \u8FDC\u7A0B\u8C03\u8BD5"),n("li",null,"\u7B80\u5355\u6613\u7528\uFF0C\u5F00\u6E90")],-1),O=n("h2",{id:"\u542F\u52A8\u672C\u5730\u96C6\u7FA4\u4ECE\u800C-debug-\u4EE5-api-server-\u4E3A\u4F8B",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u542F\u52A8\u672C\u5730\u96C6\u7FA4\u4ECE\u800C-debug-\u4EE5-api-server-\u4E3A\u4F8B","aria-hidden":"true"},"#"),s(" \u542F\u52A8\u672C\u5730\u96C6\u7FA4\u4ECE\u800C Debug - \u4EE5 API Server \u4E3A\u4F8B")],-1),F={class:"custom-container tip"},S=n("p",{class:"custom-container-title"},"\u63D0\u793A",-1),A=n("p",null,"\u6B63\u597D\u4E4B\u524D\u7684 API server \u8BC1\u4E66\u51FA\u73B0\u4E86\u95EE\u9898\uFF0C\u8FD9\u4E2A\u95EE\u9898\u7684\u5730\u5740 ISSUE\uFF1A",-1),R={href:"https://github.com/kubernetes/kubernetes/issues/114222",target:"_blank",rel:"noopener noreferrer"},C=s("\u3010An error occurred attempting to install kubernetes learning\u3011 #114222"),G=o(`<h3 id="\u7F16\u8BD1\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#\u7F16\u8BD1\u53C2\u6570" aria-hidden="true">#</a> \u7F16\u8BD1\u53C2\u6570</h3><ul><li><p>\u4FEE\u6539 <code>hack/lib/golang.sh</code> \u6587\u4EF6\uFF0C\u4ECE\u800C\u4F7F\u5F97\u7F16\u8BD1\u5668\u4E0D\u53BB\u4F18\u5316\u6389\u652F\u6301\u7684 debug \u4FE1\u606F</p></li><li><p>\u7981\u6B62 <code>-w</code> \u3001<code>-s</code> \u4FDD\u7559\u6587\u4EF6\u540D\uFF0C\u884C\u53F7</p></li><li><p>\u52A0\u4E0A <code>-gcflags= &quot;all=-N -l&quot;</code> \uFF0C\u7981\u6B62\u4F18\u5316\u548C\u5185\u8054\u3002</p></li></ul><p>\u5728<code>k8s.io/kubernetes/hack/lib/golang.sh</code>\u4E2D\u8BBE\u7F6E\u4E86<code>-s -w</code>\u9009\u9879\u6765\u7981\u7528\u7B26\u53F7\u8868\u4EE5\u53CAdebug\u4FE1\u606F\uFF0C\u56E0\u6B64\u5728\u7F16\u8BD1 <code>Kubernetes</code> \u7EC4\u4EF6\u8FDB\u884C\u8FDC\u7A0B\u8C03\u8BD5\u65F6\u9700\u8981\u53BB\u6389\u8FD9\u4E24\u4E2A\u9650\u5236\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>-    <span class="token assign-left variable">goldflags</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">\${GOLDFLAGS=-s -w}</span> <span class="token variable"><span class="token variable">$(</span>kube::version::ldflags<span class="token variable">)</span></span>&quot;</span>
+    <span class="token comment">#goldflags=&quot;\${GOLDFLAGS=-s -w} $(kube::version::ldflags)&quot;</span>
+    <span class="token assign-left variable">goldflags</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">\${GOLDFLAGS<span class="token operator">:-</span>}</span> <span class="token variable"><span class="token variable">$(</span>kube::version::ldflags<span class="token variable">)</span></span>&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u542F\u52A8\u672C\u5730\u96C6\u7FA4" tabindex="-1"><a class="header-anchor" href="#\u542F\u52A8\u672C\u5730\u96C6\u7FA4" aria-hidden="true">#</a> \u542F\u52A8\u672C\u5730\u96C6\u7FA4</h3><p>\u5982\u679C\u9700\u8981\uFF0C\u7528 <code>make clean</code> \u6E05\u9664\u672A\u7F16\u8BD1\u7684\u53EF\u6267\u884C\u7A0B\u5E8F\u3002\u901A\u8FC7 <code>hack/local-up-cluster.sh</code> \u811A\u672C\u542F\u52A8\u672C\u5730\u96C6\u7FA4\u3002</p><h3 id="\u91CD\u542F-api-server" tabindex="-1"><a class="header-anchor" href="#\u91CD\u542F-api-server" aria-hidden="true">#</a> \u91CD\u542F API Server</h3><p><strong>\u5982\u679C\u8981\u8C03\u8BD5 API Server \uFF0C\u5148\u5173\u95ED\u5176\u8FDB\u7A0B\uFF0C\u518D\u4EE5 dlv \u542F\u52A8\u3002</strong></p><p>\u26A0\uFE0F \u4E3A\u4EC0\u4E48\u8981\u91CD\u542F\uFF0C\u56E0\u4E3A go \u7684 debug \u4F9D\u9760 dlv\uFF0C\u6240\u4EE5\u9700\u8981\u7528 dlv \u5305\u88B1\u518D\u542F\u52A8\u4E0B\u3002</p><h3 id="\u8FDE\u63A5-debug-server" tabindex="-1"><a class="header-anchor" href="#\u8FDE\u63A5-debug-server" aria-hidden="true">#</a> \u8FDE\u63A5 Debug Server</h3><p>\u901A\u8FC7 delve \u8FDE\u63A5 debug server \u5E76\u4E14\u5F00\u59CB\u8C03\u8BD5\u3002</p><h3 id="\u6740\u6B7B-api-server-\u8C03\u8BD5" tabindex="-1"><a class="header-anchor" href="#\u6740\u6B7B-api-server-\u8C03\u8BD5" aria-hidden="true">#</a> \u6740\u6B7B Api Server \u8C03\u8BD5</h3><p><strong>\u67E5\u770B Api Server \u7684\u5E94\u7528\u7A0B\u5E8F\u548C\u540E\u9762\u7684\u53C2\u6570\uFF0C\u8FD9\u4E2A\u5F88\u91CD\u8981\uFF1A</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>root@cubmaster01:~/go/src/k8s.io/kubernetes<span class="token comment">#  ps -ef | grep kube-apiserver</span>
root       <span class="token number">27052</span>    <span class="token number">8091</span> <span class="token number">10</span> 06:58 pts/0    00:00:43 /root/go/src/k8s.io/kubernetes/_output/local/bin/linux/amd64/kube-apiserver --authorization-mode<span class="token operator">=</span>Node,RBAC  --cloud-provider<span class="token operator">=</span> --cloud-config<span class="token operator">=</span>   <span class="token parameter variable">--v</span><span class="token operator">=</span><span class="token number">3</span> <span class="token parameter variable">--vmodule</span><span class="token operator">=</span> --audit-policy-file<span class="token operator">=</span>/tmp/kube-audit-policy-file --audit-log-path<span class="token operator">=</span>/tmp/kube-apiserver-audit.log --authorization-webhook-config-file<span class="token operator">=</span> --authentication-token-webhook-config-file<span class="token operator">=</span> --cert-dir<span class="token operator">=</span>/var/run/kubernetes --egress-selector-config-file<span class="token operator">=</span>/tmp/kube_egress_selector_configuration.yaml --client-ca-file<span class="token operator">=</span>/var/run/kubernetes/client-ca.crt --kubelet-client-certificate<span class="token operator">=</span>/var/run/kubernetes/client-kube-apiserver.crt --kubelet-client-key<span class="token operator">=</span>/var/run/kubernetes/client-kube-apiserver.key --service-account-key-file<span class="token operator">=</span>/tmp/kube-serviceaccount.key --service-account-lookup<span class="token operator">=</span>true --service-account-issuer<span class="token operator">=</span>https://kubernetes.default.svc --service-account-jwks-uri<span class="token operator">=</span>https://kubernetes.default.svc/openid/v1/jwks --service-account-signing-key-file<span class="token operator">=</span>/tmp/kube-serviceaccount.key --enable-admission-plugins<span class="token operator">=</span>NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,Priority,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction --disable-admission-plugins<span class="token operator">=</span> --admission-control-config-file<span class="token operator">=</span> --bind-address<span class="token operator">=</span><span class="token number">0.0</span>.0.0 --secure-port<span class="token operator">=</span><span class="token number">6443</span> --tls-cert-file<span class="token operator">=</span>/var/run/kubernetes/serving-kube-apiserver.crt --tls-private-key-file<span class="token operator">=</span>/var/run/kubernetes/serving-kube-apiserver.key --storage-backend<span class="token operator">=</span>etcd3 --storage-media-type<span class="token operator">=</span>application/vnd.kubernetes.protobuf --etcd-servers<span class="token operator">=</span>http://127.0.0.1:2379 --service-cluster-ip-range<span class="token operator">=</span><span class="token number">10.0</span>.0.0/24 --feature-gates<span class="token operator">=</span>AllAlpha<span class="token operator">=</span>false --external-hostname<span class="token operator">=</span>localhost --requestheader-username-headers<span class="token operator">=</span>X-Remote-User --requestheader-group-headers<span class="token operator">=</span>X-Remote-Group --requestheader-extra-headers-prefix<span class="token operator">=</span>X-Remote-Extra- --requestheader-client-ca-file<span class="token operator">=</span>/var/run/kubernetes/request-header-ca.crt --requestheader-allowed-names<span class="token operator">=</span>system:auth-proxy --proxy-client-cert-file<span class="token operator">=</span>/var/run/kubernetes/client-auth-proxy.crt --proxy-client-key-file<span class="token operator">=</span>/var/run/kubernetes/client-auth-proxy.key --cors-allowed-origins<span class="token operator">=</span>/127.0.0.1<span class="token punctuation">(</span>:<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>+<span class="token punctuation">)</span>?$,/localhost<span class="token punctuation">(</span>:<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>+<span class="token punctuation">)</span>?$
root       <span class="token number">33017</span>    <span class="token number">9251</span>  <span class="token number">0</span> 07:05 pts/1    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto kube-apiserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u6740\u6B7B</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kill -9 {api-server PID}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u542F\u52A8\uFF1A</strong></p><p>\u521B\u5EFA\u65E5\u5FD7\u4FE1\u606F\u4FDD\u5B58\u76EE\u5F55\uFF1A<code>mkdir -p /root/kubelog/delve-log </code></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>sudo dlv  --headless exec /root/go/src/k8s.io/kubernetes/_output/local/bin/linux/amd64/kube-apiserver --listen=127.0.0.1:2345 --api-version=2 --log --log-output=debugger,gdbwire,lidbout,debuglineerr,rpc,dap,fncall,minidump --log-dest=/root/kubelog/delve-log/log -- --authorization-mode=Node,RBAC  --cloud-provider= --cloud-config=   --v=3 --vmodule= --audit-policy-file=/tmp/kube-audit-policy-file --audit-log-path=/tmp/kube-apiserver-audit.log --authorization-webhook-config-file= --authentication-token-webhook-config-file= --cert-dir=/var/run/kubernetes --egress-selector-config-file=/tmp/kube_egress_selector_configuration.yaml --client-ca-file=/var/run/kubernetes/client-ca.crt --kubelet-client-certificate=/var/run/kubernetes/client-kube-apiserver.crt --kubelet-client-key=/var/run/kubernetes/client-kube-apiserver.key --service-account-key-file=/tmp/kube-serviceaccount.key --service-account-lookup=true --service-account-issuer=https://kubernetes.default.svc --service-account-jwks-uri=https://kubernetes.default.svc/openid/v1/jwks --service-account-signing-key-file=/tmp/kube-serviceaccount.key --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,Priority,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction --disable-admission-plugins= --admission-control-config-file= --bind-address=0.0.0.0 --secure-port=6443 --tls-cert-file=/var/run/kubernetes/serving-kube-apiserver.crt --tls-private-key-file=/var/run/kubernetes/serving-kube-apiserver.key --storage-backend=etcd3 --storage-media-type=application/vnd.kubernetes.protobuf --etcd-servers=http://127.0.0.1:2379 --service-cluster-ip-range=10.0.0.0/24 --feature-gates=AllAlpha=false --external-hostname=localhost --requestheader-username-headers=X-Remote-User --requestheader-group-headers=X-Remote-Group --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-client-ca-file=/var/run/kubernetes/request-header-ca.crt --requestheader-allowed-names=system:auth-proxy --proxy-client-cert-file=/var/run/kubernetes/client-auth-proxy.crt --proxy-client-key-file=/var/run/kubernetes/client-auth-proxy.key --cors-allowed-origins=&quot;/127.0.0.1(:[0-9]+)?$,/localhost(:[0-9]+)?$&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u53E6\u4E00\u53F0\u673A\u5668\u8FDE\u63A5\uFF1A</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>dlv connect localhost:2345
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="vscode-\u8FDC\u7A0B\u8C03\u8BD5\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#vscode-\u8FDC\u7A0B\u8C03\u8BD5\u65B9\u6848" aria-hidden="true">#</a> vscode \u8FDC\u7A0B\u8C03\u8BD5\u65B9\u6848</h2><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token comment">// \u4F7F\u7528 IntelliSense \u4E86\u89E3\u76F8\u5173\u5C5E\u6027\u3002 </span>
    <span class="token comment">// \u60AC\u505C\u4EE5\u67E5\u770B\u73B0\u6709\u5C5E\u6027\u7684\u63CF\u8FF0\u3002</span>
    <span class="token comment">// \u6B32\u4E86\u89E3\u66F4\u591A\u4FE1\u606F\uFF0C\u8BF7\u8BBF\u95EE: https://go.microsoft.com/fwlink/?linkid=830387</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Connect to server&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;go&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;attach&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;mode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;remote&quot;</span><span class="token punctuation">,</span>
            <span class="token comment">// &quot;remotePath&quot;: &quot;\${workspaceFolder}&quot;,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">2345</span><span class="token punctuation">,</span>
            <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;192.168.71.130&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u5728\u8FDC\u7A0B\u542F\u52A8 API Server\uFF1A</strong></p><blockquote><p>\u548C\u4E0A\u9762\u7684\u542F\u52A8\u4E00\u6837\uFF1A</p></blockquote><h2 id="end-\u94FE\u63A5" tabindex="-1"><a class="header-anchor" href="#end-\u94FE\u63A5" aria-hidden="true">#</a> END \u94FE\u63A5</h2><ul><li><div><a href="30.md" style="float:left;">\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} </a><a href="32.md" style="float:right;"> \uFE0F\u4E0B\u4E00\u8282\u{1F517}</a></div></li></ul>`,27),E=s("\u24C2\uFE0F\u56DE\u5230\u76EE\u5F55\u{1F3E0}"),$={href:"https://nsddd.top/archives/contributors",target:"_blank",rel:"noopener noreferrer"},D=n("strong",null,"\u{1FAF5}\u53C2\u4E0E\u8D21\u732E\u{1F49E}\u2764\uFE0F\u200D\u{1F525}\u{1F496}",-1),L=s(")"),P=s("\u2734\uFE0F\u7248\u6743\u58F0\u660E \xA9 \uFF1A\u672C\u4E66\u6240\u6709\u5185\u5BB9\u9075\u5FAA"),T={href:"http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},B=s("CC-BY-SA 3.0\u534F\u8BAE\uFF08\u7F72\u540D-\u76F8\u540C\u65B9\u5F0F\u5171\u4EAB\uFF09\xA9");function W(z,U){const e=t("ExternalLinkIcon"),i=t("RouterLink");return l(),c("div",null,[n("ul",null,[n("li",null,[n("a",d,[k,a(e)])])]),v,b,m,n("blockquote",null,[n("p",null,[g,n("a",h,[f,a(e)])])]),y,n("div",q,[x,n("ul",null,[n("li",null,[n("a",_,[N,a(e)])])])]),I,w,O,n("div",F,[S,A,n("ul",null,[n("li",null,[n("a",R,[C,a(e)])])])]),G,n("ul",null,[n("li",null,[n("p",null,[a(i,{to:"/"},{default:r(()=>[E]),_:1})])]),n("li",null,[n("p",null,[n("a",$,[D,a(e)]),L])]),n("li",null,[n("p",null,[P,n("a",T,[B,a(e)])])])])])}const X=p(u,[["render",W],["__file","31.html.vue"]]);export{X as default};
