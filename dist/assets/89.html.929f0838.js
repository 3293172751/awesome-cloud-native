import{_ as o,r as l,o as p,c as r,a as n,b as a,w as c,e as s,d as t}from"./app.9f14a191.js";const u={},d={href:"http://nsddd.top",target:"_blank",rel:"noopener noreferrer"},k=s("author"),v=n("h1",{id:"\u7B2C89\u8282-gitops-\u5B9E\u8DF5\u7406\u8BBA-\u4E0A\u90E8\u5206",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u7B2C89\u8282-gitops-\u5B9E\u8DF5\u7406\u8BBA-\u4E0A\u90E8\u5206","aria-hidden":"true"},"#"),s(" \u7B2C89\u8282 GitOps \u5B9E\u8DF5\u7406\u8BBA\uFF08\u4E0A\u90E8\u5206\uFF09")],-1),m=n("div",null,[n("a",{href:"88.md",style:{float:"left"}},"\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} "),n("a",{href:"90.md",style:{float:"right"}}," \u2B07\uFE0F\u4E0B\u4E00\u8282\u{1F517}")],-1),b=n("br",null,null,-1),g=s("\u2764\uFE0F\u{1F495}\u{1F495}\u65B0\u65F6\u4EE3\u62E5\u62B1\u4E91\u539F\u751F\uFF0C\u4E91\u539F\u751F\u5177\u6709\u73AF\u5883\u7EDF\u4E00\u3001\u6309\u9700\u4ED8\u8D39\u3001\u5373\u5F00\u5373\u7528\u3001\u7A33\u5B9A\u6027\u5F3A\u7279\u70B9\u3002Myblog:"),h={href:"http://nsddd.top/",target:"_blank",rel:"noopener noreferrer"},y=s("http://nsddd.top"),f=t(`<hr><p>[TOC]</p><p>\u4ECA\u5929\u6211\u4EEC\u6765\u770B\u770B kubernetes \u548C gitops \u7684\u7406\u8BBA\u5B9E\u8DF5</p><h2 id="\u547D\u4EE4\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#\u547D\u4EE4\u4ECB\u7ECD" aria-hidden="true">#</a> \u547D\u4EE4\u4ECB\u7ECD</h2><p>\u9996\u5148\u6211\u4EEC\u6765\u770B\u770B kubectl \u652F\u6301\u7684\u5B50\u547D\u540D\uFF0C\u65B9\u4FBF\u6211\u4EEC\u4F7F\u7528\uFF1A</p><ol><li><strong><code>kubectl apply</code></strong> - \u5E94\u7528\u4E00\u4E2A\u6216\u591A\u4E2A\u8D44\u6E90\u7684\u5B9A\u4E49\u3002\u901A\u5E38\u7528\u4E8E\u90E8\u7F72\u5E94\u7528\u7A0B\u5E8F\u6216\u66F4\u65B0\u8D44\u6E90\u3002</li><li><strong><code>kubectl get</code></strong> - \u663E\u793A\u4E00\u4E2A\u6216\u591A\u4E2A\u8D44\u6E90\u7684\u4FE1\u606F\u3002\u8FD9\u662F\u67E5\u770B Kubernetes \u96C6\u7FA4\u4E2D\u8D44\u6E90\u72B6\u6001\u7684\u5E38\u7528\u547D\u4EE4\u3002</li><li><strong><code>kubectl describe</code></strong> - \u663E\u793A\u4E00\u4E2A\u6216\u591A\u4E2A\u8D44\u6E90\u7684\u8BE6\u7EC6\u4FE1\u606F\uFF0C\u5982\u4E8B\u4EF6\u3001\u72B6\u6001\u548C\u914D\u7F6E\u3002</li><li><strong><code>kubectl delete</code></strong> - \u5220\u9664 Kubernetes \u96C6\u7FA4\u4E2D\u7684\u8D44\u6E90\u3002</li><li><strong><code>kubectl exec</code></strong> - \u5728\u96C6\u7FA4\u4E2D\u7684\u5BB9\u5668\u91CC\u6267\u884C\u547D\u4EE4\u3002</li><li><strong><code>kubectl logs</code></strong> - \u6253\u5370\u5BB9\u5668\u7684\u65E5\u5FD7\u3002</li><li><strong><code>kubectl create</code></strong> - \u4ECE\u6587\u4EF6\u6216\u6807\u51C6\u8F93\u5165\u4E2D\u521B\u5EFA\u4E00\u4E2A\u6216\u591A\u4E2A\u8D44\u6E90\u3002</li><li><strong><code>kubectl edit</code></strong> - \u7F16\u8F91\u96C6\u7FA4\u4E2D\u7684\u8D44\u6E90\u3002\u8FD9\u5C06\u6253\u5F00\u4E00\u4E2A\u7F16\u8F91\u5668\u6765\u4FEE\u6539\u8D44\u6E90\u7684\u914D\u7F6E\u3002</li><li><strong><code>kubectl port-forward</code></strong> - \u5C06\u672C\u5730\u7AEF\u53E3\u8F6C\u53D1\u5230\u96C6\u7FA4\u4E2D\u7684 Pod\u3002</li><li><strong><code>kubectl run</code></strong> - \u5728\u96C6\u7FA4\u4E2D\u8FD0\u884C\u4E00\u4E2A\u6307\u5B9A\u7684\u955C\u50CF\u3002</li><li><strong><code>kubectl scale</code></strong> - \u8C03\u6574\u8D44\u6E90\uFF08\u5982 Deployment\u3001ReplicaSet\uFF09\u7684\u526F\u672C\u6570\u91CF\u3002</li><li><strong><code>kubectl rollout</code></strong> - \u7BA1\u7406\u8D44\u6E90\u7684\u90E8\u7F72\uFF0C\u5982\u67E5\u770B\u72B6\u6001\u3001\u6682\u505C\u3001\u6062\u590D\u6216\u56DE\u6EDA\u66F4\u65B0\u3002</li></ol><p><strong>\u9664\u4E86\u4E0A\u9762\u7684\u547D\u4EE4\uFF0CKubernetes \u4E2D\u7684 kubectl \u8FD8\u652F\u6301\u6CE8\u89E3\uFF1A</strong></p><p><code>kubectl annotate</code> \u547D\u4EE4\u7528\u4E8E\u7ED9 Kubernetes \u96C6\u7FA4\u4E2D\u7684\u8D44\u6E90\u6DFB\u52A0\u6216\u66F4\u65B0\u6CE8\u89E3\uFF08annotations\uFF09\u3002\u6CE8\u89E3\u662F\u4E00\u79CD\u9644\u52A0\u4FE1\u606F\uFF0C\u53EF\u4EE5\u7528\u4E8E\u5B58\u50A8\u975E\u8BC6\u522B\u6027\u7684\u5143\u6570\u636E\u3002\u5B83\u4EEC\u901A\u5E38\u7528\u4E8E\u7BA1\u7406\u5DE5\u5177\u3001\u5E93\u548C\u5BA2\u6237\u7AEF\u4EE5\u5B58\u50A8\u8F85\u52A9\u4FE1\u606F\uFF0C\u4F8B\u5982\u63CF\u8FF0\u3001\u7248\u672C\u4FE1\u606F\u7B49\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl annotate <span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="operator" tabindex="-1"><a class="header-anchor" href="#operator" aria-hidden="true">#</a> Operator</h2><p>optrator \u548C controller \u662F\u7ECF\u5E38\u6DF7\u6DC6\u7684\u4E24\u4E2A\u672F\u8BED\uFF0Ckubernetes operator \u662F\u4E00\u4E2A\u5E94\u7528\u7279\u5B9A\u7684\u63A7\u5236\u5668\uFF0C\u5B83\u6269\u5C55 Kubernetes API \u6765\u4EE3\u8868 Kubernetes \u7684\u5B9E\u9645\u7528\u6237\u53BB\u521B\u5EFA\u3001\u914D\u7F6E\u548C\u7BA1\u7406\u590D\u6742\u7684\u6709\u72B6\u6001\u5E94\u7528\u5B9E\u4F8B\uFF0C\u5B83\u5728\u57FA\u7840\u7684 Kubernetes \u8D44\u6E90\u548C\u63A7\u5236\u5668\u6982\u5FF5\u4E0A\u53BB\u5EFA\u7ACB\u7684\u3002</p><p><strong>\u6240\u6709\u7684 Operator \u90FD\u4F7F\u7528 Controller \u7684\u6A21\u5F0F\uFF0C\u4F46\u5E76\u975E\u6240\u6709\u7684 Controller \u90FD\u662F Operator\u3002</strong></p><p>\u9996\u5148\uFF0C<strong>Controller</strong> \u662F Kubernetes \u4E2D\u7684\u4E00\u4E2A\u6838\u5FC3\u6982\u5FF5\u3002\u5B83\u662F\u4E00\u4E2A\u5FAA\u73AF\uFF0C\u4E0D\u65AD\u76D1\u89C6\u96C6\u7FA4\u7684\u72B6\u6001\uFF0C\u5E76\u5728\u5FC5\u8981\u65F6\u91C7\u53D6\u884C\u52A8\u4EE5\u5C06\u5F53\u524D\u72B6\u6001\u8F6C\u53D8\u4E3A\u6240\u9700\u72B6\u6001\u3002Controller \u901A\u8FC7\u4E0E Kubernetes API \u4EA4\u4E92\u6765\u5B9E\u73B0\u8FD9\u4E00\u70B9\u3002\u4F8B\u5982\uFF0C\u4E00\u4E2A Deployment Controller \u8D1F\u8D23\u786E\u4FDD\u6307\u5B9A\u6570\u91CF\u7684 Pod \u526F\u672C\u6B63\u5728\u8FD0\u884C\u3002</p><p>\u76F8\u6BD4\u4E4B\u4E0B\uFF0C<strong>Operator</strong> \u662F\u4E00\u79CD\u66F4\u7279\u5B9A\u7684\u63A7\u5236\u5668\u7C7B\u578B\u3002Kubernetes Operator \u662F\u4E3A\u4E86\u7BA1\u7406\u590D\u6742\u3001\u6709\u72B6\u6001\u7684\u5E94\u7528\u7A0B\u5E8F\u800C\u8BBE\u8BA1\u7684\u3002\u5B83\u4E0D\u4EC5\u5305\u542B\u6807\u51C6\u7684\u63A7\u5236\u5668\u529F\u80FD\uFF0C\u8FD8\u6269\u5C55\u4E86 Kubernetes API\uFF0C\u4EE5\u4FBF\u66F4\u597D\u5730\u7BA1\u7406\u7279\u5B9A\u5E94\u7528\u7A0B\u5E8F\u7684\u751F\u547D\u5468\u671F\u3002\u4F8B\u5982\uFF0C\u4E00\u4E2A\u6570\u636E\u5E93 Operator \u53EF\u4EE5\u8D1F\u8D23\u90E8\u7F72\u6570\u636E\u5E93\u3001\u5907\u4EFD\u6570\u636E\u3001\u6062\u590D\u6570\u636E\u7B49\u3002</p><p>\u5173\u952E\u533A\u522B\u5728\u4E8E\uFF1A</p><ul><li><strong>Controller</strong> \u901A\u5E38\u662F\u66F4\u901A\u7528\u7684\uFF0C\u8D1F\u8D23\u7BA1\u7406 Kubernetes \u4E2D\u7684\u6807\u51C6\u8D44\u6E90\uFF0C\u5982 Pods\u3001Deployments \u7B49\u3002</li><li><strong>Operator</strong> \u662F\u4E00\u79CD\u7279\u6B8A\u7C7B\u578B\u7684 Controller\uFF0C\u4E13\u95E8\u7528\u4E8E\u7BA1\u7406\u7279\u5B9A\u7684\u3001\u901A\u5E38\u662F\u590D\u6742\u7684\u5E94\u7528\u7A0B\u5E8F\u3002\u5B83\u4EEC\u4F7F\u7528\u81EA\u5B9A\u4E49\u8D44\u6E90\uFF08Custom Resources\uFF09\u6765\u8868\u793A\u5E94\u7528\u7A0B\u5E8F\u7684\u72B6\u6001\uFF0C\u5E76\u5B9E\u73B0\u7279\u5B9A\u4E8E\u8BE5\u5E94\u7528\u7A0B\u5E8F\u7684\u4E1A\u52A1\u903B\u8F91\u3002</li></ul><p>\u56E0\u6B64\uFF0C<strong>\u6240\u6709\u7684 Operator \u90FD\u4F7F\u7528 Controller \u7684\u6A21\u5F0F\uFF0C\u4F46\u5E76\u975E\u6240\u6709\u7684 Controller \u90FD\u662F Operator</strong>\u3002\u8FD9\u662F\u56E0\u4E3A\u6240\u6709 Operator \u90FD\u662F\u6784\u5EFA\u5728\u63A7\u5236\u5668\u6A21\u5F0F\u4E4B\u4E0A\u7684\uFF0C\u4F46\u63A7\u5236\u5668\u4E0D\u4E00\u5B9A\u9700\u8981\u5177\u6709\u7BA1\u7406\u7279\u5B9A\u5E94\u7528\u7A0B\u5E8F\u751F\u547D\u5468\u671F\u7684\u590D\u6742\u903B\u8F91\u548C\u6269\u5C55 API \u7684\u80FD\u529B\uFF0C\u8FD9\u662F Operator \u7279\u6709\u7684\u3002</p><h3 id="\u5B9E\u73B0\u4E00\u4E2A-operator" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0\u4E00\u4E2A-operator" aria-hidden="true">#</a> \u5B9E\u73B0\u4E00\u4E2A Operator</h3><p>\u6211\u4EEC\u4E86\u89E3\u4E86 Controller \u7684\u57FA\u7840\u77E5\u8BC6\u4EE5\u53CA Controller \u548C Operator \u4E4B\u95F4\u7684\u533A\u522B\u4E4B\u540E\uFF0C\u6211\u4EEC\u51C6\u5907\u5B9E\u73B0\u4E00\u4E2A Operator \u3002\u793A\u4F8B Operator \u5C06\u89E3\u51B3\u5B9E\u9645\u73AF\u5883\u4E2D\u7684\u4EFB\u52A1\uFF1A\u7BA1\u7406\u4E00\u7EC4\u5E26\u6709\u9884\u914D\u7F6E\u9759\u6001\u8D44\u6E90\u5185\u5BB9\u7684 Nginx \u670D\u52A1\u5668\u3002\u6539 Operator \u652F\u6301 \u7528\u6237 \u6307\u5B9A Nginx \u670D\u52A1\u5668\u5217\u8868\uFF0C\u5E76\u4E14\u914D\u7F6E\u5B89\u88C5\u5728\u6BCF\u4E00\u4E2A\u670D\u52A1\u4E0A\u7684\u9759\u6001\u6587\u4EF6\u3002</p><p>\u5F88\u5BB9\u6613\u60F3\u5230\u7684\u662F\uFF0CConfigMap \u662F\u6211\u4EEC\u7528\u6765\u505A\u73AF\u5883\u53D8\u91CF\uFF0C\u547D\u4EE4\u884C\u53C2\u6570\u6216\u8005\u5377\u8F74\u7684\u914D\u7F6E\u4F7F\u7528\u7684\u3002</p><p>Kubernetes \u7684\u63A7\u5236\u5668\u662F\u53EF\u4EE5\u4F7F\u7528\u4EFB\u4F55\u4E00\u79CD\u8BED\u8A00\u6765\u5B9E\u73B0\u7684\uFF0C\u6211\u4EEC\u7528 bash \u6765\u7B80\u5355\u4ECB\u7ECD\u4E00\u4E0B</p><p>\u521B\u5EFA\u4E00\u4E2A\u5B8C\u6574\u7684 Kubernetes Operator \u6848\u4F8B\uFF0C\u5C24\u5176\u662F\u6D89\u53CA\u5230 Nginx \u670D\u52A1\u5668\u7BA1\u7406\u7684 Operator\uFF0C\u53EF\u4EE5\u5206\u4E3A\u51E0\u4E2A\u4E3B\u8981\u90E8\u5206\uFF1A\u5B9A\u4E49 CRD\uFF08Custom Resource Definition\uFF09\uFF0C\u7F16\u5199 Operator \u63A7\u5236\u5668\u4EE3\u7801\uFF0C\u4EE5\u53CA\u90E8\u7F72\u548C\u6D4B\u8BD5 Operator\u3002\u5728\u8FD9\u4E2A\u793A\u4F8B\u4E2D\uFF0C\u6211\u4EEC\u4F1A\u4F7F\u7528\u4E00\u79CD\u66F4\u5E38\u7528\u7684\u8BED\u8A00\u5982 Go\uFF0C\u56E0\u4E3A\u5B83\u63D0\u4F9B\u4E86\u66F4\u5F3A\u5927\u7684\u5DE5\u5177\u548C\u5E93\u6765\u4E0E Kubernetes API \u4EA4\u4E92\u3002\u6211\u4EEC\u5C06\u901A\u8FC7\u4EE5\u4E0B\u6B65\u9AA4\u521B\u5EFA\u4E00\u4E2A\u7B80\u5355\u7684 Operator\uFF1A</p><h3 id="\u5B9A\u4E49-crd" tabindex="-1"><a class="header-anchor" href="#\u5B9A\u4E49-crd" aria-hidden="true">#</a> \u5B9A\u4E49 CRD</h3><p>\u9996\u5148\uFF0C\u5B9A\u4E49\u4E00\u4E2A CRD \u6765\u8868\u793A Nginx \u7684\u914D\u7F6E\u3002\u8FD9\u4E2A CRD \u5C06\u63CF\u8FF0 Nginx \u5B9E\u4F8B\u7684\u5C5E\u6027\uFF0C\u5982\u7248\u672C\u3001\u914D\u7F6E\u6587\u4EF6\u5185\u5BB9\u548C\u76F8\u5173\u7684\u9759\u6001\u8D44\u6E90\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apiextensions.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> CustomResourceDefinition
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginxconfigs.example.com
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">group</span><span class="token punctuation">:</span> example.com
  <span class="token key atrule">versions</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> v1
      <span class="token key atrule">served</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">scope</span><span class="token punctuation">:</span> Namespaced
  <span class="token key atrule">names</span><span class="token punctuation">:</span>
    <span class="token key atrule">plural</span><span class="token punctuation">:</span> nginxconfigs
    <span class="token key atrule">singular</span><span class="token punctuation">:</span> nginxconfig
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> NginxConfig
    <span class="token key atrule">shortNames</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ngxconf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-\u7F16\u5199-operator-\u63A7\u5236\u5668" tabindex="-1"><a class="header-anchor" href="#_2-\u7F16\u5199-operator-\u63A7\u5236\u5668" aria-hidden="true">#</a> 2. \u7F16\u5199 Operator \u63A7\u5236\u5668</h3><p>\u4F7F\u7528 Go \u8BED\u8A00\u7F16\u5199 Operator \u63A7\u5236\u5668\u3002Operator \u63A7\u5236\u5668\u5C06\u76D1\u542C NginxConfig \u8D44\u6E90\u7684\u521B\u5EFA\u3001\u66F4\u65B0\u548C\u5220\u9664\u4E8B\u4EF6\uFF0C\u5E76\u6267\u884C\u76F8\u5E94\u7684\u64CD\u4F5C\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token comment">// \u5F15\u5165\u5FC5\u8981\u7684\u5E93</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u521D\u59CB\u5316\u5BA2\u6237\u7AEF\u3001\u76D1\u542C NginxConfig \u8D44\u6E90\u7684\u53D8\u5316</span>
    <span class="token comment">// \u5B9E\u73B0\u4E1A\u52A1\u903B\u8F91\uFF1A\u521B\u5EFA/\u66F4\u65B0/\u5220\u9664 Nginx \u5B9E\u4F8B</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-\u5904\u7406-nginx-\u5B9E\u4F8B" tabindex="-1"><a class="header-anchor" href="#_3-\u5904\u7406-nginx-\u5B9E\u4F8B" aria-hidden="true">#</a> 3. \u5904\u7406 Nginx \u5B9E\u4F8B</h3><p>\u5728\u63A7\u5236\u5668\u4E2D\uFF0C\u5904\u7406 Nginx \u5B9E\u4F8B\u7684\u521B\u5EFA\u548C\u66F4\u65B0\u3002\u5F53\u4E00\u4E2A NginxConfig \u8D44\u6E90\u88AB\u521B\u5EFA\u6216\u66F4\u65B0\u65F6\uFF0C\u63A7\u5236\u5668\u4F1A\u6839\u636E\u5B9A\u4E49\u7684\u89C4\u683C\u6765\u8BBE\u7F6E Nginx Pod\uFF0C\u5305\u62EC\u6240\u9700\u7684\u914D\u7F6E\u548C\u9759\u6001\u6587\u4EF6\u3002</p><h3 id="_4-\u521B\u5EFA-docker-\u955C\u50CF\u548C\u90E8\u7F72-operator" tabindex="-1"><a class="header-anchor" href="#_4-\u521B\u5EFA-docker-\u955C\u50CF\u548C\u90E8\u7F72-operator" aria-hidden="true">#</a> 4. \u521B\u5EFA Docker \u955C\u50CF\u548C\u90E8\u7F72 Operator</h3><p>\u5C06 Operator \u6253\u5305\u6210 Docker \u955C\u50CF\uFF0C\u7136\u540E\u5728 Kubernetes \u96C6\u7FA4\u4E2D\u90E8\u7F72\u8FD9\u4E2A\u955C\u50CF\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u4F7F\u7528\u5408\u9002\u7684\u57FA\u7840\u955C\u50CF</span>
FROM golang:1.15

<span class="token comment"># \u6DFB\u52A0 Operator \u4EE3\u7801</span>
ADD <span class="token builtin class-name">.</span> /operator
WORKDIR /operator

<span class="token comment"># \u7F16\u8BD1 Operator</span>
RUN go build <span class="token parameter variable">-o</span> operator <span class="token builtin class-name">.</span>

<span class="token comment"># \u8BBE\u7F6E\u542F\u52A8\u547D\u4EE4</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;./operator&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u90E8\u7F72\u5230 Kubernetes\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>operator
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>operator
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>operator
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> operator
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>operator<span class="token punctuation">:</span>latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-\u6D4B\u8BD5-operator" tabindex="-1"><a class="header-anchor" href="#_5-\u6D4B\u8BD5-operator" aria-hidden="true">#</a> 5. \u6D4B\u8BD5 Operator</h3><p>\u521B\u5EFA\u4E00\u4E2A NginxConfig \u5B9E\u4F8B\u6765\u6D4B\u8BD5 Operator\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> <span class="token string">&quot;example.com/v1&quot;</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> NginxConfig
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;latest&quot;</span>
  <span class="token key atrule">staticContent</span><span class="token punctuation">:</span> <span class="token string">&quot;Welcome to Nginx!&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u76D1\u89C6 Kubernetes \u96C6\u7FA4\uFF0C\u786E\u4FDD Operator \u6B63\u786E\u54CD\u5E94\u4E86\u8FD9\u4E2A NginxConfig \u5B9E\u4F8B\u7684\u521B\u5EFA\u3002</p><h3 id="\u6CE8\u610F\u4E8B\u9879" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u610F\u4E8B\u9879" aria-hidden="true">#</a> \u6CE8\u610F\u4E8B\u9879</h3><ul><li><strong>\u9519\u8BEF\u5904\u7406\u548C\u8D44\u6E90\u6E05\u7406</strong>\uFF1A\u786E\u4FDD Operator \u80FD\u591F\u4F18\u96C5\u5730\u5904\u7406\u9519\u8BEF\u548C\u8D44\u6E90\u7684\u751F\u547D\u5468\u671F\u3002</li><li><strong>\u6743\u9650\u548C\u5B89\u5168</strong>\uFF1A\u786E\u4FDD Operator \u6709\u9002\u5F53\u7684\u6743\u9650\u6765\u7BA1\u7406 Kubernetes \u8D44\u6E90\uFF0C\u5E76\u8003\u8651\u5B89\u5168\u6027\u3002</li><li><strong>\u6D4B\u8BD5\u548C\u9A8C\u8BC1</strong>\uFF1A\u5728\u751F\u4EA7\u73AF\u5883\u90E8\u7F72\u524D\uFF0C\u5145\u5206\u6D4B\u8BD5 Operator \u7684\u884C\u4E3A\u3002</li></ul><h2 id="\u7B80\u5355\u7684-cicd-\u5165\u95E8" tabindex="-1"><a class="header-anchor" href="#\u7B80\u5355\u7684-cicd-\u5165\u95E8" aria-hidden="true">#</a> \u7B80\u5355\u7684 CICD \u5165\u95E8</h2><p>\u63A5\u4E0B\u6765\uFF0C\u6211\u4EEC\u9996\u5148\u521B\u5EFA\u4E00\u4E2A GitOps Operator \u6765\u9A71\u52A8\u6301\u7EED\u4EA4\u4ED8\u3002</p><p>GitOps \u662F\u4E00\u79CD\u7528\u4E8E\u6301\u7EED\u90E8\u7F72\u7684\u5B9E\u8DF5\uFF0C\u5B83\u5C06 Git \u4F5C\u4E3A\u771F\u5B9E\u72B6\u6001\u7684\u6E90\u3002\u5728 GitOps \u6A21\u578B\u4E2D\uFF0C\u6240\u6709\u7684\u90E8\u7F72\u548C\u73AF\u5883\u914D\u7F6E\u90FD\u5B58\u50A8\u5728 Git \u4ED3\u5E93\u4E2D\uFF0C\u8FD9\u6837\u505A\u53EF\u4EE5\u63D0\u4F9B\u7248\u672C\u63A7\u5236\u3001\u5BA1\u8BA1\u8DDF\u8E2A\u548C\u56DE\u6EDA\u80FD\u529B\u3002\u4E3A\u4E86\u5B9E\u73B0 GitOps\uFF0C\u6211\u4EEC\u53EF\u4EE5\u521B\u5EFA\u4E00\u4E2A GitOps Operator\uFF0C\u5B83\u5C06\u81EA\u52A8\u5316\u4ECE Git \u4ED3\u5E93\u5230 Kubernetes \u96C6\u7FA4\u7684\u90E8\u7F72\u8FC7\u7A0B\u3002</p><h3 id="\u521B\u5EFA-gitops-operator-\u7684\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA-gitops-operator-\u7684\u6B65\u9AA4" aria-hidden="true">#</a> \u521B\u5EFA GitOps Operator \u7684\u6B65\u9AA4</h3><ol><li><strong>\u5B9A\u4E49 GitOps Operator \u7684\u804C\u8D23</strong>\uFF1A <ul><li>\u76D1\u542C Git \u4ED3\u5E93\u7684\u53D8\u5316\u3002</li><li>\u5F53\u4ED3\u5E93\u4E2D\u7684\u5B9A\u4E49\uFF08\u5982 Kubernetes \u90E8\u7F72\u6587\u4EF6\uFF09\u53D1\u751F\u53D8\u5316\u65F6\uFF0C\u81EA\u52A8\u5E94\u7528\u8FD9\u4E9B\u53D8\u5316\u5230 Kubernetes \u96C6\u7FA4\u3002</li><li>\u786E\u4FDD\u96C6\u7FA4\u72B6\u6001\u4E0E Git \u4ED3\u5E93\u4E2D\u5B9A\u4E49\u7684\u72B6\u6001\u4FDD\u6301\u4E00\u81F4\u3002</li></ul></li><li><strong>\u9009\u62E9\u5DE5\u5177\u548C\u6846\u67B6</strong>\uFF1A <ul><li>\u4F7F\u7528\u5982 Operator SDK \u6216 Kubebuilder \u7B49\u5DE5\u5177\u53EF\u4EE5\u7B80\u5316 Operator \u7684\u521B\u5EFA\u548C\u7BA1\u7406\u8FC7\u7A0B\u3002</li><li>\u5BF9\u4E8E Git \u4EA4\u4E92\uFF0C\u53EF\u4EE5\u4F7F\u7528 Git \u5BA2\u6237\u7AEF\u5E93\uFF0C\u4F8B\u5982 Go-git\uFF08\u5BF9\u4E8E Go \u8BED\u8A00\uFF09\u3002</li></ul></li><li><strong>\u5B9E\u73B0 GitOps Operator</strong>\uFF1A <ul><li>\u4F7F\u7528 CRD \u5B9A\u4E49 GitOps \u914D\u7F6E\uFF0C\u5305\u62EC Git \u4ED3\u5E93\u7684 URL\u3001\u5206\u652F\u3001\u8DEF\u5F84\u7B49\u3002</li><li>\u7F16\u5199 Operator \u63A7\u5236\u5668\u903B\u8F91\u6765\u5904\u7406\u8FD9\u4E9B\u81EA\u5B9A\u4E49\u8D44\u6E90\uFF0C\u5305\u62EC\u4ECE Git \u4ED3\u5E93\u514B\u9686\u4EE3\u7801\u3001\u89E3\u6790 Kubernetes \u914D\u7F6E\u6587\u4EF6\uFF0C\u5E76\u5C06\u5176\u5E94\u7528\u5230\u96C6\u7FA4\u4E2D\u3002</li></ul></li><li><strong>\u90E8\u7F72\u548C\u6D4B\u8BD5 Operator</strong>\uFF1A <ul><li>\u5C06 Operator \u5BB9\u5668\u5316\uFF0C\u90E8\u7F72\u5230 Kubernetes \u96C6\u7FA4\u3002</li><li>\u521B\u5EFA GitOps \u914D\u7F6E\u8D44\u6E90\u6765\u6D4B\u8BD5 Operator\uFF0C\u786E\u4FDD\u5B83\u80FD\u6B63\u786E\u5730\u4ECE Git \u4ED3\u5E93\u62C9\u53D6\u548C\u90E8\u7F72\u914D\u7F6E\u3002</li></ul></li><li><strong>\u6574\u5408\u6301\u7EED\u96C6\u6210\u6D41\u7A0B</strong>\uFF1A <ul><li>\u5C06 GitOps Operator \u96C6\u6210\u5230 CI \u6D41\u7A0B\u4E2D\uFF0C\u4EE5\u81EA\u52A8\u89E6\u53D1\u96C6\u7FA4\u7684\u66F4\u65B0\u3002</li><li>\u5728\u4EE3\u7801\u63D0\u4EA4\u5230 Git \u4ED3\u5E93\u540E\uFF0CCI \u5DE5\u5177\uFF08\u5982 Jenkins\u3001GitLab CI \u6216 GitHub Actions\uFF09\u53EF\u4EE5\u8FD0\u884C\u6D4B\u8BD5\uFF0C\u5408\u5E76\u4EE3\u7801\uFF0C\u89E6\u53D1 Operator \u5E94\u7528\u66F4\u65B0\u3002</li></ul></li></ol><h3 id="\u5B9E\u73B0-gitops-operator" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0-gitops-operator" aria-hidden="true">#</a> \u5B9E\u73B0 GitOps Operator</h3><ol><li><p><strong>\u5B9A\u4E49 GitOps CRD</strong>\uFF1A</p><ul><li>\u521B\u5EFA\u4E00\u4E2A Custom Resource Definition\uFF08CRD\uFF09\uFF0C\u7528\u4E8E\u8868\u793A GitOps \u914D\u7F6E\u3002\u8FD9\u4E2A CRD \u5E94\u8BE5\u5305\u62EC Git \u4ED3\u5E93\u7684\u5730\u5740\u3001\u5206\u652F\u3001\u4EE5\u53CA\u8DEF\u5F84\u3002</li></ul><div class="language-yanl ext-yanl line-numbers-mode"><pre class="language-yanl"><code>apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: gitopsconfigs.gitops.example.com
spec:
  group: gitops.example.com
  versions:
    - name: v1
      served: true
      storage: true
  scope: Namespaced
  names:
    plural: gitopsconfigs
    singular: gitopsconfig
    kind: GitOpsConfig
    shortNames:
    - goc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>\u7F16\u5199 Operator \u63A7\u5236\u5668</strong>\uFF1A</p><ul><li>\u4F7F\u7528 Go\u3001Python \u6216\u5176\u4ED6\u7F16\u7A0B\u8BED\u8A00\u7F16\u5199 Operator \u63A7\u5236\u5668\u3002</li><li>\u63A7\u5236\u5668\u5E94\u5F53\u76D1\u542C GitOpsConfig \u8D44\u6E90\u7684\u53D8\u5316\uFF0C\u5E76\u6839\u636E\u5176\u5B9A\u4E49\u7684 Git \u4ED3\u5E93\u4FE1\u606F\u540C\u6B65\u914D\u7F6E\u3002</li><li>\u63A7\u5236\u5668\u5E94\u5F53\u80FD\u591F\u4ECE Git \u4ED3\u5E93\u514B\u9686\u914D\u7F6E\u6587\u4EF6\uFF0C\u89E3\u6790 Kubernetes \u90E8\u7F72\u6587\u4EF6\uFF0C\u5E76\u5C06\u5176\u5E94\u7528\u5230\u96C6\u7FA4\u4E2D\u3002</li></ul></li><li><p><strong>\u6784\u5EFA\u548C\u90E8\u7F72 Operator</strong>\uFF1A</p><ul><li>\u521B\u5EFA Docker \u955C\u50CF\u5E76\u5C06 Operator \u90E8\u7F72\u5230 Kubernetes \u96C6\u7FA4\u3002</li></ul></li><li><p><strong>\u6D4B\u8BD5 Operator</strong>\uFF1A</p><ul><li>\u5728 Git \u4ED3\u5E93\u4E2D\u66F4\u65B0 Nginx \u7684\u914D\u7F6E\u6216\u7248\u672C\u3002</li><li>\u89C2\u5BDF Operator \u662F\u5426\u81EA\u52A8\u5C06\u66F4\u65B0\u5E94\u7528\u5230 Kubernetes \u96C6\u7FA4\u3002</li></ul></li></ol><h3 id="\u6301\u7EED\u96C6\u6210-ci-\u96C6\u6210" tabindex="-1"><a class="header-anchor" href="#\u6301\u7EED\u96C6\u6210-ci-\u96C6\u6210" aria-hidden="true">#</a> \u6301\u7EED\u96C6\u6210 (CI) \u96C6\u6210</h3><ol><li><strong>\u8BBE\u7F6E CI \u5DE5\u5177</strong>\uFF1A <ul><li>\u9009\u62E9\u4E00\u4E2A CI \u5DE5\u5177\uFF08\u5982 Jenkins\u3001Travis CI\u3001GitHub Actions\uFF09\u3002</li><li>\u5728 Git \u4ED3\u5E93\u4E2D\u8BBE\u7F6E CI \u6D41\u7A0B\uFF0C\u4EE5\u5728\u4EE3\u7801\u63D0\u4EA4\u65F6\u8FD0\u884C\u6D4B\u8BD5\u3002</li></ul></li><li><strong>\u81EA\u52A8\u5316\u89E6\u53D1</strong>\uFF1A <ul><li>\u914D\u7F6E CI \u5DE5\u5177\u5728\u4EE3\u7801\u53D8\u66F4\u88AB\u5408\u5E76\u5230\u4E3B\u5206\u652F\u540E\u81EA\u52A8\u901A\u77E5 Kubernetes \u96C6\u7FA4\uFF0C\u89E6\u53D1 GitOps Operator \u5E94\u7528\u66F4\u65B0\u3002</li></ul></li></ol><h3 id="\u5B8C\u6574\u7684-gitops-\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u5B8C\u6574\u7684-gitops-\u6D41\u7A0B" aria-hidden="true">#</a> \u5B8C\u6574\u7684 GitOps \u6D41\u7A0B</h3><ul><li>\u5F00\u53D1\u4EBA\u5458\u63D0\u4EA4\u4EE3\u7801\u5230 Git \u4ED3\u5E93\u3002</li><li>CI \u5DE5\u5177\u5728\u4EE3\u7801\u5408\u5E76\u5230\u4E3B\u5206\u652F\u65F6\u8FD0\u884C\u6D4B\u8BD5\u3002</li><li>GitOps Operator \u76D1\u542C\u5230 Git \u4ED3\u5E93\u7684\u53D8\u5316\uFF0C\u81EA\u52A8\u540C\u6B65\u66F4\u65B0\u5230 Kubernetes \u96C6\u7FA4\u3002</li></ul><h2 id="\u73AF\u5883\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883\u7BA1\u7406" aria-hidden="true">#</a> \u73AF\u5883\u7BA1\u7406</h2><p>\u4E0D\u540C\u7684\u8FD0\u884C\u65F6\u73AF\u5883\uFF0C\u4EE5\u53CA Kubernetes \u547D\u540D\u7A7A\u95F4\u662F\u5982\u4F55\u5B9A\u4E49\u73AF\u5883\u8FB9\u754C\u7684\u3002</p><p>\u4E00\u4E2A\u73AF\u5883\u662F\u7531\u4E09\u4E2A\u540C\u6837\u91CD\u8981\u7684\u90E8\u5206\u7EC4\u6210\u7684\uFF1A</p><ul><li>\u4EE3\u7801</li><li>\u6EE1\u8DB3\u5148\u51B3\u6761\u4EF6\u7684\u8FD0\u884C\u65F6</li><li>\u914D\u7F6E</li></ul><p><strong>\u4EE3\u7801\uFF1A</strong></p><p>\u4EE3\u7801\u662F\u5E94\u7528\u7A0B\u5E8F\u6267\u884C\u7279\u5B9A\u4EFB\u52A1\u7684\u673A\u5668\u6307\u4EE4\u3002\u8981\u6267\u884C\u4EE3\u7801\uFF0C\u53EF\u80FD\u8FD8\u9700\u8981\u8FD0\u884C\u65F6\u4F9D\u8D56\u9879\u3002\u4F8B\u5982\uFF0CNode.js\u4EE3\u7801\u9700\u8981Node.js\u4E8C\u8FDB\u5236\u5305\u548C\u5176\u4ED6NPM\u5305\u624D\u80FD\u6210\u529F\u5730\u6267\u884C\u3002\u5BF9\u4E8EKubernetes\uFF0C\u6240\u6709\u8FD0\u884C\u65F6\u4F9D\u8D56\u9879\u548C\u4EE3\u7801\u90FD\u6253\u5305\u4E3A\u4E00\u4E2A\u53EF\u90E8\u7F72\u5355\u5143\uFF08\u53C8\u540DDocker\u6620\u50CF\uFF09\uFF0C\u5E76\u901A\u8FC7Docker\u5B88\u62A4\u8FDB\u7A0B\u8FDB\u884C\u7F16\u6392\u3002\u5E94\u7528\u7A0B\u5E8F\u7684Docker\u6620\u50CF\u53EF\u4EE5\u653E\u5FC3\u5730\u5728\u4EFB\u4F55\u73AF\u5883\u4E2D\u8FD0\u884C\uFF0C\u4ECE\u5F00\u53D1\u4EBA\u5458\u7684\u7B14\u8BB0\u672C\u7535\u8111\u5230\u5728\u4E91\u4E2D\u8FD0\u884C\u7684\u751F\u4EA7\u96C6\u7FA4\uFF0C\u56E0\u4E3A\u6620\u50CF\u5C01\u88C5\u4E86\u4EE3\u7801\u548C\u6240\u6709\u4F9D\u8D56\u5173\u7CFB\uFF0C\u6D88\u9664\u4E86\u73AF\u5883\u4E4B\u95F4\u6F5C\u5728\u7684\u4E0D\u517C\u5BB9\u6027\u3002</p><p>\u5728\u8F6F\u4EF6\u90E8\u7F72\u4E2D\uFF0C\u73AF\u5883\u662F\u90E8\u7F72\u548C\u6267\u884C\u4EE3\u7801\u7684\u5730\u65B9\u3002\u5728\u8F6F\u4EF6\u5F00\u53D1\u7684\u751F\u5B58\u5468\u671F\u4E2D\uFF0C\u4E0D\u540C\u7684\u73AF\u5883\u670D\u52A1\u4E8E\u4E0D\u540C\u7684\u76EE\u7684\u3002\u4F8B\u5982\uFF0C\u672C\u5730\u5F00\u53D1\u73AF\u5883\uFF08\u53C8\u540D\u7B14\u8BB0\u672C\u7535\u8111\uFF09\u662F\u5DE5\u7A0B\u5E08\u53EF\u4EE5\u521B\u5EFA\u3001\u6D4B\u8BD5\u548C\u8C03\u8BD5\u65B0\u4EE3\u7801\u7248\u672C\u7684\u5730\u65B9\u3002\u5728\u5DE5\u7A0B\u5E08\u5B8C\u6210\u4EE3\u7801\u5F00\u53D1\u540E\uFF0C\u4E0B\u4E00\u6B65\u662F\u5C06\u66F4\u6539\u63D0\u4EA4\u5230Git\uFF0C\u5E76\u5F00\u59CB\u90E8\u7F72\u5230\u4E0D\u540C\u7684\u73AF\u5883\u4E2D\u8FDB\u884C\u96C6\u6210\u6D4B\u8BD5\u548C\u6700\u7EC8\u7684\u4EA7\u54C1\u53D1\u5E03\u3002\u8FD9\u4E2A\u8FC7\u7A0B\u88AB\u79F0\u4E3A\u6301\u7EED\u96C6\u6210/\u6301\u7EED\u90E8\u7F72\uFF08CI/CD\uFF09\uFF0C\u901A\u5E38\u7531\u4EE5\u4E0B\u73AF\u5883\u7EC4\u6210\uFF1A</p><ul><li>QA</li><li>E2E</li><li>\u9636\u6BB5\u548C\u4EA7\u54C1</li></ul><p>\u5728QA\u73AF\u5883\u4E2D\uFF0C\u65B0\u4EE3\u7801\u5C06\u6839\u636E\u786C\u4EF6\u3001\u6570\u636E\u548C\u5176\u4ED6\u7C7B\u4F3C\u4E8E\u751F\u4EA7\u7684\u4F9D\u8D56\u9879\u8FDB\u884C\u6D4B\u8BD5\uFF0C\u4EE5\u786E\u4FDD\u670D\u52A1\u7684\u6B63\u786E\u6027\u3002\u5982\u679C\u6240\u6709\u7684\u6D4B\u8BD5\u90FD\u901A\u8FC7\u4E86QA\uFF0C\u65B0\u7684\u4EE3\u7801\u5C06\u88AB\u63D0\u5347\u5230E2E\u73AF\u5883\uFF0C\u4F5C\u4E3A\u5176\u4ED6\u9884\u53D1\u5E03\u670D\u52A1\u6D4B\u8BD5/\u96C6\u6210\u7684\u7A33\u5B9A\u73AF\u5883\u3002QA\u548CE2E\u73AF\u5883\u4E5F\u79F0\u4E3A\u9884\u751F\u4EA7\uFF08preprod\uFF09\u73AF\u5883\uFF0C\u56E0\u4E3A\u5B83\u4EEC\u4E0D\u627F\u8F7D\u751F\u4EA7\u6D41\u91CF\u6216\u4F7F\u7528\u751F\u4EA7\u6570\u636E\u3002\u5F53\u4E00\u4E2A\u65B0\u7248\u672C\u7684\u4EE3\u7801\u51C6\u5907\u597D\u7528\u4E8E\u751F\u4EA7\u53D1\u5E03\u65F6\uFF0C\u4EE3\u7801\u901A\u5E38\u4F1A\u9996\u5148\u90E8\u7F72\u5728Stage\u73AF\u5883\u4E2D\uFF08\u5B83\u53EF\u4EE5\u8BBF\u95EE\u5B9E\u9645\u7684\u751F\u4EA7\u4F9D\u8D56\uFF09\uFF0C\u4EE5\u786E\u4FDD\u5728\u4EE3\u7801\u8FDB\u5165Prod\u73AF\u5883\u4E4B\u524D\uFF0C\u6240\u6709\u7684\u751F\u4EA7\u4F9D\u8D56\u90FD\u5DF2\u5230\u4F4D\u3002\u4F8B\u5982\uFF0C\u65B0\u4EE3\u7801\u53EF\u80FD\u9700\u8981\u4E00\u4E2A\u65B0\u7684\u6570\u636E\u5E93\u6A21\u5F0F\u66F4\u65B0\uFF0C\u800CStage\u73AF\u5883\u53EF\u4EE5\u7528\u6765\u9A8C\u8BC1\u65B0\u6A21\u5F0F\u662F\u5426\u6B63\u786E\u3002\u914D\u7F6E\u53EA\u5C06\u6D4B\u8BD5\u6D41\u91CF\u5B9A\u5411\u5230Stage\u73AF\u5883\uFF0C\u8FD9\u6837\u65B0\u4EE3\u7801\u5F15\u5165\u7684\u4EFB\u4F55\u95EE\u9898\u90FD\u4E0D\u4F1A\u5F71\u54CD\u5B9E\u9645\u5BA2\u6237\u3002\u4F46\u662F\uFF0CStage\u73AF\u5883\u901A\u5E38\u914D\u7F6E\u4E3A\u4F7F\u7528\u201C\u771F\u5B9E\u7684\u201D\u751F\u4EA7\u6570\u636E\u5E93\u64CD\u4F5C\u3002\u5728Stage\u73AF\u5883\u4E2D\u8FDB\u884C\u7684\u6D4B\u8BD5\u5FC5\u987B\u7ECF\u8FC7\u4ED4\u7EC6\u7684\u5BA1\u67E5\uFF0C\u4EE5\u786E\u4FDD\u5B83\u4EEC\u5728\u751F\u4EA7\u4E2D\u662F\u5B89\u5168\u7684\u3002\u6240\u6709\u6D4B\u8BD5\u5728Stage\u4E2D\u901A\u8FC7\u540E\uFF0C\u65B0\u4EE3\u7801\u5C06\u6700\u7EC8\u90E8\u7F72\u5230Prod\u4E2D\uFF0C\u7528\u4E8E\u5B9E\u65F6\u751F\u4EA7\u6D41\u91CF\u3002\u56E0\u4E3AStage\u548CProd\u90FD\u53EF\u4EE5\u8BBF\u95EE\u751F\u4EA7\u6570\u636E\uFF0C\u6240\u4EE5\u5B83\u4EEC\u90FD\u88AB\u8BA4\u4E3A\u662F\u751F\u4EA7\u73AF\u5883\u3002</p><p><strong>\u547D\u540D\u7A7A\u95F4\u7BA1\u7406</strong></p><p>\u547D\u540D\u7A7A\u95F4\u662FKubernetes\u4E2D\u652F\u6301\u73AF\u5883\u7684\u81EA\u7136\u6784\u9020\u3002\u5B83\u4EEC\u5141\u8BB8\u5728\u591A\u4E2A\u56E2\u961F\u6216\u9879\u76EE\u4E4B\u95F4\u5212\u5206\u7FA4\u96C6\u8D44\u6E90\u3002\u547D\u540D\u7A7A\u95F4\u4E3A\u552F\u4E00\u8D44\u6E90\u547D\u540D\u3001\u8D44\u6E90\u914D\u989D\u3001RBAC\u3001\u786C\u4EF6\u9694\u79BB\u548C\u7F51\u7EDC\u914D\u7F6E\u63D0\u4F9B\u4E86\u8303\u56F4\uFF1A</p><p><code>Kubernetes \u547D\u540D\u7A7A\u95F4~=\u73AF\u5883</code></p><p>\u5728\u6BCF\u4E2A\u547D\u540D\u7A7A\u95F4\u4E2D\uFF0C\u5E94\u7528\u7A0B\u5E8F\u5B9E\u4F8B\uFF08\u53C8\u540DPod\uFF09\u662F\u4E00\u4E2A\u6216\u591A\u4E2ADocker\u5BB9\u5668\uFF0C\u5728\u90E8\u7F72\u8FC7\u7A0B\u4E2D\u6CE8\u5165\u4E86\u73AF\u5883\u7279\u5B9A\u7684\u5E94\u7528\u7A0B\u5E8F\u5C5E\u6027\u3002\u8FD9\u4E9B\u5E94\u7528\u7A0B\u5E8F\u5C5E\u6027\u5B9A\u4E49\u4E86\u73AF\u5883\u5E94\u8BE5\u5982\u4F55\u8FD0\u884C\uFF08\u6BD4\u5982feature flag\uFF09\u4EE5\u53CA\u5E94\u8BE5\u4F7F\u7528\u54EA\u4E9B\u5916\u90E8\u4F9D\u8D56\uFF08\u6BD4\u5982\u6570\u636E\u5E93\u8FDE\u63A5\u5B57\u7B26\u4E32\uFF09\u3002\u9664\u4E86\u5E94\u7528\u7A0B\u5E8FPod\u4E4B\u5916\uFF0CNamespace\u8FD8\u53EF\u4EE5\u5305\u542B\u63D0\u4F9B\u73AF\u5883\u6240\u9700\u7684\u9644\u52A0\u529F\u80FD\u7684\u5176\u4ED6Pod\u3002</p><p>Namespace\u76F8\u5F53\u4E8EKubernetes\u4E2D\u7684\u73AF\u5883\u3002\u547D\u540D\u7A7A\u95F4\u53EF\u4EE5\u7531Pods\uFF08\u5E94\u7528\u7A0B\u5E8F\u5B9E\u4F8B\uFF09\u3001\u7F51\u7EDC\u7B56\u7565\uFF08\u5165\u53E3/\u51FA\u53E3\uFF09\u548CRBAC\uFF08\u8BBF\u95EE\u63A7\u5236\uFF09\uFF0C\u4EE5\u53CA\u5728\u5355\u72EC\u7684Pod\u4E2D\u8FD0\u884C\u7684\u5E94\u7528\u7A0B\u5E8F\u4F9D\u8D56\u3002</p><p>RBAC\u662F\u4E00\u79CD\u6839\u636E\u4F01\u4E1A\u5185\u5404\u4E2A\u7528\u6237\u7684\u89D2\u8272\u6765\u7BA1\u7406\u5BF9\u8BA1\u7B97\u673A\u6216\u7F51\u7EDC\u8D44\u6E90\u7684\u8BBF\u95EE\u7684\u65B9\u6CD5\u3002\u5728Kubernetes\u4E2D\uFF0C\u89D2\u8272\u5305\u542B\u8868\u793A\u4E00\u7EC4\u6743\u9650\u7684\u89C4\u5219\u3002\u6743\u9650\u7EAF\u7CB9\u662F\u52A0\u6027\u7684\uFF08\u6CA1\u6709\u5426\u5B9A\u89C4\u5219\uFF09\u3002\u89D2\u8272\u53EF\u4EE5\u4F7F\u7528\u89D2\u8272\u5728\u547D\u540D\u7A7A\u95F4\u4E2D\u5B9A\u4E49\uFF0C\u4E5F\u53EF\u4EE5\u4F7F\u7528Cluster Role\u5728\u96C6\u7FA4\u8303\u56F4\u5185\u5B9A\u4E49\u3002\u547D\u540D\u7A7A\u95F4\u8FD8\u53EF\u4EE5\u5177\u6709\u4E13\u7528\u7684\u786C\u4EF6\u548C\u7F51\u7EDC\u7B56\u7565\uFF0C\u4EE5\u4FBF\u6839\u636E\u5E94\u7528\u7A0B\u5E8F\u9700\u6C42\u5BF9\u5176\u914D\u7F6E\u8FDB\u884C\u4F18\u5316\u3002\u4F8B\u5982\uFF0CCPU\u5BC6\u96C6\u578B\u5E94\u7528\u7A0B\u5E8F\u53EF\u4EE5\u90E8\u7F72\u5728\u5177\u6709\u4E13\u7528\u591A\u6838\u786C\u4EF6\u7684\u547D\u540D\u7A7A\u95F4\u4E2D\u3002\u53E6\u4E00\u4E2A\u9700\u8981\u91CD\u78C1\u76D8\u7684\u670D\u52A1\u6211/O\u53EF\u4EE5\u90E8\u7F72\u5728\u5177\u6709\u9AD8\u901FSSD\u7684\u5355\u72EC\u547D\u540D\u7A7A\u95F4\u4E2D\u3002\u6BCF\u4E2A\u540D\u79F0\u7A7A\u95F4\u8FD8\u53EF\u4EE5\u5B9A\u4E49\u81EA\u5DF1\u7684\u7F51\u7EDC\u7B56\u7565\uFF08\u5165\u53E3/\u51FA\u53E3\uFF09\uFF0C\u4EE5\u9650\u5236\u8DE8\u540D\u79F0\u7A7A\u95F4\u6D41\u91CF\u6216\u4F7F\u7528\u975E\u9650\u5B9ADNS\u540D\u79F0\u8BBF\u95EE\u96C6\u7FA4\u4E2D\u7684\u5176\u4ED6\u540D\u79F0\u7A7A\u95F4\u3002</p><h3 id="\u73AF\u5883\u6A21\u62DF" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883\u6A21\u62DF" aria-hidden="true">#</a> \u73AF\u5883\u6A21\u62DF</h3><p>\u6A21\u62DF\u4E24\u4E2A\u73AF\u5883\uFF0C\u5206\u522B\u662F \u6D4B\u8BD5\u73AF\u5883\uFF08qa) \u4EE5\u53CA\u975E\u751F\u4EA7 e2e \u73AF\u5883\uFF08e2e)</p><p>\u9996\u5148\uFF0C\u4E3A\u60A8\u7684\u6BCF\u4E2A\u6765\u5BBE\u7C3F\u73AF\u5883\u521B\u5EFAguestbook-qa\u548Cguestbook-e2e\u547D\u540D\u7A7A\u95F4:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl create namespace guestbook-qa
$ kubectl create namespace guestbook-e2
$ kubectl get namespaces
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u73B0\u5728\uFF0C\u60A8\u53EF\u4EE5\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4\u5C06\u7559\u8A00\u7C3F\u5E94\u7528\u7A0B\u5E8F\u90E8\u7F72\u5230\u7559\u8A00\u7C3F-qa\u73AF\u5883:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">K8S_GUESTBOOK_URL</span><span class="token operator">=</span>https://raw.githubusercontent.com/kubernetes/website/main/content/zh-cn/examples/application/guestbook/redis-leader-deployment.yaml
$ kubectl apply <span class="token parameter variable">-n</span> guestbook-qa <span class="token parameter variable">-f</span> <span class="token variable">\${K8S_GUESTBOOK_URL}</span>/redis-master-deployment.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u8BE2 Pod \u5217\u8868\u4EE5\u9A8C\u8BC1 Redis Pod \u662F\u5426\u6B63\u5728\u8FD0\u884C\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl get pods <span class="token parameter variable">-n</span> guestbook-qa
NAME                            READY   STATUS    RESTARTS   AGE
redis-leader-5596fc7b68-wxjvp   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          77s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u884C\u4EE5\u4E0B\u547D\u4EE4\u67E5\u770B Redis Deployment \u4E2D\u7684\u65E5\u5FD7\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl logs <span class="token parameter variable">-f</span> deployment/redis-leader <span class="token parameter variable">-n</span> guestbook-qa 
<span class="token number">1</span>:C <span class="token number">26</span> Nov <span class="token number">2023</span> 05:57:07.309 <span class="token comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
<span class="token number">1</span>:C <span class="token number">26</span> Nov <span class="token number">2023</span> 05:57:07.309 <span class="token comment"># Redis version=6.0.5, bits=64, commit=00000000, modified=0, pid=1, just started</span>
<span class="token number">1</span>:C <span class="token number">26</span> Nov <span class="token number">2023</span> 05:57:07.309 <span class="token comment"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
<span class="token number">1</span>:M <span class="token number">26</span> Nov <span class="token number">2023</span> 05:57:07.311 * Running <span class="token assign-left variable">mode</span><span class="token operator">=</span>standalone, <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>.
<span class="token number">1</span>:M <span class="token number">26</span> Nov <span class="token number">2023</span> 05:57:07.311 <span class="token comment"># Server initialized</span>
<span class="token number">1</span>:M <span class="token number">26</span> Nov <span class="token number">2023</span> 05:57:07.311 <span class="token comment"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span>
<span class="token number">1</span>:M <span class="token number">26</span> Nov <span class="token number">2023</span> 05:57:07.311 * Ready to accept connections
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u521B\u5EFA-redis-\u9886\u5BFC\u8005\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA-redis-\u9886\u5BFC\u8005\u670D\u52A1" aria-hidden="true">#</a> \u521B\u5EFA Redis \u9886\u5BFC\u8005\u670D\u52A1</h3>`,78),x=s("\u7559\u8A00\u677F\u5E94\u7528\u9700\u8981\u5F80 Redis \u4E2D\u5199\u6570\u636E\u3002\u56E0\u6B64\uFF0C\u9700\u8981\u521B\u5EFA "),R={href:"https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/",target:"_blank",rel:"noopener noreferrer"},O=s("Service"),C=s(" \u6765\u8F6C\u53D1 Redis Pod \u7684\u6D41\u91CF\u3002Service \u5B9A\u4E49\u4E86\u8BBF\u95EE Pod \u7684\u7B56\u7565\u3002"),G=s("\u7559\u8A00\u677F\u5E94\u7528\u9700\u8981\u5F80 Redis \u4E2D\u5199\u6570\u636E\u3002\u56E0\u6B64\uFF0C\u9700\u8981\u521B\u5EFA "),I={href:"https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/",target:"_blank",rel:"noopener noreferrer"},S=s("Service"),D=s(" \u6765\u8F6C\u53D1 Redis Pod \u7684\u6D41\u91CF\u3002Service \u5B9A\u4E49\u4E86\u8BBF\u95EE Pod \u7684\u7B56\u7565\u3002"),P={href:"https://raw.githubusercontent.com/kubernetes/website/main/content/zh-cn/examples/application/guestbook/redis-leader-service.yaml",target:"_blank",rel:"noopener noreferrer"},K=n("code",null,"application/guestbook/redis-leader-service.yaml",-1),_=t(`<div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># \u6765\u6E90\uFF1Ahttps://cloud.google.com/kubernetes-engine/docs/tutorials/guestbook</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>leader
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">role</span><span class="token punctuation">:</span> leader
    <span class="token key atrule">tier</span><span class="token punctuation">:</span> backend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">6379</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">role</span><span class="token punctuation">:</span> leader
    <span class="token key atrule">tier</span><span class="token punctuation">:</span> backend
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>\u4F7F\u7528\u4E0B\u9762\u7684 <code>redis-leader-service.yaml</code> \u6587\u4EF6\u521B\u5EFA Redis \u7684\u670D\u52A1\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl apply <span class="token parameter variable">-f</span> ./guestbook/redis-leader-service.yaml  <span class="token parameter variable">-n</span> guestbook-qa
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u67E5\u8BE2\u670D\u52A1\u5217\u8868\u9A8C\u8BC1 Redis \u670D\u52A1\u662F\u5426\u6B63\u5728\u8FD0\u884C\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl get <span class="token parameter variable">-n</span> guestbook-qa <span class="token function">service</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u54CD\u5E94\u5E94\u8BE5\u4E0E\u6B64\u7C7B\u4F3C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>NAME           TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)    AGE
redis-leader   ClusterIP   10.68.10.77   &lt;none&gt;        6379/TCP   3s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p><strong>\u8BF4\u660E\uFF1A</strong></p><p>\u8FD9\u4E2A\u6E05\u5355\u6587\u4EF6\u521B\u5EFA\u4E86\u4E00\u4E2A\u540D\u4E3A <code>redis-leader</code> \u7684 Service\uFF0C \u5176\u4E2D\u5305\u542B\u4E00\u7EC4\u4E0E\u524D\u9762\u5B9A\u4E49\u7684\u6807\u7B7E\u5339\u914D\u7684\u6807\u7B7E\uFF0C\u56E0\u6B64\u670D\u52A1\u5C06\u7F51\u7EDC\u6D41\u91CF\u8DEF\u7531\u5230 Redis Pod \u4E0A\u3002</p><h3 id="\u8BBE\u7F6E-redis-\u8DDF\u968F\u8005" tabindex="-1"><a class="header-anchor" href="#\u8BBE\u7F6E-redis-\u8DDF\u968F\u8005" aria-hidden="true">#</a> \u8BBE\u7F6E Redis \u8DDF\u968F\u8005</h3><p>\u5C3D\u7BA1 Redis \u9886\u5BFC\u8005\u53EA\u6709\u4E00\u4E2A Pod\uFF0C\u4F60\u53EF\u4EE5\u901A\u8FC7\u6DFB\u52A0\u82E5\u5E72 Redis \u8DDF\u968F\u8005\u6765\u5C06\u5176\u914D\u7F6E\u4E3A\u9AD8\u53EF\u7528\u72B6\u6001\uFF0C \u4EE5\u6EE1\u8DB3\u6D41\u91CF\u9700\u6C42\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># \u6765\u6E90\uFF1Ahttps://cloud.google.com/kubernetes-engine/docs/tutorials/guestbook</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>follower
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">role</span><span class="token punctuation">:</span> follower
    <span class="token key atrule">tier</span><span class="token punctuation">:</span> backend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> redis
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> redis
        <span class="token key atrule">role</span><span class="token punctuation">:</span> follower
        <span class="token key atrule">tier</span><span class="token punctuation">:</span> backend
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> follower
        <span class="token key atrule">image</span><span class="token punctuation">:</span> gcr.io/google_samples/gb<span class="token punctuation">-</span>redis<span class="token punctuation">-</span>follower<span class="token punctuation">:</span>v2
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> 100Mi
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">6379</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>\u5E94\u7528\u4E0B\u9762\u7684 <code>redis-follower-deployment.yaml</code> \u6587\u4EF6\u521B\u5EFA Redis Deployment\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl apply <span class="token parameter variable">-f</span> ./guestbook/redis-follower-deployment.yaml <span class="token parameter variable">-n</span> guestbook-qa
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u901A\u8FC7\u67E5\u8BE2 Pods \u5217\u8868\uFF0C\u9A8C\u8BC1\u4E24\u4E2A Redis \u8DDF\u968F\u8005\u526F\u672C\u5728\u8FD0\u884C\uFF1A</p></li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl get  <span class="token parameter variable">-n</span> guestbook-qa pods
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u63A5\u4E0B\u6765\u540C\u6837\u4E5F\u662F\u6D4B\u8BD5 guestbook-qa \u7684\u73AF\u5883\u662F\u5426\u662F\u7B26\u5408\u6211\u4EEC\u7684\u9884\u671F\u3002</p><p>\u7136\u540E\u540C\u6837\u662F\u5427 guestbook-qa \u664B\u7EA7\u5230 guestbook-e2e \u73AF\u5883\uFF0C</p><p>\u7136\u540E\u540C\u6837\u7684\u6D4B\u8BD5 guestbook-e2e \u73AF\u5883\u662F\u5426\u6B63\u5E38\u5DE5\u4F5C\u3002</p><h3 id="\u7F51\u7EDC\u9694\u79BB" tabindex="-1"><a class="header-anchor" href="#\u7F51\u7EDC\u9694\u79BB" aria-hidden="true">#</a> \u7F51\u7EDC\u9694\u79BB</h3><p>\u5B9A\u4E49\u90E8\u7F72\u5E94\u7528\u7A0B\u5E8F\u7684\u73AF\u5883\u7684\u4E00\u4E2A\u5173\u952E\u65B9\u9762\u662F\u786E\u4FDD\u53EA\u6709\u76EE\u6807\u5BA2\u6237\u7AEF\u53EF\u4EE5\u8BBF\u95EE\u7279\u5B9A\u7684\u73AF\u5883\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u6240\u6709\u547D\u540D\u7A7A\u95F4\u90FD\u53EF\u4EE5\u8FDE\u63A5\u5230\u5728\u6240\u6709\u5176\u4ED6\u547D\u540D\u7A7A\u95F4\u4E2D\u8FD0\u884C\u7684\u670D\u52A1\u3002\u4F46\u662F\u5BF9\u4E8E\u4E24\u4E2A\u4E0D\u540C\u7684\u73AF\u5883\uFF0C\u6BD4\u5982QA\u548CProd\uFF0C\u60A8\u4E0D\u5E0C\u671B\u8FD9\u4E9B\u73AF\u5883\u4E4B\u95F4\u53D1\u751F\u4E32\u6270\u3002\u5E78\u8FD0\u7684\u662F\uFF0C\u53EF\u4EE5\u5E94\u7528\u547D\u540D\u7A7A\u95F4\u7F51\u7EDC\u7B56\u7565\u6765\u9650\u5236\u547D\u540D\u7A7A\u95F4\u4E4B\u95F4\u7684\u7F51\u7EDC\u901A\u4FE1\u3002\u8BA9\u6211\u4EEC\u770B\u770B\u5982\u4F55\u5C06\u5E94\u7528\u7A0B\u5E8F\u90E8\u7F72\u5230\u4E24\u4E2A\u4E0D\u540C\u7684\u540D\u79F0\u7A7A\u95F4\uFF0C\u5E76\u4F7F\u7528\u7F51\u7EDC\u7B56\u7565\u63A7\u5236\u8BBF\u95EE\u3002\u6211\u4EEC\u5C06\u4ECB\u7ECD\u5728\u4E24\u4E2A\u4E0D\u540C\u7684\u547D\u540D\u7A7A\u95F4\u4E2D\u90E8\u7F72\u670D\u52A1\u7684\u6B65\u9AA4\u3002\u60A8\u8FD8\u5C06\u4FEE\u6539\u7F51\u7EDC\u7B56\u7565\u5E76\u89C2\u5BDF\u5176\u6548\u679C\u3002</p><blockquote><p>Egress traffic is network traffic that begins inside a network and pro-EGRESSceeds through its routers to a destination somewhere outside the network.</p></blockquote><p>\u51FA\u53E3\u6D41\u91CF\u662F\u4ECE\u7F51\u7EDC\u5185\u90E8\u5F00\u59CB\uFF0C\u7ECF\u8FC7\u8DEF\u7531\u5668\u5230\u8FBE\u7F51\u7EDC\u5916\u90E8\u67D0\u4E2A\u76EE\u7684\u5730\u7684\u7F51\u7EDC\u6D41\u91CF\u3002</p><blockquote><p>Ingress traffic is composed of all the data communications and net-INGRESSwork traffic originating from external networks.</p></blockquote><p>\u5165\u53E3\u6D41\u91CF\u7531\u6765\u81EA\u5916\u90E8\u7F51\u7EDC\u7684\u6240\u6709\u6570\u636E\u901A\u4FE1\u548C\u7F51\u7EDC-INGRESS\u5DE5\u4F5C\u6D41\u91CF\u7EC4\u6210\u3002</p><blockquote><p>Before you begin, verify thatVERIFY KUBERNETES CLUSTER CONNECTIONyou have correctly configured your KUBECONFIG environment variable topoint to the desired Kubernetes cluster. Please refer to appendix A for more information.</p></blockquote><p>\u5F00\u59CB\u4E4B\u524D\uFF0C\u8BF7\u9A8C\u8BC1\u60A8\u662F\u5426\u5DF2\u6B63\u786E\u914D\u7F6EKUBERNETES CLUSTER CONNECTION\u73AF\u5883\u53D8\u91CF\u4EE5\u6307\u5411\u6240\u9700\u7684Kubernetes\u7FA4\u96C6\u3002\u8BE6\u60C5\u8BF7\u53C2\u9605\u9644\u5F55A\u3002</p><p>\u5E76\u4E14\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u5728\u4E00\u4E2A\u547D\u540D\u7A7A\u95F4\u4E2D\u8FD0\u884C\u7684 Pod \u53EF\u4EE5\u5F80\u4E0D\u540C\u7684\u547D\u540D\u7A7A\u95F4\u4E2D\u8FD0\u884C\u7684\u5176\u4ED6 Pod \u53D1\u9001\u7F51\u7EDC\u6D41\u91CF\uFF0C\u6211\u4EEC\u4E0B\u9762\u901A\u8FC7\u4ECE qa \u547D\u540D\u7A7A\u95F4\u7684 Pod \u5230 prod \u547D\u540D\u7A7A\u95F4\u7684 Nginx pod \u6267\u884C\u4E00\u6761 url \u547D\u4EE4\u6765\u8BC1\u660E\u8FD9\u4E00\u70B9\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl describe pod web <span class="token parameter variable">-n</span> prod <span class="token operator">|</span> <span class="token function">grep</span> IPz
$ kubectl <span class="token parameter variable">-n</span> qa <span class="token builtin class-name">exec</span> curl-pod -- <span class="token function">curl</span> <span class="token parameter variable">-I</span> http://<span class="token operator">&lt;</span>web pod ip<span class="token operator">&gt;</span>
$ kubectl <span class="token parameter variable">-n</span> prod <span class="token builtin class-name">exec</span> curl-pod -- <span class="token function">curl</span> <span class="token parameter variable">-I</span> http://<span class="token operator">&lt;</span>web pod ip<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u901A\u5E38\uFF0C\u60A8\u6C38\u8FDC\u4E0D\u5E0C\u671Bqa\u548Cprod\u73AF\u5883\u4E4B\u95F4\u5B58\u5728\u76F8\u4E92\u4F9D\u8D56\u6027\u3002\u5982\u679C\u5E94\u7528\u7A0B\u5E8F\u7684\u4E24\u4E2A\u5B9E\u4F8B\u90FD\u88AB\u6B63\u786E\u914D\u7F6E\uFF0C\u90A3\u4E48qa\u548Cprod\u4E4B\u95F4\u5C31\u4E0D\u4F1A\u6709\u4F9D\u8D56\u5173\u7CFB\uFF0C\u4F46\u662F\u5982\u679Cqa\u7684\u914D\u7F6E\u4E2D\u6709\u4E00\u4E2Abug\uFF0C\u5B83\u610F\u5916\u5730\u5411prod\u53D1\u9001\u4E86\u6D41\u91CF\uFF0C\u90A3\u8BE5\u600E\u4E48\u529E\u5462\uFF1F\u60A8\u53EF\u80FD\u4F1A\u635F\u574F\u751F\u4EA7\u6570\u636E\u3002\u751A\u81F3\u5728\u751F\u4EA7\u73AF\u5883\u4E2D\uFF0C\u5982\u679C\u4E00\u4E2A\u73AF\u5883\u627F\u8F7D\u60A8\u7684\u8425\u9500\u7AD9\u70B9\uFF0C\u800C\u53E6\u4E00\u4E2A\u73AF\u5883\u627F\u8F7D\u5305\u542B\u654F\u611F\u6570\u636E\u7684HR\u5E94\u7528\u7A0B\u5E8F\uFF0C\u8BE5\u600E\u4E48\u529E\uFF1F\u5728\u8FD9\u4E9B\u60C5\u51B5\u4E0B\uFF0C\u963B\u6B62\u540D\u79F0\u7A7A\u95F4\u4E4B\u95F4\u7684\u7F51\u7EDC\u6D41\u91CF\u6216\u8005\u53EA\u5141\u8BB8\u7279\u5B9A\u540D\u79F0\u7A7A\u95F4\u4E4B\u95F4\u7684\u6D41\u91CF\u53EF\u80FD\u662F\u5408\u9002\u7684\u3002\u8FD9\u53EF\u4EE5\u901A\u8FC7\u5411\u540D\u79F0\u7A7A\u95F4\u6DFB\u52A0\u7F51\u7EDC\u7B56\u7565\u6765\u5B8C\u6210\u3002\u8BA9\u6211\u4EEC\u5728\u6BCF\u4E2A\u540D\u79F0\u7A7A\u95F4\u4E2D\u4E3A\u6211\u4EEC\u7684Pods\u6DFB\u52A0\u4E00\u4E2A\u7F51\u7EDC\u7B56\u7565:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl apply <span class="token parameter variable">-f</span> block-other-namespace.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="git-\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#git-\u7B56\u7565" aria-hidden="true">#</a> Git \u7B56\u7565</h3><p>GitOps \u4E2D\u9488\u5BF9 Git \u7684\u4E09\u79CD\u60C5\u51B5\uFF0C\u5206\u522B\u662F\u5355\u5206\u652F\uFF08\u591A\u76EE\u5F55\uFF09\uFF0C\u591A\u5206\u652F\uFF0C\u591A\u4EE3\u7801\u5E93\u4E0E\u5355\u4E00\u4EE3\u7801\u5E93</p><ol><li><strong>\u5355\u5206\u652F\uFF08\u591A\u76EE\u5F55\uFF09\u7B56\u7565</strong>\uFF1A\u8FD9\u79CD\u7B56\u7565\u4F7F\u7528\u5355\u4E00\u7684Git\u5206\u652F\u6765\u7BA1\u7406\u6240\u6709\u7684\u914D\u7F6E\u6587\u4EF6\uFF0C\u4F46\u5C06\u4E0D\u540C\u7684\u73AF\u5883\uFF08\u5982\u5F00\u53D1\u3001\u6D4B\u8BD5\u548C\u751F\u4EA7\uFF09\u7684\u914D\u7F6E\u653E\u7F6E\u5728\u4E0D\u540C\u7684\u76EE\u5F55\u4E2D\u3002\u8FD9\u79CD\u65B9\u6CD5\u7684\u4F18\u70B9\u662F\u7B80\u5355\u6613\u7BA1\u7406\uFF0C\u56E0\u4E3A\u6240\u6709\u73AF\u5883\u7684\u914D\u7F6E\u90FD\u5728\u4E00\u4E2A\u5730\u65B9\u3002\u4F46\u7F3A\u70B9\u662F\u53EF\u80FD\u4F1A\u56E0\u4E3A\u914D\u7F6E\u7684\u7D27\u5BC6\u8026\u5408\u800C\u5BFC\u81F4\u95EE\u9898\u7684\u4F20\u64AD\uFF0C\u4F8B\u5982\uFF0C\u9519\u8BEF\u7684\u914D\u7F6E\u53EF\u80FD\u4F1A\u5F71\u54CD\u5230\u591A\u4E2A\u73AF\u5883\u3002</li><li><strong>\u591A\u5206\u652F\u7B56\u7565</strong>\uFF1A\u5728\u8FD9\u79CD\u7B56\u7565\u4E2D\uFF0C\u4E3A\u4E0D\u540C\u7684\u73AF\u5883\uFF08\u5982\u5F00\u53D1\u3001\u6D4B\u8BD5\u548C\u751F\u4EA7\uFF09\u521B\u5EFA\u4E0D\u540C\u7684Git\u5206\u652F\u3002\u8FD9\u6837\u505A\u7684\u4F18\u70B9\u662F\u53EF\u4EE5\u66F4\u597D\u5730\u9694\u79BB\u4E0D\u540C\u73AF\u5883\u7684\u914D\u7F6E\uFF0C\u51CF\u5C11\u9519\u8BEF\u914D\u7F6E\u5BF9\u5176\u4ED6\u73AF\u5883\u7684\u5F71\u54CD\u3002\u7F3A\u70B9\u662F\u9700\u8981\u66F4\u591A\u7684\u5206\u652F\u7BA1\u7406\u5DE5\u4F5C\uFF0C\u5E76\u4E14\u5728\u5206\u652F\u4E4B\u95F4\u540C\u6B65\u66F4\u6539\u53EF\u80FD\u4F1A\u53D8\u5F97\u590D\u6742\u3002</li><li><strong>\u591A\u4EE3\u7801\u5E93\u4E0E\u5355\u4E00\u4EE3\u7801\u5E93</strong>\uFF1A\u8FD9\u91CC\u7684\u533A\u522B\u5728\u4E8E\u662F\u5C06\u6240\u6709\u7684\u914D\u7F6E\u96C6\u4E2D\u5B58\u50A8\u5728\u4E00\u4E2A\u4EE3\u7801\u5E93\u4E2D\uFF0C\u8FD8\u662F\u5C06\u5B83\u4EEC\u5206\u6563\u5728\u591A\u4E2A\u4EE3\u7801\u5E93\u4E2D\u3002\u5355\u4E00\u4EE3\u7801\u5E93\u7684\u4F18\u70B9\u662F\u96C6\u4E2D\u7BA1\u7406\u548C\u4E00\u81F4\u6027\uFF0C\u800C\u591A\u4EE3\u7801\u5E93\u7684\u4F18\u70B9\u5219\u662F\u63D0\u4F9B\u4E86\u66F4\u9AD8\u7684\u7075\u6D3B\u6027\u548C\u53EF\u7EF4\u62A4\u6027\uFF0C\u5C24\u5176\u662F\u5728\u5927\u578B\u6216\u590D\u6742\u7684\u9879\u76EE\u4E2D\u3002</li></ol><p>\u6BCF\u79CD\u7B56\u7565\u90FD\u6709\u5176\u4F18\u70B9\u548C\u7F3A\u70B9\uFF0C\u9009\u62E9\u54EA\u4E00\u79CD\u53D6\u51B3\u4E8E\u7EC4\u7EC7\u7684\u9700\u6C42\u3001\u56E2\u961F\u7684\u5927\u5C0F\u3001\u9879\u76EE\u7684\u590D\u6742\u6027\u4EE5\u53CA\u5BF9\u98CE\u9669\u7BA1\u7406\u7684\u6001\u5EA6\u3002\u901A\u5E38\uFF0C\u8FD9\u4E9B\u7B56\u7565\u53EF\u80FD\u4F1A\u7ED3\u5408\u4F7F\u7528\uFF0C\u4EE5\u9002\u5E94\u4E0D\u540C\u7684\u9879\u76EE\u548C\u7EC4\u7EC7\u7ED3\u6784\u3002</p><h3 id="\u914D\u7F6E\u7BA1\u7406" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u7BA1\u7406" aria-hidden="true">#</a> \u914D\u7F6E\u7BA1\u7406</h3><p>\u73AF\u5883\u7684\u914D\u7F6E\u7BA1\u7406\u53EF\u4EE5\u5230\u6BCF\u4E00\u4E2A\u73AF\u5883\u4E2D\u521B\u5EFA\u4E00\u4E2A\u76EE\u5F55\uFF0C\u5176\u4E2D\u5305\u542B\u6240\u6709\u7684\u5E94\u8BE5\u90E8\u7F72\u7684\u8D44\u6E90\u7684 YAML \u6E05\u5355\uFF0C\u8FD9\u4E9B YAML \u6E05\u5355\u4E2D\u6240\u6709\u503C\u90FD\u53EF\u4EE5\u786C\u7F16\u7801\u4E3A\u8BE5\u73AF\u5883\u6240\u9700\u7684\u7279\u5B9A\u503C\u3002</p><p>\u9700\u8981\u8FDB\u884C\u90E8\u7F72\uFF0C\u90A3\u4E48\u8FD0\u884C\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl apply <span class="token operator">&lt;</span>directory<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4E00\u4E2A SaaS \u7684\u5E94\u7528\u7A0B\u5E8F\u5F00\u53D1\u8005\u5C06\u5176\u5B9A\u5236\u7684\u5E94\u7528\u7A0B\u5E8F\u90E8\u7F72\u5230\u4E00\u4E2A\u6216\u8005\u591A\u4E2A\u73AF\u5883\uFF08dev, test)</p><p>\u8FD9\u4E9B\u73AF\u5883\u53EF\u80FD\u5206\u5E03\u5728\u4E0D\u540C\u7684\u8D26\u6237\uFF0C\u96C6\u7FA4\u6216\u8005\u547D\u540D\u7A7A\u95F4\u3002\u5B83\u4EEC\u4E4B\u95F4\u6709\u7EC6\u5FAE\u7684\u533A\u522B\uFF0C\u56E0\u6B64\u914D\u7F6E\u91CD\u7528\u662F\u6700\u91CD\u8981\u7684\u3002</p><h3 id="helm" tabindex="-1"><a class="header-anchor" href="#helm" aria-hidden="true">#</a> helm</h3><p>helm \u4F5C\u4E3A\u51FA\u573A\u7684\u7B2C\u4E00\u4E2A\u914D\u7F6E\u5DE5\u5177\uFF0C\u662F Kubernetes \u751F\u6001\u4E2D\u4E0D\u53EF\u6216\u7F3A\u7684\u4E00\u90E8\u5206\u3002</p><p>\u4EE5\u4E0B\u662FHelm\u7684\u4E3B\u8981\u7279\u70B9\u548C\u5B83\u5728Kubernetes\u751F\u6001\u4E2D\u7684\u4F5C\u7528\uFF1A</p><ol><li><strong>\u5E94\u7528\u7A0B\u5E8F\u5305\u7BA1\u7406</strong>\uFF1AHelm\u53EF\u4EE5\u88AB\u770B\u4F5C\u662FKubernetes\u7684\u5305\u7BA1\u7406\u5668\u3002\u5B83\u5141\u8BB8\u5F00\u53D1\u8005\u548C\u8FD0\u7EF4\u4EBA\u5458\u5C06\u5E94\u7528\u7A0B\u5E8F\u53CA\u5176\u4F9D\u8D56\u9879\u6253\u5305\u6210\u4E00\u4E2A\u79F0\u4E3A&quot;chart&quot;\u7684\u5355\u5143\u3002\u8FD9\u4E9Bchart\u662F\u9884\u914D\u7F6E\u7684Kubernetes\u8D44\u6E90\u96C6\u5408\uFF0C\u53EF\u4EE5\u5728Kubernetes\u96C6\u7FA4\u4E0A\u8F7B\u677E\u90E8\u7F72\u548C\u7BA1\u7406\u3002</li><li><strong>\u7B80\u5316\u590D\u6742\u90E8\u7F72</strong>\uFF1AHelm\u4F7F\u5F97\u90E8\u7F72\u590D\u6742\u7684\u5E94\u7528\u7A0B\u5E8F\u53D8\u5F97\u7B80\u5355\u3002\u5B83\u53EF\u4EE5\u7BA1\u7406\u590D\u6742\u7684\u4F9D\u8D56\u5173\u7CFB\uFF0C\u5E76\u786E\u4FDD\u6240\u6709Kubernetes\u7EC4\u4EF6\u4EE5\u6B63\u786E\u7684\u987A\u5E8F\u548C\u914D\u7F6E\u90E8\u7F72\u3002\u8FD9\u5BF9\u4E8E\u90A3\u4E9B\u9700\u8981\u591A\u4E2A\u670D\u52A1\u548C\u914D\u7F6E\u7684\u5927\u578B\u5E94\u7528\u7A0B\u5E8F\u6765\u8BF4\u5C24\u5176\u91CD\u8981\u3002</li><li><strong>\u6613\u4E8E\u7248\u672C\u63A7\u5236\u548C\u56DE\u6EDA</strong>\uFF1AHelm charts\u6613\u4E8E\u7248\u672C\u63A7\u5236\uFF0C\u8FD9\u610F\u5473\u7740\u4F60\u53EF\u4EE5\u8FFD\u8E2A\u5230\u6BCF\u6B21\u90E8\u7F72\u7684\u53D8\u5316\uFF0C\u5E76\u5728\u9700\u8981\u65F6\u8F7B\u677E\u5730\u56DE\u6EDA\u5230\u65E7\u7248\u672C\u3002</li><li><strong>\u5171\u4EAB\u548C\u91CD\u7528</strong>\uFF1A\u901A\u8FC7Helm\u4ED3\u5E93\uFF0C\u7528\u6237\u53EF\u4EE5\u5171\u4EAB\u4ED6\u4EEC\u7684charts\uFF0C\u4F7F\u5F97\u91CD\u7528\u914D\u7F6E\u53D8\u5F97\u7B80\u5355\u3002\u8FD9\u4FC3\u8FDB\u4E86\u6700\u4F73\u5B9E\u8DF5\u7684\u5171\u4EAB\u548C\u793E\u533A\u534F\u4F5C\u3002</li><li><strong>\u914D\u7F6E\u7075\u6D3B\u6027</strong>\uFF1AHelm\u5141\u8BB8\u7528\u6237\u81EA\u5B9A\u4E49chart\u7684\u914D\u7F6E\uFF0C\u4EE5\u9002\u5E94\u4E0D\u540C\u7684\u73AF\u5883\u548C\u9700\u6C42\u3002\u8FD9\u79CD\u7075\u6D3B\u6027\u662F\u901A\u8FC7\u4F7F\u7528\u6A21\u677F\u548C\u914D\u7F6E\u6587\u4EF6\u5B9E\u73B0\u7684\uFF0C\u8FD9\u4E9B\u6587\u4EF6\u53EF\u4EE5\u5728\u90E8\u7F72\u65F6\u4FEE\u6539\u3002</li><li><strong>\u96C6\u6210\u548C\u6269\u5C55\u6027</strong>\uFF1AHelm\u53EF\u4EE5\u4E0E\u5176\u4ED6Kubernetes\u5DE5\u5177\u548C\u63D2\u4EF6\u65E0\u7F1D\u96C6\u6210\uFF0C\u589E\u52A0\u4E86\u5B83\u7684\u6269\u5C55\u6027\u3002\u8FD9\u4F7F\u5F97\u5B83\u53EF\u4EE5\u9002\u5E94\u5404\u79CD\u4E0D\u540C\u7684\u90E8\u7F72\u9700\u6C42\u548C\u73AF\u5883\u3002</li></ol><h3 id="jsonnet" tabindex="-1"><a class="header-anchor" href="#jsonnet" aria-hidden="true">#</a> Jsonnet</h3><p>Jsonnet\uFF0C\u4F5C\u4E3A\u4E00\u79CD\u7F16\u7A0B\u8BED\u8A00\uFF0C\u4E3B\u8981\u88AB\u8BBE\u8BA1\u6765\u589E\u5F3A\u548C\u7B80\u5316JSON\u6570\u636E\u7684\u58F0\u660E\u548C\u5904\u7406\u3002\u867D\u7136\u5B83\u5E76\u975E\u4E13\u95E8\u4E3AKubernetes\u8BBE\u8BA1\uFF0C\u4F46\u5728Kubernetes\u793E\u533A\u4E2D\u786E\u5B9E\u83B7\u5F97\u4E86\u5E7F\u6CDB\u7684\u5E94\u7528\u548C\u666E\u53CA\u3002\u4EE5\u4E0B\u662FJsonnet\u7684\u5173\u952E\u7279\u6027\u548C\u5B83\u5728\u6570\u636E\u5904\u7406\u4E2D\u7684\u4F5C\u7528\uFF1A</p><ol><li><strong>\u589E\u5F3A\u7684JSON</strong>\uFF1AJsonnet\u53EF\u4EE5\u88AB\u770B\u4F5C\u662FJSON\u7684\u4E00\u4E2A\u8D85\u96C6\uFF0C\u5B83\u5728JSON\u7684\u57FA\u7840\u4E0A\u6DFB\u52A0\u4E86\u53D8\u91CF\u3001\u6761\u4EF6\u8868\u8FBE\u5F0F\u3001\u51FD\u6570\u3001\u7B97\u672F\u8FD0\u7B97\u548C\u5176\u4ED6\u7F16\u7A0B\u8BED\u8A00\u7684\u7279\u6027\u3002\u8FD9\u4E9B\u6269\u5C55\u4F7F\u5F97Jsonnet\u975E\u5E38\u9002\u5408\u5904\u7406\u590D\u6742\u7684\u6570\u636E\u63CF\u8FF0\u548C\u914D\u7F6E\u6587\u4EF6\u3002</li><li><strong>\u6A21\u677F\u548C\u62BD\u8C61</strong>\uFF1AJsonnet\u652F\u6301\u9AD8\u7EA7\u522B\u7684\u62BD\u8C61\u548C\u6A21\u677F\u5316\uFF0C\u8FD9\u5BF9\u4E8E\u7BA1\u7406\u5927\u91CF\u7684\u3001\u7ED3\u6784\u76F8\u4F3C\u7684\u6570\u636E\u7279\u522B\u6709\u7528\u3002\u7528\u6237\u53EF\u4EE5\u5B9A\u4E49\u901A\u7528\u7684\u6A21\u5F0F\u548C\u7ED3\u6784\uFF0C\u7136\u540E\u5728\u4E0D\u540C\u7684\u4E0A\u4E0B\u6587\u4E2D\u91CD\u590D\u4F7F\u7528\u5B83\u4EEC\uFF0C\u51CF\u5C11\u91CD\u590D\u548C\u9519\u8BEF\u3002</li><li><strong>\u7075\u6D3B\u6027\u548C\u53EF\u7EF4\u62A4\u6027</strong>\uFF1A\u901A\u8FC7\u63D0\u4F9B\u53D8\u91CF\u548C\u51FD\u6570\uFF0CJsonnet\u4F7F\u5F97\u6570\u636E\u6587\u4EF6\u7684\u7EF4\u62A4\u53D8\u5F97\u66F4\u52A0\u7075\u6D3B\u548C\u6613\u4E8E\u7BA1\u7406\u3002\u8FD9\u5BF9\u4E8E\u9700\u8981\u9891\u7E41\u66F4\u65B0\u6216\u4FEE\u6539\u7684\u914D\u7F6E\u5C24\u5176\u91CD\u8981\u3002</li><li><strong>\u6E05\u6670\u7684\u903B\u8F91\u7ED3\u6784</strong>\uFF1AJsonnet\u7684\u7F16\u7A0B\u8BED\u8A00\u7279\u6027\u5141\u8BB8\u7528\u6237\u4EE5\u66F4\u6E05\u6670\u3001\u903B\u8F91\u5316\u7684\u65B9\u5F0F\u7F16\u5199\u548C\u7406\u89E3\u590D\u6742\u7684\u6570\u636E\u7ED3\u6784\uFF0C\u8FD9\u5BF9\u4E8E\u590D\u6742\u7684\u914D\u7F6E\u7BA1\u7406\u6765\u8BF4\u662F\u4E00\u4E2A\u5DE8\u5927\u7684\u4F18\u52BF\u3002</li><li><strong>\u5728Kubernetes\u4E2D\u7684\u5E94\u7528</strong>\uFF1A\u867D\u7136Jsonnet\u5E76\u975E\u4E13\u95E8\u4E3AKubernetes\u8BBE\u8BA1\uFF0C\u4F46\u5B83\u5728\u7BA1\u7406Kubernetes\u7684\u914D\u7F6E\u6587\u4EF6\u65B9\u9762\u663E\u793A\u51FA\u4E86\u5DE8\u5927\u7684\u6F5C\u529B\u3002\u5B83\u53EF\u4EE5\u751F\u6210\u590D\u6742\u7684Kubernetes\u8D44\u6E90\u5B9A\u4E49\uFF0C\u5982\u90E8\u7F72\u3001\u670D\u52A1\u548Cpod\u914D\u7F6E\uFF0C\u5E76\u652F\u6301\u9AD8\u7EA7\u7684\u914D\u7F6E\u6A21\u5F0F\u3002</li><li><strong>\u793E\u533A\u652F\u6301\u548C\u5DE5\u5177\u96C6\u6210</strong>\uFF1A\u7531\u4E8EJsonnet\u5728Kubernetes\u793E\u533A\u4E2D\u7684\u6D41\u884C\uFF0C\u8BB8\u591A\u5DE5\u5177\u548C\u5E93\u5DF2\u7ECF\u5F00\u53D1\u51FA\u6765\u652F\u6301Jsonnet\u6587\u4EF6\u7684\u751F\u6210\u548C\u7BA1\u7406\u3002\u8FD9\u8FDB\u4E00\u6B65\u589E\u5F3A\u4E86\u5B83\u5728\u73B0\u4EE3\u4E91\u539F\u751F\u67B6\u6784\u4E2D\u7684\u5E94\u7528\u3002</li></ol><h2 id="\u6D41\u6C34\u7EBF" tabindex="-1"><a class="header-anchor" href="#\u6D41\u6C34\u7EBF" aria-hidden="true">#</a> \u6D41\u6C34\u7EBF</h2><p>CICD \u6D41\u6C34\u7EBF\u4E2D\u7684\u9636\u6BB5</p><p>\u6301\u7EED\u96C6\u6210 \uFF08CI\uFF09\u662F\u4E00\u79CD\u8F6F\u4EF6\u5F00\u53D1\u7684\u5B9E\u8DF5\uFF0C\u5728\u8FD9\u79CD\u5B9E\u8DF5\u4E2D\uFF0C\u6240\u6709\u7684\u5F00\u53D1\u4EBA\u5458\u90FD\u4F1A\u5728\u4E00\u4E2A\u4E2D\u592E\u4ED3\u5E93\uFF08GIT\uFF09\u4E2D\u5408\u5E76\u53D8\u66F4\uFF0C\u901A\u8FC7 CI \uFF0C\u6BCF\u4E00\u6B21\u4EE3\u7801\u53D8\u66F4\uFF08\u63D0\u4EA4\uFF09\u90FD\u4F1A\u89E6\u53D1\u7ED9\u5B9A\u4ED3\u5E93\u7684\u81EA\u52A8\u6784\u5EFA\u548C\u6D4B\u8BD5\u9636\u6BB5\uFF0C\u5E76\u5411\u505A\u51FA\u53D8\u66F4\u7684\u5F00\u53D1\u8005\u63D0\u4F9B\u53CD\u9988\u3002\u4E0E\u4F20\u7EDF\u7684 CI \u76F8\u6BD4\uFF0CGitOps \u7684\u4E3B\u8981\u533A\u522B\u5728\u4E8E\uFF0C\u5728\u6784\u5EFA\u548C\u6D4B\u8BD5\u9636\u6BB5\u6210\u529F\u5B8C\u6210\u540E\uFF0CCI \u6D41\u6C34\u7EBF\u8FD8\u4F1A\u5728\u5E94\u7528\u7A0B\u5E8F\u6E05\u5355\u4E2D\u66F4\u65B0\u65B0\u7684\u955C\u50CF\u7248\u672C\u3002</p><p>\u6301\u7EED\u4EA4\u4ED8\uFF08CD\uFF09 \u662F\u5C06\u6574\u4E2A\u8F6F\u4EF6\u53D1\u5E03\u8FC7\u7A0B\u81EA\u52A8\u5316\u3002</p><p>\u4E0E\u4F20\u7EDF\u7684 CICD \u4E0D\u540C\uFF0C\u4F7F\u7528 GitOps Operator \u6765\u76D1\u63A7\u6E05\u5355\u7684\u53D8\u5316\u5E76\u534F\u8C03\u90E8\u7F72\uFF0C\u53EA\u8981 CI \u6784\u5EFA\u5B8C\u6210\uFF0C\u5E76\u4E14\u6E05\u5355\u66F4\u65B0\uFF0CGitOps Operator \u5C31\u4F1A</p><h3 id="\u6301\u7EED\u96C6\u6210" tabindex="-1"><a class="header-anchor" href="#\u6301\u7EED\u96C6\u6210" aria-hidden="true">#</a> \u6301\u7EED\u96C6\u6210</h3><p><strong>\u6B65\u9AA4\u5982\u4E0B\uFF1A</strong></p><p>\u6D41\u7A0B\u5C06\u4ECE\u201C\u62C9\u53D6\u8BF7\u6C42\u201D\u5F00\u59CB\uFF0C\u7ECF\u8FC7\u591A\u4E2A\u9636\u6BB5\uFF0C\u5982\u201C\u4EE3\u7801\u5BA1\u6838\u201D\u3001\u201C\u6F0F\u6D1E\u626B\u63CF\u201D\u3001\u201C\u4EE3\u7801\u5206\u6790\u201D\u3001\u201C\u6784\u5EFA\u201D\u3001\u201C\u5355\u5143\u6D4B\u8BD5\u201D\u3001\u201C\u4EE3\u7801\u8986\u76D6\u201D\u3001\u201CDocker\u6784\u5EFA\u201D\u3001\u201CDocker\u63A8\u9001\u201D\u3001\u201CGit\u514B\u9686\u914D\u7F6E\u4ED3\u5E93\u201D\u3001\u201C\u66F4\u65B0\u914D\u7F6E\u6E05\u5355\u201D\u3001\u201CGit\u63D0\u4EA4\u548C\u63A8\u9001\u201D\u3001\u201C\u53D1\u5E03CI\u6307\u6807\u201D\uFF0C\u6700\u540E\u5230\u8FBE\u201C\u6784\u5EFA\u901A\u77E5\u201D\u3002</p><p><img src="http://sm.nsddd.top/sm202311261925321.webp" alt="544991a1-6499-4de0-acef-bb43af85fdb3"></p><p>\u96C6\u6210 Go \u8BED\u8A00\u548C\u5176\u4ED6\u7684\u4E00\u4E9B\u5DE5\u5177\uFF1A</p><ol><li><strong>GitHub Actions \u96C6\u6210</strong>\uFF1A\u5728\u6D41\u7A0B\u56FE\u4E2D\u7684\u5404\u4E2A\u9636\u6BB5\uFF0C\u5982\u201C\u4EE3\u7801\u5BA1\u6838\u201D\u3001\u201C\u6F0F\u6D1E\u626B\u63CF\u201D\u3001\u201C\u4EE3\u7801\u5206\u6790\u201D\u7B49\uFF0C\u53EF\u4EE5\u901A\u8FC7 GitHub Actions \u81EA\u52A8\u5316\u6267\u884C\u3002\u8FD9\u610F\u5473\u7740\u6BCF\u4E2A\u6B65\u9AA4\u53EF\u4EE5\u88AB\u914D\u7F6E\u4E3A GitHub Actions \u7684\u4E00\u4E2A\u5DE5\u4F5C\u6D41\uFF0C\u4ECE\u800C\u5B9E\u73B0\u81EA\u52A8\u5316\u548C\u6D41\u7A0B\u63A7\u5236\u3002</li><li><strong>Go \u8BED\u8A00\u76F8\u5173\u5DE5\u5177</strong>\uFF1A <ul><li><strong>\u4EE3\u7801\u5BA1\u6838</strong>\uFF1A\u96C6\u6210\u5982 <code>golint</code> \u6216 <code>gometalinter</code> \u7684 Go \u8BED\u8A00\u4EE3\u7801\u5BA1\u67E5\u5DE5\u5177\u3002</li><li><strong>\u6F0F\u6D1E\u626B\u63CF</strong>\uFF1A\u4F7F\u7528\u9488\u5BF9 Go \u8BED\u8A00\u7684\u6F0F\u6D1E\u626B\u63CF\u5DE5\u5177\uFF0C\u5982 <code>gosec</code>\u3002</li><li><strong>\u4EE3\u7801\u5206\u6790</strong>\uFF1A\u5E94\u7528\u5982 <code>staticcheck</code> \u7684\u9759\u6001\u5206\u6790\u5DE5\u5177\u3002</li><li><strong>\u5355\u5143\u6D4B\u8BD5</strong>\uFF1A\u5229\u7528 Go \u81EA\u5E26\u7684\u6D4B\u8BD5\u6846\u67B6\u548C <code>go test</code> \u547D\u4EE4\u3002</li><li><strong>\u4EE3\u7801\u8986\u76D6</strong>\uFF1A\u4F7F\u7528 Go \u7684 <code>cover</code> \u5DE5\u5177\u6765\u68C0\u67E5\u6D4B\u8BD5\u8986\u76D6\u7387\u3002</li></ul></li><li><strong>Docker \u4E0E Go</strong>\uFF1A\u5728 Docker \u6784\u5EFA\u9636\u6BB5\uFF0C\u53EF\u4EE5\u4F7F\u7528\u9488\u5BF9 Go \u5E94\u7528\u7684 Dockerfile\uFF0C\u786E\u4FDD\u5E94\u7528\u88AB\u6B63\u786E\u6253\u5305\u3002</li><li><strong>\u914D\u7F6E\u7BA1\u7406</strong>\uFF1A\u5BF9\u4E8E\u201CGit \u514B\u9686\u914D\u7F6E\u4ED3\u5E93\u201D\u548C\u201C\u66F4\u65B0\u914D\u7F6E\u6E05\u5355\u201D\u9636\u6BB5\uFF0C\u53EF\u4EE5\u8003\u8651\u4F7F\u7528\u5982 <code>Viper</code> \u6216 <code>Consul</code> \u7B49 Go \u8BED\u8A00\u914D\u7F6E\u7BA1\u7406\u5DE5\u5177\uFF0C\u4EE5\u4FBF\u66F4\u597D\u5730\u7BA1\u7406\u548C\u7EF4\u62A4\u914D\u7F6E\u3002</li></ol><p><img src="http://sm.nsddd.top/sm202311261938086.png" alt="chatp"></p><h3 id="\u6301\u7EED\u4EA4\u4ED8" tabindex="-1"><a class="header-anchor" href="#\u6301\u7EED\u4EA4\u4ED8" aria-hidden="true">#</a> \u6301\u7EED\u4EA4\u4ED8</h3><p>\u6301\u7EED\u96C6\u6210\u540E\uFF0C\u5C31\u8FDB\u5165\u5230\u6301\u7EED\u4EA4\u4ED8\u7684\u73AF\u8282\u4E86\uFF0C</p><p>\u5EFA\u7ACB\u5728 GitOps CICD \u57FA\u7840\u4E0A\u7684\u5B8C\u6574\u7684 CD \u6D41\u6C34\u7EBF</p><ol><li><strong>Git \u514B\u9686\u914D\u7F6E\u4ED3\u5E93</strong>\uFF1A\u8FD9\u4E00\u6B65\u9AA4\u4FDD\u6301\u4E0D\u53D8\uFF0C\u4F5C\u4E3A\u914D\u7F6E\u7BA1\u7406\u7684\u4E00\u90E8\u5206\u3002</li><li><strong>\u53D1\u73B0\u6E05\u5355</strong>\uFF1A\u8FD9\u53EF\u80FD\u6D89\u53CA\u81EA\u52A8\u5316\u811A\u672C\u6216\u5DE5\u5177\uFF0C\u7528\u4E8E\u68C0\u6D4B\u548C\u6574\u7406\u5E94\u7528\u7684\u914D\u7F6E\u9879\u548C\u4F9D\u8D56\u3002</li><li><strong>kubectl apply</strong>\uFF1A\u5728 Kubernetes \u73AF\u5883\u4E2D\u5E94\u7528\u914D\u7F6E\u66F4\u6539\u6216\u90E8\u7F72\u65B0\u7684\u670D\u52A1\u3002</li><li><strong>\u529F\u80FD\u6D4B\u8BD5</strong>\uFF1A\u6267\u884C\u81EA\u52A8\u5316\u7684\u529F\u80FD\u6D4B\u8BD5\uFF0C\u4EE5\u9A8C\u8BC1\u5E94\u7528\u7684\u529F\u80FD\u548C\u6027\u80FD\u3002</li><li><strong>\u8FD0\u884C\u65F6\u6F0F\u6D1E\u626B\u63CF</strong>\uFF1A\u4F7F\u7528\u9002\u5408 Kubernetes \u73AF\u5883\u7684\u5DE5\u5177\u6765\u68C0\u6D4B\u8FD0\u884C\u65F6\u7684\u5B89\u5168\u6F0F\u6D1E\u3002</li><li><strong>\u53D1\u5E03 CD \u6307\u6807</strong>\uFF1A\u6536\u96C6\u548C\u53D1\u5E03\u90E8\u7F72\u76F8\u5173\u7684\u6307\u6807\uFF0C\u53EF\u80FD\u901A\u8FC7\u96C6\u6210\u7684\u76D1\u63A7\u5DE5\u5177\u6216\u5B9A\u5236\u811A\u672C\u5B9E\u73B0\u3002</li></ol><p><img src="http://sm.nsddd.top/sm202311261945127.webp" alt="50629a41-bded-4f36-abfe-b3dfadd7c9d3"></p><h3 id="\u63A8\u52A8\u664B\u7EA7\u5DE5\u4F5C" tabindex="-1"><a class="header-anchor" href="#\u63A8\u52A8\u664B\u7EA7\u5DE5\u4F5C" aria-hidden="true">#</a> \u63A8\u52A8\u664B\u7EA7\u5DE5\u4F5C</h3><p>\u6211\u4EEC\u77E5\u9053\uFF0CKubernetes \u6E05\u5355\u548C\u4EE3\u7801\u4E00\u822C\u4E0D\u653E\u5728\u540C\u4E00\u4E2A\u4ED3\u5E93\uFF0C\u8FD9\u6837\u53EF\u4EE5\u83B7\u53D6\u5230\u66F4\u7075\u6D3B\u7684\u90E8\u7F72\u9009\u62E9\uFF0C\u66F4\u597D\u7684\u8BBF\u95EE\u63A7\u5236\u548C\u5BA1\u8BA1\u80FD\u529B\u3002\u90A3\u4E48\u6211\u4EEC\u5E94\u8BE5\u5728\u54EA\u91CC\u7EF4\u62A4\u7279\u5B9A\u7684\u73AF\u5883\u4F9D\u8D56\u7684\u5E94\u7528\u914D\u7F6E\uFF0C\u5982\u6570\u636E\u5E93\u94FE\u63A5\u548C\u5206\u5E03\u5F0F\u7F13\u5B58\u3002</p><ol><li><strong>\u5355\u72EC\u7684\u914D\u7F6E\u4ED3\u5E93</strong>\uFF1A\u521B\u5EFA\u4E00\u4E2A\u72EC\u7ACB\u7684\u4ED3\u5E93\u6765\u5B58\u50A8\u73AF\u5883\u7279\u5B9A\u7684\u914D\u7F6E\u6587\u4EF6\u3002\u8FD9\u79CD\u65B9\u6CD5\u53EF\u4EE5\u63D0\u4F9B\u6E05\u6670\u7684\u5206\u79BB\uFF0C\u786E\u4FDD\u4EE3\u7801\u548C\u914D\u7F6E\u7684\u72EC\u7ACB\u7BA1\u7406\uFF0C\u540C\u65F6\u4FBF\u4E8E\u8FFD\u8E2A\u548C\u5BA1\u8BA1\u3002</li><li><strong>\u914D\u7F6E\u7BA1\u7406\u5DE5\u5177</strong>\uFF1A\u4F7F\u7528\u914D\u7F6E\u7BA1\u7406\u5DE5\u5177\uFF0C\u5982 Helm\u3001Kustomize \u6216 Terraform\uFF0C\u6765\u7BA1\u7406\u548C\u5E94\u7528\u4E0D\u540C\u73AF\u5883\u7684\u914D\u7F6E\u3002\u8FD9\u4E9B\u5DE5\u5177\u53EF\u4EE5\u5E2E\u52A9\u4F60\u6839\u636E\u73AF\u5883\u5DEE\u5F02\uFF08\u5982\u5F00\u53D1\u3001\u6D4B\u8BD5\u3001\u751F\u4EA7\uFF09\u8C03\u6574\u914D\u7F6E\u3002</li><li><strong>\u79D8\u5BC6\u7BA1\u7406</strong>\uFF1A\u5BF9\u4E8E\u654F\u611F\u4FE1\u606F\uFF08\u5982\u6570\u636E\u5E93\u5BC6\u7801\u548C\u8BBF\u95EE\u5BC6\u94A5\uFF09\uFF0C\u4F7F\u7528 Kubernetes \u7684\u79D8\u5BC6\uFF08Secrets\uFF09\u7BA1\u7406\u529F\u80FD\u6765\u5B58\u50A8\u3002\u8FD9\u4E9B\u79D8\u5BC6\u53EF\u4EE5\u5728\u90E8\u7F72\u65F6\u52A8\u6001\u6302\u8F7D\u5230\u5BB9\u5668\u4E2D\u3002</li><li><strong>\u914D\u7F6E\u6620\u5C04\uFF08ConfigMaps\uFF09</strong>\uFF1A\u5BF9\u4E8E\u975E\u654F\u611F\u7684\u914D\u7F6E\u4FE1\u606F\uFF0C\u5982\u6570\u636E\u5E93\u94FE\u63A5\u548C\u5E94\u7528\u53C2\u6570\uFF0C\u53EF\u4EE5\u4F7F\u7528 Kubernetes \u7684 ConfigMap \u6765\u5B58\u50A8\u3002ConfigMap \u53EF\u4EE5\u5728\u5BB9\u5668\u542F\u52A8\u65F6\u4F5C\u4E3A\u73AF\u5883\u53D8\u91CF\u6216\u6302\u8F7D\u7684\u5377\u63D0\u4F9B\u7ED9\u5E94\u7528\u7A0B\u5E8F\u3002</li><li><strong>\u73AF\u5883\u53D8\u91CF</strong>\uFF1A\u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\uFF0C\u76F4\u63A5\u5728 Kubernetes \u7684\u90E8\u7F72\u914D\u7F6E\u4E2D\u4F7F\u7528\u73AF\u5883\u53D8\u91CF\u6765\u4F20\u9012\u914D\u7F6E\u4FE1\u606F\u662F\u6709\u7528\u7684\u3002\u8FD9\u79CD\u65B9\u6CD5\u9002\u7528\u4E8E\u4E0D\u9700\u8981\u9891\u7E41\u66F4\u6539\u7684\u7B80\u5355\u914D\u7F6E\u3002</li><li><strong>GitOps \u5B9E\u8DF5</strong>\uFF1A\u91C7\u7528 GitOps \u7684\u65B9\u5F0F\u6765\u7BA1\u7406 Kubernetes \u914D\u7F6E\u3002\u5728\u8FD9\u79CD\u6A21\u5F0F\u4E0B\uFF0C\u6240\u6709\u914D\u7F6E\u66F4\u6539\u90FD\u901A\u8FC7 Git \u4ED3\u5E93\u6765\u8FDB\u884C\uFF0C\u901A\u8FC7\u81EA\u52A8\u5316\u6D41\u7A0B\u5E94\u7528\u5230 Kubernetes \u73AF\u5883\u4E2D\u3002\u8FD9\u6709\u52A9\u4E8E\u786E\u4FDD\u914D\u7F6E\u7684\u4E00\u81F4\u6027\u548C\u53EF\u8FFD\u6EAF\u6027\u3002</li></ol><p>\u5728 GitOps \u5B9E\u8DF5\u4E2D\uFF0C<code>git reset</code> \u548C <code>git revert</code> \u662F\u4E24\u4E2A\u91CD\u8981\u7684 Git \u547D\u4EE4\uFF0C\u5B83\u4EEC\u7528\u4E8E\u5904\u7406\u914D\u7F6E\u53D8\u66F4\u548C\u7EF4\u62A4\u5386\u53F2\u8BB0\u5F55\u3002\u7406\u89E3\u8FD9\u4E24\u4E2A\u547D\u4EE4\u7684\u5DEE\u5F02\u548C\u9002\u7528\u573A\u666F\u5BF9\u4E8E\u6709\u6548\u5730\u7BA1\u7406 Kubernetes \u914D\u7F6E\u81F3\u5173\u91CD\u8981\u3002</p><ol><li><strong>git reset</strong>\uFF1A <ul><li><code>git reset</code> \u547D\u4EE4\u7528\u4E8E\u64A4\u9500\u67D0\u4E9B\u63D0\u4EA4\uFF0C\u5B83\u53EF\u4EE5\u5C06 HEAD \u6307\u9488\u79FB\u52A8\u5230\u6307\u5B9A\u7684\u63D0\u4EA4\u3002</li><li>\u5728 GitOps \u4E2D\uFF0C\u5982\u679C\u4F60\u9700\u8981\u64A4\u9500\u4E00\u7CFB\u5217\u6700\u8FD1\u7684\u63D0\u4EA4\uFF0C\u5E76\u5C06\u4ED3\u5E93\u72B6\u6001\u56DE\u6EDA\u5230\u4EE5\u524D\u7684\u67D0\u4E2A\u7279\u5B9A\u63D0\u4EA4\uFF0C\u53EF\u4EE5\u4F7F\u7528 <code>git reset</code>\u3002</li><li>\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C<code>git reset</code> \u4F1A\u66F4\u6539\u5386\u53F2\u8BB0\u5F55\uFF0C\u8FD9\u5728\u5171\u4EAB\u4ED3\u5E93\u4E2D\u53EF\u80FD\u4F1A\u5BFC\u81F4\u95EE\u9898\u3002\u5176\u4ED6\u5F00\u53D1\u8005\u9700\u8981\u7528 <code>git pull --force</code> \u6765\u540C\u6B65\u66F4\u6539\uFF0C\u8FD9\u53EF\u80FD\u5BFC\u81F4\u6DF7\u4E71\u3002</li></ul></li><li><strong>git revert</strong>\uFF1A <ul><li><code>git revert</code> \u547D\u4EE4\u7528\u4E8E\u64A4\u9500\u67D0\u4E2A\u7279\u5B9A\u7684\u63D0\u4EA4\uFF0C\u4F46\u5B83\u4E0D\u4F1A\u6539\u53D8\u5386\u53F2\u8BB0\u5F55\u3002\u76F8\u53CD\uFF0C\u5B83\u4F1A\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684\u63D0\u4EA4\uFF0C\u8FD9\u4E2A\u65B0\u63D0\u4EA4\u7684\u72B6\u6001\u4E0E\u8981\u64A4\u9500\u7684\u63D0\u4EA4\u76F8\u53CD\u3002</li><li>\u5728 GitOps \u4E2D\uFF0C\u5982\u679C\u9700\u8981\u64A4\u9500\u4E00\u4E2A\u7279\u5B9A\u7684\u66F4\u6539\uFF0C\u540C\u65F6\u4FDD\u7559\u540E\u7EED\u7684\u66F4\u6539\uFF0C\u5E76\u4E14\u4E0D\u60F3\u4FEE\u6539\u5386\u53F2\u8BB0\u5F55\uFF0C<code>git revert</code> \u662F\u4E00\u4E2A\u66F4\u597D\u7684\u9009\u62E9\u3002</li><li><code>git revert</code> \u66F4\u9002\u5408\u516C\u5171\u4ED3\u5E93\u6216\u56E2\u961F\u73AF\u5883\uFF0C\u56E0\u4E3A\u5B83\u4E0D\u4F1A\u5F71\u54CD\u5176\u4ED6\u5F00\u53D1\u8005\u7684\u5386\u53F2\u8BB0\u5F55\u3002</li></ul></li></ol><blockquote><p>\u6211\u7684\u4E2A\u4EBA\u5F00\u53D1\u7ECF\u9A8C\u603B\u7ED3\u51FA\u6765\u7684\u662F\uFF0C\u4E2A\u4EBA\u4E0D\u4F7F\u7528 <code>revert</code>\uFF0C\u800C\u662F\u4F7F\u7528 <code>reset</code> \u5728\u672C\u5730\uFF0C\u524D\u63D0\u662F\u81EA\u5DF1\u5BF9\u81EA\u5DF1\u63D0\u4EA4\u7684\u6811\u72B6\u56FE\u5F88\u6E05\u6670\uFF0C\u4E0D\u8FC7\u751F\u4EA7\u4E2D\u8FD8\u662F\u4F7F\u7528 <code>revert</code>\uFF0C\u8FD9\u662F\u4E00\u4E2A\u975E\u5E38\u4FDD\u9669\u548C\u5B89\u88C5\u7684\u505A\u6CD5\u3002</p></blockquote><p>\u8FD9\u548C git rebase \u548C git merge \u7684\u7406\u89E3\u4E00\u6837\u7684\u3002</p><p><strong>merge \u548C rebase</strong> merge \u662F\u5408\u5E76\u7684\u610F\u601D\uFF0Crebase\u662F\u590D\u4F4D\u57FA\u5E95\u7684\u610F\u601D\u3002 \u73B0\u5728\u6211\u4EEC\u6709\u8FD9\u6837\u7684\u4E24\u4E2A\u5206\u652F,test\u548Cmaster\uFF0C\u63D0\u4EA4\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>     D---E test
    /
A---B---C---F master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728master\u6267\u884C<code>git merge test</code>\u7136\u540E\u4F1A\u5F97\u5230\u5982\u4E0B\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>     D--------E
    /          \\
A---B---C---F---G    test , master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728master\u6267\u884C<code>git rebase test</code>,\u7136\u540E\u5F97\u5230\u5982\u4E0B\u7ED3\u679C\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code> A---C---D---E---C \`---F\` test , master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u5230merge\u64CD\u4F5C\u4F1A\u751F\u6210\u4E00\u4E2A\u65B0\u7684\u8282\u70B9\uFF0C\u4E4B\u524D\u63D0\u4EA4\u5206\u5F00\u663E\u793A\u3002\u800Crebase\u64CD\u4F5C\u4E0D\u4F1A\u751F\u6210\u65B0\u7684\u8282\u70B9\uFF0C\u662F\u5C06\u4E24\u4E2A\u5206\u652F\u878D\u5408\u6210\u4E00\u4E2A\u7EBF\u6027\u7684\u64CD\u4F5C\u3002</p><h2 id="\u90E8\u7F72\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72\u7B56\u7565" aria-hidden="true">#</a> \u90E8\u7F72\u7B56\u7565</h2><p>\u5728 Kubernetes \u4E2D\uFF0C\u4F60\u53EF\u4EE5\u53EA\u7528\u5E26\u6709 PodSpec \u7684\u6E05\u5355\u6765\u90E8\u7F72\u4E00\u4E2A Pod\uFF0C\u5E76\u4E14\u4FDD\u8BC1\u5176\u53EF\u7528\u6027\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u4F60\u53EF\u4EE5\u81EA\u5B9A\u4E49 ReplocaSet \u6E05\u5355\uFF0C\u4EE5\u4FDD\u6301\u5728\u4EFB\u4F55\u7279\u5B9A\u65F6\u95F4\u8FD0\u884C\u4E00\u7EC4\u7A33\u5B9A\u7684 Pod \u526F\u672C\u96C6\u5408\u3002ReplicaSet \u662F\u901A\u8FC7\u6307\u5B9A\u7528\u4E8E\u8BC6\u522B Pod \u7684\u9009\u62E9\u5668\u3002</p><p>ReplicaSet \u4E0D\u662F\u58F0\u660E\u5F0F\u7684\uFF0C\u56E0\u6B64\u4E0D\u9002\u5408 GitOps</p><p>\u6211\u6CA1\u77E5\u9053 Deployment \u662F\u4E00\u4E2A\u66F4\u9AD8\u5C42\u7684\u62BD\u8C61\uFF0C\u867D\u7136\u53EF\u4EE5\u4F7F\u7528\u5E26\u6709 <code>PodSpec</code> \u7684\u6E05\u5355\u76F4\u63A5\u90E8\u7F72\u5355\u4E2A Pod\uFF0C\u4F46\u8FD9\u79CD\u65B9\u5F0F\u901A\u5E38\u4E0D\u9002\u7528\u4E8E\u4FDD\u8BC1 Pod \u7684\u53EF\u7528\u6027\u548C\u53EF\u7BA1\u7406\u6027\u3002</p><h3 id="replicaset" tabindex="-1"><a class="header-anchor" href="#replicaset" aria-hidden="true">#</a> ReplicaSet</h3><ul><li><strong>\u4F5C\u7528</strong>\uFF1A<code>ReplicaSet</code> \u7684\u4E3B\u8981\u76EE\u7684\u662F\u786E\u4FDD\u5728\u4EFB\u4F55\u65F6\u5019\u90FD\u6709\u6307\u5B9A\u6570\u91CF\u7684 Pod \u526F\u672C\u6B63\u5728\u8FD0\u884C\u3002</li><li><strong>\u9009\u62E9\u5668</strong>\uFF1A\u5B83\u901A\u8FC7\u4F7F\u7528\u6807\u7B7E\u9009\u62E9\u5668\u6765\u8BC6\u522B\u8981\u7BA1\u7406\u7684 Pod\u3002\u8FD9\u4E9B\u6807\u7B7E\u5728 Pod \u7684\u5B9A\u4E49\u4E2D\u6307\u5B9A\u3002</li><li><strong>\u7F3A\u70B9</strong>\uFF1A\u5C3D\u7BA1 <code>ReplicaSet</code> \u53EF\u4EE5\u786E\u4FDD\u6307\u5B9A\u6570\u91CF\u7684 Pod \u5B9E\u4F8B\u59CB\u7EC8\u8FD0\u884C\uFF0C\u4F46\u5B83\u672C\u8EAB\u5E76\u4E0D\u652F\u6301\u6EDA\u52A8\u66F4\u65B0\u3002\u5982\u679C\u4F60\u9700\u8981\u66F4\u65B0 Pod \u7684\u5B9A\u4E49\uFF08\u4F8B\u5982\uFF0C\u66F4\u65B0\u4F7F\u7528\u7684\u5BB9\u5668\u955C\u50CF\uFF09\uFF0C\u5C31\u9700\u8981\u624B\u52A8\u66F4\u65B0 <code>ReplicaSet</code>\uFF0C\u6216\u8005\u5220\u9664\u5E76\u91CD\u65B0\u521B\u5EFA\u5B83\u3002</li></ul><h3 id="deployment" tabindex="-1"><a class="header-anchor" href="#deployment" aria-hidden="true">#</a> Deployment</h3><ul><li><strong>\u66F4\u9AD8\u7EA7\u7684\u62BD\u8C61</strong>\uFF1A<code>Deployment</code> \u662F\u4E00\u4E2A\u66F4\u9AD8\u7EA7\u522B\u7684\u62BD\u8C61\uFF0C\u5B83\u5728 <code>ReplicaSet</code> \u7684\u57FA\u7840\u4E0A\u63D0\u4F9B\u4E86\u66F4\u591A\u529F\u80FD\u3002\u5B83\u4E0D\u4EC5\u786E\u4FDD Pod \u6570\u91CF\uFF0C\u8FD8\u652F\u6301\u58F0\u660E\u5F0F\u5730\u66F4\u65B0 Pod \u548C <code>ReplicaSet</code>\u3002</li><li><strong>\u6EDA\u52A8\u66F4\u65B0</strong>\uFF1A<code>Deployment</code> \u652F\u6301\u6EDA\u52A8\u66F4\u65B0\uFF0C\u5141\u8BB8\u4F60\u9010\u6E10\u66FF\u6362\u65E7\u7248\u672C\u7684 Pod \u4E3A\u65B0\u7248\u672C\uFF0C\u800C\u4E0D\u4F1A\u5BFC\u81F4\u505C\u673A\u3002</li><li><strong>\u9002\u7528\u4E8E GitOps</strong>\uFF1A\u7531\u4E8E\u5176\u58F0\u660E\u5F0F\u7684\u7279\u6027\uFF0C<code>Deployment</code> \u975E\u5E38\u9002\u5408 GitOps \u7684\u5DE5\u4F5C\u6D41\u3002\u4F60\u53EF\u4EE5\u5728 Git \u4ED3\u5E93\u4E2D\u58F0\u660E\u5E94\u7528\u7684\u671F\u671B\u72B6\u6001\uFF0C\u7136\u540E\u4F7F\u7528\u81EA\u52A8\u5316\u5DE5\u5177\uFF08\u5982 Argocd \u6216 Flux\uFF09\u6765\u76D1\u89C6\u4ED3\u5E93\u5E76\u5C06\u66F4\u6539\u5E94\u7528\u5230 Kubernetes \u96C6\u7FA4\u3002</li></ul><p><img src="http://sm.nsddd.top/sm202311262010756.png" alt="gitops-deployment-replicaset"></p><h3 id="\u6D41\u91CF\u8DEF\u7531-traffic-routing" tabindex="-1"><a class="header-anchor" href="#\u6D41\u91CF\u8DEF\u7531-traffic-routing" aria-hidden="true">#</a> \u6D41\u91CF\u8DEF\u7531 Traffic Routing</h3><p>\u5728Kubernetes\u4E2D\uFF0CService \u662F\u4E00\u79CD\u62BD\u8C61\uFF0C\u5B83\u5B9A\u4E49\u4E86\u4E00\u7EC4\u903B\u8F91\u7684Pods\u548C\u8BBF\u95EE\u5B83\u4EEC\u7684\u7B56\u7565\u3002\u670D\u52A1\u6240\u9488\u5BF9\u7684\u8C46 Pod targeted\u7531\u4EE5\u4E0B\u9009\u62E9\u5668\u786E\u5B9A</p><p>Service minifest \u4E2D\u7684\u5B57\u6BB5\u3002\u7136\u540E\uFF0C\u670D\u52A1\u5C06\u6D41\u91CF\u8F6C\u53D1\u5230\u5E26\u6709\u9009\u62E9\u5668\u6307\u5B9A\u7684\u5339\u914D\u6807\u7B7E\u7684Pods\u3002\u5982\u679C\u5E95\u5C42\u7684Pods\u662F\u65E0\u72B6\u6001\u548C\u5411\u540E\u517C\u5BB9\u7684\uFF0C\u90A3\u4E48Service\u53EF\u4EE5\u8FDB\u884C\u5FAA\u73AF\u8D1F\u8F7D\u5E73\u8861\uFF0C\u5E76\u4E14\u975E\u5E38\u9002\u5408\u6EDA\u52A8\u66F4\u65B0\u3002\u5982\u679C\u9700\u8981\u4E3A\u90E8\u7F72\u5B9A\u5236\u8D1F\u8F7D\u5E73\u8861\uFF0C\u5219\u9700\u8981\u63A2\u7D22\u5176\u4ED6\u8DEF\u7531\u66FF\u4EE3\u65B9\u6848\u3002</p><p>\u5F53Service\u6536\u5230\u6D41\u91CF\u65F6\uFF0C\u5B83\u4F1A\u6839\u636E\u5B9A\u4E49\u7684\u9009\u62E9\u5668\u5C06\u6D41\u91CF\u8F6C\u53D1\u5230\u62E5\u6709\u76F8\u5E94\u5339\u914D\u6807\u7B7E\u7684Pods\u3002\u4F8B\u5982\uFF0C\u5982\u679CService\u7684\u9009\u62E9\u5668\u88AB\u8BBE\u7F6E\u4E3A\u5339\u914D\u6807\u7B7E\u201Ccolor: blue\u201D\uFF0C\u90A3\u4E48\u6240\u6709\u5E26\u6709\u6B64\u6807\u7B7E\u7684Pods\u5C06\u63A5\u6536\u5230\u7531\u8BE5Service\u8F6C\u53D1\u7684\u6D41\u91CF\u3002\u8FD9\u79CD\u65B9\u6CD5\u4F7F\u5F97\u6D41\u91CF\u7BA1\u7406\u65E2\u7075\u6D3B\u53C8\u9AD8\u6548\u3002</p><h4 id="\u65E0\u72B6\u6001pods\u548C\u8D1F\u8F7D\u5E73\u8861" tabindex="-1"><a class="header-anchor" href="#\u65E0\u72B6\u6001pods\u548C\u8D1F\u8F7D\u5E73\u8861" aria-hidden="true">#</a> \u65E0\u72B6\u6001Pods\u548C\u8D1F\u8F7D\u5E73\u8861</h4><p>\u5982\u679C\u5E95\u5C42\u7684Pods\u662F\u65E0\u72B6\u6001\u7684\uFF08Stateless\uFF09\u5E76\u4E14\u4FDD\u6301\u5411\u540E\u517C\u5BB9\u6027\uFF0C\u90A3\u4E48Service\u53EF\u4EE5\u5B9E\u73B0\u6709\u6548\u7684\u5FAA\u73AF\u8D1F\u8F7D\u5E73\u8861\u3002\u8FD9\u5BF9\u4E8E\u5B9E\u65BD\u6EDA\u52A8\u66F4\u65B0\u5C24\u4E3A\u91CD\u8981\uFF0C\u56E0\u4E3A\u5B83\u5141\u8BB8\u5728\u4E0D\u4E2D\u65AD\u670D\u52A1\u7684\u60C5\u51B5\u4E0B\u9010\u6B65\u66FF\u6362\u65E7\u7684Pods\u3002</p><h4 id="\u5B9A\u5236\u8D1F\u8F7D\u5E73\u8861\u4E0E\u8DEF\u7531\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#\u5B9A\u5236\u8D1F\u8F7D\u5E73\u8861\u4E0E\u8DEF\u7531\u7B56\u7565" aria-hidden="true">#</a> \u5B9A\u5236\u8D1F\u8F7D\u5E73\u8861\u4E0E\u8DEF\u7531\u7B56\u7565</h4><p>\u5BF9\u4E8E\u9700\u8981\u66F4\u590D\u6742\u8DEF\u7531\u903B\u8F91\u6216\u5B9A\u5236\u8D1F\u8F7D\u5E73\u8861\u7684\u90E8\u7F72\uFF0C\u53EF\u80FD\u9700\u8981\u63A2\u7D22Kubernetes\u63D0\u4F9B\u7684\u5176\u4ED6\u8DEF\u7531\u66FF\u4EE3\u65B9\u6848\u3002\u4F8B\u5982\uFF0C\u4F7F\u7528Ingress Controllers\u548CIngress Resources\u53EF\u4EE5\u63D0\u4F9B\u66F4\u9AD8\u7EA7\u7684\u8DEF\u7531\u80FD\u529B\uFF0C\u6BD4\u5982\u57FA\u4E8EURL\u7684\u8DEF\u7531\u3001SSL/TLS\u7EC8\u7AEF\u52A0\u5BC6\u548C\u8D1F\u8F7D\u5747\u8861\u7B56\u7565\u3002</p><h4 id="\u6807\u7B7E\u9A71\u52A8\u7684\u8DEF\u7531" tabindex="-1"><a class="header-anchor" href="#\u6807\u7B7E\u9A71\u52A8\u7684\u8DEF\u7531" aria-hidden="true">#</a> \u6807\u7B7E\u9A71\u52A8\u7684\u8DEF\u7531</h4><p>Kubernetes\u4E2D\u7684\u670D\u52A1\u8DEF\u7531\u662F\u5B8C\u5168\u57FA\u4E8E\u6807\u7B7E\u7684\u3002\u8FD9\u610F\u5473\u7740\uFF0C\u4F8B\u5982\uFF0C\u4E00\u4E2A\u6807\u8BB0\u4E3A\u201Cblue\u201D\u7684Service\u53EA\u4F1A\u5C06\u6D41\u91CF\u8DEF\u7531\u5230\u5E26\u6709\u201Cblue\u201D\u6807\u7B7E\u7684Pods\uFF0C\u800C\u4E00\u4E2A\u6807\u8BB0\u4E3A\u201Cgreen\u201D\u7684Service\u5219\u53EA\u8DEF\u7531\u5230\u5E26\u6709\u201Cgreen\u201D\u6807\u7B7E\u7684Pods\u3002\u8FD9\u79CD\u8BBE\u8BA1\u5141\u8BB8\u7B80\u5355\u800C\u76F4\u89C2\u7684\u6D41\u91CF\u5206\u914D\u548C\u7BA1\u7406\u3002</p><p><img src="http://sm.nsddd.top/sm202311262110507.png" alt="ingree-istio"></p><h4 id="nginx-ingress-controller" tabindex="-1"><a class="header-anchor" href="#nginx-ingress-controller" aria-hidden="true">#</a> NGINX Ingress Controller</h4><p>NGINX Ingress Controller\u662F\u4E00\u4E2A\u529F\u80FD\u5F3A\u5927\u7684\u5DE5\u5177\uFF0C\u7528\u4E8E\u5728Kubernetes\u73AF\u5883\u4E2D\u7BA1\u7406\u8FDB\u5165\u96C6\u7FA4\u7684\u6D41\u91CF\u3002\u5B83\u652F\u6301\u591A\u79CD\u8D1F\u8F7D\u5E73\u8861\u548C\u8DEF\u7531\u89C4\u5219\uFF0C\u9002\u7528\u4E8E\u5E7F\u6CDB\u7684\u7528\u4F8B\u3002\u5173\u952E\u7279\u70B9\u5305\u62EC\uFF1A</p><ul><li><strong>\u524D\u7AEF\u8D1F\u8F7D\u5747\u8861\u5668</strong>\uFF1A\u5B83\u53EF\u4EE5\u914D\u7F6E\u4E3A\u524D\u7AEF\u8D1F\u8F7D\u5747\u8861\u5668\uFF0C\u8D1F\u8D23\u5904\u7406\u8FDB\u5165\u96C6\u7FA4\u7684\u6240\u6709\u6D41\u91CF\u3002</li><li><strong>\u81EA\u5B9A\u4E49\u8DEF\u7531</strong>\uFF1A\u652F\u6301\u5404\u79CD\u81EA\u5B9A\u4E49\u8DEF\u7531\u529F\u80FD\uFF0C\u5982TLS\u7EC8\u7AEF\u52A0\u5BC6\u3001URL\u91CD\u5199\uFF0C\u4EE5\u53CA\u57FA\u4E8E\u81EA\u5B9A\u4E49\u89C4\u5219\u7684\u6D41\u91CF\u8DEF\u7531\u3002</li><li><strong>\u6D41\u91CF\u5206\u914D</strong>\uFF1A\u53EF\u4EE5\u914D\u7F6E\u89C4\u5219\u6765\u5206\u914D\u6D41\u91CF\uFF0C\u4F8B\u5982\u5C0640%\u7684\u6D41\u91CF\u8DEF\u7531\u5230\u5E26\u6709\u7279\u5B9A\u6807\u7B7E\uFF08\u5982\u201Cblue\u201D\uFF09\u7684\u670D\u52A1\uFF0C\u800C60%\u8DEF\u7531\u5230\u53E6\u4E00\u4E2A\u6807\u7B7E\uFF08\u5982\u201Cgreen\u201D\uFF09\u7684\u670D\u52A1\u3002</li></ul><p>\u901A\u8FC7\u8FD9\u4E9B\u529F\u80FD\uFF0CNGINX Ingress Controller\u80FD\u591F\u6709\u6548\u5730\u7BA1\u7406\u548C\u4F18\u5316\u8FDB\u5165Kubernetes\u96C6\u7FA4\u7684\u6D41\u91CF\u3002</p><h4 id="istio-gateway" tabindex="-1"><a class="header-anchor" href="#istio-gateway" aria-hidden="true">#</a> Istio Gateway</h4><p>Istio Gateway\u662F\u53E6\u4E00\u4E2A\u5173\u952E\u7EC4\u4EF6\uFF0C\u7528\u4E8E\u5728Kubernetes\u96C6\u7FA4\u7684\u8FB9\u7F18\u7BA1\u7406\u6D41\u91CF\u3002\u5B83\u4E3B\u8981\u8D1F\u8D23\u5904\u7406\u8FDB\u5165\u548C\u79BB\u5F00\u96C6\u7FA4\u7684HTTP\u548CTCP\u8FDE\u63A5\u3002Istio Gateway\u7684\u4E3B\u8981\u7279\u70B9\u5305\u62EC\uFF1A</p><ul><li><strong>\u8FB9\u7F18\u8D1F\u8F7D\u5E73\u8861\u5668</strong>\uFF1A\u4F5C\u4E3A\u96C6\u7FA4\u8FB9\u7F18\u7684\u8D1F\u8F7D\u5E73\u8861\u5668\uFF0C\u5B83\u5904\u7406\u6240\u6709\u8FDB\u5165\u548C\u79BB\u5F00\u96C6\u7FA4\u7684\u6D41\u91CF\u3002</li><li><strong>\u7AEF\u53E3\u548C\u534F\u8BAE\u89C4\u8303</strong>\uFF1AIstio Gateway\u5141\u8BB8\u5B9A\u4E49\u4E00\u7EC4\u8981\u516C\u5F00\u7684\u7AEF\u53E3\uFF0C\u4EE5\u53CA\u76F8\u5173\u7684\u534F\u8BAE\u7C7B\u578B\uFF0C\u786E\u4FDD\u6D41\u91CF\u6309\u7167\u65E2\u5B9A\u7684\u89C4\u5219\u548C\u534F\u8BAE\u6D41\u52A8\u3002</li><li><strong>\u96C6\u6210\u4E0EIstio\u670D\u52A1\u7F51\u683C</strong>\uFF1A\u4F5C\u4E3AIstio\u751F\u6001\u7CFB\u7EDF\u7684\u4E00\u90E8\u5206\uFF0C\u5B83\u4E0EIstio\u7684\u670D\u52A1\u7F51\u683C\u529F\u80FD\u7D27\u5BC6\u96C6\u6210\uFF0C\u63D0\u4F9B\u9AD8\u7EA7\u7684\u6D41\u91CF\u7BA1\u7406\u548C\u5B89\u5168\u6027\u529F\u80FD\u3002</li></ul><p><img src="http://sm.nsddd.top/sm202311262115919.png" alt="istio-ingress"></p><blockquote><p>\u8BF4\u660E\u901A\u8FC7Kubernetes\u4E2D\u7684Ingress\u63A7\u5236\u5668\u7684\u6D41\u91CF\u6D41\u548CIstio\u670D\u52A1\u7F51\u683C\u4E2D\u7684\u6D41\u91CF\u6D41\u7684\u56FE\u8868\u5DF2\u7ECF\u51C6\u5907\u597D\u4E86\u3002\u8FD9\u4E9B\u56FE\u8868\u6E05\u6670\u5730\u6BD4\u8F83\u4E86\u6BCF\u4E2A\u7CFB\u7EDF\u5728Kubernetes\u73AF\u5883\u4E2D\u5982\u4F55\u5904\u7406\u6D41\u91CF\u8DEF\u7531\u548C\u7BA1\u7406\uFF0C\u5305\u62EC\u5165\u53E3\u63A7\u5236\u5668\u548CIstio\u7F51\u5173\u7684\u89D2\u8272\u3002</p></blockquote><h3 id="argo-rollouts" tabindex="-1"><a class="header-anchor" href="#argo-rollouts" aria-hidden="true">#</a> Argo Rollouts</h3><h4 id="\u4EC0\u4E48\u662Fargo-rollouts" tabindex="-1"><a class="header-anchor" href="#\u4EC0\u4E48\u662Fargo-rollouts" aria-hidden="true">#</a> \u4EC0\u4E48\u662FArgo Rollouts\uFF1F</h4><p>Argo Rollouts \u662F\u4E00\u4E2AKubernetes\u63A7\u5236\u5668\uFF0C\u7528\u4E8E\u66F4\u590D\u6742\u3001\u66F4\u5F3A\u5927\u7684\u90E8\u7F72\u7B56\u7565\uFF0C\u5982\u84DD\u7EFF\u90E8\u7F72\uFF08Blue-Green Deployments\uFF09\u548C\u91D1\u4E1D\u96C0\u90E8\u7F72\uFF08Canary Deployments\uFF09\u3002\u5B83\u901A\u8FC7\u6269\u5C55Kubernetes\u81EA\u8EAB\u7684\u90E8\u7F72\u80FD\u529B\uFF0C\u4F7F\u5F97\u5728\u4E0D\u4E2D\u65AD\u670D\u52A1\u7684\u60C5\u51B5\u4E0B\u66F4\u65B0\u548C\u7BA1\u7406\u5E94\u7528\u7A0B\u5E8F\u53D8\u5F97\u66F4\u52A0\u5BB9\u6613\u3002</p><h4 id="\u5B89\u88C5-\u4F7F\u7528-argo-rollouts" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5-\u4F7F\u7528-argo-rollouts" aria-hidden="true">#</a> \u5B89\u88C5 &amp; \u4F7F\u7528 Argo Rollouts</h4><ol><li><p><strong>\u5148\u51B3\u6761\u4EF6</strong>\uFF1A</p><ul><li>\u786E\u4FDD\u60A8\u6709\u4E00\u4E2A\u8FD0\u884C\u4E2D\u7684 Kubernetes \u96C6\u7FA4\u3002</li><li>\u60A8\u9700\u8981\u6709\u8DB3\u591F\u7684\u6743\u9650\u6765\u90E8\u7F72\u65B0\u7684 Kubernetes \u8D44\u6E90\u3002</li></ul></li><li><p><strong>\u5B89\u88C5\u547D\u4EE4</strong>\uFF1A</p><ul><li><p>Argo Rollouts \u53EF\u4EE5\u901A\u8FC7\u5176 Helm \u56FE\u8868\u6216\u4F7F\u7528 kubectl \u76F4\u63A5\u4ECE\u5176 GitHub \u4ED3\u5E93\u5B89\u88C5\u3002</p></li><li><p>\u4F7F\u7528 Helm \u5B89\u88C5\uFF08\u5982\u679C\u60A8\u4F7F\u7528 Helm\uFF09:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>helm repo <span class="token function">add</span> argo https://argoproj.github.io/argo-helm
helm <span class="token function">install</span> argo-rollouts argo/argo-rollouts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u6216\u8005\uFF0C\u4F7F\u7528 kubectl \u4ECE\u5176 GitHub \u4ED3\u5E93\u5B89\u88C5\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl create namespace argo-rollouts
kubectl apply <span class="token parameter variable">-n</span> argo-rollouts <span class="token parameter variable">-f</span> https://raw.githubusercontent.com/argoproj/argo-rollouts/stable/manifests/install.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ol><h3 id="\u5B9A\u4E49-rollout-\u8D44\u6E90" tabindex="-1"><a class="header-anchor" href="#\u5B9A\u4E49-rollout-\u8D44\u6E90" aria-hidden="true">#</a> \u5B9A\u4E49 Rollout \u8D44\u6E90</h3><ol><li><p><strong>\u521B\u5EFA Rollout \u8D44\u6E90\u5B9A\u4E49</strong>\uFF1A</p><ul><li>Rollout \u8D44\u6E90\u7C7B\u4F3C\u4E8E Kubernetes \u7684 Deployment \u8D44\u6E90\uFF0C\u4F46\u5B83\u5305\u542B\u989D\u5916\u7684\u5B57\u6BB5\u6765\u6307\u5B9A\u90E8\u7F72\u7B56\u7565\uFF08\u4F8B\u5982\u91D1\u4E1D\u96C0\u6216\u84DD\u7EFF\u90E8\u7F72\uFF09\u3002</li><li>\u521B\u5EFA\u4E00\u4E2A YAML \u6587\u4EF6\uFF0C\u5B9A\u4E49\u60A8\u7684 Rollout\uFF0C\u5305\u62EC\u955C\u50CF\u3001\u526F\u672C\u6570\u3001\u66F4\u65B0\u7B56\u7565\u7B49\u3002</li></ul></li><li><p><strong>\u793A\u4F8B Rollout \u5B9A\u4E49</strong>\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> argoproj.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Rollout
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>rollout
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> example
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> example
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> app
        <span class="token key atrule">image</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>image<span class="token punctuation">:</span>latest
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">canary</span><span class="token punctuation">:</span> 
      <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">setWeight</span><span class="token punctuation">:</span> <span class="token number">20</span>
      <span class="token punctuation">-</span> <span class="token key atrule">pause</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">duration</span><span class="token punctuation">:</span> 1h<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="\u89E6\u53D1\u548C\u7BA1\u7406\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u89E6\u53D1\u548C\u7BA1\u7406\u90E8\u7F72" aria-hidden="true">#</a> \u89E6\u53D1\u548C\u7BA1\u7406\u90E8\u7F72</h3><ol><li><p><strong>\u5E94\u7528 Rollout \u8D44\u6E90</strong>\uFF1A</p><ul><li><p>\u4F7F\u7528 kubectl \u5E94\u7528\u60A8\u7684 Rollout \u5B9A\u4E49\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> your-rollout-definition.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li><li><p><strong>\u76D1\u63A7 Rollout \u72B6\u6001</strong>\uFF1A</p><ul><li><p>\u4F7F\u7528 kubectl \u68C0\u67E5 Rollout \u72B6\u6001\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl argo rollouts get rollout example-rollout <span class="token parameter variable">--watch</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li><li><p><strong>\u7BA1\u7406 Rollout</strong>\uFF1A</p><ul><li>\u53EF\u4EE5\u901A\u8FC7\u66F4\u65B0 Rollout \u8D44\u6E90\u7684\u5B9A\u4E49\uFF08\u4F8B\u5982\uFF0C\u66F4\u6539\u955C\u50CF\u6807\u7B7E\uFF09\u6765\u89E6\u53D1\u65B0\u7684\u90E8\u7F72\u3002</li><li>\u4F7F\u7528 Argo Rollouts \u7684 CLI \u5DE5\u5177\uFF0C\u60A8\u53EF\u4EE5\u7BA1\u7406 Rollout \u7684\u6682\u505C\u3001\u6062\u590D\u548C\u4E2D\u6B62\u7B49\u64CD\u4F5C\u3002</li></ul></li></ol><h4 id="argo-rollouts\u7684\u6838\u5FC3\u529F\u80FD" tabindex="-1"><a class="header-anchor" href="#argo-rollouts\u7684\u6838\u5FC3\u529F\u80FD" aria-hidden="true">#</a> Argo Rollouts\u7684\u6838\u5FC3\u529F\u80FD</h4><ul><li><strong>\u9AD8\u7EA7\u90E8\u7F72\u7B56\u7565</strong>\uFF1A\u652F\u6301\u84DD\u7EFF\u90E8\u7F72\u548C\u91D1\u4E1D\u96C0\u90E8\u7F72\u7B49\u3002</li><li><strong>\u81EA\u52A8\u5316\u56DE\u6EDA</strong>\uFF1A\u5982\u679C\u65B0\u7248\u672C\u51FA\u73B0\u95EE\u9898\uFF0C\u5B83\u80FD\u81EA\u52A8\u56DE\u6EDA\u5230\u4E0A\u4E00\u4E2A\u7A33\u5B9A\u7248\u672C\u3002</li><li><strong>\u6743\u91CD\u5F0F\u6D41\u91CF\u5206\u914D</strong>\uFF1A\u53EF\u4EE5\u63A7\u5236\u65B0\u7248\u672C\u548C\u65E7\u7248\u672C\u4E4B\u95F4\u7684\u6D41\u91CF\u5206\u914D\u6BD4\u4F8B\u3002</li><li><strong>\u96C6\u6210\u5EA6\u9AD8</strong>\uFF1A\u4E0EIstio\u3001NGINX Ingress\u7B49\u670D\u52A1\u7F51\u683C\u548CIngress\u63A7\u5236\u5668\u7D27\u5BC6\u96C6\u6210\u3002</li></ul><ol><li><strong>\u84DD\u7EFF\u90E8\u7F72</strong>\uFF1A <ul><li>\u9996\u5148\uFF0C\u60A8\u90E8\u7F72\u4E86\u65B0\u7248\u672C\uFF08\u7EFF\u8272\u7248\u672C\uFF09\u800C\u4E0D\u4F1A\u5F71\u54CD\u5230\u5F53\u524D\u8FD0\u884C\u7684\u65E7\u7248\u672C\uFF08\u84DD\u8272\u7248\u672C\uFF09\u3002</li><li>\u4E00\u65E6\u7EFF\u8272\u7248\u672C\u5C31\u7EEA\u5E76\u4E14\u7ECF\u8FC7\u4E86\u6D4B\u8BD5\u9A8C\u8BC1\u5176\u7A33\u5B9A\u6027\uFF0C\u6D41\u91CF\u5C06\u4ECE\u84DD\u8272\u7248\u672C\u5E73\u6ED1\u8F6C\u79FB\u5230\u7EFF\u8272\u7248\u672C\u3002</li><li>\u5982\u679C\u7EFF\u8272\u7248\u672C\u8FD0\u884C\u826F\u597D\uFF0C\u5219\u5B8C\u6210\u90E8\u7F72\uFF1B\u5982\u679C\u6709\u95EE\u9898\uFF0C\u5219\u53EF\u4EE5\u7ACB\u5373\u5207\u6362\u56DE\u84DD\u8272\u7248\u672C\u3002</li></ul></li><li><strong>\u91D1\u4E1D\u96C0\u90E8\u7F72</strong>\uFF1A <ul><li>\u5728\u8FD9\u79CD\u7B56\u7565\u4E2D\uFF0C\u60A8\u4F1A\u9010\u6E10\u5411\u65B0\u7248\u672C\uFF08\u91D1\u4E1D\u96C0\u7248\u672C\uFF09\u5F15\u5165\u4E00\u5C0F\u90E8\u5206\u7528\u6237\u6D41\u91CF\u3002</li><li>\u521D\u59CB\u9636\u6BB5\uFF0C\u53EA\u6709\u5C11\u91CF\u7684\u6D41\u91CF\u88AB\u8DEF\u7531\u5230\u65B0\u7248\u672C\uFF0C\u540C\u65F6\u76D1\u63A7\u5176\u6027\u80FD\u548C\u7A33\u5B9A\u6027\u3002</li><li>\u5982\u679C\u65B0\u7248\u672C\u8868\u73B0\u826F\u597D\uFF0C\u60A8\u53EF\u4EE5\u9010\u6E10\u589E\u52A0\u6D41\u91CF\u6BD4\u4F8B\uFF0C\u76F4\u5230\u5168\u90E8\u6D41\u91CF\u90FD\u8F6C\u79FB\u5230\u65B0\u7248\u672C\u3002</li><li>\u5982\u679C\u65B0\u7248\u672C\u51FA\u73B0\u95EE\u9898\uFF0C\u53EF\u4EE5\u7ACB\u5373\u505C\u6B62\u6D41\u91CF\u7684\u8F6C\u79FB\uFF0C\u5E76\u5C06\u5176\u8DEF\u7531\u56DE\u65E7\u7248\u672C\u3002</li></ul></li></ol><h3 id="\u84DD\u7EFF\u53D1\u5E03" tabindex="-1"><a class="header-anchor" href="#\u84DD\u7EFF\u53D1\u5E03" aria-hidden="true">#</a> \u84DD\u7EFF\u53D1\u5E03</h3><p>\u6211\u4EEC\u5DF2\u7ECF\u77E5\u9053\uFF0C\u652F\u6301\u58F0\u660E\u5F0F\u7684 Deployment \u7684\u6EDA\u52A8\u66F4\u65B0\u662F\u66F4\u65B0\u5E94\u7528\u7684\u7EDD\u4F73\u65B9\u5F0F\uFF0C\u56E0\u4E3A\u4F60\u7684\u5E94\u7528\u5728\u90E8\u7F72\u671F\u95F4\u5C06\u4F7F\u7528\u5927\u81F4\u76F8\u540C\u6570\u91CF\u7684\u8D44\u6E90\uFF0C\u4E14\u505C\u673A\u65F6\u95F4\u4E3A\u96F6\uFF0C\u5BF9\u6027\u80FD\u7684\u5F71\u54CD\u6700\u5C0F\u3002\u7136\u800C\uFF0C\u7531\u4E8E\u5411\u540E\u4E0D\u517C\u5BB9\u6027\u6216\u6709\u72B6\u6001\u6027\uFF0C\u6709\u8BB8\u591A\u9057\u7559\u5E94\u7528\u7A0B\u5E8F\u4E0D\u80FD\u5F88\u597D\u5730\u4E0E\u6EDA\u52A8\u66F4\u65B0\u4E00\u8D77\u5DE5\u4F5C\u3002\u6709\u4E9B\u5E94\u7528\u7A0B\u5E8F\u53EF\u80FD\u8FD8\u9700\u8981\u90E8\u7F72\u65B0\u7248\u672C\u5E76\u7ACB\u5373\u5207\u6362\u5230\u8BE5\u7248\u672C\uFF0C\u6216\u8005\u5728\u51FA\u73B0\u95EE\u9898\u65F6\u5FEB\u901F\u56DE\u6EDA\u3002\u5BF9\u4E8E\u8FD9\u4E9B\u7528\u4F8B\uFF0C\u84DD\u7EFF\u8272\u90E8\u7F72\u5C06\u662F\u9002\u5F53\u7684\u90E8\u7F72\u7B56\u7565\u3002\u84DD\u7EFF\u90E8\u7F72\u901A\u8FC7\u8BA9\u4E24\u4E2A\u90E8\u7F72\u540C\u65F6\u5B8C\u5168\u6269\u5C55\uFF0C\u4F46\u53EA\u5C06\u4F20\u5165\u6D41\u91CF\u5B9A\u5411\u5230\u4E24\u4E2A\u90E8\u7F72\u4E2D\u7684\u4E00\u4E2A\u6765\u5B9E\u73B0\u8FD9\u4E9B\u3002</p><blockquote><p>\u8FD9\u91CC\u6211\u4EEC\u4F7F\u7528 Nginx Ingress \u63A7\u5236\u5668\u5C06 100% \u7684\u6D41\u91CF\u8DEF\u7531\u5230 blue \u6216\u8005 green deployment\uFF0C\u56E0\u4E3A\u5185\u7F6E\u7684 kubernetes service \u53EA\u652F\u6301 iptables\uFF0C\u5E76\u4E0D\u91CD\u7F6E\u4E0E pod \u7684\u73B0\u6709\u94FE\u63A5\uFF0C\u56E0\u6B64\u4E0D\u9002\u5408\u84DD\u7EFF\u53D1\u5E03\u3002</p></blockquote><p>\u5728 Kubernetes \u73AF\u5883\u4E2D\uFF0C\u867D\u7136\u58F0\u660E\u5F0F\u7684 Deployment \u901A\u8FC7\u6EDA\u52A8\u66F4\u65B0\uFF08Rolling Update\uFF09\u63D0\u4F9B\u4E86\u96F6\u505C\u673A\u65F6\u95F4\u548C\u6700\u5C0F\u5316\u5BF9\u6027\u80FD\u7684\u5F71\u54CD\uFF0C\u4F46\u786E\u5B9E\u5B58\u5728\u67D0\u4E9B\u60C5\u51B5\u548C\u5E94\u7528\u7A0B\u5E8F\u7C7B\u578B\uFF0C\u5176\u4E2D\u8FD9\u79CD\u65B9\u6CD5\u53EF\u80FD\u4E0D\u662F\u6700\u4F73\u9009\u62E9\u3002\u7279\u522B\u662F\u5BF9\u4E8E\u90A3\u4E9B\u6709\u72B6\u6001\u6027\uFF08Stateful\uFF09\u5E94\u7528\u6216\u56E0\u5411\u540E\u4E0D\u517C\u5BB9\u6027\u800C\u96BE\u4EE5\u8FDB\u884C\u6EDA\u52A8\u66F4\u65B0\u7684\u9057\u7559\u5E94\u7528\u7A0B\u5E8F\uFF0C\u84DD\u7EFF\u90E8\u7F72\uFF08Blue-Green Deployment\uFF09\u53EF\u80FD\u66F4\u9002\u5408\u3002</p><h3 id="iptable" tabindex="-1"><a class="header-anchor" href="#iptable" aria-hidden="true">#</a> Iptable</h3><p>Iptables \u662F Linux \u4E0A\u4E00\u79CD\u5F3A\u5927\u7684\u9632\u706B\u5899\u5DE5\u5177\uFF0C\u7528\u4E8E\u63A7\u5236\u8FDB\u51FA Linux \u7CFB\u7EDF\u7684\u7F51\u7EDC\u6D41\u91CF\u3002\u5B83\u662F\u57FA\u4E8E Netfilter \u63D0\u4F9B\u7684\u7F51\u7EDC\u5305\u8FC7\u6EE4\u6846\u67B6\uFF0C\u5141\u8BB8\u7CFB\u7EDF\u7BA1\u7406\u5458\u914D\u7F6E\u89C4\u5219\u96C6\uFF0C\u4EE5\u8FC7\u6EE4\u6D41\u91CF\u5E76\u63D0\u4F9B NAT \u529F\u80FD\u3002</p><h4 id="\u4E3B\u8981\u7279\u70B9\u548C\u529F\u80FD" tabindex="-1"><a class="header-anchor" href="#\u4E3B\u8981\u7279\u70B9\u548C\u529F\u80FD" aria-hidden="true">#</a> \u4E3B\u8981\u7279\u70B9\u548C\u529F\u80FD</h4><ol><li><strong>\u5305\u8FC7\u6EE4</strong>\uFF1A <ul><li>Iptables \u53EF\u4EE5\u8FC7\u6EE4\u8FDB\u51FA\u7CFB\u7EDF\u7684\u6570\u636E\u5305\uFF0C\u5305\u62EC\u6E90\u5730\u5740\u3001\u76EE\u7684\u5730\u5740\u3001\u4F20\u8F93\u534F\u8BAE\u7B49\u3002</li><li>\u5B83\u53EF\u4EE5\u63A5\u53D7\u3001\u62D2\u7EDD\u6216\u4E22\u5F03\u6570\u636E\u5305\uFF0C\u6839\u636E\u5B9A\u4E49\u7684\u89C4\u5219\u5BF9\u7F51\u7EDC\u6D41\u91CF\u8FDB\u884C\u7CBE\u786E\u63A7\u5236\u3002</li></ul></li><li><strong>\u94FE\u548C\u8868</strong>\uFF1A <ul><li>Iptables \u4F7F\u7528\u94FE\uFF08Chains\uFF09\u548C\u8868\uFF08Tables\uFF09\u6765\u7EC4\u7EC7\u89C4\u5219\u3002</li><li>\u5E38\u89C1\u7684\u94FE\u6709 INPUT\u3001OUTPUT \u548C FORWARD\uFF0C\u5206\u522B\u63A7\u5236\u8FDB\u5165\u7CFB\u7EDF\u3001\u79BB\u5F00\u7CFB\u7EDF\u548C\u7A7F\u8FC7\u7CFB\u7EDF\u7684\u6D41\u91CF\u3002</li><li>\u8868\u5982 <code>filter</code>\u3001<code>nat</code> \u548C <code>mangle</code> \u8868\u7528\u4E8E\u4E0D\u540C\u7C7B\u578B\u7684\u6D41\u91CF\u5904\u7406\u3002</li></ul></li><li><strong>NAT\uFF08\u7F51\u7EDC\u5730\u5740\u8F6C\u6362\uFF09</strong>\uFF1A <ul><li><code>Iptables</code> \u652F\u6301 NAT \u529F\u80FD\uFF0C\u5305\u62EC\u6E90\u5730\u5740\u8F6C\u6362\uFF08SNAT\uFF09\u548C\u76EE\u7684\u5730\u5740\u8F6C\u6362\uFF08DNAT\uFF09\u3002</li><li>\u8FD9\u5BF9\u4E8E\u8DEF\u7531\u548C\u8F6C\u53D1\u6D41\u91CF\u81F3\u5185\u90E8\u7F51\u7EDC\u4E2D\u7684\u79C1\u6709\u5730\u5740\u975E\u5E38\u91CD\u8981\u3002</li></ul></li><li><strong>\u72B6\u6001\u8DDF\u8E2A</strong>\uFF1A <ul><li>Iptables \u80FD\u591F\u8DDF\u8E2A\u7F51\u7EDC\u8FDE\u63A5\u7684\u72B6\u6001\uFF0C\u5982\u65B0\u5EFA\u3001\u5DF2\u5EFA\u7ACB\u3001\u76F8\u5173\u8054\u548C\u65E0\u6548\u8FDE\u63A5\u3002</li><li>\u8FD9\u5141\u8BB8\u57FA\u4E8E\u8FDE\u63A5\u72B6\u6001\u5E94\u7528\u89C4\u5219\uFF0C\u63D0\u9AD8\u8FC7\u6EE4\u7684\u7075\u6D3B\u6027\u548C\u6548\u679C\u3002</li></ul></li></ol><h4 id="\u5E94\u7528\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#\u5E94\u7528\u573A\u666F" aria-hidden="true">#</a> \u5E94\u7528\u573A\u666F</h4><ol><li><strong>\u5B89\u5168\u9632\u62A4</strong>\uFF1A <ul><li>\u5728\u670D\u52A1\u5668\u548C\u7F51\u7EDC\u8BBE\u5907\u4E0A\u5B9E\u65BD\u9632\u706B\u5899\u89C4\u5219\uFF0C\u9632\u6B62\u672A\u6388\u6743\u8BBF\u95EE\u548C\u653B\u51FB\u3002</li></ul></li><li><strong>\u6D41\u91CF\u7BA1\u7406</strong>\uFF1A <ul><li>\u7BA1\u7406\u548C\u9650\u5236\u7279\u5B9A\u7C7B\u578B\u7684\u6D41\u91CF\uFF0C\u4F18\u5316\u7F51\u7EDC\u4F7F\u7528\u3002</li></ul></li><li><strong>\u7F51\u7EDC\u8C03\u8BD5</strong>\uFF1A <ul><li>\u8DDF\u8E2A\u548C\u76D1\u63A7\u7F51\u7EDC\u6D41\u91CF\uFF0C\u5E2E\u52A9\u8BCA\u65AD\u7F51\u7EDC\u95EE\u9898\u3002</li></ul></li></ol><h4 id="\u4F7F\u7528\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u793A\u4F8B" aria-hidden="true">#</a> \u4F7F\u7528\u793A\u4F8B</h4><ul><li><p>\u963B\u6B62\u6765\u81EA\u7279\u5B9A IP \u5730\u5740\u7684\u6D41\u91CF\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">123.456</span>.789.0 <span class="token parameter variable">-j</span> DROP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>\u5141\u8BB8\u7279\u5B9A\u7AEF\u53E3\u7684\u6D41\u91CF\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> ACCEPT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>Iptables \u7684\u7075\u6D3B\u6027\u548C\u5F3A\u5927\u529F\u80FD\u4F7F\u5176\u6210\u4E3A Linux \u7CFB\u7EDF\u4E2D\u7BA1\u7406\u7F51\u7EDC\u6D41\u91CF\u548C\u5B9E\u65BD\u5B89\u5168\u7B56\u7565\u7684\u5173\u952E\u5DE5\u5177\u3002\u7136\u800C\uFF0C\u7531\u4E8E\u5176\u590D\u6742\u6027\uFF0C\u5EFA\u8BAE\u5728\u751F\u4EA7\u73AF\u5883\u4E2D\u8C28\u614E\u4F7F\u7528\uFF0C\u5E76\u4E14\u5728\u5E94\u7528\u4EFB\u4F55\u89C4\u5219\u4E4B\u524D\u8FDB\u884C\u5145\u5206\u7684\u6D4B\u8BD5\u3002</p><h3 id="\u84DD\u7EFF\u90E8\u7F72\u7684\u5DE5\u4F5C\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#\u84DD\u7EFF\u90E8\u7F72\u7684\u5DE5\u4F5C\u539F\u7406" aria-hidden="true">#</a> \u84DD\u7EFF\u90E8\u7F72\u7684\u5DE5\u4F5C\u539F\u7406</h3><p>\u84DD\u7EFF\u90E8\u7F72\u7684\u6838\u5FC3\u601D\u60F3\u662F\u540C\u65F6\u7EF4\u62A4\u4E24\u4E2A\u751F\u4EA7\u73AF\u5883\uFF08\u6216\u90E8\u7F72\uFF09\u7684\u5B8C\u5168\u4E0D\u540C\u7248\u672C\uFF1A\u4E00\u4E2A\u84DD\u8272\uFF08Blue\uFF09\u7248\u672C\u548C\u4E00\u4E2A\u7EFF\u8272\uFF08Green\uFF09\u7248\u672C\u3002</p><ul><li><strong>\u84DD\u8272\u90E8\u7F72</strong>\uFF1A\u5F53\u524D\u8FD0\u884C\u7684\u65E7\u7248\u672C\u3002</li><li><strong>\u7EFF\u8272\u90E8\u7F72</strong>\uFF1A\u65B0\u7248\u672C\uFF0C\u4E0E\u84DD\u8272\u90E8\u7F72\u76F8\u540C\u4F46\u5305\u542B\u66F4\u65B0\u3002</li></ul><p>\u8FD9\u4E24\u4E2A\u90E8\u7F72\u90FD\u4F1A\u5B8C\u5168\u6269\u5C55\uFF0C\u4F46\u5728\u4EFB\u4F55\u65F6\u523B\uFF0C\u53EA\u6709\u4E00\u4E2A\u90E8\u7F72\uFF08\u84DD\u8272\u6216\u7EFF\u8272\uFF09\u4F1A\u63A5\u6536\u5230\u6240\u6709\u4F20\u5165\u6D41\u91CF\u3002</p><h3 id="\u4F7F\u7528-nginx-ingress-\u63A7\u5236\u5668\u5B9E\u73B0\u84DD\u7EFF\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528-nginx-ingress-\u63A7\u5236\u5668\u5B9E\u73B0\u84DD\u7EFF\u90E8\u7F72" aria-hidden="true">#</a> \u4F7F\u7528 Nginx Ingress \u63A7\u5236\u5668\u5B9E\u73B0\u84DD\u7EFF\u90E8\u7F72</h3><ol><li><p><strong>\u6D41\u91CF\u8DEF\u7531</strong>\uFF1A</p><ul><li><p>\u5728\u84DD\u7EFF\u90E8\u7F72\u4E2D\uFF0CNginx Ingress \u63A7\u5236\u5668\u53EF\u4EE5\u7528\u4E8E\u5C06100%\u7684\u6D41\u91CF\u8DEF\u7531\u5230\u84DD\u8272\u6216\u7EFF\u8272\u90E8\u7F72\u3002\u6216\u8005\u662F\u5C06\u90E8\u5206\u7684\u6D41\u91CF\u8DEF\u7531\u5230\u84DD\u8272\u90E8\u7F72\uFF0C\u90E8\u5206\u7684\u6D41\u91CF\u8DEF\u7531\u5230\u7EFF\u8272\u90E8\u7F72\u3002</p><blockquote><p>\u54C8\u54C8\u54C8\u4F46\u662F\u8FD9\u6837\u8C8C\u4F3C\u5C31\u4E0D\u662F\u84DD\u7EFF\u90E8\u7F72\u4E86\uFF0C\u6709\u70B9\u50CF\u662F\u91D1\u4E1D\u96C0\u90E8\u7F72\uFF1A</p><p>\u5982\u679C\u60A8\u7684\u9700\u6C42\u662F\u540C\u65F6\u5411\u84DD\u8272\u548C\u7EFF\u8272\u90E8\u7F72\u5206\u914D\u6D41\u91CF\uFF0C\u90A3\u4E48\u60A8\u53EF\u80FD\u9700\u8981\u8003\u8651\u4F7F\u7528\u91D1\u4E1D\u96C0\u90E8\u7F72\uFF08Canary Deployment\uFF09\u3002\u5728\u91D1\u4E1D\u96C0\u90E8\u7F72\u4E2D\uFF0C\u65B0\u7248\u672C\uFF08\u91D1\u4E1D\u96C0\uFF09\u6700\u521D\u53EA\u63A5\u6536\u4E00\u5C0F\u90E8\u5206\u6D41\u91CF\uFF0C\u800C\u4E3B\u8981\u6D41\u91CF\u4ECD\u7136\u8DEF\u7531\u5230\u65E7\u7248\u672C\u3002\u6839\u636E\u65B0\u7248\u672C\u7684\u6027\u80FD\u548C\u7A33\u5B9A\u6027\uFF0C\u9010\u6E10\u589E\u52A0\u6D41\u5411\u65B0\u7248\u672C\u7684\u6D41\u91CF\u6BD4\u4F8B\u3002</p></blockquote></li><li><p>\u8FD9\u662F\u901A\u8FC7\u66F4\u65B0 Ingress \u8D44\u6E90\u6765\u5B9E\u73B0\u7684\uFF0C\u8BE5\u8D44\u6E90\u51B3\u5B9A\u4E86\u54EA\u4E2A\u670D\u52A1\uFF08\u84DD\u8272\u8FD8\u662F\u7EFF\u8272\uFF09\u5C06\u63A5\u6536\u6D41\u91CF\u3002</p></li></ul></li><li><p><strong>Kubernetes Service \u7684\u5C40\u9650\u6027</strong>\uFF1A</p><ul><li>Kubernetes Service \u57FA\u4E8E iptables \u5B9E\u73B0\uFF0C\u4E0D\u4F1A\u91CD\u7F6E\u4E0EPod\u7684\u73B0\u6709\u8FDE\u63A5\u3002</li><li>\u8FD9\u610F\u5473\u7740\u5728\u8FDB\u884C\u7248\u672C\u5207\u6362\u65F6\uFF0C\u4E00\u4E9B\u73B0\u6709\u7684\u8FDE\u63A5\u53EF\u80FD\u4ECD\u7136\u6307\u5411\u65E7\u7248\u672C\u7684Pod\uFF0C\u8FD9\u5BF9\u4E8E\u9700\u8981\u7ACB\u5373\u5207\u6362\u548C\u5FEB\u901F\u56DE\u6EDA\u7684\u5E94\u7528\u4E0D\u662F\u6700\u4F73\u9009\u62E9\u3002</li><li>\u56E0\u6B64\uFF0C\u5BF9\u4E8E\u84DD\u7EFF\u90E8\u7F72\uFF0C\u4F7F\u7528\u50CF Nginx \u8FD9\u6837\u7684 Ingress \u63A7\u5236\u5668\u53EF\u4EE5\u66F4\u597D\u5730\u7BA1\u7406\u6D41\u91CF\u5207\u6362\uFF0C\u56E0\u4E3A\u5B83\u80FD\u66F4\u7CBE\u786E\u5730\u63A7\u5236\u6D41\u91CF\u7684\u8DEF\u7531\u3002</li></ul></li></ol><h3 id="\u4F7F\u7528-deployment-\u5B9E\u73B0\u84DD\u7EFF\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528-deployment-\u5B9E\u73B0\u84DD\u7EFF\u90E8\u7F72" aria-hidden="true">#</a> \u4F7F\u7528 Deployment \u5B9E\u73B0\u84DD\u7EFF\u90E8\u7F72</h3><p><img src="http://sm.nsddd.top/sm202311270932090.png" alt="deployment-blue-green"></p><blockquote><p>The diagram illustrating the concept of Blue-Green Deployment in a Kubernetes environment using NGINX Ingress and Deployments is ready. It visually explains how traffic is directed to either the Blue or Green Deployments, showcasing the clear separation and traffic management between these two deployments.</p></blockquote><p>\u8981\u4F7F\u7528 Ingress \u5B9E\u73B0 Kubernetes \u4E2D\u7684\u84DD\u7EFF\u90E8\u7F72\uFF0C\u60A8\u9700\u8981\u51C6\u5907\u4E24\u5957\u5B8C\u5168\u4E00\u6837\u4F46\u4E0D\u540C\u7248\u672C\u7684\u5E94\u7528\u90E8\u7F72\uFF08Deployment\uFF09\uFF0C\u4E00\u4E2A Ingress \u63A7\u5236\u5668\uFF08\u4F8B\u5982 NGINX\uFF09\uFF0C\u4EE5\u53CA\u4E00\u4E2A Ingress \u8D44\u6E90\u6765\u63A7\u5236\u6D41\u91CF\u7684\u8DEF\u7531\u3002\u4EE5\u4E0B\u662F\u5B9E\u73B0\u8FD9\u4E00\u7B56\u7565\u7684\u6B65\u9AA4\u548C\u793A\u4F8B\u4EE3\u7801\u3002</p><h3 id="\u8BBE\u8BA1\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#\u8BBE\u8BA1\u65B9\u6848" aria-hidden="true">#</a> \u8BBE\u8BA1\u65B9\u6848</h3><ol><li><strong>\u51C6\u5907\u4E24\u4E2A Deployment</strong>\uFF1A <ul><li>\u4E00\u4E2A\u201C\u84DD\u8272\u201DDeployment\uFF0C\u8FD0\u884C\u5F53\u524D\u7248\u672C\u7684\u5E94\u7528\u3002</li><li>\u4E00\u4E2A\u201C\u7EFF\u8272\u201DDeployment\uFF0C\u8FD0\u884C\u65B0\u7248\u672C\u7684\u5E94\u7528\u3002</li></ul></li><li><strong>\u914D\u7F6E Service</strong>\uFF1A <ul><li>\u4E3A\u6BCF\u4E2A Deployment \u521B\u5EFA\u4E00\u4E2A Service\u3002\u8FD9\u4E9B Service \u5C06\u4F5C\u4E3A\u6D41\u91CF\u7684\u5165\u53E3\u70B9\u3002</li></ul></li><li><strong>\u8BBE\u7F6E Ingress \u63A7\u5236\u5668</strong>\uFF1A <ul><li>\u786E\u4FDD\u60A8\u7684 Kubernetes \u96C6\u7FA4\u4E2D\u5DF2\u5B89\u88C5\u5E76\u8FD0\u884C\u4E86 Ingress \u63A7\u5236\u5668\uFF0C\u4F8B\u5982 NGINX\u3002</li></ul></li><li><strong>\u7F16\u5199 Ingress \u8D44\u6E90</strong>\uFF1A <ul><li>\u521B\u5EFA\u4E00\u4E2A Ingress \u8D44\u6E90\u6765\u5B9A\u4E49\u6D41\u91CF\u8DEF\u7531\u89C4\u5219\u3002\u5F00\u59CB\u65F6\uFF0C\u5C06\u6240\u6709\u6D41\u91CF\u8DEF\u7531\u5230\u84DD\u8272 Deployment\u3002</li><li>\u5F53\u51C6\u5907\u5C06\u6D41\u91CF\u5207\u6362\u5230\u7EFF\u8272 Deployment \u65F6\uFF0C\u66F4\u65B0 Ingress \u8D44\u6E90\u3002</li></ul></li><li><strong>\u76D1\u63A7\u548C\u5207\u6362</strong>\uFF1A <ul><li>\u5728\u5207\u6362\u6D41\u91CF\u4E4B\u524D\uFF0C\u786E\u4FDD\u7EFF\u8272 Deployment \u5B8C\u5168\u5C31\u7EEA\u4E14\u6D4B\u8BD5\u65E0\u8BEF\u3002</li><li>\u901A\u8FC7\u66F4\u65B0 Ingress \u89C4\u5219\uFF0C\u5C06\u6D41\u91CF\u4ECE\u84DD\u8272\u5207\u6362\u5230\u7EFF\u8272 Deployment\u3002</li><li>\u5982\u679C\u65B0\u7248\u672C\u8FD0\u884C\u6B63\u5E38\uFF0C\u7EE7\u7EED\u5C06\u6D41\u91CF\u8DEF\u7531\u5230\u7EFF\u8272 Deployment\uFF1B\u5982\u679C\u6709\u95EE\u9898\uFF0C\u53EF\u4EE5\u5FEB\u901F\u5207\u56DE\u84DD\u8272 Deployment\u3002</li></ul></li></ol><p><strong>\u793A\u4F8B\u4EE3\u7801\uFF1A</strong></p><p><strong>\u84DD\u8272 Deployment</strong> (<code>blue-deployment.yaml</code>):</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> blue<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
      <span class="token key atrule">version</span><span class="token punctuation">:</span> blue
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
        <span class="token key atrule">version</span><span class="token punctuation">:</span> blue
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp
        <span class="token key atrule">image</span><span class="token punctuation">:</span> myapp<span class="token punctuation">:</span>blue
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u7EFF\u8272 Deployment</strong> (<code>green-deployment.yaml</code>):</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> green<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
      <span class="token key atrule">version</span><span class="token punctuation">:</span> green
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
        <span class="token key atrule">version</span><span class="token punctuation">:</span> green
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp
        <span class="token key atrule">image</span><span class="token punctuation">:</span> myapp<span class="token punctuation">:</span>green

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u7ED3\u5408argo Rollouts</strong></p><p>\u8981\u5C06 Argo Rollouts \u4E0E\u84DD\u7EFF\u90E8\u7F72\u7ED3\u5408\u8D77\u6765\uFF0C\u60A8\u53EF\u4EE5\u901A\u8FC7 Argo Rollouts \u5B9A\u4E49\u548C\u7BA1\u7406\u84DD\u7EFF\u90E8\u7F72\u8FC7\u7A0B\uFF0C\u540C\u65F6\u5229\u7528\u5176\u5F3A\u5927\u7684\u6D41\u91CF\u63A7\u5236\u548C\u81EA\u52A8\u5316\u56DE\u6EDA\u529F\u80FD\u3002\u8FD9\u9700\u8981\u60A8\u5728 Kubernetes \u96C6\u7FA4\u4E2D\u5B89\u88C5 Argo Rollouts \u63A7\u5236\u5668\uFF0C\u5E76\u5B9A\u4E49\u76F8\u5E94\u7684 Rollout \u8D44\u6E90\u6765\u4EE3\u66FF\u6807\u51C6\u7684 Deployment \u8D44\u6E90\u3002</p><h3 id="\u7ED3\u5408argo-rollouts\u8BBE\u8BA1\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#\u7ED3\u5408argo-rollouts\u8BBE\u8BA1\u65B9\u6848" aria-hidden="true">#</a> \u7ED3\u5408argo Rollouts\u8BBE\u8BA1\u65B9\u6848</h3><ol><li><strong>\u5B89\u88C5 Argo Rollouts \u63A7\u5236\u5668</strong>\uFF1A <ul><li>\u786E\u4FDD\u60A8\u7684 Kubernetes \u96C6\u7FA4\u4E2D\u5DF2\u7ECF\u5B89\u88C5\u4E86 Argo Rollouts\u3002</li></ul></li><li><strong>\u5B9A\u4E49 Rollout \u8D44\u6E90</strong>\uFF1A <ul><li>\u66FF\u4EE3\u4F20\u7EDF\u7684 Deployment \u8D44\u6E90\uFF0C\u4F7F\u7528 Rollout \u8D44\u6E90\u6765\u5B9A\u4E49\u60A8\u7684\u5E94\u7528\u90E8\u7F72\u3002</li><li>\u5728 Rollout \u914D\u7F6E\u4E2D\u6307\u5B9A\u84DD\u7EFF\u90E8\u7F72\u7B56\u7565\u3002</li></ul></li><li><strong>\u914D\u7F6E Service</strong>\uFF1A <ul><li>\u5B9A\u4E49 Service \u6765\u6307\u5411 Rollout \u7BA1\u7406\u7684 Pods\u3002</li></ul></li><li><strong>\u914D\u7F6E Ingress</strong>\uFF1A <ul><li>\u4F7F\u7528 Ingress \u8D44\u6E90\u6765\u63A7\u5236\u5916\u90E8\u6D41\u91CF\u8FDB\u5165\u60A8\u7684\u670D\u52A1\u3002</li></ul></li><li><strong>\u6D41\u91CF\u8F6C\u79FB</strong>\uFF1A <ul><li>\u5229\u7528 Argo Rollouts \u7684\u80FD\u529B\u6765\u7BA1\u7406\u4ECE\u84DD\u8272\u5230\u7EFF\u8272\u7684\u6D41\u91CF\u8F6C\u79FB\u3002</li></ul></li></ol><h3 id="\u793A\u4F8B\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B\u4EE3\u7801" aria-hidden="true">#</a> \u793A\u4F8B\u4EE3\u7801</h3><ol><li><p><strong>Rollout \u8D44\u6E90</strong> (<code>blue-green-rollout.yaml</code>):</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> argoproj.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Rollout
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> bluegreen<span class="token punctuation">-</span>rollout
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp
        <span class="token key atrule">image</span><span class="token punctuation">:</span> myapp<span class="token punctuation">:</span>latest
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">blueGreen</span><span class="token punctuation">:</span> 
      <span class="token key atrule">activeService</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>active
      <span class="token key atrule">previewService</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>preview
      <span class="token key atrule">autoPromotionEnabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Active Service</strong> (<code>active-service.yaml</code>):</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>active
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Preview Service</strong> (<code>preview-service.yaml</code>):</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>preview
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
    <span class="token key atrule">rollouts-pod-template-hash</span><span class="token punctuation">:</span> &lt;HASH<span class="token punctuation">&gt;</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Ingress \u8D44\u6E90</strong> (<code>ingress.yaml</code>):</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>ingress
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
        <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">service</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>active
            <span class="token key atrule">port</span><span class="token punctuation">:</span>
              <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>\u5728\u8FD9\u4E2A\u65B9\u6848\u4E2D\uFF0C<code>activeService</code> \u548C <code>previewService</code> \u5206\u522B\u4EE3\u8868\u5F53\u524D\u6D3B\u8DC3\u7248\u672C\u548C\u9884\u89C8\uFF08\u65B0\u7248\u672C\uFF09\u7684\u670D\u52A1\u3002Argo Rollouts \u4F1A\u6839\u636E\u914D\u7F6E\u81EA\u52A8\u7BA1\u7406\u84DD\u7EFF\u90E8\u7F72\u8FC7\u7A0B\uFF0C\u5305\u62EC\u6D41\u91CF\u7684\u8F6C\u79FB\u3002\u60A8\u53EF\u4EE5\u901A\u8FC7\u66F4\u65B0 Rollout \u8D44\u6E90\u4E2D\u7684\u955C\u50CF\u7248\u672C\u6765\u89E6\u53D1\u65B0\u7684\u90E8\u7F72\uFF0C\u5E76\u4F7F\u7528 Argo Rollouts \u7684\u547D\u4EE4\u884C\u5DE5\u5177\u6765\u63A7\u5236\u6D41\u91CF\u8F6C\u79FB\u548C\u4FC3\u8FDB\u65B0\u7248\u672C\u7684\u53D1\u5E03\u3002</p><h2 id="\u91D1\u4E1D\u96C0\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u91D1\u4E1D\u96C0\u90E8\u7F72" aria-hidden="true">#</a> \u91D1\u4E1D\u96C0\u90E8\u7F72</h2><p>\u91D1\u4E1D\u96C0\u90E8\u7F72\u662F\u4E00\u79CD\u6280\u672F\uFF1A</p><blockquote><p>\u91D1\u4E1D\u96C0\u90E8\u7F72\uFF08Canary Deployment\uFF09\u662F\u4E00\u79CD\u8F6F\u4EF6\u53D1\u5E03\u6280\u672F\uFF0C\u5B83\u5728\u66F4\u65B0\u5E94\u7528\u7A0B\u5E8F\u65F6\u91C7\u53D6\u9010\u6B65\u7684\u65B9\u6CD5\uFF0C\u4EE5\u6700\u5C0F\u5316\u98CE\u9669\u3002\u8FD9\u79CD\u7B56\u7565\u7684\u547D\u540D\u6E90\u4E8E\u77FF\u5DE5\u4F7F\u7528\u91D1\u4E1D\u96C0\u4F5C\u4E3A\u4E00\u79CD\u5B89\u5168\u9884\u8B66\u7CFB\u7EDF\u7684\u5386\u53F2\u3002\u5728\u8F6F\u4EF6\u90E8\u7F72\u7684\u8BED\u5883\u4E2D\uFF0C\u5B83\u4EE3\u8868\u4E86\u9010\u6E10\u5F15\u5165\u65B0\u7248\u672C\u5E94\u7528\u7A0B\u5E8F\u7684\u8FC7\u7A0B\uFF0C\u4EE5\u4FBF\u5728\u5168\u9762\u90E8\u7F72\u524D\u5BF9\u5176\u8FDB\u884C\u6D4B\u8BD5\u548C\u9A8C\u8BC1\u3002</p></blockquote><h3 id="\u7279\u70B9" tabindex="-1"><a class="header-anchor" href="#\u7279\u70B9" aria-hidden="true">#</a> \u7279\u70B9</h3><ol><li><strong>\u9010\u6B65\u63A8\u51FA</strong>\uFF1A <ul><li>\u65B0\u7248\u672C\u521D\u59CB\u53EA\u5411\u4E00\u5C0F\u90E8\u5206\u7528\u6237\u6216\u73AF\u5883\u53D1\u5E03\uFF0C\u800C\u5927\u90E8\u5206\u7528\u6237\u4ECD\u7136\u4F7F\u7528\u65E7\u7248\u672C\u3002</li></ul></li><li><strong>\u98CE\u9669\u63A7\u5236</strong>\uFF1A <ul><li>\u5982\u679C\u65B0\u7248\u672C\u8868\u73B0\u4E0D\u4F73\uFF08\u5982\u51FA\u73B0\u9519\u8BEF\u6216\u6027\u80FD\u95EE\u9898\uFF09\uFF0C\u5219\u5F71\u54CD\u7684\u7528\u6237\u8303\u56F4\u6709\u9650\uFF0C\u4E14\u53EF\u4EE5\u8FC5\u901F\u56DE\u6EDA\u3002</li></ul></li><li><strong>\u5B9E\u65F6\u53CD\u9988</strong>\uFF1A <ul><li>\u63D0\u4F9B\u673A\u4F1A\u89C2\u5BDF\u65B0\u7248\u672C\u5728\u5B9E\u9645\u73AF\u5883\u4E2D\u7684\u8868\u73B0\uFF0C\u6536\u96C6\u5B9E\u65F6\u53CD\u9988\u548C\u6027\u80FD\u6570\u636E\u3002</li></ul></li></ol><h3 id="\u5B9E\u65BD\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u65BD\u6B65\u9AA4" aria-hidden="true">#</a> \u5B9E\u65BD\u6B65\u9AA4</h3><ol><li><strong>\u521D\u59CB\u53D1\u5E03</strong>\uFF1A <ul><li>\u65B0\u7248\u672C\u6700\u521D\u53EA\u5BF9\u4E00\u5C0F\u7EC4\u7528\u6237\u6216\u4E00\u90E8\u5206\u6D41\u91CF\u53EF\u89C1\u3002</li></ul></li><li><strong>\u76D1\u63A7\u548C\u8BC4\u4F30</strong>\uFF1A <ul><li>\u5BF9\u65B0\u7248\u672C\u7684\u6027\u80FD\u3001\u7A33\u5B9A\u6027\u548C\u7528\u6237\u53CD\u9988\u8FDB\u884C\u6301\u7EED\u76D1\u63A7\u3002</li></ul></li><li><strong>\u9010\u6B65\u589E\u52A0\u8986\u76D6\u7387</strong>\uFF1A <ul><li>\u5982\u679C\u65B0\u7248\u672C\u8868\u73B0\u826F\u597D\uFF0C\u9010\u6B65\u589E\u52A0\u5176\u5BF9\u7528\u6237\u6216\u6D41\u91CF\u7684\u8986\u76D6\u8303\u56F4\u3002</li></ul></li><li><strong>\u5168\u9762\u90E8\u7F72\u6216\u56DE\u6EDA</strong>\uFF1A <ul><li>\u6839\u636E\u53CD\u9988\u548C\u76D1\u63A7\u7ED3\u679C\uFF0C\u51B3\u5B9A\u662F\u5168\u9762\u90E8\u7F72\u65B0\u7248\u672C\u8FD8\u662F\u56DE\u6EDA\u5230\u65E7\u7248\u672C\u3002</li></ul></li></ol><h3 id="\u5E94\u7528\u573A\u666F-1" tabindex="-1"><a class="header-anchor" href="#\u5E94\u7528\u573A\u666F-1" aria-hidden="true">#</a> \u5E94\u7528\u573A\u666F</h3><ul><li><strong>\u9AD8\u98CE\u9669\u66F4\u65B0</strong>\uFF1A\u5BF9\u4E8E\u53EF\u80FD\u5BF9\u7CFB\u7EDF\u7A33\u5B9A\u6027\u6216\u7528\u6237\u4F53\u9A8C\u6709\u91CD\u5927\u5F71\u54CD\u7684\u66F4\u65B0\u3002</li><li><strong>\u5927\u578B\u5E94\u7528</strong>\uFF1A\u5728\u5927\u578B\u6216\u590D\u6742\u7684\u5E94\u7528\u4E2D\uFF0C\u4E0D\u540C\u7528\u6237\u7FA4\u53EF\u80FD\u5BF9\u66F4\u65B0\u6709\u4E0D\u540C\u7684\u53CD\u5E94\u3002</li><li><strong>\u8FDE\u7EED\u90E8\u7F72\u73AF\u5883</strong>\uFF1A\u5728\u654F\u6377\u5F00\u53D1\u548C\u6301\u7EED\u96C6\u6210/\u6301\u7EED\u90E8\u7F72 (CI/CD) \u73AF\u5883\u4E2D\uFF0C\u91D1\u4E1D\u96C0\u90E8\u7F72\u53EF\u4EE5\u4F5C\u4E3A\u4E00\u79CD\u6709\u6548\u7684\u98CE\u9669\u7BA1\u7406\u5DE5\u5177\u3002</li></ul><h3 id="\u4F7F\u7528-ingress-\u548C-deployment-\u5B9E\u73B0\u91D1\u4E1D\u96C0\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528-ingress-\u548C-deployment-\u5B9E\u73B0\u91D1\u4E1D\u96C0\u90E8\u7F72" aria-hidden="true">#</a> \u4F7F\u7528 Ingress \u548C Deployment \u5B9E\u73B0\u91D1\u4E1D\u96C0\u90E8\u7F72</h3><h4 id="\u8BBE\u8BA1\u65B9\u6848-1" tabindex="-1"><a class="header-anchor" href="#\u8BBE\u8BA1\u65B9\u6848-1" aria-hidden="true">#</a> \u8BBE\u8BA1\u65B9\u6848</h4><ol><li><strong>\u51C6\u5907\u4E24\u4E2A Deployment</strong>\uFF1A <ul><li>\u4E00\u4E2A\u4E3A\u5F53\u524D\u7248\u672C\uFF08\u4F8B\u5982\uFF0C\u6807\u8BB0\u4E3A <code>version: stable</code>\uFF09\u3002</li><li>\u53E6\u4E00\u4E2A\u4E3A\u65B0\u7248\u672C\uFF08\u4F8B\u5982\uFF0C\u6807\u8BB0\u4E3A <code>version: canary</code>\uFF09\u3002</li></ul></li><li><strong>\u914D\u7F6E Service</strong>\uFF1A <ul><li>\u4E3A\u6BCF\u4E2A Deployment \u521B\u5EFA\u4E00\u4E2A Service\u3002</li></ul></li><li><strong>\u914D\u7F6E Ingress</strong>\uFF1A <ul><li>\u4F7F\u7528 Ingress \u8D44\u6E90\u5B9A\u4E49\u6D41\u91CF\u7684\u5206\u914D\u7B56\u7565\uFF0C\u6307\u5B9A\u4E00\u90E8\u5206\u6D41\u91CF\u5230\u65B0\u7248\u672C\u3002</li></ul></li></ol><h4 id="\u793A\u4F8B\u4EE3\u7801-1" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B\u4EE3\u7801-1" aria-hidden="true">#</a> \u793A\u4F8B\u4EE3\u7801</h4><ol><li><p><strong>Stable Deployment</strong> (<code>stable-deployment.yaml</code>):</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>stable
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
      <span class="token key atrule">version</span><span class="token punctuation">:</span> stable
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
        <span class="token key atrule">version</span><span class="token punctuation">:</span> stable
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp
        <span class="token key atrule">image</span><span class="token punctuation">:</span> myapp<span class="token punctuation">:</span>stable
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Canary Deployment</strong> (<code>canary-deployment.yaml</code>):</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>canary
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>  <span class="token comment"># Lesser replicas as it&#39;s a canary release</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
      <span class="token key atrule">version</span><span class="token punctuation">:</span> canary
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
        <span class="token key atrule">version</span><span class="token punctuation">:</span> canary
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp
        <span class="token key atrule">image</span><span class="token punctuation">:</span> myapp<span class="token punctuation">:</span>canary
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Service</strong> (<code>service.yaml</code>):</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yamlCopy codeapiVersion: v1
kind: Service
metadata:
  name: myapp-service
spec:
  selector:
    app: myapp
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Ingress \u8D44\u6E90</strong> (<code>ingress.yaml</code>):</p><ul><li>\u5728\u8FD9\u91CC\uFF0C\u60A8\u9700\u8981\u4F7F\u7528 Ingress \u63A7\u5236\u5668\u7684\u7279\u5B9A\u529F\u80FD\u6765\u5206\u914D\u6D41\u91CF\uFF08\u4F8B\u5982\uFF0CNGINX Ingress \u7684\u6743\u91CD\u5206\u914D\uFF09\u3002</li></ul></li></ol><h3 id="\u4F7F\u7528-argo-rollouts-\u5B9E\u73B0\u91D1\u4E1D\u96C0\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528-argo-rollouts-\u5B9E\u73B0\u91D1\u4E1D\u96C0\u90E8\u7F72" aria-hidden="true">#</a> \u4F7F\u7528 Argo Rollouts \u5B9E\u73B0\u91D1\u4E1D\u96C0\u90E8\u7F72</h3><h4 id="\u8BBE\u8BA1\u65B9\u6848-2" tabindex="-1"><a class="header-anchor" href="#\u8BBE\u8BA1\u65B9\u6848-2" aria-hidden="true">#</a> \u8BBE\u8BA1\u65B9\u6848</h4><ol><li><strong>\u5B89\u88C5 Argo Rollouts</strong>\uFF1A <ul><li>\u786E\u4FDD\u60A8\u7684 Kubernetes \u96C6\u7FA4\u4E2D\u5DF2\u7ECF\u5B89\u88C5\u4E86 Argo Rollouts\u3002</li></ul></li><li><strong>\u5B9A\u4E49 Rollout \u8D44\u6E90</strong>\uFF1A <ul><li>\u4F7F\u7528 Rollout \u8D44\u6E90\u6765\u5B9A\u4E49\u5E94\u7528\u90E8\u7F72\uFF0C\u5E76\u6307\u5B9A\u91D1\u4E1D\u96C0\u7B56\u7565\u3002</li></ul></li><li><strong>\u914D\u7F6E Service</strong>\uFF1A <ul><li>\u5B9A\u4E49 Service \u6765\u6307\u5411 Rollout \u7BA1\u7406\u7684 Pods\u3002</li></ul></li><li><strong>\u76D1\u63A7\u548C\u7BA1\u7406\u90E8\u7F72</strong>\uFF1A <ul><li>\u5229\u7528 Argo Rollouts \u63D0\u4F9B\u7684\u5DE5\u5177\u6765\u76D1\u63A7\u548C\u7BA1\u7406\u90E8\u7F72\u8FC7\u7A0B\u3002</li></ul></li></ol><h4 id="\u793A\u4F8B\u4EE3\u7801-2" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B\u4EE3\u7801-2" aria-hidden="true">#</a> \u793A\u4F8B\u4EE3\u7801</h4><ol><li><p><strong>Rollout \u8D44\u6E90</strong> (<code>canary-rollout.yaml</code>):</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> argoproj.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Rollout
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>rollout
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">4</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp
        <span class="token key atrule">image</span><span class="token punctuation">:</span> myapp<span class="token punctuation">:</span>new<span class="token punctuation">-</span>version
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">canary</span><span class="token punctuation">:</span>
      <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">setWeight</span><span class="token punctuation">:</span> <span class="token number">20</span>
      <span class="token punctuation">-</span> <span class="token key atrule">pause</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">duration</span><span class="token punctuation">:</span> 48h<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">setWeight</span><span class="token punctuation">:</span> <span class="token number">50</span>
      <span class="token punctuation">-</span> <span class="token key atrule">pause</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">duration</span><span class="token punctuation">:</span> 48h<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Service</strong> (<code>service.yaml</code>):</p><ul><li>\u540C\u4E0A\u9762\u7684 Ingress \u548C Deployment \u65B9\u6CD5\u4E2D\u7684 Service\u3002</li></ul></li></ol><p>\u5728\u4F7F\u7528 Argo Rollouts \u7684\u60C5\u51B5\u4E0B\uFF0C\u90E8\u7F72\u7684\u7BA1\u7406\u548C\u6D41\u91CF\u5206\u914D\u53D8\u5F97\u66F4\u52A0\u7B80\u5355\u548C\u76F4\u89C2\u3002\u60A8\u53EF\u4EE5\u66F4\u7CBE\u786E\u5730\u63A7\u5236\u65B0\u7248\u672C\u7684\u6D41\u91CF\u6BD4\u4F8B\uFF0C\u5E76\u5229\u7528 Rollouts \u7684\u81EA\u52A8\u5316\u7279\u6027\u6765\u76D1\u63A7\u90E8\u7F72\u7684\u5065\u5EB7\u72B6\u51B5\u548C\u81EA\u52A8\u56DE\u6EDA</p><h3 id="\u6E10\u8FDB\u5F0F\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u6E10\u8FDB\u5F0F\u90E8\u7F72" aria-hidden="true">#</a> \u6E10\u8FDB\u5F0F\u90E8\u7F72</h3><p>\u6E10\u8FDB\u5F0F\u90E8\u7F72\u662F\u91D1\u4E1D\u96C0\u90E8\u7F72\u7684\u4E00\u4E2A\u5B8C\u5168\u7684\u81EA\u52A8\u5316\u7248\u672C\u3002\u6E10\u8FDB\u5F0F\u4EA4\u4E92\u4E0D\u662F\u5728\u6269\u5927\u91D1\u4E1D\u96C0\u90E8\u7F72\u4E4B\u524D\u68C0\u6D4B\u4E00\u4E2A\u56FA\u5B9A\u7684\u65F6\u95F4\u6BB5\uFF0C\u800C\u662F\u6301\u7EED\u76D1\u6D4B Pod \u7684\u5065\u5EB7\u72B6\u6001\uFF0C\u5E76\u4E14\u4E0D\u65AD\u6269\u5927\u89C4\u6A21\uFF0C\u76F4\u5230\u5B8C\u5168\u6269\u5C55\u3002</p><h2 id="end-\u94FE\u63A5" tabindex="-1"><a class="header-anchor" href="#end-\u94FE\u63A5" aria-hidden="true">#</a> END \u94FE\u63A5</h2><ul><li><div><a href="88.md" style="float:left;">\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} </a><a href="90.md" style="float:right;"> \uFE0F\u4E0B\u4E00\u8282\u{1F517}</a></div></li></ul>`,174),N=s("\u24C2\uFE0F\u56DE\u5230\u76EE\u5F55\u{1F3E0}"),A={href:"https://nsddd.top/archives/contributors",target:"_blank",rel:"noopener noreferrer"},w=n("strong",null,"\u{1FAF5}\u53C2\u4E0E\u8D21\u732E\u{1F49E}\u2764\uFE0F\u200D\u{1F525}\u{1F496}",-1),E=s(")"),T=s("\u2734\uFE0F\u7248\u6743\u58F0\u660E \xA9 \uFF1A\u672C\u4E66\u6240\u6709\u5185\u5BB9\u9075\u5FAA"),q={href:"http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},L=s("CC-BY-SA 3.0\u534F\u8BAE\uFF08\u7F72\u540D-\u76F8\u540C\u65B9\u5F0F\u5171\u4EAB\uFF09\xA9");function H(V,U){const e=l("ExternalLinkIcon"),i=l("RouterLink");return p(),r("div",null,[n("ul",null,[n("li",null,[n("a",d,[k,a(e)])])]),v,m,b,n("blockquote",null,[n("p",null,[g,n("a",h,[y,a(e)])])]),f,n("p",null,[x,n("a",R,[O,a(e)]),C]),n("p",null,[G,n("a",I,[S,a(e)]),D]),n("p",null,[n("a",P,[K,a(e)])]),_,n("ul",null,[n("li",null,[n("p",null,[a(i,{to:"/"},{default:c(()=>[N]),_:1})])]),n("li",null,[n("p",null,[n("a",A,[w,a(e)]),E])]),n("li",null,[n("p",null,[T,n("a",q,[L,a(e)])])])])])}const M=o(u,[["render",H],["__file","89.html.vue"]]);export{M as default};
