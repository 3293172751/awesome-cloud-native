import{_ as c,r as i,o,c as p,a as n,b as e,w as r,e as s,d as t}from"./app.9f3e6cab.js";const u={},d={href:"http://nsddd.top",target:"_blank",rel:"noopener noreferrer"},k=s("author"),v=n("h1",{id:"\u7B2C77\u8282-\u7BA1\u7406\u96C6\u7FA4\u4E2D\u7684-tls-\u8BA4\u8BC1",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u7B2C77\u8282-\u7BA1\u7406\u96C6\u7FA4\u4E2D\u7684-tls-\u8BA4\u8BC1","aria-hidden":"true"},"#"),s(" \u7B2C77\u8282 \u7BA1\u7406\u96C6\u7FA4\u4E2D\u7684 TLS \u8BA4\u8BC1")],-1),m=n("div",null,[n("a",{href:"76.md",style:{float:"left"}},"\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} "),n("a",{href:"78.md",style:{float:"right"}}," \u2B07\uFE0F\u4E0B\u4E00\u8282\u{1F517}")],-1),b=n("br",null,null,-1),h=s("\u2764\uFE0F\u{1F495}\u{1F495}\u65B0\u65F6\u4EE3\u62E5\u62B1\u4E91\u539F\u751F\uFF0C\u4E91\u539F\u751F\u5177\u6709\u73AF\u5883\u7EDF\u4E00\u3001\u6309\u9700\u4ED8\u8D39\u3001\u5373\u5F00\u5373\u7528\u3001\u7A33\u5B9A\u6027\u5F3A\u7279\u70B9\u3002Myblog:"),g={href:"http://nsddd.top/",target:"_blank",rel:"noopener noreferrer"},_=s("http://nsddd.top"),y=n("hr",null,null,-1),f=n("p",null,"[TOC]",-1),x=n("h2",{id:"\u7BA1\u7406\u96C6\u7FA4\u4E2D\u7684-tls-\u8BA4\u8BC1",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u7BA1\u7406\u96C6\u7FA4\u4E2D\u7684-tls-\u8BA4\u8BC1","aria-hidden":"true"},"#"),s(" \u7BA1\u7406\u96C6\u7FA4\u4E2D\u7684 TLS \u8BA4\u8BC1")],-1),S=n("p",null,[s("Kubernetes \u63D0\u4F9B "),n("code",null,"certificates.k8s.io"),s(" API\uFF0C\u53EF\u8BA9\u4F60\u914D\u7F6E\u7531\u4F60\u63A7\u5236\u7684\u8BC1\u4E66\u9881\u53D1\u673A\u6784\uFF08CA\uFF09 \u7B7E\u540D\u7684 TLS \u8BC1\u4E66\u3002 \u4F60\u7684\u5DE5\u4F5C\u8D1F\u8F7D\u53EF\u4EE5\u4F7F\u7528\u8FD9\u4E9B CA \u548C\u8BC1\u4E66\u6765\u5EFA\u7ACB\u4FE1\u4EFB\u3002")],-1),C=n("code",null,"certificates.k8s.io",-1),P=s(" API\u4F7F\u7528\u7684\u534F\u8BAE\u7C7B\u4F3C\u4E8E "),I={href:"https://github.com/ietf-wg-acme/acme/",target:"_blank",rel:"noopener noreferrer"},T=s("ACME \u8349\u6848"),N=s("\u3002"),A=n("h3",{id:"\u96C6\u7FA4\u4E2D\u7684-tls-\u4FE1\u4EFB",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u96C6\u7FA4\u4E2D\u7684-tls-\u4FE1\u4EFB","aria-hidden":"true"},"#"),s(" \u96C6\u7FA4\u4E2D\u7684 TLS \u4FE1\u4EFB")],-1),E=s("\u4FE1\u4EFB Pod \u4E2D\u8FD0\u884C\u7684\u5E94\u7528\u7A0B\u5E8F\u6240\u63D0\u4F9B\u7684"),q={href:"https://kubernetes.io/zh-cn/docs/tasks/tls/managing-tls-in-a-cluster/#configuring-your-cluster-to-provide-signing",target:"_blank",rel:"noopener noreferrer"},R=s("\u81EA\u5B9A\u4E49 CA"),z=s(" \u901A\u5E38\u9700\u8981\u4E00\u4E9B\u989D\u5916\u7684\u5E94\u7528\u7A0B\u5E8F\u914D\u7F6E\u3002 \u4F60\u9700\u8981\u5C06 CA \u8BC1\u4E66\u5305\u6DFB\u52A0\u5230 TLS \u5BA2\u6237\u7AEF\u6216\u670D\u52A1\u5668\u4FE1\u4EFB\u7684 CA \u8BC1\u4E66\u5217\u8868\u4E2D\u3002 \u4F8B\u5982\uFF0C\u4F60\u53EF\u4EE5\u4F7F\u7528 Golang TLS \u914D\u7F6E\u901A\u8FC7\u89E3\u6790\u8BC1\u4E66\u94FE\u5E76\u5C06\u89E3\u6790\u7684\u8BC1\u4E66\u6DFB\u52A0\u5230 "),L={href:"https://pkg.go.dev/crypto/tls#Config",target:"_blank",rel:"noopener noreferrer"},w=n("code",null,"tls.Config",-1),D=s(" \u7ED3\u6784\u4E2D\u7684 "),M=n("code",null,"RootCAs",-1),K=s(" \u5B57\u6BB5\u4E2D\u3002"),O=n("p",null,[n("strong",null,"\u8BF4\u660E\uFF1A")],-1),F=n("p",null,[s("\u5373\u4F7F\u81EA\u5B9A\u4E49 CA \u8BC1\u4E66\u53EF\u80FD\u5305\u542B\u5728\u6587\u4EF6\u7CFB\u7EDF\u4E2D\uFF08\u5728 ConfigMap "),n("code",null,"kube-root-ca.crt"),s(" \u4E2D\uFF09\uFF0C \u9664\u4E86\u9A8C\u8BC1\u5185\u90E8 Kubernetes \u7AEF\u70B9\u4E4B\u5916\uFF0C\u4F60\u4E0D\u5E94\u5C06\u8BE5\u8BC1\u4E66\u9881\u53D1\u673A\u6784\u7528\u4E8E\u4EFB\u4F55\u76EE\u7684\u3002 \u5185\u90E8 Kubernetes \u7AEF\u70B9\u7684\u4E00\u4E2A\u793A\u4F8B\u662F\u9ED8\u8BA4\u547D\u540D\u7A7A\u95F4\u4E2D\u540D\u4E3A "),n("code",null,"kubernetes"),s(" \u7684\u670D\u52A1\u3002")],-1),V=s("\u5982\u679C\u4F60\u60F3\u4E3A\u4F60\u7684\u5DE5\u4F5C\u8D1F\u8F7D\u4F7F\u7528\u81EA\u5B9A\u4E49\u8BC1\u4E66\u9881\u53D1\u673A\u6784\uFF0C\u4F60\u5E94\u8BE5\u5355\u72EC\u751F\u6210\u8BE5 CA\uFF0C \u5E76\u4F7F\u7528\u4F60\u7684 Pod \u6709\u8BFB\u6743\u9650\u7684 "),B={href:"https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-pod-configmap",target:"_blank",rel:"noopener noreferrer"},H=s("ConfigMap"),j=s(" \u5206\u53D1\u8BE5 CA \u8BC1\u4E66\u3002"),G=n("h3",{id:"\u8BF7\u6C42\u8BC1\u4E66",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u8BF7\u6C42\u8BC1\u4E66","aria-hidden":"true"},"#"),s(" \u8BF7\u6C42\u8BC1\u4E66")],-1),U=n("p",null,"\u4EE5\u4E0B\u90E8\u5206\u6F14\u793A\u5982\u4F55\u4E3A\u901A\u8FC7 DNS \u8BBF\u95EE\u7684 Kubernetes \u670D\u52A1\u521B\u5EFA TLS \u8BC1\u4E66\u3002",-1),Z=n("strong",null,"\u8BF4\u660E\uFF1A",-1),W=s(" \u672C\u6559\u7A0B\u4F7F\u7528 CFSSL\uFF1ACloudflare's PKI \u548C TLS \u5DE5\u5177\u5305 "),Y={href:"https://blog.cloudflare.com/introducing-cfssl/",target:"_blank",rel:"noopener noreferrer"},Q=s("\u70B9\u51FB\u6B64\u5904"),X=s("\u4E86\u89E3\u66F4\u591A\u4FE1\u606F\u3002"),$=t(`<h3 id="\u521B\u5EFA\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42" aria-hidden="true">#</a> \u521B\u5EFA\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42</h3><p>\u901A\u8FC7\u8FD0\u884C\u4EE5\u4E0B\u547D\u4EE4\u751F\u6210\u79C1\u94A5\u548C\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42\uFF08\u6216 CSR\uFF09:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cat &lt;&lt;EOF | cfssl genkey - | cfssljson -bare server
{
  &quot;hosts&quot;: [
    &quot;my-svc.my-namespace.svc.cluster.local&quot;,
    &quot;my-pod.my-namespace.pod.cluster.local&quot;,
    &quot;192.0.2.24&quot;,
    &quot;10.0.34.2&quot;
  ],
  &quot;CN&quot;: &quot;my-pod.my-namespace.pod.cluster.local&quot;,
  &quot;key&quot;: {
    &quot;algo&quot;: &quot;ecdsa&quot;,
    &quot;size&quot;: 256
  }
}
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5176\u4E2D <code>192.0.2.24</code> \u662F\u670D\u52A1\u7684\u96C6\u7FA4 IP\uFF0C<code>my-svc.my-namespace.svc.cluster.local</code> \u662F\u670D\u52A1\u7684 DNS \u540D\u79F0\uFF0C<code>10.0.34.2</code> \u662F Pod \u7684 IP\uFF0C\u800C <code>my-pod.my-namespace.pod.cluster.local</code> \u662F Pod \u7684 DNS \u540D\u79F0\u3002 \u4F60\u80FD\u770B\u5230\u7684\u8F93\u51FA\u7C7B\u4F3C\u4E8E\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>2022/02/01 11:45:32 [INFO] generate received request
2022/02/01 11:45:32 [INFO] received CSR
2022/02/01 11:45:32 [INFO] generating key: ecdsa-256
2022/02/01 11:45:32 [INFO] encoded CSR
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),J=s("\u6B64\u547D\u4EE4\u751F\u6210\u4E24\u4E2A\u6587\u4EF6\uFF1B\u5B83\u751F\u6210\u5305\u542B PEM \u7F16\u7801 "),nn={href:"https://tools.ietf.org/html/rfc2986",target:"_blank",rel:"noopener noreferrer"},sn=s("PKCS#10"),en=s(" \u8BC1\u4E66\u8BF7\u6C42\u7684 "),an=n("code",null,"server.csr",-1),tn=s("\uFF0C \u4EE5\u53CA PEM \u7F16\u7801\u5BC6\u94A5\u7684 "),ln=n("code",null,"server-key.pem",-1),cn=s("\uFF0C\u7528\u4E8E\u5F85\u751F\u6210\u7684\u8BC1\u4E66\u3002"),on=t(`<h3 id="\u521B\u5EFA\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42-csr-\u5BF9\u8C61\u53D1\u9001\u5230-kubernetes-api" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42-csr-\u5BF9\u8C61\u53D1\u9001\u5230-kubernetes-api" aria-hidden="true">#</a> \u521B\u5EFA\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42\uFF08CSR\uFF09\u5BF9\u8C61\u53D1\u9001\u5230 Kubernetes API</h3><p>\u4F60\u53EF\u4EE5\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4\u521B\u5EFA CSR \u6E05\u5355\uFF08YAML \u683C\u5F0F\uFF09\uFF0C\u5E76\u53D1\u9001\u5230 API \u670D\u52A1\u5668\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> kubectl apply <span class="token parameter variable">-f</span> -</span>
apiVersion: certificates.k8s.io/v1
kind: CertificateSigningRequest
metadata:
  name: my-svc.my-namespace
spec:
  request: <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> server.csr <span class="token operator">|</span> base64 <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">&#39;\\n&#39;</span><span class="token variable">)</span></span>
  signerName: example.com/serving
  usages:
  - digital signature
  - key encipherment
  - server auth
EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),pn=s("\u8BF7\u6CE8\u610F\uFF0C\u5728\u6B65\u9AA4 1 \u4E2D\u521B\u5EFA\u7684 "),rn=n("code",null,"server.csr",-1),un=s(" \u6587\u4EF6\u662F base64 \u7F16\u7801\u5E76\u5B58\u50A8\u5728 "),dn=n("code",null,".spec.request",-1),kn=s(" \u5B57\u6BB5\u4E2D\u7684\u3002\u4F60\u8FD8\u8981\u6C42\u63D0\u4F9B \u201Cdigital signature\uFF08\u6570\u5B57\u7B7E\u540D\uFF09\u201D\uFF0C \u201C\u5BC6\u94A5\u52A0\u5BC6\uFF08key encipherment\uFF09\u201D \u548C \u201C\u670D\u52A1\u5668\u8EAB\u4EFD\u9A8C\u8BC1\uFF08server auth\uFF09\u201D \u5BC6\u94A5\u7528\u9014\uFF0C \u7531 "),vn=n("code",null,"example.com/serving",-1),mn=s(" \u793A\u4F8B\u7B7E\u540D\u7A0B\u5E8F\u7B7E\u540D\u7684\u8BC1\u4E66\u3002 \u4F60\u4E5F\u53EF\u4EE5\u8981\u6C42\u4F7F\u7528\u7279\u5B9A\u7684 "),bn=n("code",null,"signerName",-1),hn=s("\u3002\u66F4\u591A\u4FE1\u606F\u53EF\u53C2\u9605 "),gn={href:"https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/certificate-signing-requests/#signers",target:"_blank",rel:"noopener noreferrer"},_n=s("\u652F\u6301\u7684\u7B7E\u7F72\u8005\u540D\u79F0"),yn=s("\u3002"),fn=t(`<p>\u5728 API server \u4E2D\u53EF\u4EE5\u770B\u5230\u8FD9\u4E9B CSR \u5904\u4E8E Pending \u72B6\u6001\u3002\u6267\u884C\u4E0B\u9762\u7684\u547D\u4EE4\u4F60\u5C06\u53EF\u4EE5\u770B\u5230\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl describe csr my-svc.my-namespace
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u6279\u51C6\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42-csr" tabindex="-1"><a class="header-anchor" href="#\u6279\u51C6\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42-csr" aria-hidden="true">#</a> \u6279\u51C6\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42\uFF08CSR\uFF09</h3>`,3),xn={href:"https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/certificate-signing-requests/",target:"_blank",rel:"noopener noreferrer"},Sn=s("\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42"),Cn=s(" \u7684\u6279\u51C6\u6216\u8005\u662F\u901A\u8FC7\u81EA\u52A8\u6279\u51C6\u8FC7\u7A0B\u5B8C\u6210\u7684\uFF0C\u6216\u7531\u96C6\u7FA4\u7BA1\u7406\u5458\u4E00\u6B21\u6027\u5B8C\u6210\u3002 \u5982\u679C\u4F60\u88AB\u6388\u6743\u6279\u51C6\u8BC1\u4E66\u8BF7\u6C42\uFF0C\u4F60\u53EF\u4EE5\u4F7F\u7528 "),Pn=n("code",null,"kubectl",-1),In=s(" \u6765\u624B\u52A8\u5B8C\u6210\u6B64\u64CD\u4F5C\uFF1B\u4F8B\u5982\uFF1A"),Tn=t(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl certificate approve my-svc.my-namespace
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>\u5224\u65AD\u72B6\u6001\uFF1AStatus: Approved</p></blockquote><p>\u4F60\u73B0\u5728\u5E94\u8BE5\u80FD\u770B\u5230\u5982\u4E0B\u8F93\u51FA\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>controlplane $ kubectl get csr
NAME                  AGE     SIGNERNAME                                    REQUESTOR                  REQUESTEDDURATION   CONDITION
csr-46sxj             37d     kubernetes.io/kube-apiserver-client-kubelet   system:bootstrap:z6kr08    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>              Approved,Issued
csr-6z592             38d     kubernetes.io/kube-apiserver-client-kubelet   system:node:controlplane   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>              Approved,Issued
my-svc.my-namespace   9m17s   example.com/serving                           kubernetes-admin           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>              Approved
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u610F\u5473\u7740\u8BC1\u4E66\u8BF7\u6C42\u5DF2\u88AB\u6279\u51C6\uFF0C\u5E76\u6B63\u5728\u7B49\u5F85\u8BF7\u6C42\u7684\u7B7E\u540D\u8005\u5BF9\u5176\u7B7E\u540D\u3002</p><h3 id="\u7B7E\u540D\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42-csr" tabindex="-1"><a class="header-anchor" href="#\u7B7E\u540D\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42-csr" aria-hidden="true">#</a> \u7B7E\u540D\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42\uFF08CSR)</h3><p>\u63A5\u4E0B\u6765\uFF0C\u4F60\u5C06\u626E\u6F14\u8BC1\u4E66\u7B7E\u7F72\u8005\u7684\u89D2\u8272\uFF0C\u9881\u53D1\u8BC1\u4E66\u5E76\u5C06\u5176\u4E0A\u4F20\u5230 API \u670D\u52A1\u5668\u3002</p><p>\u7B7E\u540D\u8005\u901A\u5E38\u4F1A\u4F7F\u7528\u5176 <code>signerName</code> \u67E5\u770B\u5BF9\u8C61\u7684 CertificateSigningRequest API\uFF0C \u68C0\u67E5\u5B83\u4EEC\u662F\u5426\u5DF2\u88AB\u6279\u51C6\uFF0C\u4E3A\u8FD9\u4E9B\u8BF7\u6C42\u7B7E\u7F72\u8BC1\u4E66\uFF0C\u5E76\u4F7F\u7528\u5DF2\u9881\u53D1\u7684\u8BC1\u4E66\u66F4\u65B0 API \u5BF9\u8C61\u72B6\u6001\u3002</p><h3 id="\u521B\u5EFA\u8BC1\u4E66\u9881\u53D1\u673A\u6784" tabindex="-1"><a class="header-anchor" href="#\u521B\u5EFA\u8BC1\u4E66\u9881\u53D1\u673A\u6784" aria-hidden="true">#</a> \u521B\u5EFA\u8BC1\u4E66\u9881\u53D1\u673A\u6784</h3><p>\u4F60\u9700\u8981\u6388\u6743\u5728\u65B0\u8BC1\u4E66\u4E0A\u63D0\u4F9B\u6570\u5B57\u7B7E\u540D\u3002</p><p>\u9996\u5148\uFF0C\u901A\u8FC7\u8FD0\u884C\u4EE5\u4E0B\u547D\u4EE4\u521B\u5EFA\u7B7E\u540D\u8BC1\u4E66\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> cfssl gencert <span class="token parameter variable">-initca</span> - <span class="token operator">|</span> cfssljson <span class="token parameter variable">-bare</span> ca</span>
{
  &quot;CN&quot;: &quot;My Example Signer&quot;,
  &quot;key&quot;: {
    &quot;algo&quot;: &quot;rsa&quot;,
    &quot;size&quot;: 2048
  }
}
EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F60\u5E94\u8BE5\u770B\u5230\u7C7B\u4F3C\u4E8E\u4EE5\u4E0B\u7684\u8F93\u51FA\uFF1A</p><div class="language-none ext-none line-numbers-mode"><pre class="language-none"><code>2022/02/01 11:50:39 [INFO] generating a new CA key and certificate from CSR
2022/02/01 11:50:39 [INFO] generate received request
2022/02/01 11:50:39 [INFO] received CSR
2022/02/01 11:50:39 [INFO] generating key: rsa-2048
2022/02/01 11:50:39 [INFO] encoded CSR
2022/02/01 11:50:39 [INFO] signed certificate with serial number 263983151013686720899716354349605500797834580472
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD9\u4F1A\u4EA7\u751F\u4E00\u4E2A\u8BC1\u4E66\u9881\u53D1\u673A\u6784\u5BC6\u94A5\u6587\u4EF6\uFF08<code>ca-key.pem</code>\uFF09\u548C\u8BC1\u4E66\uFF08<code>ca.pem</code>\uFF09\u3002</p><h3 id="\u4E0B\u8F7D\u8BC1\u4E66\u5E76\u4F7F\u7528\u5B83" tabindex="-1"><a class="header-anchor" href="#\u4E0B\u8F7D\u8BC1\u4E66\u5E76\u4F7F\u7528\u5B83" aria-hidden="true">#</a> \u4E0B\u8F7D\u8BC1\u4E66\u5E76\u4F7F\u7528\u5B83</h3><p>\u73B0\u5728\uFF0C\u4F5C\u4E3A\u8BF7\u6C42\u7528\u6237\uFF0C\u4F60\u53EF\u4EE5\u901A\u8FC7\u8FD0\u884C\u4EE5\u4E0B\u547D\u4EE4\u4E0B\u8F7D\u9881\u53D1\u7684\u8BC1\u4E66\u5E76\u5C06\u5176\u4FDD\u5B58\u5230 <code>server.crt</code> \u6587\u4EF6\u4E2D\uFF1A</p><p>CSR \u88AB\u7B7E\u7F72\u5E76\u83B7\u5F97\u6279\u51C6\u540E\uFF0C\u4F60\u5E94\u8BE5\u770B\u5230\u4EE5\u4E0B\u5185\u5BB9\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl get csr my-svc.my-namespace <span class="token parameter variable">-o</span> <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">&#39;{.status.certificate}&#39;</span> <span class="token punctuation">\\</span>
    <span class="token operator">|</span> base64 <span class="token parameter variable">--decode</span> <span class="token operator">&gt;</span> server.crt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,19),Nn=s("\u73B0\u5728\u4F60\u53EF\u4EE5\u5C06 "),An=n("code",null,"server.crt",-1),En=s(" \u548C "),qn=n("code",null,"server-key.pem",-1),Rn=s(" \u586B\u5145\u5230 "),zn={href:"https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/",target:"_blank",rel:"noopener noreferrer"},Ln=s("Secret"),wn=s(" \u4E2D\uFF0C \u7A0D\u540E\u4F60\u53EF\u4EE5\u5C06\u5176\u6302\u8F7D\u5230 Pod \u4E2D\uFF08\u4F8B\u5982\uFF0C\u7528\u4E8E\u63D0\u4F9B HTTPS \u7684\u7F51\u7EDC\u670D\u52A1\u5668\uFF09\u3002"),Dn=t(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl create secret tls server <span class="token parameter variable">--cert</span> server.crt <span class="token parameter variable">--key</span> server-key.pem
secret/server created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,1),Mn=s("\u6700\u540E\uFF0C\u4F60\u53EF\u4EE5\u5C06 "),Kn=n("code",null,"ca.pem",-1),On=s(" \u586B\u5145\u5230 "),Fn={href:"https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-pod-configmap/",target:"_blank",rel:"noopener noreferrer"},Vn=s("ConfigMap"),Bn=s(" \u5E76\u5C06\u5176\u7528\u4F5C\u4FE1\u4EFB\u6839\u6765\u9A8C\u8BC1\u670D\u52A1\u8BC1\u4E66\uFF1A"),Hn=t(`<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl create configmap example-serving-ca --from-file <span class="token assign-left variable">ca.crt</span><span class="token operator">=</span>ca.pem
configmap/example-serving-ca created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6279\u51C6\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42-csr-1" tabindex="-1"><a class="header-anchor" href="#\u6279\u51C6\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42-csr-1" aria-hidden="true">#</a> \u6279\u51C6\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42\uFF08CSR\uFF09</h3><p>Kubernetes \u7BA1\u7406\u5458\uFF08\u5177\u6709\u9002\u5F53\u6743\u9650\uFF09\u53EF\u4EE5\u4F7F\u7528 <code>kubectl certificate approve</code> \u548C <code>kubectl certificate deny</code> \u547D\u4EE4\u624B\u52A8\u6279\u51C6\uFF08\u6216\u62D2\u7EDD\uFF09\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42\uFF08CSR\uFF09\u3002 \u4F46\u662F\uFF0C\u5982\u679C\u4F60\u6253\u7B97\u5927\u91CF\u4F7F\u7528\u6B64 API\uFF0C\u5219\u53EF\u4EE5\u8003\u8651\u7F16\u5199\u81EA\u52A8\u5316\u7684\u8BC1\u4E66\u63A7\u5236\u5668\u3002</p><p><strong>\u6CE8\u610F\uFF1A</strong></p><p>\u6279\u51C6\u8BC1\u4E66 CSR \u7684\u80FD\u529B\u51B3\u5B9A\u4E86\u5728\u4F60\u7684\u73AF\u5883\u4E2D\u8C01\u4FE1\u4EFB\u8C01\u3002 \u4E0D\u5E94\u5E7F\u6CDB\u6216\u8F7B\u7387\u5730\u6388\u4E88\u6279\u51C6 CSR \u7684\u80FD\u529B\u3002</p><p>\u5728\u6388\u4E88 <code>approve</code> \u6743\u9650\u4E4B\u524D\uFF0C\u4F60\u5E94\u8BE5\u786E\u4FDD\u81EA\u5DF1\u5145\u5206\u4E86\u89E3\u6279\u51C6\u4EBA\u7684\u9A8C\u8BC1\u8981\u6C42<strong>\u548C</strong>\u9881\u53D1\u7279\u5B9A\u8BC1\u4E66\u7684\u540E\u679C\u3002</p><p>\u65E0\u8BBA\u4E0A\u8FF0\u673A\u5668\u6216\u4EBA\u4F7F\u7528 kubectl\uFF0C\u201C\u6279\u51C6\u8005\u201D\u7684\u4F5C\u7528\u662F\u9A8C\u8BC1 CSR \u6EE1\u8DB3\u5982\u4E0B\u4E24\u4E2A\u8981\u6C42\uFF1A</p><ol><li>CSR \u7684 subject \u63A7\u5236\u7528\u4E8E\u7B7E\u7F72 CSR \u7684\u79C1\u94A5\u3002\u8FD9\u89E3\u51B3\u4E86\u4F2A\u88C5\u6210\u6388\u6743\u4E3B\u4F53\u7684\u7B2C\u4E09\u65B9\u7684\u5A01\u80C1\u3002 \u5728\u4E0A\u8FF0\u793A\u4F8B\u4E2D\uFF0C\u6B64\u6B65\u9AA4\u5C06\u9A8C\u8BC1\u8BE5 Pod \u63A7\u5236\u4E86\u7528\u4E8E\u751F\u6210 CSR \u7684\u79C1\u94A5\u3002</li><li>CSR \u7684 subject \u88AB\u6388\u6743\u5728\u8BF7\u6C42\u7684\u4E0A\u4E0B\u6587\u4E2D\u6267\u884C\u3002 \u8FD9\u70B9\u7528\u4E8E\u5904\u7406\u4E0D\u671F\u671B\u7684\u4E3B\u4F53\u88AB\u52A0\u5165\u96C6\u7FA4\u7684\u5A01\u80C1\u3002 \u5728\u4E0A\u8FF0\u793A\u4F8B\u4E2D\uFF0C\u6B64\u6B65\u9AA4\u5C06\u662F\u9A8C\u8BC1\u8BE5 Pod \u662F\u5426\u88AB\u5141\u8BB8\u52A0\u5165\u5230\u6240\u8BF7\u6C42\u7684\u670D\u52A1\u4E2D\u3002</li></ol><p>\u5F53\u4E14\u4EC5\u5F53\u6EE1\u8DB3\u8FD9\u4E24\u4E2A\u8981\u6C42\u65F6\uFF0C\u5BA1\u6279\u8005\u5E94\u8BE5\u6279\u51C6 CSR\uFF0C\u5426\u5219\u62D2\u7EDD CSR\u3002</p>`,9),jn=s("\u6709\u5173\u8BC1\u4E66\u6279\u51C6\u548C\u8BBF\u95EE\u63A7\u5236\u7684\u66F4\u591A\u4FE1\u606F\uFF0C \u8BF7\u9605\u8BFB"),Gn={href:"https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/certificate-signing-requests/",target:"_blank",rel:"noopener noreferrer"},Un=s("\u8BC1\u4E66\u7B7E\u540D\u8BF7\u6C42"),Zn=s("\u53C2\u8003\u9875\u3002"),Wn=n("h2",{id:"\u624B\u52A8\u8F6E\u6362-ca-\u8BC1\u4E66",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u624B\u52A8\u8F6E\u6362-ca-\u8BC1\u4E66","aria-hidden":"true"},"#"),s(" \u624B\u52A8\u8F6E\u6362 CA \u8BC1\u4E66")],-1),Yn=n("p",null,[n("strong",null,"\u6CE8\u610F\uFF1A")],-1),Qn=n("p",null,"\u786E\u4FDD\u5907\u4EFD\u4F60\u7684\u8BC1\u4E66\u76EE\u5F55\u3001\u914D\u7F6E\u6587\u4EF6\u4EE5\u53CA\u5176\u4ED6\u5FC5\u8981\u6587\u4EF6\u3002",-1),Xn=n("p",null,"\u8FD9\u91CC\u7684\u65B9\u6CD5\u5047\u5B9A Kubernetes \u7684\u63A7\u5236\u9762\u901A\u8FC7\u8FD0\u884C\u591A\u4E2A API \u670D\u52A1\u5668\u4EE5\u9AD8\u53EF\u7528\u914D\u7F6E\u6A21\u5F0F\u8FD0\u884C\u3002 \u53E6\u4E00\u5047\u5B9A\u662F API \u670D\u52A1\u5668\u53EF\u4F53\u9762\u5730\u7EC8\u6B62\uFF0C\u56E0\u800C\u5BA2\u6237\u7AEF\u53EF\u4EE5\u5F7B\u5E95\u5730\u4E0E\u4E00\u4E2A API \u670D\u52A1\u5668\u65AD\u5F00 \u8FDE\u63A5\u5E76\u8FDE\u63A5\u5230\u53E6\u4E00\u4E2A API \u670D\u52A1\u5668\u3002",-1),$n=n("p",null,"\u5982\u679C\u96C6\u7FA4\u4E2D\u53EA\u6709\u4E00\u4E2A API \u670D\u52A1\u5668\uFF0C\u5219\u5728 API \u670D\u52A1\u5668\u91CD\u542F\u671F\u95F4\u4F1A\u7ECF\u5386\u670D\u52A1\u4E2D\u65AD\u671F\u3002",-1),Jn=n("li",null,[n("p",null,[s("\u5C06\u65B0\u7684 CA \u8BC1\u4E66\u548C\u79C1\u94A5\uFF08\u4F8B\u5982\uFF1A"),n("code",null,"ca.crt"),s("\u3001"),n("code",null,"ca.key"),s("\u3001"),n("code",null,"front-proxy-ca.crt"),s(" \u548C "),n("code",null,"front-proxy-client.key"),s("\uFF09\u5206\u53D1\u5230\u6240\u6709\u63A7\u5236\u9762\u8282\u70B9\uFF0C\u653E\u5728\u5176 Kubernetes \u8BC1\u4E66\u76EE\u5F55\u4E0B\u3002")])],-1),ns=s("\u66F4\u65B0 "),ss={href:"https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-controller-manager/",target:"_blank",rel:"noopener noreferrer"},es=s("kube-controller-manager"),as=s(" \u7684 "),ts=n("code",null,"--root-ca-file",-1),is=s(" \u6807\u5FD7\uFF0C\u4F7F\u4E4B\u540C\u65F6\u5305\u542B\u8001\u7684\u548C\u65B0\u7684 CA\uFF0C\u4E4B\u540E\u91CD\u542F kube-controller-manager\u3002"),ls=s("\u81EA\u6B64\u523B\u8D77\uFF0C\u6240\u521B\u5EFA\u7684\u6240\u6709"),cs={href:"https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-service-account/",target:"_blank",rel:"noopener noreferrer"},os=s("ServiceAccount"),ps=s(" \u90FD\u4F1A\u83B7\u5F97\u540C\u65F6\u5305\u542B\u8001\u7684 CA \u548C\u65B0\u7684 CA \u7684 Secret\u3002"),rs=n("h2",{id:"\u521B\u5EFA\u5916\u90E8\u8D1F\u8F7D\u5747\u8861\u5668",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u521B\u5EFA\u5916\u90E8\u8D1F\u8F7D\u5747\u8861\u5668","aria-hidden":"true"},"#"),s(" \u521B\u5EFA\u5916\u90E8\u8D1F\u8F7D\u5747\u8861\u5668")],-1),us=s("\u521B\u5EFA"),ds={href:"https://kubernetes.io/zh-cn/docs/concepts/services-networking/service/",target:"_blank",rel:"noopener noreferrer"},ks=s("\u670D\u52A1"),vs=s("\u65F6\uFF0C\u4F60\u53EF\u4EE5\u9009\u62E9\u81EA\u52A8\u521B\u5EFA\u4E91\u7F51\u7EDC\u8D1F\u8F7D\u5747\u8861\u5668\u3002 \u8D1F\u8F7D\u5747\u8861\u5668\u63D0\u4F9B\u5916\u90E8\u53EF\u8BBF\u95EE\u7684 IP \u5730\u5740\uFF0C\u53EF\u5C06\u6D41\u91CF\u53D1\u9001\u5230\u96C6\u7FA4\u8282\u70B9\u4E0A\u7684\u6B63\u786E\u7AEF\u53E3\u4E0A \uFF08"),ms=n("strong",null,"\u5047\u8BBE\u96C6\u7FA4\u5728\u652F\u6301\u7684\u73AF\u5883\u4E2D\u8FD0\u884C\uFF0C\u5E76\u914D\u7F6E\u4E86\u6B63\u786E\u7684\u4E91\u8D1F\u8F7D\u5747\u8861\u5668\u9A71\u52A8\u5305",-1),bs=s("\uFF09\u3002"),hs=t(`<h3 id="\u57FA\u4E8E\u6E05\u5355\u6587\u4EF6\u521B\u5EFA\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#\u57FA\u4E8E\u6E05\u5355\u6587\u4EF6\u521B\u5EFA\u670D\u52A1" aria-hidden="true">#</a> \u57FA\u4E8E\u6E05\u5355\u6587\u4EF6\u521B\u5EFA\u670D\u52A1</h3><p>\u8981\u521B\u5EFA\u5916\u90E8\u8D1F\u8F7D\u5747\u8861\u5668\uFF0C\u8BF7\u5C06\u4EE5\u4E0B\u5185\u5BB9\u6DFB\u52A0\u5230\u4F60\u7684 Service \u6E05\u5355\u6587\u4EF6\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>    <span class="token key atrule">type</span><span class="token punctuation">:</span> LoadBalancer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4F60\u7684\u6E05\u5355\u6587\u4EF6\u53EF\u80FD\u4F1A\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> example
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8765</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9376</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> LoadBalancer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u4F7F\u7528-kubectl-\u521B\u5EFA-service" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528-kubectl-\u521B\u5EFA-service" aria-hidden="true">#</a> \u4F7F\u7528 kubectl \u521B\u5EFA Service</h3><p>\u4F60\u4E5F\u53EF\u4EE5\u4F7F\u7528 <code>kubectl expose</code> \u547D\u4EE4\u53CA\u5176 <code>--type=LoadBalancer</code> \u53C2\u6570\u521B\u5EFA\u670D\u52A1\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl expose deployment example <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8765</span> --target-port<span class="token operator">=</span><span class="token number">9376</span> <span class="token punctuation">\\</span>
        <span class="token parameter variable">--name</span><span class="token operator">=</span>example-service <span class="token parameter variable">--type</span><span class="token operator">=</span>LoadBalancer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,8),gs=s("\u6B64\u547D\u4EE4\u901A\u8FC7\u4F7F\u7528\u4E0E\u5F15\u7528\u8D44\u6E90\uFF08\u5728\u4E0A\u9762\u7684\u793A\u4F8B\u7684\u60C5\u51B5\u4E0B\uFF0C\u540D\u4E3A "),_s=n("code",null,"example",-1),ys=s(" \u7684 "),fs={href:"https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/deployment/",target:"_blank",rel:"noopener noreferrer"},xs=s("Deployment"),Ss=s("\uFF09 \u76F8\u540C\u7684\u9009\u62E9\u5668\u6765\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684\u670D\u52A1\u3002"),Cs=t(`<h3 id="\u627E\u5230\u4F60\u7684-ip-\u5730\u5740" tabindex="-1"><a class="header-anchor" href="#\u627E\u5230\u4F60\u7684-ip-\u5730\u5740" aria-hidden="true">#</a> \u627E\u5230\u4F60\u7684 IP \u5730\u5740</h3><p>\u4F60\u53EF\u4EE5\u901A\u8FC7 <code>kubectl</code> \u83B7\u53D6\u670D\u52A1\u4FE1\u606F\uFF0C\u627E\u5230\u4E3A\u4F60\u7684\u670D\u52A1\u521B\u5EFA\u7684 IP \u5730\u5740\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl describe services example-service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD9\u5C06\u83B7\u5F97\u7C7B\u4F3C\u5982\u4E0B\u8F93\u51FA\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Name:                     example-service
Namespace:                default
Labels:                   <span class="token assign-left variable">app</span><span class="token operator">=</span>example
Annotations:              <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Selector:                 <span class="token assign-left variable">app</span><span class="token operator">=</span>example
Type:                     LoadBalancer
IP Families:              <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
IP:                       <span class="token number">10.3</span>.22.96
IPs:                      <span class="token number">10.3</span>.22.96
LoadBalancer Ingress:     <span class="token number">192.0</span>.2.89
Port:                     <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span>  <span class="token number">8765</span>/TCP
TargetPort:               <span class="token number">9376</span>/TCP
NodePort:                 <span class="token operator">&lt;</span>unset<span class="token operator">&gt;</span>  <span class="token number">30593</span>/TCP
Endpoints:                <span class="token number">172.17</span>.0.3:9376
Session Affinity:         None
External Traffic Policy:  Cluster
Events:                   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8D1F\u8F7D\u5747\u8861\u5668\u7684 IP \u5730\u5740\u5217\u5728 <code>LoadBalancer Ingress</code> \u65C1\u8FB9\u3002</p><p><strong>\u8BF4\u660E\uFF1A</strong></p><p>\u5982\u679C\u4F60\u5728 Minikube \u4E0A\u8FD0\u884C\u670D\u52A1\uFF0C\u4F60\u53EF\u4EE5\u901A\u8FC7\u4EE5\u4E0B\u547D\u4EE4\u627E\u5230\u5206\u914D\u7684 IP \u5730\u5740\u548C\u7AEF\u53E3\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>minikube <span class="token function">service</span> example-service <span class="token parameter variable">--url</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u4FDD\u7559\u5BA2\u6237\u7AEF\u6E90-ip" tabindex="-1"><a class="header-anchor" href="#\u4FDD\u7559\u5BA2\u6237\u7AEF\u6E90-ip" aria-hidden="true">#</a> \u4FDD\u7559\u5BA2\u6237\u7AEF\u6E90 IP</h3><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u76EE\u6807\u5BB9\u5668\u4E2D\u770B\u5230\u7684\u6E90 IP \u5C06<strong>\u4E0D\u662F\u5BA2\u6237\u7AEF\u7684\u539F\u59CB\u6E90 IP</strong>\u3002 \u8981\u542F\u7528\u4FDD\u7559\u5BA2\u6237\u7AEF IP\uFF0C\u53EF\u4EE5\u5728\u670D\u52A1\u7684 <code>.spec</code> \u4E2D\u914D\u7F6E\u4EE5\u4E0B\u5B57\u6BB5\uFF1A</p><ul><li><p><code>.spec.externalTrafficPolicy</code> - \u8868\u793A\u6B64 Service \u662F\u5426\u5E0C\u671B\u5C06\u5916\u90E8\u6D41\u91CF\u8DEF\u7531\u5230\u8282\u70B9\u672C\u5730\u6216\u96C6\u7FA4\u8303\u56F4\u7684\u7AEF\u70B9\u3002 \u6709\u4E24\u4E2A\u53EF\u7528\u9009\u9879\uFF1A<code>Cluster</code>\uFF08\u9ED8\u8BA4\uFF09\u548C <code>Local</code>\u3002 <code>Cluster</code> \u9690\u85CF\u4E86\u5BA2\u6237\u7AEF\u6E90 IP\uFF0C\u53EF\u80FD\u5BFC\u81F4\u7B2C\u4E8C\u8DF3\u5230\u53E6\u4E00\u4E2A\u8282\u70B9\uFF0C\u4F46\u5177\u6709\u826F\u597D\u7684\u6574\u4F53\u8D1F\u8F7D\u5206\u5E03\u3002 <code>Local</code> \u4FDD\u7559\u5BA2\u6237\u7AEF\u6E90 IP \u5E76\u907F\u514D LoadBalancer \u548C NodePort \u7C7B\u578B\u670D\u52A1\u7684\u7B2C\u4E8C\u8DF3\uFF0C \u4F46\u5B58\u5728\u6F5C\u5728\u7684\u4E0D\u5747\u8861\u6D41\u91CF\u4F20\u64AD\u98CE\u9669\u3002</p></li><li><p><code>.spec.healthCheckNodePort</code> - \u6307\u5B9A\u670D\u52A1\u7684 healthcheck nodePort\uFF08\u6570\u5B57\u7AEF\u53E3\u53F7\uFF09\u3002 \u5982\u679C\u4F60\u672A\u6307\u5B9A <code>healthCheckNodePort</code>\uFF0C\u670D\u52A1\u63A7\u5236\u5668\u4ECE\u96C6\u7FA4\u7684 NodePort \u8303\u56F4\u5185\u5206\u914D\u4E00\u4E2A\u7AEF\u53E3\u3002 \u4F60\u53EF\u4EE5\u901A\u8FC7\u8BBE\u7F6E API \u670D\u52A1\u5668\u7684\u547D\u4EE4\u884C\u9009\u9879 <code>--service-node-port-range</code> \u6765\u914D\u7F6E\u4E0A\u8FF0\u8303\u56F4\u3002 \u5728\u670D\u52A1 <code>type</code> \u8BBE\u7F6E\u4E3A LoadBalancer \u5E76\u4E14 <code>externalTrafficPolicy</code> \u8BBE\u7F6E\u4E3A <code>Local</code> \u65F6\uFF0C Service \u5C06\u4F1A\u4F7F\u7528\u7528\u6237\u6307\u5B9A\u7684 <code>healthCheckNodePort</code> \u503C\uFF08\u5982\u679C\u4F60\u6307\u5B9A\u4E86\u5B83\uFF09\u3002</p></li></ul><p>\u53EF\u4EE5\u901A\u8FC7\u5728\u670D\u52A1\u7684\u6E05\u5355\u6587\u4EF6\u4E2D\u5C06 <code>externalTrafficPolicy</code> \u8BBE\u7F6E\u4E3A Local \u6765\u6FC0\u6D3B\u6B64\u529F\u80FD\u3002\u6BD4\u5982\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> example<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> example
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8765</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9376</span>
  <span class="token key atrule">externalTrafficPolicy</span><span class="token punctuation">:</span> Local
  <span class="token key atrule">type</span><span class="token punctuation">:</span> LoadBalancer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E00\u4E9B\u4E91\u670D\u52A1\u4F9B\u5E94\u5546\u7684\u8D1F\u8F7D\u5747\u8861\u670D\u52A1\u4E0D\u5141\u8BB8\u4F60\u4E3A\u6BCF\u4E2A\u76EE\u6807\u914D\u7F6E\u4E0D\u540C\u7684\u6743\u91CD\u3002</p><p>\u7531\u4E8E\u6BCF\u4E2A\u76EE\u6807\u5728\u5411\u8282\u70B9\u53D1\u9001\u6D41\u91CF\u65B9\u9762\u7684\u6743\u91CD\u76F8\u540C\uFF0C\u56E0\u6B64\u5916\u90E8\u6D41\u91CF\u4E0D\u4F1A\u5728\u4E0D\u540C Pod \u4E4B\u95F4\u5E73\u5747\u8D1F\u8F7D\u3002 \u5916\u90E8\u8D1F\u8F7D\u5747\u8861\u5668\u4E0D\u77E5\u9053\u6BCF\u4E2A\u8282\u70B9\u4E0A\u7528\u4F5C\u76EE\u6807\u7684 Pod \u6570\u91CF\u3002</p><p>\u5728 <code>NumServicePods &lt;&lt; _NumNodes</code> \u6216 <code>NumServicePods &gt;&gt; NumNodes</code> \u65F6\uFF0C \u5373\u4F7F\u6CA1\u6709\u6743\u91CD\uFF0C\u4E5F\u4F1A\u770B\u5230\u63A5\u8FD1\u76F8\u7B49\u7684\u5206\u5E03\u3002</p><p>\u5185\u90E8 Pod \u5230 Pod \u7684\u6D41\u91CF\u5E94\u8BE5\u4E0E ClusterIP \u670D\u52A1\u7C7B\u4F3C\uFF0C\u6240\u6709 Pod \u7684\u6982\u7387\u76F8\u540C\u3002</p><h3 id="\u56DE\u6536\u8D1F\u8F7D\u5747\u8861\u5668" tabindex="-1"><a class="header-anchor" href="#\u56DE\u6536\u8D1F\u8F7D\u5747\u8861\u5668" aria-hidden="true">#</a> \u56DE\u6536\u8D1F\u8F7D\u5747\u8861\u5668</h3><p><strong>\u7279\u6027\u72B6\u6001\uFF1A</strong> <code>Kubernetes v1.17 [stable]</code></p><p>\u5728\u901A\u5E38\u60C5\u51B5\u4E0B\uFF0C\u5E94\u5728\u5220\u9664 LoadBalancer \u7C7B\u578B Service \u540E\u7ACB\u5373\u6E05\u9664\u4E91\u670D\u52A1\u4F9B\u5E94\u5546\u4E2D\u7684\u76F8\u5173\u8D1F\u8F7D\u5747\u8861\u5668\u8D44\u6E90\u3002 \u4F46\u662F\uFF0C\u4F17\u6240\u5468\u77E5\uFF0C\u5728\u5220\u9664\u5173\u8054\u7684\u670D\u52A1\u540E\uFF0C\u4E91\u8D44\u6E90\u88AB\u5B64\u7ACB\u7684\u60C5\u51B5\u5F88\u591A\u3002 \u5F15\u5165\u4E86\u9488\u5BF9\u670D\u52A1\u8D1F\u8F7D\u5747\u8861\u5668\u7684\u7EC8\u7ED3\u5668\u4FDD\u62A4\uFF0C\u4EE5\u9632\u6B62\u8FD9\u79CD\u60C5\u51B5\u53D1\u751F\u3002 \u901A\u8FC7\u4F7F\u7528\u7EC8\u7ED3\u5668\uFF0C\u5728\u5220\u9664\u76F8\u5173\u7684\u8D1F\u8F7D\u5747\u8861\u5668\u8D44\u6E90\u4E4B\u524D\uFF0C\u4E5F\u4E0D\u4F1A\u5220\u9664\u670D\u52A1\u8D44\u6E90\u3002</p><p>\u5177\u4F53\u6765\u8BF4\uFF0C\u5982\u679C\u670D\u52A1\u5177\u6709 <code>type</code> LoadBalancer\uFF0C\u5219\u670D\u52A1\u63A7\u5236\u5668\u5C06\u9644\u52A0\u4E00\u4E2A\u540D\u4E3A <code>service.kubernetes.io/load-balancer-cleanup</code> \u7684\u7EC8\u7ED3\u5668\u3002 \u4EC5\u5728\u6E05\u9664\u8D1F\u8F7D\u5747\u8861\u5668\u8D44\u6E90\u540E\u624D\u80FD\u5220\u9664\u7EC8\u7ED3\u5668\u3002 \u5373\u4F7F\u5728\u8BF8\u5982\u670D\u52A1\u63A7\u5236\u5668\u5D29\u6E83\u4E4B\u7C7B\u7684\u6781\u7AEF\u60C5\u51B5\u4E0B\uFF0C\u8FD9\u4E5F\u53EF\u4EE5\u9632\u6B62\u8D1F\u8F7D\u5747\u8861\u5668\u8D44\u6E90\u60AC\u7A7A\u3002</p><h3 id="\u5916\u90E8\u8D1F\u8F7D\u5747\u8861\u5668\u4F9B\u5E94\u5546" tabindex="-1"><a class="header-anchor" href="#\u5916\u90E8\u8D1F\u8F7D\u5747\u8861\u5668\u4F9B\u5E94\u5546" aria-hidden="true">#</a> \u5916\u90E8\u8D1F\u8F7D\u5747\u8861\u5668\u4F9B\u5E94\u5546</h3><p>\u8BF7\u52A1\u5FC5\u6CE8\u610F\uFF0C\u6B64\u529F\u80FD\u7684\u6570\u636E\u8DEF\u5F84\u7531 Kubernetes \u96C6\u7FA4\u5916\u90E8\u7684\u8D1F\u8F7D\u5747\u8861\u5668\u63D0\u4F9B\u3002</p><p>\u5F53\u670D\u52A1 <code>type</code> \u8BBE\u7F6E\u4E3A LoadBalancer \u65F6\uFF0CKubernetes \u5411\u96C6\u7FA4\u4E2D\u7684 Pod \u63D0\u4F9B\u7684\u529F\u80FD\u7B49\u540C\u4E8E <code>type</code> \u8BBE\u7F6E\u4E3A ClusterIP\uFF0C\u5E76\u901A\u8FC7\u4F7F\u7528\u6258\u7BA1\u4E86\u76F8\u5173 Kubernetes Pod \u7684\u8282\u70B9\u4F5C\u4E3A\u6761\u76EE\u5BF9\u8D1F\u8F7D\u5747\u8861\u5668 \uFF08\u4ECE\u5916\u90E8\u5230 Kubernetes\uFF09\u8FDB\u884C\u7F16\u7A0B\u6765\u6269\u5C55\u5B83\u3002 Kubernetes \u63A7\u5236\u5E73\u9762\u81EA\u52A8\u521B\u5EFA\u5916\u90E8\u8D1F\u8F7D\u5747\u8861\u5668\u3001\u5065\u5EB7\u68C0\u67E5\uFF08\u5982\u679C\u9700\u8981\uFF09\u548C\u5305\u8FC7\u6EE4\u89C4\u5219\uFF08\u5982\u679C\u9700\u8981\uFF09\u3002 \u4E00\u65E6\u4E91\u670D\u52A1\u4F9B\u5E94\u5546\u4E3A\u8D1F\u8F7D\u5747\u8861\u5668\u5206\u914D\u4E86 IP \u5730\u5740\uFF0C\u63A7\u5236\u5E73\u9762\u5C31\u4F1A\u67E5\u627E\u8BE5\u5916\u90E8 IP \u5730\u5740\u5E76\u5C06\u5176\u586B\u5145\u5230 Service \u5BF9\u8C61\u4E2D\u3002</p><h2 id="kubernetes-ingress-\u914D\u7F6E\u6CDB\u57DF\u540D-tls-\u8BC1\u4E66" tabindex="-1"><a class="header-anchor" href="#kubernetes-ingress-\u914D\u7F6E\u6CDB\u57DF\u540D-tls-\u8BC1\u4E66" aria-hidden="true">#</a> Kubernetes Ingress \u914D\u7F6E\u6CDB\u57DF\u540D TLS \u8BC1\u4E66</h2><p>\u8BA9 Ingress \u9AD8\u53EF\u7528\u53EF\u4EE5\u7528 LB\uFF0C \u5F53\u7136\u4E5F\u6709 Local \u7684\u65B9\u6CD5\uFF0C</p><p>\u8FD9\u91CC\u5F55\u4E86\u5229\u7528 <code>let&#39;s encrytp</code> \u6CDB\u57DF\u540D\u8BC1\u4E66\u5B9E\u73B0 Kubernetes \u96C6\u7FA4\u5916\u90E8\u670D\u52A1\u81EA\u52A8\u8BC1\u4E66\u914D\u7F6E\u548C\u8BC1\u4E66\u5230\u671F\u81EA\u52A8\u66F4\u65B0\uFF0C\u652F\u6301 HTTPS \u8BBF\u95EE\u3002\u6211\u4EEC\u8FD8\u90E8\u7F72\u4E86\u8BC1\u4E66\u81EA\u52A8\u5206\u53D1\u7EC4\u4EF6\uFF0C\u5B9E\u73B0\u8BC1\u4E66\u6587\u4EF6\u81EA\u52A8\u5206\u53D1\u5230\u5176\u4ED6 namespace \u3002</p><ul><li>\u521B\u5EFA Ingress \u9009\u7528 HTTPS \u76D1\u542C\u534F\u8BAE\u65F6\uFF0C\u9009\u7528\u5408\u9002\u7684\u670D\u52A1\u5668\u8BC1\u4E66\u80FD\u591F\u786E\u4FDD\u8BBF\u95EE\u5B89\u5168\u3002</li><li>\u4E3A\u6240\u6709\u7684 HTTPS \u57DF\u540D\u7ED1\u5B9A\u540C\u4E00\u4E2A\u8BC1\u4E66\uFF0C\u7B80\u5316\u914D\u7F6E Ingress \u4E0B\u6240\u6709 HTTPS \u89C4\u5219\u7684\u8BC1\u4E66\uFF0C\u4F7F\u66F4\u65B0\u64CD\u4F5C\u66F4\u52A0\u4FBF\u6377\u3002</li><li>\u4E3A\u4E0D\u540C\u7684\u57DF\u540D\u7ED1\u5B9A\u4E0D\u540C\u7684\u8BC1\u4E66\uFF0C\u6539\u5584\u670D\u52A1\u5668\u4E0E\u5BA2\u6237\u7AEF SSL/TLS\u3002</li></ul><p>\u5229\u7528 dnspod \u3001 cert-manager \u3001let\u2019s encrytp \u7B49\u5F00\u6E90\u7EC4\u4EF6\uFF0C\u5B9E\u73B0\u6CDB\u57DF\u540D\u8BC1\u4E66\u7684\u81EA\u52A8\u751F\u6210\u3001\u7EED\u671F\u7BA1\u7406\uFF0C\u4E3A\u73B0\u6709kubernetes \u96C6\u7FA4\u5E94\u7528\u542F\u52A8 HTTPS\uFF0C\u63D0\u9AD8\u7CFB\u7EDF\u5B89\u5168\u6027\u3002</p><p><strong>\u67B6\u6784:</strong></p><p>\u5728 Kubernetes \u96C6\u7FA4\u4E2D\u4F7F\u7528 HTTPS \u534F\u8BAE\uFF0C\u9700\u8981\u4E00\u4E2A\u8BC1\u4E66\u7BA1\u7406\u5668\u3001\u4E00\u4E2A\u8BC1\u4E66\u81EA\u52A8\u7B7E\u53D1\u670D\u52A1</p><p>cert-manager \u662F\u4E00\u4E2A\u4E91\u539F\u751F\u8BC1\u4E66\u7BA1\u7406\u5F00\u6E90\u9879\u76EE\uFF0C\u7528\u4E8E\u5728 Kubernetes \u96C6\u7FA4\u4E2D\u63D0\u4F9B HTTPS \u8BC1\u4E66\u5E76\u81EA\u52A8\u7EED\u671F\uFF0C\u652F\u6301 Let\u2019s Encrypt, HashiCorp Vault \u8FD9\u4E9B\u514D\u8D39\u8BC1\u4E66\u7684\u7B7E\u53D1\u3002\u5728Kubernetes\u96C6\u7FA4\u4E2D\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7 Kubernetes Ingress \u548C Let\u2019s Encrypt \u5B9E\u73B0\u5916\u90E8\u670D\u52A1\u7684\u81EA\u52A8\u5316 HTTPS\u3002</p><p><img src="http://sm.nsddd.top/sm202310122016285.png" alt="\u5728\u8FD9\u91CC\u63D2\u5165\u56FE\u7247\u63CF\u8FF0"></p><p>Issuers/ClusterIssuers\uFF1A\u5B9A\u4E49\u4F7F\u7528\u4EC0\u4E48\u8BC1\u4E66\u9881\u53D1\u673A\u6784 (CA) \u6765\u53BB\u9881\u53D1\u8BC1\u4E66\uFF0CIssuers \u548C ClusterIssuers \u533A\u522B\u662F\uFF1A issuers</p><p>\u662F\u4E00\u4E2A\u540D\u79F0\u7A7A\u95F4\u7EA7\u522B\u7684\u8D44\u6E90\uFF0C\u53EA\u80FD\u7528\u6765\u7B7E\u53D1\u81EA\u5DF1\u6240\u5728 namespace \u4E0B\u7684\u8BC1\u4E66\uFF0CClusterIssuer \u662F\u4E2A\u96C6\u7FA4\u7EA7\u522B\u7684\u8D44\u6E90 \u53EF\u4EE5\u7B7E\u53D1\u4EFB\u610F namespace \u4E0B\u7684\u8BC1\u4E66</p><p>Certificate\uFF1A\u5B9A\u4E49\u6240\u9700\u7684 X.509 \u8BC1\u4E66\uFF0C\u8BE5\u8BC1\u4E66\u5C06\u66F4\u65B0\u5E76\u4FDD\u6301\u6700\u65B0\u3002Certificate \u662F\u4E00\u4E2A\u547D\u540D\u7A7A\u95F4\u8D44\u6E90\uFF0C\u5F53 Certificate \u88AB\u521B\u5EFA\u65F6\uFF0C\u5B83\u4F1A\u53BB\u521B\u5EFA\u76F8\u5E94\u7684 CertificateRequest \u8D44\u6E90\u6765\u53BB\u7533\u8BF7\u8BC1\u4E66\u3002</p><h3 id="\u5B89\u88C5\u8BC1\u4E66\u7BA1\u7406\u5668" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5\u8BC1\u4E66\u7BA1\u7406\u5668" aria-hidden="true">#</a> \u5B89\u88C5\u8BC1\u4E66\u7BA1\u7406\u5668</h3><p>\u5B89\u88C5\u8BC1\u4E66\u7BA1\u7406\u5668\u6BD4\u8F83\u7B80\u5355\uFF0C\u76F4\u63A5\u6267\u884C\u4EE5\u4E0B\u811A\u672C\u5C31\u53EF\u4EE5\u4E86\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl create ns cert-manager
helm uninstall cert-manager <span class="token parameter variable">-n</span> cert-manager

helm <span class="token function">install</span> cert-manager jetstack/cert-manager <span class="token punctuation">\\</span>
	<span class="token parameter variable">-n</span> cert-manager <span class="token punctuation">\\</span>
	<span class="token parameter variable">--version</span> v1.8.0 <span class="token punctuation">\\</span>
	<span class="token parameter variable">--set</span> <span class="token assign-left variable">installCRDs</span><span class="token operator">=</span>true <span class="token punctuation">\\</span>
	<span class="token parameter variable">--set</span> <span class="token assign-left variable">prometheus.enabled</span><span class="token operator">=</span>false <span class="token punctuation">\\</span>
	<span class="token parameter variable">--set</span> <span class="token string">&#39;extraArgs={--dns01-recursive-nameservers-only,--dns01-recursive-nameservers=119.29.29.29:53\\,8.8.8.8:53}&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u9009\u62E9\u8BC1\u4E66\u9881\u53D1\u8005" tabindex="-1"><a class="header-anchor" href="#\u9009\u62E9\u8BC1\u4E66\u9881\u53D1\u8005" aria-hidden="true">#</a> \u9009\u62E9\u8BC1\u4E66\u9881\u53D1\u8005</h3><p>cert-manager\u652F\u6301\u4EE5\u4E0B\u51E0\u79CD\u8BC1\u4E66\u9881\u53D1\u8005</p><ul><li>SelfSigned</li><li>CA</li><li>Vault</li><li>Venafi</li><li>External</li><li>ACME \u6211\u4EEC\u9009\u62E9\u4F7F\u7528ACME\u6765\u9881\u53D1\u8BC1\u4E66\u3002</li></ul><h3 id="\u9009\u62E9\u8BC1\u4E66\u6821\u9A8C\u65B9\u5F0F" tabindex="-1"><a class="header-anchor" href="#\u9009\u62E9\u8BC1\u4E66\u6821\u9A8C\u65B9\u5F0F" aria-hidden="true">#</a> \u9009\u62E9\u8BC1\u4E66\u6821\u9A8C\u65B9\u5F0F</h3><p>\u5E38\u7528\u7684\u6821\u9A8C\u65B9\u5F0F\u6709 HTTP-01 \u3001DNS-01 \u3002</p><h4 id="dns-01-\u6821\u9A8C\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#dns-01-\u6821\u9A8C\u539F\u7406" aria-hidden="true">#</a> DNS-01 \u6821\u9A8C\u539F\u7406</h4><p>DNS-01 \u7684\u6821\u9A8C\u539F\u7406\u662F\u5229\u7528 DNS \u63D0\u4F9B\u5546\u7684 API Key \u62FF\u5230 DNS \u63A7\u5236\u6743\u9650\uFF0C \u5728 Let\u2019s Encrypt \u4E3A ACME \u5BA2\u6237\u7AEF\u63D0\u4F9B\u4EE4\u724C\u540E\uFF0CACME \u5BA2\u6237\u7AEF (cert-manager) \u5C06\u521B\u5EFA\u4ECE\u8BE5\u4EE4\u724C\u548C\u6211\u7684\u5E10\u6237\u5BC6\u94A5\u6D3E\u751F\u7684 TXT \u8BB0\u5F55\uFF0C\u5E76\u5C06\u8BE5\u8BB0\u5F55\u653E\u5728 _acme-challenge\u3002 \u7136\u540E Let\u2019s Encrypt \u5C06\u5411 DNS \u7CFB\u7EDF\u67E5\u8BE2\u8BE5\u8BB0\u5F55\uFF0C\u5982\u679C\u627E\u5230\u5339\u914D\u9879\uFF0C\u5C31\u53EF\u4EE5\u9881\u53D1\u8BC1\u4E66\u3002\u6B64\u65B9\u6CD5\u652F\u6301\u6CDB\u57DF\u540D\u8BC1\u4E66\u3002</p><h4 id="http-01-\u6821\u9A8C\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#http-01-\u6821\u9A8C\u539F\u7406" aria-hidden="true">#</a> HTTP-01 \u6821\u9A8C\u539F\u7406</h4>`,48),Ps=s("HTTP-01 \u7684\u6821\u9A8C\u539F\u7406\u662F\u7ED9\u57DF\u540D\u6307\u5411\u7684 HTTP \u670D\u52A1\u589E\u52A0\u4E00\u4E2A\u4E34\u65F6 location \uFF0CLet\u2019s Encrypt \u4F1A\u53D1\u9001 http \u8BF7\u6C42\uFF0C\u53C2\u6570\u4E2D YOUR_DOMAIN \u5C31\u662F\u88AB\u6821\u9A8C\u7684\u57DF\u540D\uFF0CTOKEN \u662F ACME \u534F\u8BAE\u7684\u5BA2\u6237\u7AEF\u8D1F\u8D23\u653E\u7F6E\u7684\u6587\u4EF6\uFF0CACME \u5BA2\u6237\u7AEF\u5C31\u662F cert-manager\uFF0C\u5B83\u901A\u8FC7\u4FEE\u6539\u6216\u521B\u5EFA "),Is={href:"https://so.csdn.net/so/search?q=Ingress&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"},Ts=s("Ingress"),Ns=s(" \u89C4\u5219\u6765\u589E\u52A0\u8FD9\u4E2A\u4E34\u65F6\u6821\u9A8C\u8DEF\u5F84\u5E76\u6307\u5411\u63D0\u4F9B TOKEN \u7684\u670D\u52A1\u3002Let\u2019s Encrypt \u4F1A\u5BF9\u6BD4 TOKEN \u662F\u5426\u7B26\u5408\u9884\u671F\uFF0C\u6821\u9A8C\u6210\u529F\u540E\u5C31\u4F1A\u9881\u53D1\u8BC1\u4E66\u3002\u6B64\u65B9\u6CD5\u4EC5\u9002\u7528\u4E8E\u7ED9\u4F7F\u7528 Ingress \u66B4\u9732\u6D41\u91CF\u7684\u670D\u52A1\u9881\u53D1\u8BC1\u4E66\uFF0C\u4E0D\u652F\u6301\u6CDB\u57DF\u540D\u8BC1\u4E66\u3002"),As=t(`<h3 id="\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E" aria-hidden="true">#</a> \u914D\u7F6E</h3><h4 id="http-01-\u914D\u7F6E\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#http-01-\u914D\u7F6E\u793A\u4F8B" aria-hidden="true">#</a> HTTP-01 \u914D\u7F6E\u793A\u4F8B</h4><p>\u8FD9\u4E2A\u914D\u7F6E\u793A\u4F8B\u4EC5\u4F9B\u53C2\u8003\uFF0C\u4F7F\u7528\u8FD9\u79CD\u65B9\u5F0F\uFF0C\u6709\u591A\u5C11\u7684 ingress \u670D\u52A1\uFF0C\u5C31\u9700\u8981\u7533\u8BF7\u591A\u5C11\u5F20\u8BC1\u4E66 \uFF0C\u6BD4\u8F83\u9EBB\u70E6\uFF0C\u4F46\u662F\u914D\u7F6E\u8F83\u4E3A\u7B80\u5355\uFF0C\u4E0D\u4F9D\u8D56 DNS \u670D\u52A1\u5546\u3002</p><h5 id="_1-\u521B\u5EFA-ca-\u7FA4\u96C6\u8BC1\u4E66\u9881\u53D1\u8005" tabindex="-1"><a class="header-anchor" href="#_1-\u521B\u5EFA-ca-\u7FA4\u96C6\u8BC1\u4E66\u9881\u53D1\u8005" aria-hidden="true">#</a> 1. \u521B\u5EFA CA \u7FA4\u96C6\u8BC1\u4E66\u9881\u53D1\u8005</h5><p>\u8BC1\u4E66\u7BA1\u7406\u5668\u9700\u8981 Issuer \u6216 ClusterIssuer \u8D44\u6E90\uFF0C\u624D\u80FD\u9881\u53D1\u8BC1\u4E66\u3002 \u8FD9\u4E24\u79CD Kubernetes \u8D44\u6E90\u7684\u529F\u80FD\u5B8C\u5168\u76F8\u540C\uFF0C\u533A\u522B\u5728\u4E8E Issuer \u9002\u7528\u4E8E\u5355\u4E00\u547D\u540D\u7A7A\u95F4\uFF0C\u800C ClusterIssuer \u9002\u7528\u4E8E\u6240\u6709\u547D\u540D\u7A7A\u95F4\u3002 <code>ClusterIssuer.yaml</code></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> cert<span class="token punctuation">-</span>manager.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterIssuer
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> letsencrypt
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">acme</span><span class="token punctuation">:</span>
    <span class="token key atrule">email</span><span class="token punctuation">:</span> xxxx@xyz.cn
    <span class="token key atrule">server</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//acme<span class="token punctuation">-</span>v02.api.letsencrypt.org/directory
    <span class="token key atrule">privateKeySecretRef</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> issuer<span class="token punctuation">-</span>account<span class="token punctuation">-</span>key
    <span class="token key atrule">solvers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">http01</span><span class="token punctuation">:</span>
        <span class="token key atrule">ingress</span><span class="token punctuation">:</span>
          <span class="token key atrule">class</span><span class="token punctuation">:</span> nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8BF4\u660E\uFF1A</p><ul><li><code>metadata.name</code>: \u662F\u6211\u4EEC\u521B\u5EFA\u7684\u7B7E\u53D1\u673A\u6784\u7684\u540D\u79F0\uFF0C\u540E\u9762\u6211\u4EEC\u521B\u5EFA\u8BC1\u4E66\u7684\u65F6\u5019\u4F1A\u5F15\u7528\u5B83</li><li><code>spec.acme.email</code>: \u662F\u4F60\u81EA\u5DF1\u7684\u90AE\u7BB1\uFF0C\u8BC1\u4E66\u5FEB\u8FC7\u671F\u7684\u65F6\u5019\u4F1A\u6709\u90AE\u4EF6\u63D0\u9192\uFF0C\u4E0D\u8FC7 cert-manager \u4F1A\u5229\u7528 acme \u534F\u8BAE\u81EA\u52A8\u7ED9\u6211\u4EEC\u91CD\u65B0\u9881\u53D1\u8BC1\u4E66\u6765\u7EED\u671F</li><li><code>spec.acme.server</code>: \u662F acme \u534F\u8BAE\u7684\u670D\u52A1\u7AEF\uFF0C\u6211\u4EEC\u4F7F\u7528 Let\u2019s Encrypt</li><li><code>spec.acme.privateKeySecretRef</code>: \u6307\u793A\u6B64\u7B7E\u53D1\u673A\u6784\u7684\u79C1\u94A5\u5C06\u8981\u5B58\u50A8\u5230\u54EA\u4E2A Secret \u5BF9\u8C61\u4E2D</li><li><code>spec.acme.solvers</code>: \u8FD9\u91CC\u6307\u793A\u7B7E\u53D1\u673A\u6784\u6821\u9A8C\u65B9\u5F0F\uFF0C\u6709 http01 \u548C dns01 \u4E24\u79CD\uFF0C\u8BE5\u5B57\u6BB5\u4E0B\u914D\u7F6E\u7684 class \u548C name \u53EA\u80FD\u540C\u65F6\u5B58\u5728\u4E00\u4E2A\uFF0C class \u6307\u5B9A\u4F7F\u7528\u7684 ingress class \u540D\u79F0\uFF0C name \u6BD4\u8F83\u5C11\u7528\uFF0C\u901A\u5E38\u7528\u4E8E kubernetes \u7684 ingress\u3002</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> ClusterIssuer.yaml <span class="token parameter variable">-n</span> cert-manager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_2-\u521B\u5EFA-ingress-\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_2-\u521B\u5EFA-ingress-\u670D\u52A1" aria-hidden="true">#</a> 2. \u521B\u5EFA ingress \u670D\u52A1</h5><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">cert-manager.io/cluster-issuer</span><span class="token punctuation">:</span> letsencrypt
    <span class="token key atrule">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>wikijs
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ingressClassName</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> wiki.xyz.cn
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">service</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> wikijs
            <span class="token key atrule">port</span><span class="token punctuation">:</span>
              <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">3000</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /
        <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
  <span class="token key atrule">tls</span><span class="token punctuation">:</span> 
  <span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> wikijs.xyz.cn
    <span class="token key atrule">secretName</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>wikijs<span class="token punctuation">-</span>tls
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CE8\u610F\uFF1A</p><p>\u5728 annotations \u91CC \u8BBE\u7F6E<code>cert-manager.io/cluster-issuer</code> \u4E3A\u7B7E\u540D\u521B\u5EFA\u7684\u96C6\u7FA4\u8BC1\u4E66\u9881\u53D1\u8005 <code>letsencrypt</code></p><p>\u4F7F\u7528 yaml \u6587\u4EF6\u521B\u5EFA ingress \u540E\uFF0C\u5C31\u53EF\u4EE5\u4F7F\u7528\u8BE5 ingress \u5BF9\u5916\u63D0\u4F9B https \u670D\u52A1\u4E86\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># \u521B\u5EFA ingress</span>
kubectl apply <span class="token punctuation">-</span>f ingress<span class="token punctuation">-</span>wikijs.yaml <span class="token punctuation">-</span>n infra
<span class="token comment"># \u67E5\u770B\u8BC1\u4E66\u662F\u5426\u81EA\u52A8\u521B\u5EFA\u6210\u529F</span>
kubectl <span class="token punctuation">-</span>n infra  get certificate
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="dns01\u914D\u7F6E\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#dns01\u914D\u7F6E\u793A\u4F8B" aria-hidden="true">#</a> DNS01\u914D\u7F6E\u793A\u4F8B</h4><p>\u4F7F\u7528\u8FD9\u79CD\u65B9\u5F0F\u9700\u8981 DNS \u670D\u52A1\u5546\u652F\u6301\u901A\u8FC7 API \u521B\u5EFA DNS \u8BB0\u5F55\uFF0C\u6B63\u597D\u6211\u7684 DNS \u670D\u52A1\u5546\u662F dnspod \u652F\u6301\uFF0C\u56E0\u6B64\u5728\u6211\u4EEC\u7684\u53CA\u7FA4\u91CC\uFF0C\u6700\u7EC8\u91C7\u7528\u4E86\u8FD9\u79CD\u65B9\u5F0F\u3002</p><p>\u8FD9\u4E2A\u65B9\u5F0F\u7684\u914D\u7F6E\u4F1A\u6BD4\u8F83\u9EBB\u70E6\uFF0C\u8E29\u4E86\u5F88\u4E45\u7684\u5751\uFF0C\u4E3B\u8981\u662F\u56E0\u4E3A\u6211\u7684\u96C6\u7FA4\u542F\u7528\u4E86\u672C\u5730 DNS \u670D\u52A1\u5668\uFF0C\u9ED8\u8BA4 cert-manager \u4F1A\u901A\u8FC7\u672C\u5730 DNS \u670D\u52A1\u5668\u53BB\u9A8C\u8BC1\u901A\u8FC7 API \u521B\u5EFA\u7684 DNS txt\u8BB0\u5F55\uFF0C\u4F1A\u4E00\u76F4\u68C0\u67E5\u4E0D\u5230\u65B0\u589E\u7684 txt \u8BB0\u5F55\uFF0C\u9020\u6210\u5728 challenge \u9636\u6BB5\u5C31\u4E00\u76F4 pendding\u3002\u89E3\u51B3\u65B9\u6848\u9644\u540E\u3002</p><h5 id="_1-\u5728-dnspod-\u521B\u5EFA-api-id-\u548C-api-token" tabindex="-1"><a class="header-anchor" href="#_1-\u5728-dnspod-\u521B\u5EFA-api-id-\u548C-api-token" aria-hidden="true">#</a> 1. \u5728 dnspod \u521B\u5EFA API ID \u548C API Token</h5><p>\u53C2\u8003dnspod \u4E91\u5B98\u65B9\u6587\u6863 \u8BB0\u5F55\u4E0B\u521B\u5EFA\u7684 API ID \u548C API Token \u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>&lt;API ID <span class="token punctuation">&gt;</span>
&lt;API Token<span class="token punctuation">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-\u5B89\u88C5-cert-manager-webhook-dnspod" tabindex="-1"><a class="header-anchor" href="#_2-\u5B89\u88C5-cert-manager-webhook-dnspod" aria-hidden="true">#</a> 2. \u5B89\u88C5 cert-manager-webhook-dnspod</h5><p>\u4F7F\u7528 helm \u5B89\u88C5 roc/cert-manager-webhook-dnspod\u3002</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>helm repo add roc https<span class="token punctuation">:</span>//charts.imroc.cc

helm uninstall cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>dnspod <span class="token punctuation">-</span>n cert<span class="token punctuation">-</span>manager
helm install cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>dnspod roc/cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>dnspod \\
    <span class="token punctuation">-</span>n cert<span class="token punctuation">-</span>manager \\
    <span class="token punctuation">-</span><span class="token punctuation">-</span>set clusterIssuer.secretId=&lt;API ID <span class="token punctuation">&gt;</span> \\
    <span class="token punctuation">-</span><span class="token punctuation">-</span>set clusterIssuer.secretKey=&lt;API Token<span class="token punctuation">&gt;</span> \\
    <span class="token punctuation">-</span><span class="token punctuation">-</span>set clusterIssuer.email=xxxx@xyz.cn
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-\u521B\u5EFA\u6CDB\u57DF\u540D\u8BC1\u4E66" tabindex="-1"><a class="header-anchor" href="#_3-\u521B\u5EFA\u6CDB\u57DF\u540D\u8BC1\u4E66" aria-hidden="true">#</a> 3. \u521B\u5EFA\u6CDB\u57DF\u540D\u8BC1\u4E66</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>xyz-crt.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> cert<span class="token punctuation">-</span>manager.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Certificate
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> xyz<span class="token punctuation">-</span>crt
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">secretName</span><span class="token punctuation">:</span> xyz<span class="token punctuation">-</span>crt
  <span class="token key atrule">issuerRef</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> dnspod
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterIssuer
    <span class="token key atrule">group</span><span class="token punctuation">:</span> cert<span class="token punctuation">-</span>manager.io
  <span class="token key atrule">dnsNames</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;*.xyz.cn&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-\u9A8C\u8BC1\u8BC1\u4E66" tabindex="-1"><a class="header-anchor" href="#_4-\u9A8C\u8BC1\u8BC1\u4E66" aria-hidden="true">#</a> 4. \u9A8C\u8BC1\u8BC1\u4E66</h5><p>\u67E5\u770B\u8BC1\u4E66\u662F\u5426\u521B\u5EFA\u6210\u529F</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ks<span class="token punctuation">-</span>master infra<span class="token punctuation">]</span><span class="token comment"># kubectl get Certificate -n cert-manager</span>
NAME                                      READY   SECRET                                    AGE
cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>dnspod<span class="token punctuation">-</span>ca            True    cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>dnspod<span class="token punctuation">-</span>ca            18m
cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>dnspod<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>tls   True    cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>dnspod<span class="token punctuation">-</span>webhook<span class="token punctuation">-</span>tls   18m
xyz<span class="token punctuation">-</span>crt                             True    xyz<span class="token punctuation">-</span>crt                             3m12s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE5\u4E0A\u53EF\u4EE5\u770B\u51FA xyz-crt \u5DF2\u7ECF\u521B\u5EFA\u6210\u529F\uFF0C READY \u72B6\u6001\u4E5F\u662F True\u3002</p><p>\u67E5\u770B\u8BC1\u4E66\u5BF9\u5E94\u7684\u57DF\u540D</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@ks<span class="token punctuation">-</span>master infra<span class="token punctuation">]</span><span class="token comment"># kubectl describe Certificate xyz-crt -n cert-manager</span>
<span class="token key atrule">Name</span><span class="token punctuation">:</span>         xyz<span class="token punctuation">-</span>crt
<span class="token key atrule">Namespace</span><span class="token punctuation">:</span>    cert<span class="token punctuation">-</span>manager
<span class="token key atrule">Labels</span><span class="token punctuation">:</span>       &lt;none<span class="token punctuation">&gt;</span>
<span class="token key atrule">Annotations</span><span class="token punctuation">:</span>  &lt;none<span class="token punctuation">&gt;</span>
<span class="token key atrule">API Version</span><span class="token punctuation">:</span>  cert<span class="token punctuation">-</span>manager.io/v1
<span class="token key atrule">Kind</span><span class="token punctuation">:</span>         Certificate
<span class="token key atrule">Metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">Creation Timestamp</span><span class="token punctuation">:</span>  <span class="token datetime number">2022-05-07T14:19:07Z</span>
  <span class="token key atrule">Generation</span><span class="token punctuation">:</span>          <span class="token number">1</span>
  <span class="token key atrule">Managed Fields</span><span class="token punctuation">:</span>
    <span class="token key atrule">API Version</span><span class="token punctuation">:</span>  cert<span class="token punctuation">-</span>manager.io/v1
    <span class="token key atrule">Fields Type</span><span class="token punctuation">:</span>  FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:status</span><span class="token punctuation">:</span>
        <span class="token key atrule">.</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:conditions</span><span class="token punctuation">:</span>
    <span class="token key atrule">Manager</span><span class="token punctuation">:</span>      cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>certificates<span class="token punctuation">-</span>trigger
    <span class="token key atrule">Operation</span><span class="token punctuation">:</span>    Update
    <span class="token key atrule">Subresource</span><span class="token punctuation">:</span>  status
    <span class="token key atrule">Time</span><span class="token punctuation">:</span>         <span class="token datetime number">2022-05-07T14:19:07Z</span>
    <span class="token key atrule">API Version</span><span class="token punctuation">:</span>  cert<span class="token punctuation">-</span>manager.io/v1
    <span class="token key atrule">Fields Type</span><span class="token punctuation">:</span>  FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:metadata</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:annotations</span><span class="token punctuation">:</span>
          <span class="token key atrule">.</span><span class="token punctuation">:</span>
          <span class="token key atrule">f:kubectl.kubernetes.io/last-applied-configuration</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:spec</span><span class="token punctuation">:</span>
        <span class="token key atrule">.</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:dnsNames</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:issuerRef</span><span class="token punctuation">:</span>
          <span class="token key atrule">.</span><span class="token punctuation">:</span>
          <span class="token key atrule">f:group</span><span class="token punctuation">:</span>
          <span class="token key atrule">f:kind</span><span class="token punctuation">:</span>
          <span class="token key atrule">f:name</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:secretName</span><span class="token punctuation">:</span>
    <span class="token key atrule">Manager</span><span class="token punctuation">:</span>      kubectl<span class="token punctuation">-</span>client<span class="token punctuation">-</span>side<span class="token punctuation">-</span>apply
    <span class="token key atrule">Operation</span><span class="token punctuation">:</span>    Update
    <span class="token key atrule">Time</span><span class="token punctuation">:</span>         <span class="token datetime number">2022-05-07T14:19:07Z</span>
    <span class="token key atrule">API Version</span><span class="token punctuation">:</span>  cert<span class="token punctuation">-</span>manager.io/v1
    <span class="token key atrule">Fields Type</span><span class="token punctuation">:</span>  FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:status</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:revision</span><span class="token punctuation">:</span>
    <span class="token key atrule">Manager</span><span class="token punctuation">:</span>      cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>certificates<span class="token punctuation">-</span>issuing
    <span class="token key atrule">Operation</span><span class="token punctuation">:</span>    Update
    <span class="token key atrule">Subresource</span><span class="token punctuation">:</span>  status
    <span class="token key atrule">Time</span><span class="token punctuation">:</span>         <span class="token datetime number">2022-05-07T14:19:14Z</span>
    <span class="token key atrule">API Version</span><span class="token punctuation">:</span>  cert<span class="token punctuation">-</span>manager.io/v1
    <span class="token key atrule">Fields Type</span><span class="token punctuation">:</span>  FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:status</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:conditions</span><span class="token punctuation">:</span>
          k<span class="token punctuation">:</span><span class="token punctuation">{</span>&quot;type&quot;<span class="token punctuation">:</span><span class="token string">&quot;Ready&quot;</span><span class="token punctuation">}</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span>
            <span class="token key atrule">f:lastTransitionTime</span><span class="token punctuation">:</span>
            <span class="token key atrule">f:message</span><span class="token punctuation">:</span>
            <span class="token key atrule">f:observedGeneration</span><span class="token punctuation">:</span>
            <span class="token key atrule">f:reason</span><span class="token punctuation">:</span>
            <span class="token key atrule">f:status</span><span class="token punctuation">:</span>
            <span class="token key atrule">f:type</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:notAfter</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:notBefore</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:renewalTime</span><span class="token punctuation">:</span>
    <span class="token key atrule">Manager</span><span class="token punctuation">:</span>         cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>certificates<span class="token punctuation">-</span>readiness
    <span class="token key atrule">Operation</span><span class="token punctuation">:</span>       Update
    <span class="token key atrule">Subresource</span><span class="token punctuation">:</span>     status
    <span class="token key atrule">Time</span><span class="token punctuation">:</span>            <span class="token datetime number">2022-05-07T14:19:14Z</span>
  <span class="token key atrule">Resource Version</span><span class="token punctuation">:</span>  <span class="token number">4784901</span>
  <span class="token key atrule">UID</span><span class="token punctuation">:</span>               f2c9be82<span class="token punctuation">-</span>f4cb<span class="token punctuation">-</span>4243<span class="token punctuation">-</span>b2c3<span class="token punctuation">-</span>19f64242cc91
<span class="token key atrule">Spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">Dns Names</span><span class="token punctuation">:</span>
    <span class="token important">*.xyz.cn</span>
  <span class="token key atrule">Issuer Ref</span><span class="token punctuation">:</span>
    <span class="token key atrule">Group</span><span class="token punctuation">:</span>      cert<span class="token punctuation">-</span>manager.io
    <span class="token key atrule">Kind</span><span class="token punctuation">:</span>       ClusterIssuer
    <span class="token key atrule">Name</span><span class="token punctuation">:</span>       dnspod
  <span class="token key atrule">Secret Name</span><span class="token punctuation">:</span>  xyz<span class="token punctuation">-</span>crt
<span class="token key atrule">Status</span><span class="token punctuation">:</span>
  <span class="token key atrule">Conditions</span><span class="token punctuation">:</span>
    <span class="token key atrule">Last Transition Time</span><span class="token punctuation">:</span>  <span class="token datetime number">2022-05-07T14:19:14Z</span>
    <span class="token key atrule">Message</span><span class="token punctuation">:</span>               Certificate is up to date and has not expired
    <span class="token key atrule">Observed Generation</span><span class="token punctuation">:</span>   <span class="token number">1</span>
    <span class="token key atrule">Reason</span><span class="token punctuation">:</span>                Ready
    <span class="token key atrule">Status</span><span class="token punctuation">:</span>                <span class="token boolean important">True</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span>                  Ready
  <span class="token key atrule">Not After</span><span class="token punctuation">:</span>               <span class="token datetime number">2022-08-05T13:19:11Z</span>
  <span class="token key atrule">Not Before</span><span class="token punctuation">:</span>              <span class="token datetime number">2022-05-07T13:19:12Z</span>
  <span class="token key atrule">Renewal Time</span><span class="token punctuation">:</span>            <span class="token datetime number">2022-07-06T13:19:11Z</span>
  <span class="token key atrule">Revision</span><span class="token punctuation">:</span>                <span class="token number">1</span>
<span class="token key atrule">Events</span><span class="token punctuation">:</span>
  Type    Reason     Age    From                                       Message
  <span class="token punctuation">---</span><span class="token punctuation">-</span>    <span class="token punctuation">---</span><span class="token punctuation">---</span>     <span class="token punctuation">---</span><span class="token punctuation">-</span>   <span class="token punctuation">---</span><span class="token punctuation">-</span>                                       <span class="token punctuation">---</span><span class="token punctuation">---</span><span class="token punctuation">-</span>
  Normal  Issuing    4m35s  cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>certificates<span class="token punctuation">-</span>trigger          Issuing certificate as Secret does not exist
  Normal  Generated  4m35s  cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>certificates<span class="token punctuation">-</span>key<span class="token punctuation">-</span>manager      Stored new private key in temporary Secret resource &quot;xyz<span class="token punctuation">-</span>crt<span class="token punctuation">-</span>4ml59&quot;
  Normal  Requested  4m35s  cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>certificates<span class="token punctuation">-</span>request<span class="token punctuation">-</span>manager  Created new CertificateRequest resource &quot;xyz<span class="token punctuation">-</span>crt<span class="token punctuation">-</span>r76wp&quot;
  Normal  Issuing    4m28s  cert<span class="token punctuation">-</span>manager<span class="token punctuation">-</span>certificates<span class="token punctuation">-</span>issuing          The certificate has been successfully issued
<span class="token punctuation">[</span>root@ks<span class="token punctuation">-</span>master infra<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE Certificate \u7684\u63CF\u8FF0\u4FE1\u606F\u53EF\u4EE5\u770B\u5230\uFF0C\u8FD9\u4E2A\u8BC1\u4E66\u662F\u5BF9\u5E94\u6240\u6709 *.xyz.cn \u7684\u6CDB\u57DF\u540D\u3002\u6240\u4EE5\u53EF\u4EE5\u76F4\u63A5\u7528\u5728\u96C6\u7FA4\u7684\u4EFB\u4F55\u5730\u65B9\u3002</p><p>\u67E5\u770B\u8BC1\u4E66\u5185\u5BB9</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@ks-master infra]# kubectl describe secret xyz-crt -n cert-manager
Name:         xyz-crt
Namespace:    cert-manager
Labels:       &lt;none&gt;
Annotations:  cert-manager.io/alt-names: *.xyz.cn
              cert-manager.io/certificate-name: xyz-crt
              cert-manager.io/common-name: *.xyz.cn
              cert-manager.io/ip-sans: 
              cert-manager.io/issuer-group: cert-manager.io
              cert-manager.io/issuer-kind: ClusterIssuer
              cert-manager.io/issuer-name: dnspod
              cert-manager.io/uri-sans: 

Type:  kubernetes.io/tls

Data
====
tls.crt:  5587 bytes
tls.key:  1675 bytes

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TLS \u8BC1\u4E66\u4FDD\u5B58\u5728 cert-manager \u547D\u540D\u7A7A\u95F4\u91CC\u7684 xyz-crt secret\u3002\u53EF\u4EE5\u4F9B\u6240\u6709 *.xyz.cn \u7684\u670D\u52A1\u4F7F\u7528\u3002</p><h5 id="\u5176\u4ED6" tabindex="-1"><a class="header-anchor" href="#\u5176\u4ED6" aria-hidden="true">#</a> \u5176\u4ED6</h5><p>\u8FD9\u4E2A\u8FC7\u7A0B\u4E2D\uFF0C\u6700\u5927\u7684\u5751\u662F\uFF0C\u6211\u7684\u96C6\u7FA4\u4F7F\u7528\u4E86\u81EA\u5EFA\u7684 DNS \u670D\u52A1\u5668\uFF0C\u9ED8\u8BA4 cert-manager \u4F1A\u4F7F\u7528\u8FD9\u4E2A\u96C6\u7FA4\u7684\u81EA\u5EFA DNS SERVER \u8FDB\u884C\u8BC1\u4E66\u53D1\u884C\u7684\u9A8C\u8BC1\uFF0C\u867D\u7136\u901A\u8FC7\u8C03\u7528 dnspod \u7684 webook \u5728 \u817E\u8BAF\u4E91 DNS \u670D\u52A1\u5668\u4E0A\u521B\u5EFA\u7684 _acme-challenge \u63E1\u624B\u6570\u636E\uFF0C\u4F46\u662F\u5728\u6211\u7684 \u81EA\u5EFA DNS \u91CC\u662F\u67E5\u4E0D\u5230\u7684\uFF0C\u6240\u4EE5\u4F1A\u4E00\u76F4\u5361 pending \u72B6\u6001\uFF0C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ks-master infra<span class="token punctuation">]</span><span class="token comment"># kubectl get challenge -A</span>
NAMESPACE      NAME                                       STATE     DOMAIN         AGE
cert-manager   xyz-crt-f9kp6-381578565-136350475    pending   xyz.cn   24s

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u770B\u539F\u56E0\u662F\uFF1A <code>Waiting for DNS-01 challenge propagation: DNS record for &quot;xyz.cn&quot; not yet</code></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@ks-master infra]# kcm describe challenge xyz-crt-f9kp6-381578565-136350475
Name:         xyz-crt-f9kp6-381578565-136350475
Namespace:    cert-manager
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
API Version:  acme.cert-manager.io/v1
Kind:         Challenge
---
\u4E2D\u95F4\u7565
---
Status:
  Presented:   true
  Processing:  true
  Reason:      Waiting for DNS-01 challenge propagation: DNS record for &quot;xyz.cn&quot; not yet propagated
  State:       pending
Events:
  Type    Reason     Age   From                     Message
  ----    ------     ----  ----                     -------
  Normal  Started    41s   cert-manager-challenges  Challenge scheduled for processing
  Normal  Presented  39s   cert-manager-challenges  Presented challenge using DNS-01 challenge mechanism

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u67E5\u4E86\u5F88\u591A\u8D44\u6599\uFF0C\u5728\u5B98\u7F51\u4E0A\u627E\u5230\u89E3\u51B3\u65B9\u6848\u3002\u529E\u6CD5\u662F\u8BA9 cert-manager \u5F3A\u5236\u4F7F\u7528\u6307\u5B9A\u7684 DNS \u670D\u52A1\u5668\u8FDB\u884C\u63E1\u624B\u9A8C\u8BC1\u3002</p><p>\u6211\u662F\u7528\u7684\u662F helm \u5B89\u88C5 cert-manager\uFF0C\u6240\u4EE5\u6DFB\u52A0\u4E00\u4E0B set \u53C2\u6570</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>	<span class="token punctuation">-</span><span class="token punctuation">-</span>set &#39;extraArgs=<span class="token punctuation">{</span><span class="token punctuation">-</span><span class="token punctuation">-</span>dns01<span class="token punctuation">-</span>recursive<span class="token punctuation">-</span>nameservers<span class="token punctuation">-</span>only<span class="token punctuation">,</span><span class="token punctuation">-</span><span class="token punctuation">-</span>dns01<span class="token punctuation">-</span>recursive<span class="token punctuation">-</span>nameservers=119.29.29.29<span class="token punctuation">:</span>53\\<span class="token punctuation">,</span>8.8.8.8<span class="token punctuation">:</span><span class="token number">53</span><span class="token punctuation">}</span>&#39;    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="\u4F7F\u7528-tls-\u8BC1\u4E66\u914D\u7F6E-ingress" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528-tls-\u8BC1\u4E66\u914D\u7F6E-ingress" aria-hidden="true">#</a> \u4F7F\u7528 TLS \u8BC1\u4E66\u914D\u7F6E ingress</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> wikijs
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> infra
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">nginx.ingress.kubernetes.io/proxy-body-size</span><span class="token punctuation">:</span> <span class="token string">&#39;0&#39;</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ingressClassName</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">tls</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> wiki.xyz.cn
      <span class="token key atrule">secretName</span><span class="token punctuation">:</span> xyz<span class="token punctuation">-</span>crt
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> wiki.xyz.cn
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
            <span class="token key atrule">pathType</span><span class="token punctuation">:</span> ImplementationSpecific
            <span class="token key atrule">backend</span><span class="token punctuation">:</span>
              <span class="token key atrule">service</span><span class="token punctuation">:</span>
                <span class="token key atrule">name</span><span class="token punctuation">:</span> wikijs
                <span class="token key atrule">port</span><span class="token punctuation">:</span>
                  <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">3000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE5\u4E0A\u914D\u7F6E\u5B8C\u6210\u540E\uFF0C\u5C31\u53EF\u4EE5\u4F7F\u7528 https \u6765\u8BBF\u95EE\u65B0\u7684 wiki.js \u670D\u52A1\u4E86\u3002</p><h2 id="let-s-encrypt" tabindex="-1"><a class="header-anchor" href="#let-s-encrypt" aria-hidden="true">#</a> Let\u2019s Encrypt</h2>`,49),Es=s("\u4E3A\u4E86\u5728\u60A8\u7684\u7F51\u7AD9\u4E0A\u542F\u7528 HTTPS\uFF0C\u60A8\u9700\u8981\u4ECE\u8BC1\u4E66\u9881\u53D1\u673A\u6784\uFF08CA\uFF09\u83B7\u53D6\u8BC1\u4E66\uFF08\u4E00\u79CD\u6587\u4EF6\uFF09\u3002 Let\u2019s Encrypt \u6B63\u662F\u5176\u4E2D\u4E00\u5BB6\u8BC1\u4E66\u9881\u53D1\u673A\u6784\u3002 \u8981\u4ECE Let\u2019s Encrypt \u83B7\u53D6\u60A8\u7F51\u7AD9\u57DF\u540D\u7684\u8BC1\u4E66\uFF0C\u60A8\u5FC5\u987B\u8BC1\u660E\u60A8\u5BF9\u57DF\u540D\u7684\u5B9E\u9645\u63A7\u5236\u6743\u3002 \u8FD9\u4E00\u8FC7\u7A0B\u901A\u5E38\u7531 Web \u4E3B\u673A\u4E0A\u8FD0\u884C\u7684 "),qs={href:"https://tools.ietf.org/html/rfc8555",target:"_blank",rel:"noopener noreferrer"},Rs=s("ACME \u534F\u8BAE"),zs=s("\u5BA2\u6237\u7AEF\u5B8C\u6210\u3002"),Ls=s("\u7533\u8BF7\u8BC1\u4E66\u7684\u6700\u4F73\u65B9\u5F0F\u53D6\u51B3\u4E8E\u60A8\u662F\u5426\u5177\u5907\u670D\u52A1\u5668\u7684"),ws={href:"https://en.wikipedia.org/wiki/Shell_account",target:"_blank",rel:"noopener noreferrer"},Ds=s("\u547D\u4EE4\u884C\u8BBF\u95EE\u6743\u9650"),Ms=s("\uFF08\u4E5F\u79F0\u4E3A SSH \u6743\u9650\uFF09\u3002 \u5982\u679C\u60A8\u4EC5\u4F7F\u7528\u63A7\u5236\u9762\u677F\uFF08\u4F8B\u5982 "),Ks={href:"https://cpanel.net/",target:"_blank",rel:"noopener noreferrer"},Os=s("cPanel"),Fs=s("\u3001"),Vs={href:"https://www.plesk.com/",target:"_blank",rel:"noopener noreferrer"},Bs=s("Plesk"),Hs=s(" \u6216 "),js={href:"https://wordpress.org/",target:"_blank",rel:"noopener noreferrer"},Gs=s("WordPress"),Us=s("\uFF09\u7BA1\u7406\u60A8\u7684\u7F51\u7AD9\uFF0C\u60A8\u5F88\u6709\u53EF\u80FD\u6CA1\u6709\u547D\u4EE4\u884C\u8BBF\u95EE\u6743\u9650\u3002 \u60A8\u53EF\u4EE5\u8054\u7CFB\u60A8\u7684\u6258\u7BA1\u670D\u52A1\u63D0\u4F9B\u5546\u786E\u8BA4\u3002"),Zs=n("h3",{id:"\u62E5\u6709\u547D\u4EE4\u884C\u8BBF\u95EE\u6743\u9650",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#\u62E5\u6709\u547D\u4EE4\u884C\u8BBF\u95EE\u6743\u9650","aria-hidden":"true"},"#"),s(" \u62E5\u6709\u547D\u4EE4\u884C\u8BBF\u95EE\u6743\u9650")],-1),Ws=s("\u6211\u4EEC\u5EFA\u8BAE\u5927\u591A\u6570\u5177\u6709\u547D\u4EE4\u884C\u8BBF\u95EE\u6743\u9650\u7684\u4EBA\u4F7F\u7528 "),Ys={href:"https://certbot.eff.org/",target:"_blank",rel:"noopener noreferrer"},Qs=s("Certbot"),Xs=s(" ACME \u5BA2\u6237\u7AEF\u3002 \u5B83\u53EF\u4EE5\u5728\u4E0D\u4E0B\u7EBF\u60A8\u7684\u670D\u52A1\u5668\u7684\u524D\u63D0\u4E0B\u81EA\u52A8\u6267\u884C\u8BC1\u4E66\u9881\u53D1\u548C\u5B89\u88C5\u3002 \u5BF9\u4E8E\u4E0D\u9700\u8981\u81EA\u52A8\u914D\u7F6E\u7684\u7528\u6237\uFF0CCertbot \u8FD8\u63D0\u4F9B\u4E13\u5BB6\u6A21\u5F0F\u3002 \u5B83\u6613\u4E8E\u4F7F\u7528\uFF0C\u9002\u7528\u4E8E\u8BB8\u591A\u64CD\u4F5C\u7CFB\u7EDF\uFF0C\u5E76\u4E14\u5177\u6709\u51FA\u8272\u7684\uFF08\u6CE8\uFF1A\u82F1\u6587\uFF09\u6587\u6863\u3002 \u524D\u5F80 "),$s={href:"https://certbot.eff.org/",target:"_blank",rel:"noopener noreferrer"},Js=s("Certbot \u5B98\u7F51"),ne=s("\u5373\u53EF\u83B7\u53D6\u9488\u5BF9\u5404\u7C7B\u64CD\u4F5C\u7CFB\u7EDF\u4E0E\u670D\u52A1\u5668\u8F6F\u4EF6\u7684\u4F7F\u7528\u8BF4\u660E\u3002"),se=s("\u5982\u679C "),ee={href:"https://certbot.eff.org/",target:"_blank",rel:"noopener noreferrer"},ae=s("Certbot"),te=s(" \u4E0D\u80FD\u6EE1\u8DB3\u60A8\u7684\u9700\u6C42\uFF0C\u6216\u8005\u60A8\u60F3\u5C1D\u8BD5\u522B\u7684\u5BA2\u6237\u7AEF\uFF0C\u8FD8\u6709"),ie={href:"https://letsencrypt.org/zh-cn/docs/client-options/",target:"_blank",rel:"noopener noreferrer"},le=s("\u66F4\u591A ACME \u5BA2\u6237\u7AEF"),ce=s("\u53EF\u4F9B\u9009\u62E9\u3002 \u9009\u5B9A ACME \u5BA2\u6237\u7AEF\u8F6F\u4EF6\u540E\uFF0C\u8BF7\u53C2\u9605\u8BE5\u5BA2\u6237\u7AEF\u7684\u6587\u6863\u3002"),oe=n("h2",{id:"end-\u94FE\u63A5",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#end-\u94FE\u63A5","aria-hidden":"true"},"#"),s(" END \u94FE\u63A5")],-1),pe=n("ul",null,[n("li",null,[n("div",null,[n("a",{href:"76.md",style:{float:"left"}},"\u2B06\uFE0F\u4E0A\u4E00\u8282\u{1F517} "),n("a",{href:"78.md",style:{float:"right"}}," \uFE0F\u4E0B\u4E00\u8282\u{1F517}")])])],-1),re=s("\u24C2\uFE0F\u56DE\u5230\u76EE\u5F55\u{1F3E0}"),ue={href:"https://nsddd.top/archives/contributors",target:"_blank",rel:"noopener noreferrer"},de=n("strong",null,"\u{1FAF5}\u53C2\u4E0E\u8D21\u732E\u{1F49E}\u2764\uFE0F\u200D\u{1F525}\u{1F496}",-1),ke=s(")"),ve=s("\u2734\uFE0F\u7248\u6743\u58F0\u660E \xA9 \uFF1A\u672C\u4E66\u6240\u6709\u5185\u5BB9\u9075\u5FAA"),me={href:"http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},be=s("CC-BY-SA 3.0\u534F\u8BAE\uFF08\u7F72\u540D-\u76F8\u540C\u65B9\u5F0F\u5171\u4EAB\uFF09\xA9");function he(ge,_e){const a=i("ExternalLinkIcon"),l=i("RouterLink");return o(),p("div",null,[n("ul",null,[n("li",null,[n("a",d,[k,e(a)])])]),v,m,b,n("blockquote",null,[n("p",null,[h,n("a",g,[_,e(a)])])]),y,f,x,S,n("p",null,[C,P,n("a",I,[T,e(a)]),N]),A,n("p",null,[E,n("a",q,[R,e(a)]),z,n("a",L,[w,e(a)]),D,M,K]),n("blockquote",null,[O,F,n("p",null,[V,n("a",B,[H,e(a)]),j])]),G,U,n("blockquote",null,[n("p",null,[Z,W,n("a",Y,[Q,e(a)]),X])]),$,n("p",null,[J,n("a",nn,[sn,e(a)]),en,an,tn,ln,cn]),on,n("p",null,[pn,rn,un,dn,kn,vn,mn,bn,hn,n("a",gn,[_n,e(a)]),yn]),fn,n("p",null,[n("a",xn,[Sn,e(a)]),Cn,Pn,In]),Tn,n("p",null,[Nn,An,En,qn,Rn,n("a",zn,[Ln,e(a)]),wn]),Dn,n("p",null,[Mn,Kn,On,n("a",Fn,[Vn,e(a)]),Bn]),Hn,n("p",null,[jn,n("a",Gn,[Un,e(a)]),Zn]),Wn,Yn,Qn,Xn,$n,n("ol",null,[Jn,n("li",null,[n("p",null,[ns,n("a",ss,[es,e(a)]),as,ts,is]),n("p",null,[ls,n("a",cs,[os,e(a)]),ps])])]),rs,n("p",null,[us,n("a",ds,[ks,e(a)]),vs,ms,bs]),hs,n("p",null,[gs,_s,ys,n("a",fs,[xs,e(a)]),Ss]),Cs,n("p",null,[Ps,n("a",Is,[Ts,e(a)]),Ns]),As,n("p",null,[Es,n("a",qs,[Rs,e(a)]),zs]),n("p",null,[Ls,n("a",ws,[Ds,e(a)]),Ms,n("a",Ks,[Os,e(a)]),Fs,n("a",Vs,[Bs,e(a)]),Hs,n("a",js,[Gs,e(a)]),Us]),Zs,n("p",null,[Ws,n("a",Ys,[Qs,e(a)]),Xs,n("a",$s,[Js,e(a)]),ne]),n("p",null,[se,n("a",ee,[ae,e(a)]),te,n("a",ie,[le,e(a)]),ce]),oe,pe,n("ul",null,[n("li",null,[n("p",null,[e(l,{to:"/"},{default:r(()=>[re]),_:1})])]),n("li",null,[n("p",null,[n("a",ue,[de,e(a)]),ke])]),n("li",null,[n("p",null,[ve,n("a",me,[be,e(a)])])])])])}const fe=c(u,[["render",he],["__file","77.html.vue"]]);export{fe as default};
